typeof window<"u"&&function(){window.console=window.console||{};for(var e=window.console,t,r,i={},n=function(){},a="memory".split(","),o="assert,clear,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profiles,profileEnd,show,table,time,timeEnd,timeline,timelineEnd,timeStamp,trace,warn".split(",");t=a.pop();)e[t]||(e[t]=i);for(;r=o.pop();)e[r]||(e[r]=n)}();typeof window.HTMLCanvasElement<"u"&&!window.HTMLCanvasElement.prototype.toBlob&&Object.defineProperty(window.HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,r){for(var i=window.atob(this.toDataURL(t,r).split(",")[1]),n=i.length,a=n>>2,o=new Uint8Array(n),s=new Uint32Array(o.buffer,0,a),u=0,c=0;u<a;u++)s[u]=i.charCodeAt(c++)|i.charCodeAt(c++)<<8|i.charCodeAt(c++)<<16|i.charCodeAt(c++)<<24;for(var f=n&3;f--;)o[c]=i.charCodeAt(c++);e(new window.Blob([o],{type:t||"image/png"}))}});Math.cbrt=Math.cbrt||function(e){var t=Math.pow(Math.abs(e),.3333333333333333);return e<0?-t:t};Math.sign||(Math.sign=function(e){return e=+e,e===0||isNaN(e)?Number(e):e>0?1:-1});Number.isInteger||(Number.isInteger=function(t){return typeof t=="number"&&isFinite(t)&&t>-9007199254740992&&t<9007199254740992&&Math.floor(t)===t});Number.isNaN||(Number.isNaN=function(t){return t!==t});Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=arguments;if(e==null)throw new TypeError("Cannot convert first argument to object");for(var r=Object(e),i=!1,n,a=1;a<arguments.length;a++){var o=t[a];if(o!=null){for(var s=Object.keys(Object(o)),u=0,c=s.length;u<c;u++){var f=s[u];try{var l=Object.getOwnPropertyDescriptor(o,f);l!==void 0&&l.enumerable&&(r[f]=o[f])}catch(h){i||(i=!0,n=h)}}if(i)throw n}}return r}});if(!String.prototype.startsWith){/*! https://mths.be/startswith v0.2.0 by @mathias */(function(){var e=function(){var i;try{var n={},a=Object.defineProperty;i=a(n,n,n)&&a}catch{}return i}(),t={}.toString,r=function(i){if(this===null)throw TypeError();var n=String(this);if(i&&t.call(i)==="[object RegExp]")throw TypeError();var a=n.length,o=String(i),s=o.length,u=arguments.length>1?arguments[1]:void 0,c=u?Number(u):0;Number.isNaN(c)&&(c=0);var f=Math.min(Math.max(c,0),a);if(s+f>a)return!1;for(var l=-1;++l<s;)if(n.charCodeAt(f+l)!==o.charCodeAt(l))return!1;return!0};e?e(String.prototype,"startsWith",{value:r,configurable:!0,writable:!0}):String.prototype.startsWith=r})()}String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var r=this.toString();(typeof t!="number"||!isFinite(t)||Math.floor(t)!==t||t>r.length)&&(t=r.length),t-=e.length;var i=r.indexOf(e,t);return i!==-1&&i===t});String.prototype.repeat||(String.prototype.repeat=function(e){if(this===null)throw new TypeError("can't convert "+this+" to object");var t=""+this;if(e=+e,Number.isNaN(e)&&(e=0),e<0)throw new RangeError("repeat count must be non-negative");if(e===1/0)throw new RangeError("repeat count must be less than infinity");if(e=Math.floor(e),t.length===0||e===0)return"";if(t.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");for(var r="";(e&1)===1&&(r+=t),e>>>=1,e!==0;)t+=t;return r});String.prototype.includes||(String.prototype.includes=function(e,t){return typeof t!="number"&&(t=0),t+e.length>this.length?!1:this.indexOf(e,t)!==-1});Array.prototype.includes||(Array.prototype.includes=function(e){if(this==null)throw new TypeError("Array.prototype.includes called on null or undefined");var t=Object(this),r=parseInt(t.length,10)||0;if(r===0)return!1;var i=parseInt(arguments[1],10)||0,n;i>=0?n=i:(n=r+i,n<0&&(n=0));for(var a;n<r;){if(a=t[n],e===a||Number.isNaN(e)&&Number.isNaN(a))return!0;n++}return!1});Array.from||(Array.from=function(){var e=Object.prototype.toString,t=function(a){return typeof a=="function"||e.call(a)==="[object Function]"},r=function(a){var o=Number(a);return isNaN(o)?0:o===0||!isFinite(o)?o:(o>0?1:-1)*Math.floor(Math.abs(o))},i=Math.pow(2,53)-1,n=function(a){var o=r(a);return Math.min(Math.max(o,0),i)};return function(o){var s=this,u=Object(o);if(o==null)throw new TypeError("Array.from requires an array-like object - not null or undefined");var c=arguments.length>1?arguments[1]:void 0,f;if(typeof c<"u"){if(!t(c))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(f=arguments[2])}for(var l=n(u.length),h=t(s)?Object(new s(l)):new Array(l),d=0,p;d<l;)p=u[d],c?h[d]=typeof f>"u"?c(p,d):c.call(f,p,d):h[d]=p,d+=1;return h.length=l,h}}());typeof window<"u"&&function(){for(var e=0,t=["ms","moz","webkit","o"],r=0;r<t.length&&!window.requestAnimationFrame;++r)window.requestAnimationFrame=window[t[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[r]+"CancelAnimationFrame"]||window[t[r]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(i){var n=new Date().getTime(),a=Math.max(0,16-(n-e)),o=window.setTimeout(function(){var s=n+a;i(s)},a);return e=n+a,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(i){clearTimeout(i)})}();Function.prototype.name===void 0&&Object.defineProperty!==void 0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}});typeof window<"u"&&(window.performance===void 0&&(self.performance={}),window.performance.now===void 0&&function(){var e=Date.now();window.performance.now=function(){return Date.now()-e}}());Object.defineProperty!==void 0&&(Number.MAX_SAFE_INTEGER===void 0&&Object.defineProperty(Number,"MAX_SAFE_INTEGER",{enumerable:!1,configurable:!1,writable:!1,value:Math.pow(2,53)-1}),Number.MIN_SAFE_INTEGER===void 0&&Object.defineProperty(Number,"MIN_SAFE_INTEGER",{enumerable:!1,configurable:!1,writable:!1,value:-(Math.pow(2,53)-1)}));function w1(e){var t=this.constructor;return this.then(function(r){return t.resolve(e()).then(function(){return r})},function(r){return t.resolve(e()).then(function(){return t.reject(r)})})}var A1=setTimeout;function S1(){}function M1(e,t){return function(){e.apply(t,arguments)}}function Mr(e){if(!(this instanceof Mr))throw new TypeError("Promises must be constructed via new");if(typeof e!="function")throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],ug(e,this)}function sg(e,t){for(;e._state===3;)e=e._value;if(e._state===0){e._deferreds.push(t);return}e._handled=!0,Mr._immediateFn(function(){var r=e._state===1?t.onFulfilled:t.onRejected;if(r===null){(e._state===1?Ph:Ds)(t.promise,e._value);return}var i;try{i=r(e._value)}catch(n){Ds(t.promise,n);return}Ph(t.promise,i)})}function Ph(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&(typeof t=="object"||typeof t=="function")){var r=t.then;if(t instanceof Mr){e._state=3,e._value=t,Th(e);return}else if(typeof r=="function"){ug(M1(r,t),e);return}}e._state=1,e._value=t,Th(e)}catch(i){Ds(e,i)}}function Ds(e,t){e._state=2,e._value=t,Th(e)}function Th(e){e._state===2&&e._deferreds.length===0&&Mr._immediateFn(function(){e._handled||Mr._unhandledRejectionFn(e._value)});for(var t=0,r=e._deferreds.length;t<r;t++)sg(e,e._deferreds[t]);e._deferreds=null}function C1(e,t,r){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.promise=r}function ug(e,t){var r=!1;try{e(function(i){r||(r=!0,Ph(t,i))},function(i){r||(r=!0,Ds(t,i))})}catch(i){if(r)return;r=!0,Ds(t,i)}}Mr.prototype.catch=function(e){return this.then(null,e)};Mr.prototype.then=function(e,t){var r=new this.constructor(S1);return sg(this,new C1(e,t,r)),r};Mr.prototype.finally=w1;Mr.all=function(e){return new Mr(function(t,r){if(!e||typeof e.length>"u")throw new TypeError("Promise.all accepts an array");var i=Array.prototype.slice.call(e);if(i.length===0)return t([]);var n=i.length;function a(s,u){try{if(u&&(typeof u=="object"||typeof u=="function")){var c=u.then;if(typeof c=="function"){c.call(u,function(f){a(s,f)},r);return}}i[s]=u,--n===0&&t(i)}catch(f){r(f)}}for(var o=0;o<i.length;o++)a(o,i[o])})};Mr.resolve=function(e){return e&&typeof e=="object"&&e.constructor===Mr?e:new Mr(function(t){t(e)})};Mr.reject=function(e){return new Mr(function(t,r){r(e)})};Mr.race=function(e){return new Mr(function(t,r){for(var i=0,n=e.length;i<n;i++)e[i].then(t,r)})};Mr._immediateFn=typeof setImmediate=="function"&&function(e){setImmediate(e)}||function(e){A1(e,0)};Mr._unhandledRejectionFn=function(t){typeof console<"u"&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};Number.EPSILON===void 0&&(Number.EPSILON=Math.pow(2,-52));Number.isInteger===void 0&&(Number.isInteger=function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e});Math.sign===void 0&&(Math.sign=function(e){return e<0?-1:e>0?1:+e});"name"in Function.prototype||Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}});Object.assign===void 0&&function(){Object.assign=function(e){var t=arguments;if(e==null)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),i=1;i<arguments.length;i++){var n=t[i];if(n!=null)for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])}return r}}();function fa(){}Object.assign(fa.prototype,{addEventListener:function(e,t){this._listeners===void 0&&(this._listeners={});var r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)},hasEventListener:function(e,t){if(this._listeners===void 0)return!1;var r=this._listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1},removeEventListener:function(e,t){if(this._listeners!==void 0){var r=this._listeners,i=r[e];if(i!==void 0){var n=i.indexOf(t);n!==-1&&i.splice(n,1)}}},dispatchEvent:function(e){var t=this;if(this._listeners!==void 0){var r=this._listeners,i=r[e.type];if(i!==void 0){e.target=this;for(var n=i.slice(0),a=0,o=n.length;a<o;a++)n[a].call(t,e)}}}});var P1="95",T1=0,Dp=1,E1=2,cg=1,I1=2,Mu=0,ni=1,Ra=2,fg=1,lg=0,hg=1,Tn=2,Ec=0,$n=1,xd=2,dg=3,pg=4,vg=5,mg=100,R1=101,L1=102,xl=103,_l=104,O1=200,D1=201,F1=202,B1=203,gg=204,yg=205,N1=206,k1=207,z1=208,U1=209,G1=210,H1=0,V1=1,W1=2,Eh=3,j1=4,X1=5,q1=6,Y1=7,Df=0,Z1=1,K1=2,wl=0,bg=1,J1=2,Q1=3,$1=4,_d=300,wd=301,Ih=302,xg=303,Rh=304,_g=305,Ad=306,Sd=307,Jn=1e3,bi=1001,mo=1002,vr=1003,Md=1004,Cd=1005,Dr=1006,wg=1007,Ff=1008,Fs=1009,eb=1010,tb=1011,Ic=1012,rb=1013,Ag=1014,go=1015,Pd=1016,ib=1017,nb=1018,ab=1019,Rc=1020,ob=1021,Bs=1022,zi=1023,sb=1024,ub=1025,lo=1026,Ns=1027,Fp=33776,Bp=33777,Np=33778,kp=33779,zp=35840,Up=35841,Gp=35842,Hp=35843,cb=36196,fb=37808,lb=37809,hb=37810,db=37811,pb=37812,vb=37813,mb=37814,gb=37815,yb=37816,bb=37817,xb=37818,_b=37819,wb=37820,Ab=37821,Sb=2200,Mb=2201,Cb=2202,Lc=2300,_c=2301,Al=2302,yo=2400,uo=2401,Oc=2402,Sg=0,Pb=1,Tb=2,Dc=3e3,Eb=3001,Mg=3007,Ib=3002,Rb=3004,Lb=3005,Ob=3006,Db=3200,Fb=3201,Td=0,Bb=1,Pt={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var i=Math.random()*4294967295|0,n=Math.random()*4294967295|0,a=Math.random()*4294967295|0,o=Math.random()*4294967295|0,s=e[i&255]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]+"-"+e[n&255]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[a&63|128]+e[a>>8&255]+"-"+e[a>>16&255]+e[a>>24&255]+e[o&255]+e[o>>8&255]+e[o>>16&255]+e[o>>24&255];return s.toUpperCase()}}(),clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,i,n){return i+(e-t)*(n-i)/(r-t)},lerp:function(e,t,r){return(1-r)*e+r*t},smoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t),e*e*(3-2*e))},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t),e*e*e*(e*(e*6-15)+10))},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Pt.DEG2RAD},radToDeg:function(e){return e*Pt.RAD2DEG},isPowerOfTwo:function(e){return(e&e-1)===0&&e!==0},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};function Ee(e,t){this.x=e||0,this.y=t||0}Object.defineProperties(Ee.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}});Object.assign(Ee.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(){var e=new Ee,t=new Ee;return function(i,n){return e.set(i,i),t.set(n,n),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,r){return r!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var r=Math.cos(t),i=Math.sin(t),n=this.x-e.x,a=this.y-e.y;return this.x=n*r-a*i+e.x,this.y=n*i+a*r+e.y,this}});function Ae(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Ae.prototype,{isMatrix4:!0,set:function(e,t,r,i,n,a,o,s,u,c,f,l,h,d,p,v){var m=this.elements;return m[0]=e,m[4]=t,m[8]=r,m[12]=i,m[1]=n,m[5]=a,m[9]=o,m[13]=s,m[2]=u,m[6]=c,m[10]=f,m[14]=l,m[3]=h,m[7]=d,m[11]=p,m[15]=v,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return new Ae().fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:function(){var e=new I;return function(r){var i=this.elements,n=r.elements,a=1/e.setFromMatrixColumn(r,0).length(),o=1/e.setFromMatrixColumn(r,1).length(),s=1/e.setFromMatrixColumn(r,2).length();return i[0]=n[0]*a,i[1]=n[1]*a,i[2]=n[2]*a,i[3]=0,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[7]=0,i[8]=n[8]*s,i[9]=n[9]*s,i[10]=n[10]*s,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,i=e.y,n=e.z,a=Math.cos(r),o=Math.sin(r),s=Math.cos(i),u=Math.sin(i),c=Math.cos(n),f=Math.sin(n);if(e.order==="XYZ"){var l=a*c,h=a*f,d=o*c,p=o*f;t[0]=s*c,t[4]=-s*f,t[8]=u,t[1]=h+d*u,t[5]=l-p*u,t[9]=-o*s,t[2]=p-l*u,t[6]=d+h*u,t[10]=a*s}else if(e.order==="YXZ"){var v=s*c,m=s*f,g=u*c,x=u*f;t[0]=v+x*o,t[4]=g*o-m,t[8]=a*u,t[1]=a*f,t[5]=a*c,t[9]=-o,t[2]=m*o-g,t[6]=x+v*o,t[10]=a*s}else if(e.order==="ZXY"){var v=s*c,m=s*f,g=u*c,x=u*f;t[0]=v-x*o,t[4]=-a*f,t[8]=g+m*o,t[1]=m+g*o,t[5]=a*c,t[9]=x-v*o,t[2]=-a*u,t[6]=o,t[10]=a*s}else if(e.order==="ZYX"){var l=a*c,h=a*f,d=o*c,p=o*f;t[0]=s*c,t[4]=d*u-h,t[8]=l*u+p,t[1]=s*f,t[5]=p*u+l,t[9]=h*u-d,t[2]=-u,t[6]=o*s,t[10]=a*s}else if(e.order==="YZX"){var y=a*s,b=a*u,_=o*s,w=o*u;t[0]=s*c,t[4]=w-y*f,t[8]=_*f+b,t[1]=f,t[5]=a*c,t[9]=-o*c,t[2]=-u*c,t[6]=b*f+_,t[10]=y-w*f}else if(e.order==="XZY"){var y=a*s,b=a*u,_=o*s,w=o*u;t[0]=s*c,t[4]=-f,t[8]=u*c,t[1]=y*f+w,t[5]=a*c,t[9]=b*f-_,t[2]=_*f-b,t[6]=o*c,t[10]=w*f+y}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(){var e=new I(0,0,0),t=new I(1,1,1);return function(i){return this.compose(e,i,t)}}(),lookAt:function(){var e=new I,t=new I,r=new I;return function(n,a,o){var s=this.elements;return r.subVectors(n,a),r.lengthSq()===0&&(r.z=1),r.normalize(),e.crossVectors(o,r),e.lengthSq()===0&&(Math.abs(o.z)===1?r.x+=1e-4:r.z+=1e-4,r.normalize(),e.crossVectors(o,r)),e.normalize(),t.crossVectors(r,e),s[0]=e.x,s[4]=t.x,s[8]=r.x,s[1]=e.y,s[5]=t.y,s[9]=r.y,s[2]=e.z,s[6]=t.z,s[10]=r.z,this}}(),multiply:function(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,i=t.elements,n=this.elements,a=r[0],o=r[4],s=r[8],u=r[12],c=r[1],f=r[5],l=r[9],h=r[13],d=r[2],p=r[6],v=r[10],m=r[14],g=r[3],x=r[7],y=r[11],b=r[15],_=i[0],w=i[4],A=i[8],S=i[12],M=i[1],E=i[5],T=i[9],H=i[13],X=i[2],q=i[6],Z=i[10],Q=i[14],N=i[3],D=i[7],W=i[11],L=i[15];return n[0]=a*_+o*M+s*X+u*N,n[4]=a*w+o*E+s*q+u*D,n[8]=a*A+o*T+s*Z+u*W,n[12]=a*S+o*H+s*Q+u*L,n[1]=c*_+f*M+l*X+h*N,n[5]=c*w+f*E+l*q+h*D,n[9]=c*A+f*T+l*Z+h*W,n[13]=c*S+f*H+l*Q+h*L,n[2]=d*_+p*M+v*X+m*N,n[6]=d*w+p*E+v*q+m*D,n[10]=d*A+p*T+v*Z+m*W,n[14]=d*S+p*H+v*Q+m*L,n[3]=g*_+x*M+y*X+b*N,n[7]=g*w+x*E+y*q+b*D,n[11]=g*A+x*T+y*Z+b*W,n[15]=g*S+x*H+y*Q+b*L,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new I;return function(r){for(var i=this,n=0,a=r.count;n<a;n++)e.x=r.getX(n),e.y=r.getY(n),e.z=r.getZ(n),e.applyMatrix4(i),r.setXYZ(n,e.x,e.y,e.z);return r}}(),determinant:function(){var e=this.elements,t=e[0],r=e[4],i=e[8],n=e[12],a=e[1],o=e[5],s=e[9],u=e[13],c=e[2],f=e[6],l=e[10],h=e[14],d=e[3],p=e[7],v=e[11],m=e[15];return d*(+n*s*f-i*u*f-n*o*l+r*u*l+i*o*h-r*s*h)+p*(+t*s*h-t*u*l+n*a*l-i*a*h+i*u*c-n*s*c)+v*(+t*u*f-t*o*h-n*a*f+r*a*h+n*o*c-r*u*c)+m*(-i*o*c-t*s*f+t*o*l+i*a*f-r*a*l+r*s*c)},transpose:function(){var e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var r=this.elements,i=e.elements,n=i[0],a=i[1],o=i[2],s=i[3],u=i[4],c=i[5],f=i[6],l=i[7],h=i[8],d=i[9],p=i[10],v=i[11],m=i[12],g=i[13],x=i[14],y=i[15],b=d*x*l-g*p*l+g*f*v-c*x*v-d*f*y+c*p*y,_=m*p*l-h*x*l-m*f*v+u*x*v+h*f*y-u*p*y,w=h*g*l-m*d*l+m*c*v-u*g*v-h*c*y+u*d*y,A=m*d*f-h*g*f-m*c*p+u*g*p+h*c*x-u*d*x,S=n*b+a*_+o*w+s*A;if(S===0){var M="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(t===!0)throw new Error(M);return console.warn(M),this.identity()}var E=1/S;return r[0]=b*E,r[1]=(g*p*s-d*x*s-g*o*v+a*x*v+d*o*y-a*p*y)*E,r[2]=(c*x*s-g*f*s+g*o*l-a*x*l-c*o*y+a*f*y)*E,r[3]=(d*f*s-c*p*s-d*o*l+a*p*l+c*o*v-a*f*v)*E,r[4]=_*E,r[5]=(h*x*s-m*p*s+m*o*v-n*x*v-h*o*y+n*p*y)*E,r[6]=(m*f*s-u*x*s-m*o*l+n*x*l+u*o*y-n*f*y)*E,r[7]=(u*p*s-h*f*s+h*o*l-n*p*l-u*o*v+n*f*v)*E,r[8]=w*E,r[9]=(m*d*s-h*g*s-m*a*v+n*g*v+h*a*y-n*d*y)*E,r[10]=(u*g*s-m*c*s+m*a*l-n*g*l-u*a*y+n*c*y)*E,r[11]=(h*c*s-u*d*s-h*a*l+n*d*l+u*a*v-n*c*v)*E,r[12]=A*E,r[13]=(h*g*o-m*d*o+m*a*p-n*g*p-h*a*x+n*d*x)*E,r[14]=(m*c*o-u*g*o-m*a*f+n*g*f+u*a*x-n*c*x)*E,r[15]=(u*d*o-h*c*o+h*a*f-n*d*f-u*a*p+n*c*p)*E,this},scale:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z;return t[0]*=r,t[4]*=i,t[8]*=n,t[1]*=r,t[5]*=i,t[9]*=n,t[2]*=r,t[6]*=i,t[10]*=n,t[3]*=r,t[7]*=i,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),i=Math.sin(t),n=1-r,a=e.x,o=e.y,s=e.z,u=n*a,c=n*o;return this.set(u*a+r,u*o-i*s,u*s+i*o,0,u*o+i*s,c*o+r,c*s-i*a,0,u*s-i*o,c*s+i*a,n*s*s+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(e,t,r){return this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,r){var i=this.elements,n=t._x,a=t._y,o=t._z,s=t._w,u=n+n,c=a+a,f=o+o,l=n*u,h=n*c,d=n*f,p=a*c,v=a*f,m=o*f,g=s*u,x=s*c,y=s*f,b=r.x,_=r.y,w=r.z;return i[0]=(1-(p+m))*b,i[1]=(h+y)*b,i[2]=(d-x)*b,i[3]=0,i[4]=(h-y)*_,i[5]=(1-(l+m))*_,i[6]=(v+g)*_,i[7]=0,i[8]=(d+x)*w,i[9]=(v-g)*w,i[10]=(1-(l+p))*w,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this},decompose:function(){var e=new I,t=new Ae;return function(i,n,a){var o=this.elements,s=e.set(o[0],o[1],o[2]).length(),u=e.set(o[4],o[5],o[6]).length(),c=e.set(o[8],o[9],o[10]).length(),f=this.determinant();f<0&&(s=-s),i.x=o[12],i.y=o[13],i.z=o[14],t.copy(this);var l=1/s,h=1/u,d=1/c;return t.elements[0]*=l,t.elements[1]*=l,t.elements[2]*=l,t.elements[4]*=h,t.elements[5]*=h,t.elements[6]*=h,t.elements[8]*=d,t.elements[9]*=d,t.elements[10]*=d,n.setFromRotationMatrix(t),a.x=s,a.y=u,a.z=c,this}}(),makePerspective:function(e,t,r,i,n,a){a===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*n/(t-e),u=2*n/(r-i),c=(t+e)/(t-e),f=(r+i)/(r-i),l=-(a+n)/(a-n),h=-2*a*n/(a-n);return o[0]=s,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=u,o[9]=f,o[13]=0,o[2]=0,o[6]=0,o[10]=l,o[14]=h,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(e,t,r,i,n,a){var o=this.elements,s=1/(t-e),u=1/(r-i),c=1/(a-n),f=(t+e)*s,l=(r+i)*u,h=(a+n)*c;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-f,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-l,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-h,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(e){for(var t=this.elements,r=e.elements,i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0},fromArray:function(e,t){var r=this;t===void 0&&(t=0);for(var i=0;i<16;i++)r.elements[i]=e[i+t];return this},toArray:function(e,t){e===void 0&&(e=[]),t===void 0&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}});function er(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._w=i!==void 0?i:1}Object.assign(er,{slerp:function(e,t,r,i){return r.copy(e).slerp(t,i)},slerpFlat:function(e,t,r,i,n,a,o){var s=r[i+0],u=r[i+1],c=r[i+2],f=r[i+3],l=n[a+0],h=n[a+1],d=n[a+2],p=n[a+3];if(f!==p||s!==l||u!==h||c!==d){var v=1-o,m=s*l+u*h+c*d+f*p,g=m>=0?1:-1,x=1-m*m;if(x>Number.EPSILON){var y=Math.sqrt(x),b=Math.atan2(y,m*g);v=Math.sin(v*b)/y,o=Math.sin(o*b)/y}var _=o*g;if(s=s*v+l*_,u=u*v+h*_,c=c*v+d*_,f=f*v+p*_,v===1-o){var w=1/Math.sqrt(s*s+u*u+c*c+f*f);s*=w,u*=w,c*=w,f*=w}}e[t]=s,e[t+1]=u,e[t+2]=c,e[t+3]=f}});Object.defineProperties(er.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}});Object.assign(er.prototype,{set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=e._x,i=e._y,n=e._z,a=e.order,o=Math.cos,s=Math.sin,u=o(r/2),c=o(i/2),f=o(n/2),l=s(r/2),h=s(i/2),d=s(n/2);return a==="XYZ"?(this._x=l*c*f+u*h*d,this._y=u*h*f-l*c*d,this._z=u*c*d+l*h*f,this._w=u*c*f-l*h*d):a==="YXZ"?(this._x=l*c*f+u*h*d,this._y=u*h*f-l*c*d,this._z=u*c*d-l*h*f,this._w=u*c*f+l*h*d):a==="ZXY"?(this._x=l*c*f-u*h*d,this._y=u*h*f+l*c*d,this._z=u*c*d+l*h*f,this._w=u*c*f-l*h*d):a==="ZYX"?(this._x=l*c*f-u*h*d,this._y=u*h*f+l*c*d,this._z=u*c*d-l*h*f,this._w=u*c*f+l*h*d):a==="YZX"?(this._x=l*c*f+u*h*d,this._y=u*h*f+l*c*d,this._z=u*c*d-l*h*f,this._w=u*c*f-l*h*d):a==="XZY"&&(this._x=l*c*f-u*h*d,this._y=u*h*f-l*c*d,this._z=u*c*d+l*h*f,this._w=u*c*f+l*h*d),t!==!1&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t=e.elements,r=t[0],i=t[4],n=t[8],a=t[1],o=t[5],s=t[9],u=t[2],c=t[6],f=t[10],l=r+o+f,h;return l>0?(h=.5/Math.sqrt(l+1),this._w=.25/h,this._x=(c-s)*h,this._y=(n-u)*h,this._z=(a-i)*h):r>o&&r>f?(h=2*Math.sqrt(1+r-o-f),this._w=(c-s)/h,this._x=.25*h,this._y=(i+a)/h,this._z=(n+u)/h):o>f?(h=2*Math.sqrt(1+o-r-f),this._w=(n-u)/h,this._x=(i+a)/h,this._y=.25*h,this._z=(s+c)/h):(h=2*Math.sqrt(1+f-r-o),this._w=(a-i)/h,this._x=(n+u)/h,this._y=(s+c)/h,this._z=.25*h),this.onChangeCallback(),this},setFromUnitVectors:function(){var e=new I,t,r=1e-6;return function(n,a){return e===void 0&&(e=new I),t=n.dot(a)+1,t<r?(t=0,Math.abs(n.x)>Math.abs(n.z)?e.set(-n.y,n.x,0):e.set(0,-n.z,n.y)):e.crossVectors(n,a),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize()}}(),angleTo:function(e){return 2*Math.acos(Math.abs(Pt.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var r=this.angleTo(e);if(r===0)return this;var i=Math.min(1,t/r);return this.slerp(e,i),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var r=e._x,i=e._y,n=e._z,a=e._w,o=t._x,s=t._y,u=t._z,c=t._w;return this._x=r*c+a*o+i*u-n*s,this._y=i*c+a*s+n*o-r*u,this._z=n*c+a*u+r*s-i*o,this._w=a*c-r*o-i*s-n*u,this.onChangeCallback(),this},slerp:function(e,t){if(t===0)return this;if(t===1)return this.copy(e);var r=this._x,i=this._y,n=this._z,a=this._w,o=a*e._w+r*e._x+i*e._y+n*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=r,this._y=i,this._z=n,this;var s=1-o*o;if(s<=Number.EPSILON){var u=1-t;return this._w=u*a+t*this._w,this._x=u*r+t*this._x,this._y=u*i+t*this._y,this._z=u*n+t*this._z,this.normalize()}var c=Math.sqrt(s),f=Math.atan2(c,o),l=Math.sin((1-t)*f)/c,h=Math.sin(t*f)/c;return this._w=a*l+this._w*h,this._x=r*l+this._x*h,this._y=i*l+this._y*h,this._z=n*l+this._z*h,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return t===void 0&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}});function I(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}Object.assign(I.prototype,{isVector3:!0,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e=new er;return function(r){return r&&r.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(r))}}(),applyAxisAngle:function(){var e=new er;return function(r,i){return this.applyQuaternion(e.setFromAxisAngle(r,i))}}(),applyMatrix3:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6]*i,this.y=n[1]*t+n[4]*r+n[7]*i,this.z=n[2]*t+n[5]*r+n[8]*i,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements,a=1/(n[3]*t+n[7]*r+n[11]*i+n[15]);return this.x=(n[0]*t+n[4]*r+n[8]*i+n[12])*a,this.y=(n[1]*t+n[5]*r+n[9]*i+n[13])*a,this.z=(n[2]*t+n[6]*r+n[10]*i+n[14])*a,this},applyQuaternion:function(e){var t=this.x,r=this.y,i=this.z,n=e.x,a=e.y,o=e.z,s=e.w,u=s*t+a*i-o*r,c=s*r+o*t-n*i,f=s*i+n*r-a*t,l=-n*t-a*r-o*i;return this.x=u*s+l*-n+c*-o-f*-a,this.y=c*s+l*-a+f*-n-u*-o,this.z=f*s+l*-o+u*-a-c*-n,this},project:function(){var e=new Ae;return function(r){return e.multiplyMatrices(r.projectionMatrix,e.getInverse(r.matrixWorld)),this.applyMatrix4(e)}}(),unproject:function(){var e=new Ae;return function(r){return e.multiplyMatrices(r.matrixWorld,e.getInverse(r.projectionMatrix)),this.applyMatrix4(e)}}(),transformDirection:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i,this.y=n[1]*t+n[5]*r+n[9]*i,this.z=n[2]*t+n[6]*r+n[10]*i,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e=new I,t=new I;return function(i,n){return e.set(i,i,i),t.set(n,n,n),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},cross:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var r=e.x,i=e.y,n=e.z,a=t.x,o=t.y,s=t.z;return this.x=i*s-n*o,this.y=n*a-r*s,this.z=r*o-i*a,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e=new I;return function(r){return e.copy(this).projectOnVector(r),this.sub(e)}}(),reflect:function(){var e=new I;return function(r){return this.sub(e.copy(r).multiplyScalar(2*this.dot(r)))}}(),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(Pt.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this},setFromCylindrical:function(e){return this.x=e.radius*Math.sin(e.theta),this.y=e.y,this.z=e.radius*Math.cos(e.theta),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,t*4)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,r){return r!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}});function Ur(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Ur.prototype,{isMatrix3:!0,set:function(e,t,r,i,n,a,o,s,u){var c=this.elements;return c[0]=e,c[1]=i,c[2]=o,c[3]=t,c[4]=n,c[5]=s,c[6]=r,c[7]=a,c[8]=u,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return new this.constructor().fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(){var e=new I;return function(r){for(var i=this,n=0,a=r.count;n<a;n++)e.x=r.getX(n),e.y=r.getY(n),e.z=r.getZ(n),e.applyMatrix3(i),r.setXYZ(n,e.x,e.y,e.z);return r}}(),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,i=t.elements,n=this.elements,a=r[0],o=r[3],s=r[6],u=r[1],c=r[4],f=r[7],l=r[2],h=r[5],d=r[8],p=i[0],v=i[3],m=i[6],g=i[1],x=i[4],y=i[7],b=i[2],_=i[5],w=i[8];return n[0]=a*p+o*g+s*b,n[3]=a*v+o*x+s*_,n[6]=a*m+o*y+s*w,n[1]=u*p+c*g+f*b,n[4]=u*v+c*x+f*_,n[7]=u*m+c*y+f*w,n[2]=l*p+h*g+d*b,n[5]=l*v+h*x+d*_,n[8]=l*m+h*y+d*w,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],s=e[6],u=e[7],c=e[8];return t*a*c-t*o*u-r*n*c+r*o*s+i*n*u-i*a*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=e.elements,i=this.elements,n=r[0],a=r[1],o=r[2],s=r[3],u=r[4],c=r[5],f=r[6],l=r[7],h=r[8],d=h*u-c*l,p=c*f-h*s,v=l*s-u*f,m=n*d+a*p+o*v;if(m===0){var g="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(t===!0)throw new Error(g);return console.warn(g),this.identity()}var x=1/m;return i[0]=d*x,i[1]=(o*l-h*a)*x,i[2]=(c*a-o*u)*x,i[3]=p*x,i[4]=(h*n-o*f)*x,i[5]=(o*s-c*n)*x,i[6]=v*x,i[7]=(a*f-l*n)*x,i[8]=(u*n-a*s)*x,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,r,i,n,a,o){var s=Math.cos(n),u=Math.sin(n);this.set(r*s,r*u,-r*(s*a+u*o)+a+e,-i*u,i*s,-i*(-u*a+s*o)+o+t,0,0,1)},scale:function(e,t){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this},rotate:function(e){var t=Math.cos(e),r=Math.sin(e),i=this.elements,n=i[0],a=i[3],o=i[6],s=i[1],u=i[4],c=i[7];return i[0]=t*n+r*s,i[3]=t*a+r*u,i[6]=t*o+r*c,i[1]=-r*n+t*s,i[4]=-r*a+t*u,i[7]=-r*o+t*c,this},translate:function(e,t){var r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this},equals:function(e){for(var t=this.elements,r=e.elements,i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0},fromArray:function(e,t){var r=this;t===void 0&&(t=0);for(var i=0;i<9;i++)r.elements[i]=e[i+t];return this},toArray:function(e,t){e===void 0&&(e=[]),t===void 0&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}});var La={getDataURL:function(e){var t;if(e instanceof HTMLCanvasElement)t=e;else{typeof OffscreenCanvas<"u"?t=new OffscreenCanvas(e.width,e.height):(t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),t.width=e.width,t.height=e.height);var r=t.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height)}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},Nb=0;function hr(e,t,r,i,n,a,o,s,u,c){Object.defineProperty(this,"id",{value:Nb++}),this.uuid=Pt.generateUUID(),this.name="",this.image=e!==void 0?e:hr.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=t!==void 0?t:hr.DEFAULT_MAPPING,this.wrapS=r!==void 0?r:bi,this.wrapT=i!==void 0?i:bi,this.magFilter=n!==void 0?n:Dr,this.minFilter=a!==void 0?a:Ff,this.anisotropy=u!==void 0?u:1,this.format=o!==void 0?o:zi,this.type=s!==void 0?s:Fs,this.offset=new Ee(0,0),this.repeat=new Ee(1,1),this.center=new Ee(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ur,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c!==void 0?c:Dc,this.version=0,this.onUpdate=null}hr.DEFAULT_IMAGE=void 0;hr.DEFAULT_MAPPING=_d;hr.prototype=Object.assign(Object.create(fa.prototype),{constructor:hr,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(this.image!==void 0){var i=this.image;if(i.uuid===void 0&&(i.uuid=Pt.generateUUID()),!t&&e.images[i.uuid]===void 0){var n;if(Array.isArray(i)){n=[];for(var a=0,o=i.length;a<o;a++)n.push(La.getDataURL(i[a]))}else n=La.getDataURL(i);e.images[i.uuid]={uuid:i.uuid,url:n}}r.image=i.uuid}return t||(e.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping===_d){if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Jn:e.x=e.x-Math.floor(e.x);break;case bi:e.x=e.x<0?0:1;break;case mo:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Jn:e.y=e.y-Math.floor(e.y);break;case bi:e.y=e.y<0?0:1;break;case mo:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}this.flipY&&(e.y=1-e.y)}}});Object.defineProperty(hr.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}});function $t(e,t,r,i){this.x=e||0,this.y=t||0,this.z=r||0,this.w=i!==void 0?i:1}Object.assign($t.prototype,{isVector4:!0,set:function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,n=this.w,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*i+a[12]*n,this.y=a[1]*t+a[5]*r+a[9]*i+a[13]*n,this.z=a[2]*t+a[6]*r+a[10]*i+a[14]*n,this.w=a[3]*t+a[7]*r+a[11]*i+a[15]*n,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,i,n,a=.01,o=.1,s=e.elements,u=s[0],c=s[4],f=s[8],l=s[1],h=s[5],d=s[9],p=s[2],v=s[6],m=s[10];if(Math.abs(c-l)<a&&Math.abs(f-p)<a&&Math.abs(d-v)<a){if(Math.abs(c+l)<o&&Math.abs(f+p)<o&&Math.abs(d+v)<o&&Math.abs(u+h+m-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var g=(u+1)/2,x=(h+1)/2,y=(m+1)/2,b=(c+l)/4,_=(f+p)/4,w=(d+v)/4;return g>x&&g>y?g<a?(r=0,i=.707106781,n=.707106781):(r=Math.sqrt(g),i=b/r,n=_/r):x>y?x<a?(r=.707106781,i=0,n=.707106781):(i=Math.sqrt(x),r=b/i,n=w/i):y<a?(r=.707106781,i=.707106781,n=0):(n=Math.sqrt(y),r=_/n,i=w/n),this.set(r,i,n,t),this}var A=Math.sqrt((v-d)*(v-d)+(f-p)*(f-p)+(l-c)*(l-c));return Math.abs(A)<.001&&(A=1),this.x=(v-d)/A,this.y=(f-p)/A,this.z=(l-c)/A,this.w=Math.acos((u+h+m-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function(i,n){return e===void 0&&(e=new $t,t=new $t),e.set(i,i,i,i),t.set(n,n,n,n),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,r){return r!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}});function En(e,t,r){this.width=e,this.height=t,this.scissor=new $t(0,0,e,t),this.scissorTest=!1,this.viewport=new $t(0,0,e,t),r=r||{},r.minFilter===void 0&&(r.minFilter=Dr),this.texture=new hr(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.generateMipmaps=r.generateMipmaps!==void 0?r.generateMipmaps:!0,this.depthBuffer=r.depthBuffer!==void 0?r.depthBuffer:!0,this.stencilBuffer=r.stencilBuffer!==void 0?r.stencilBuffer:!0,this.depthTexture=r.depthTexture!==void 0?r.depthTexture:null}En.prototype=Object.assign(Object.create(fa.prototype),{constructor:En,isWebGLRenderTarget:!0,setSize:function(e,t){(this.width!==e||this.height!==t)&&(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});function ks(e,t,r){En.call(this,e,t,r),this.activeCubeFace=0,this.activeMipMapLevel=0}ks.prototype=Object.create(En.prototype);ks.prototype.constructor=ks;ks.prototype.isWebGLRenderTargetCube=!0;function Rn(e,t,r,i,n,a,o,s,u,c,f,l){hr.call(this,null,a,o,s,u,c,i,n,f,l),this.image={data:e,width:t,height:r},this.magFilter=u!==void 0?u:vr,this.minFilter=c!==void 0?c:vr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}Rn.prototype=Object.create(hr.prototype);Rn.prototype.constructor=Rn;Rn.prototype.isDataTexture=!0;function ir(e,t){this.min=e!==void 0?e:new I(1/0,1/0,1/0),this.max=t!==void 0?t:new I(-1/0,-1/0,-1/0)}Object.assign(ir.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,r=1/0,i=1/0,n=-1/0,a=-1/0,o=-1/0,s=0,u=e.length;s<u;s+=3){var c=e[s],f=e[s+1],l=e[s+2];c<t&&(t=c),f<r&&(r=f),l<i&&(i=l),c>n&&(n=c),f>a&&(a=f),l>o&&(o=l)}return this.min.set(t,r,i),this.max.set(n,a,o),this},setFromBufferAttribute:function(e){for(var t=1/0,r=1/0,i=1/0,n=-1/0,a=-1/0,o=-1/0,s=0,u=e.count;s<u;s++){var c=e.getX(s),f=e.getY(s),l=e.getZ(s);c<t&&(t=c),f<r&&(r=f),l<i&&(i=l),c>n&&(n=c),f>a&&(a=f),l>o&&(o=l)}return this.min.set(t,r,i),this.max.set(n,a,o),this},setFromPoints:function(e){var t=this;this.makeEmpty();for(var r=0,i=e.length;r<i;r++)t.expandByPoint(e[r]);return this},setFromCenterAndSize:function(){var e=new I;return function(r,i){var n=e.copy(i).multiplyScalar(.5);return this.min.copy(r).sub(n),this.max.copy(r).add(n),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return e===void 0&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new I),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return e===void 0&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new I),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){var e,t,r,i=new I;function n(a){var o=a.geometry;if(o!==void 0){if(o.isGeometry){var s=o.vertices;for(t=0,r=s.length;t<r;t++)i.copy(s[t]),i.applyMatrix4(a.matrixWorld),e.expandByPoint(i)}else if(o.isBufferGeometry){var u=o.attributes.position;if(u!==void 0)for(t=0,r=u.count;t<r;t++)i.fromBufferAttribute(u,t).applyMatrix4(a.matrixWorld),e.expandByPoint(i)}}}return function(o){return e=this,o.updateMatrixWorld(!0),o.traverse(n),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return t===void 0&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new I),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(){var e=new I;return function(r){return this.clampPoint(r.center,e),e.distanceToSquared(r.center)<=r.radius*r.radius}}(),intersectsPlane:function(e){var t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=e.constant&&r>=e.constant},intersectsTriangle:function(){var e=new I,t=new I,r=new I,i=new I,n=new I,a=new I,o=new I,s=new I,u=new I,c=new I;function f(l){var h,d;for(h=0,d=l.length-3;h<=d;h+=3){o.fromArray(l,h);var p=u.x*Math.abs(o.x)+u.y*Math.abs(o.y)+u.z*Math.abs(o.z),v=e.dot(o),m=t.dot(o),g=r.dot(o);if(Math.max(-Math.max(v,m,g),Math.min(v,m,g))>p)return!1}return!0}return function(h){if(this.isEmpty())return!1;this.getCenter(s),u.subVectors(this.max,s),e.subVectors(h.a,s),t.subVectors(h.b,s),r.subVectors(h.c,s),i.subVectors(t,e),n.subVectors(r,t),a.subVectors(e,r);var d=[0,-i.z,i.y,0,-n.z,n.y,0,-a.z,a.y,i.z,0,-i.x,n.z,0,-n.x,a.z,0,-a.x,-i.y,i.x,0,-n.y,n.x,0,-a.y,a.x,0];return!f(d)||(d=[1,0,0,0,1,0,0,0,1],!f(d))?!1:(c.crossVectors(i,n),d=[c.x,c.y,c.z],f(d))}}(),clampPoint:function(e,t){return t===void 0&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new I),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new I;return function(r){var i=e.copy(r).clamp(this.min,this.max);return i.sub(r).length()}}(),getBoundingSphere:function(){var e=new I;return function(r){return r===void 0&&(console.warn("THREE.Box3: .getBoundingSphere() target is now required"),r=new sn),this.getCenter(r.center),r.radius=this.getSize(e).length()*.5,r}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){if(this.isEmpty())return this;var t=e.elements,r=t[0]*this.min.x,i=t[1]*this.min.x,n=t[2]*this.min.x,a=t[0]*this.max.x,o=t[1]*this.max.x,s=t[2]*this.max.x,u=t[4]*this.min.y,c=t[5]*this.min.y,f=t[6]*this.min.y,l=t[4]*this.max.y,h=t[5]*this.max.y,d=t[6]*this.max.y,p=t[8]*this.min.z,v=t[9]*this.min.z,m=t[10]*this.min.z,g=t[8]*this.max.z,x=t[9]*this.max.z,y=t[10]*this.max.z;return this.min.x=Math.min(r,a)+Math.min(u,l)+Math.min(p,g)+t[12],this.min.y=Math.min(i,o)+Math.min(c,h)+Math.min(v,x)+t[13],this.min.z=Math.min(n,s)+Math.min(f,d)+Math.min(m,y)+t[14],this.max.x=Math.max(r,a)+Math.max(u,l)+Math.max(p,g)+t[12],this.max.y=Math.max(i,o)+Math.max(c,h)+Math.max(v,x)+t[13],this.max.z=Math.max(n,s)+Math.max(f,d)+Math.max(m,y)+t[14],this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});function sn(e,t){this.center=e!==void 0?e:new I,this.radius=t!==void 0?t:0}Object.assign(sn.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new ir;return function(r,i){var n=this.center;i!==void 0?n.copy(i):e.setFromPoints(r).getCenter(n);for(var a=0,o=0,s=r.length;o<s;o++)a=Math.max(a,n.distanceToSquared(r[o]));return this.radius=Math.sqrt(a),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var r=this.center.distanceToSquared(e);return t===void 0&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new I),t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return e===void 0&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new ir),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}});function Pn(e,t){this.normal=e!==void 0?e:new I(1,0,0),this.constant=t!==void 0?t:0}Object.assign(Pn.prototype,{set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new I,t=new I;return function(i,n,a){var o=e.subVectors(a,n).cross(t.subVectors(i,n)).normalize();return this.setFromNormalAndCoplanarPoint(o,i),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return t===void 0&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new I),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var e=new I;return function(r,i){i===void 0&&(console.warn("THREE.Plane: .intersectLine() target is now required"),i=new I);var n=r.delta(e),a=this.normal.dot(n);if(a===0)return this.distanceToPoint(r.start)===0?i.copy(r.start):void 0;var o=-(r.start.dot(this.normal)+this.constant)/a;if(!(o<0||o>1))return i.copy(n).multiplyScalar(o).add(r.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return e===void 0&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new I),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new I,t=new Ur;return function(i,n){var a=n||t.getNormalMatrix(i),o=this.coplanarPoint(e).applyMatrix4(i),s=this.normal.applyMatrix3(a).normalize();return this.constant=-o.dot(s),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});function Ed(e,t,r,i,n,a){this.planes=[e!==void 0?e:new Pn,t!==void 0?t:new Pn,r!==void 0?r:new Pn,i!==void 0?i:new Pn,n!==void 0?n:new Pn,a!==void 0?a:new Pn]}Object.assign(Ed.prototype,{set:function(e,t,r,i,n,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(r),o[3].copy(i),o[4].copy(n),o[5].copy(a),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){for(var t=this.planes,r=0;r<6;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,i=r[0],n=r[1],a=r[2],o=r[3],s=r[4],u=r[5],c=r[6],f=r[7],l=r[8],h=r[9],d=r[10],p=r[11],v=r[12],m=r[13],g=r[14],x=r[15];return t[0].setComponents(o-i,f-s,p-l,x-v).normalize(),t[1].setComponents(o+i,f+s,p+l,x+v).normalize(),t[2].setComponents(o+n,f+u,p+h,x+m).normalize(),t[3].setComponents(o-n,f-u,p-h,x-m).normalize(),t[4].setComponents(o-a,f-c,p-d,x-g).normalize(),t[5].setComponents(o+a,f+c,p+d,x+g).normalize(),this},intersectsObject:function(){var e=new sn;return function(r){var i=r.geometry;return i.boundingSphere===null&&i.computeBoundingSphere(),e.copy(i.boundingSphere).applyMatrix4(r.matrixWorld),this.intersectsSphere(e)}}(),intersectsSprite:function(){var e=new sn;return function(r){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(r.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,r=e.center,i=-e.radius,n=0;n<6;n++){var a=t[n].distanceToPoint(r);if(a<i)return!1}return!0},intersectsBox:function(){var e=new I;return function(r){for(var i=this.planes,n=0;n<6;n++){var a=i[n];if(e.x=a.normal.x>0?r.max.x:r.min.x,e.y=a.normal.y>0?r.max.y:r.min.y,e.z=a.normal.z>0?r.max.z:r.min.z,a.distanceToPoint(e)<0)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}});var kb=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif
`,zb=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif
`,Ub=`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif
`,Gb=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( PHYSICAL )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif
`,Hb=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Vb=`
vec3 transformed = vec3( position );
`,Wb=`
vec3 objectNormal = vec3( normal );
`,jb=`float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	if( decayExponent > 0.0 ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		float maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		return distanceFalloff * maxDistanceCutoffFactor;
#else
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
#endif
	}
	return 1.0;
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {
	float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE  = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS  = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;
	return specularColor * AB.x + AB.y;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
`,Xb=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 );
		fDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif
`,qb=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;
	}
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;
		}
		if ( clipped ) discard;
	#endif
#endif
`,Yb=`#if NUM_CLIPPING_PLANES > 0
	#if ! defined( PHYSICAL ) && ! defined( PHONG )
		varying vec3 vViewPosition;
	#endif
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif
`,Zb=`#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )
	varying vec3 vViewPosition;
#endif
`,Kb=`#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )
	vViewPosition = - mvPosition.xyz;
#endif
`,Jb=`#ifdef USE_COLOR
	diffuseColor.rgb *= vColor;
#endif`,Qb=`#ifdef USE_COLOR
	varying vec3 vColor;
#endif
`,$b=`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,ex=`#ifdef USE_COLOR
	vColor.xyz = color.xyz;
#endif`,tx=`#define PI 3.14159265359
#define PI2 6.28318530718
#define PI_HALF 1.5707963267949
#define RECIPROCAL_PI 0.31830988618
#define RECIPROCAL_PI2 0.15915494
#define LOG2 1.442695
#define EPSILON 1e-6
#define saturate(a) clamp( a, 0.0, 1.0 )
#define whiteCompliment(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
`,rx=`#ifdef ENVMAP_TYPE_CUBE_UV
#define cubeUV_textureSize (1024.0)
int getFaceFromDirection(vec3 direction) {
	vec3 absDirection = abs(direction);
	int face = -1;
	if( absDirection.x > absDirection.z ) {
		if(absDirection.x > absDirection.y )
			face = direction.x > 0.0 ? 0 : 3;
		else
			face = direction.y > 0.0 ? 1 : 4;
	}
	else {
		if(absDirection.z > absDirection.y )
			face = direction.z > 0.0 ? 2 : 5;
		else
			face = direction.y > 0.0 ? 1 : 4;
	}
	return face;
}
#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)
#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))
vec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {
	float scale = exp2(cubeUV_maxLods1 - roughnessLevel);
	float dxRoughness = dFdx(roughness);
	float dyRoughness = dFdy(roughness);
	vec3 dx = dFdx( vec * scale * dxRoughness );
	vec3 dy = dFdy( vec * scale * dyRoughness );
	float d = max( dot( dx, dx ), dot( dy, dy ) );
	d = clamp(d, 1.0, cubeUV_rangeClamp);
	float mipLevel = 0.5 * log2(d);
	return vec2(floor(mipLevel), fract(mipLevel));
}
#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)
#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)
vec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {
	mipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;
	float a = 16.0 * cubeUV_rcpTextureSize;
	vec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );
	vec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;
	float powScale = exp2_packed.x * exp2_packed.y;
	float scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;
	float mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;
	bool bRes = mipLevel == 0.0;
	scale =  bRes && (scale < a) ? a : scale;
	vec3 r;
	vec2 offset;
	int face = getFaceFromDirection(direction);
	float rcpPowScale = 1.0 / powScale;
	if( face == 0) {
		r = vec3(direction.x, -direction.z, direction.y);
		offset = vec2(0.0+mipOffset,0.75 * rcpPowScale);
		offset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;
	}
	else if( face == 1) {
		r = vec3(direction.y, direction.x, direction.z);
		offset = vec2(scale+mipOffset, 0.75 * rcpPowScale);
		offset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;
	}
	else if( face == 2) {
		r = vec3(direction.z, direction.x, direction.y);
		offset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);
		offset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;
	}
	else if( face == 3) {
		r = vec3(direction.x, direction.z, direction.y);
		offset = vec2(0.0+mipOffset,0.5 * rcpPowScale);
		offset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;
	}
	else if( face == 4) {
		r = vec3(direction.y, direction.x, -direction.z);
		offset = vec2(scale+mipOffset, 0.5 * rcpPowScale);
		offset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;
	}
	else {
		r = vec3(direction.z, -direction.x, direction.y);
		offset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);
		offset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;
	}
	r = normalize(r);
	float texelOffset = 0.5 * cubeUV_rcpTextureSize;
	vec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;
	vec2 base = offset + vec2( texelOffset );
	return base + s * ( scale - 2.0 * texelOffset );
}
#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)
vec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {
	float roughnessVal = roughness* cubeUV_maxLods3;
	float r1 = floor(roughnessVal);
	float r2 = r1 + 1.0;
	float t = fract(roughnessVal);
	vec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);
	float s = mipInfo.y;
	float level0 = mipInfo.x;
	float level1 = level0 + 1.0;
	level1 = level1 > 5.0 ? 5.0 : level1;
	level0 += min( floor( s + 0.5 ), 5.0 );
	vec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);
	vec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));
	vec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);
	vec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));
	vec4 result = mix(color10, color20, t);
	return vec4(result.rgb, 1.0);
}
#endif
`,ix=`vec3 transformedNormal = normalMatrix * objectNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
`,nx=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif
`,ax=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );
#endif
`,ox=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif
`,sx=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif
`,ux=`  gl_FragColor = linearToOutputTexel( gl_FragColor );
`,cx=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.xyz * value.w * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.x, max( value.g, value.b ) );
	float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M            = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.x, max( value.g, value.b ) );
	float D      = max( maxRange / maxRGB, 1.0 );
	D            = min( floor( D ) / 255.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value )  {
	vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;
	Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract(Le);
	vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;
	return vec4( max(vRGB, 0.0), 1.0 );
}
`,fx=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToVertex, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_EQUIREC )
		vec2 sampleUV;
		reflectVec = normalize( reflectVec );
		sampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
		sampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;
		vec4 envColor = texture2D( envMap, sampleUV );
	#elif defined( ENVMAP_TYPE_SPHERE )
		reflectVec = normalize( reflectVec );
		vec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );
		vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	envColor = envMapTexelToLinear( envColor );
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif
`,lx=`#if defined( USE_ENVMAP ) || defined( PHYSICAL )
	uniform float reflectivity;
	uniform float envMapIntensity;
#endif
#ifdef USE_ENVMAP
	#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )
		varying vec3 vWorldPosition;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif
`,hx=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif
`,dx=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif
`,px=`
#ifdef USE_FOG
fogDepth = -mvPosition.z;
#endif`,vx=`#ifdef USE_FOG
  varying float fogDepth;
#endif
`,mx=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif
`,gx=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif
`,yx=`#ifdef TOON
	uniform sampler2D gradientMap;
	vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
		float dotNL = dot( normal, lightDirection );
		vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
		#ifdef USE_GRADIENTMAP
			return texture2D( gradientMap, coord ).rgb;
		#else
			return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
		#endif
	}
#endif
`,bx=`#ifdef USE_LIGHTMAP
	reflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;
#endif
`,xx=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,_x=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
#endif
`,wx=`uniform vec3 ambientLightColor;
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
		float shadowCameraNear;
		float shadowCameraFar;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif
`,Ax=`#if defined( USE_ENVMAP ) && defined( PHYSICAL )
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			vec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );
		#else
			vec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			vec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));
		#elif defined( ENVMAP_TYPE_EQUIREC )
			vec2 sampleUV;
			sampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
			sampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );
			#else
				vec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_SPHERE )
			vec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );
			#else
				vec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif
`,Sx=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;
`,Mx=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3	diffuseColor;
	vec3	specularColor;
	float	specularShininess;
	float	specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	#ifdef TOON
		vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#else
		float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
		vec3 irradiance = dotNL * directLight.color;
	#endif
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)
`,Cx=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
material.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );
#ifdef STANDARD
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
	material.clearCoat = saturate( clearCoat );	material.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );
#endif
`,Px=`struct PhysicalMaterial {
	vec3	diffuseColor;
	float	specularRoughness;
	vec3	specularColor;
	#ifndef STANDARD
		float clearCoat;
		float clearCoatRoughness;
	#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearCoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos - halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos + halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos + halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos - halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifndef STANDARD
		float clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );
	#else
		float clearCoatDHR = 0.0;
	#endif
	reflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );
	reflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	#ifndef STANDARD
		reflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );
	#endif
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	#ifndef STANDARD
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		float dotNL = dotNV;
		float clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );
	#else
		float clearCoatDHR = 0.0;
	#endif
	reflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );
	#ifndef STANDARD
		reflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );
	#endif
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )
#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}
`,Tx=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = normalize( vViewPosition );
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#ifdef USE_SHADOWMAP
		directLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#ifdef USE_SHADOWMAP
		directLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#ifdef USE_SHADOWMAP
		directLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
#endif
#if defined( RE_IndirectDiffuse )
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearCoatRadiance = vec3( 0.0 );
#endif
`,Ex=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )
		irradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );
	#ifndef STANDARD
		clearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );
	#endif
#endif
`,Ix=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );
#endif
`,Rx=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Lx=`#ifdef USE_LOGDEPTHBUF
	uniform float logDepthBufFC;
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
	#endif
#endif
`,Ox=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
	#endif
	uniform float logDepthBufFC;
#endif`,Dx=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
	#else
		gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
		gl_Position.z *= gl_Position.w;
	#endif
#endif
`,Fx=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif
`,Bx=`#ifdef USE_MAP
	uniform sampler2D map;
#endif
`,Nx=`#ifdef USE_MAP
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
`,kx=`#ifdef USE_MAP
	uniform mat3 uvTransform;
	uniform sampler2D map;
#endif
`,zx=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif
`,Ux=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Gx=`#ifdef USE_MORPHNORMALS
	objectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];
	objectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];
	objectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];
	objectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];
#endif
`,Hx=`#ifdef USE_MORPHTARGETS
	#ifndef USE_MORPHNORMALS
	uniform float morphTargetInfluences[ 8 ];
	#else
	uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,Vx=`#ifdef USE_MORPHTARGETS
	transformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];
	transformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];
	transformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];
	transformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
	transformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];
	transformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];
	transformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];
	transformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];
	#endif
#endif
`,Wx=`#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
#endif
`,jx=`#ifdef USE_NORMALMAP
	#ifdef OBJECTSPACE_NORMALMAP
		normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
		#ifdef FLIP_SIDED
			normal = - normal;
		#endif
		#ifdef DOUBLE_SIDED
			normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		#endif
		normal = normalize( normalMatrix * normal );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );
#endif
`,Xx=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
	#ifdef OBJECTSPACE_NORMALMAP
		uniform mat3 normalMatrix;
	#else
		vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {
			vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
			vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
			vec2 st0 = dFdx( vUv.st );
			vec2 st1 = dFdy( vUv.st );
			float scale = sign( st1.t * st0.s - st0.t * st1.s );
			vec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );
			vec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );
			vec3 N = normalize( surf_norm );
			mat3 tsn = mat3( S, T, N );
			vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
			mapN.xy *= normalScale;
			mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
			return normalize( tsn * mapN );
		}
	#endif
#endif
`,qx=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}
`,Yx=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif
`,Zx=`vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );
gl_Position = projectionMatrix * mvPosition;
`,Kx=`#if defined( DITHERING )
  gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif
`,Jx=`#if defined( DITHERING )
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif
`,Qx=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif
`,$x=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,e_=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHTS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];
	#endif
	#if NUM_SPOT_LIGHTS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];
	#endif
	#if NUM_POINT_LIGHTS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	float texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {
		const vec2 offset = vec2( 0.0, 1.0 );
		vec2 texelSize = vec2( 1.0 ) / size;
		vec2 centroidUV = floor( uv * size + 0.5 ) / size;
		float lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );
		float lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );
		float rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );
		float rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );
		vec2 f = fract( uv * size + 0.5 );
		float a = mix( lb, lt, f.y );
		float b = mix( rb, rt, f.y );
		float c = mix( a, b, f.x );
		return c;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			shadow = (
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 9.0 );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif
`,t_=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHTS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];
	#endif
	#if NUM_SPOT_LIGHTS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];
	#endif
	#if NUM_POINT_LIGHTS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];
	#endif
#endif
`,r_=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;
	}
	#endif
	#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;
	}
	#endif
	#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;
	}
	#endif
#endif
`,i_=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHTS > 0
	DirectionalLight directionalLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		shadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#endif
	#if NUM_SPOT_LIGHTS > 0
	SpotLight spotLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		shadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#endif
	#if NUM_POINT_LIGHTS > 0
	PointLight pointLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		shadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#endif
	#endif
	return shadow;
}
`,n_=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,a_=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif
`,o_=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif
`,s_=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
#endif
`,u_=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,c_=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,f_=`#if defined( TONE_MAPPING )
  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif
`,l_=`#ifndef saturate
	#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
uniform float toneMappingWhitePoint;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
`,h_=`#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )
	varying vec2 vUv;
#endif`,d_=`#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
`,p_=`#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,v_=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,m_=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
#endif`,g_=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = uv2;
#endif`,y_=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
	vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );
#endif
`,b_=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldPosition;
void main() {
	gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );
	gl_FragColor.a *= opacity;
}
`,x_=`varying vec3 vWorldPosition;
#include <common>
void main() {
	vWorldPosition = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}
`,__=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( gl_FragCoord.z );
	#endif
}
`,w_=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
}
`,A_=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}
`,S_=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}
`,M_=`uniform sampler2D tEquirect;
varying vec3 vWorldPosition;
#include <common>
void main() {
	vec3 direction = normalize( vWorldPosition );
	vec2 sampleUV;
	sampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;
	gl_FragColor = texture2D( tEquirect, sampleUV );
}
`,C_=`varying vec3 vWorldPosition;
#include <common>
void main() {
	vWorldPosition = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}
`,P_=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <premultiplied_alpha_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}
`,T_=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	vLineDistance = scale * lineDistance;
	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}
`,E_=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		reflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <premultiplied_alpha_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}
`,I_=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}
`,R_=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	reflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}
`,L_=`#define LAMBERT
varying vec3 vLightFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}
`,O_=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}
`,D_=`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}
`,F_=`#define PHYSICAL
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifndef STANDARD
	uniform float clearCoat;
	uniform float clearCoatRoughness;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}
`,B_=`#define PHYSICAL
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}
`,N_=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}
`,k_=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )
	vViewPosition = - mvPosition.xyz;
#endif
}
`,z_=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <premultiplied_alpha_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}
`,U_=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#ifdef USE_SIZEATTENUATION
		gl_PointSize = size * ( scale / - mvPosition.z );
	#else
		gl_PointSize = size;
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}
`,G_=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <fog_fragment>
}
`,H_=`#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}
`,V_=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}
`,W_=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	vec4 mvPosition;
	mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}
`,Ht={alphamap_fragment:kb,alphamap_pars_fragment:zb,alphatest_fragment:Ub,aomap_fragment:Gb,aomap_pars_fragment:Hb,begin_vertex:Vb,beginnormal_vertex:Wb,bsdfs:jb,bumpmap_pars_fragment:Xb,clipping_planes_fragment:qb,clipping_planes_pars_fragment:Yb,clipping_planes_pars_vertex:Zb,clipping_planes_vertex:Kb,color_fragment:Jb,color_pars_fragment:Qb,color_pars_vertex:$b,color_vertex:ex,common:tx,cube_uv_reflection_fragment:rx,defaultnormal_vertex:ix,displacementmap_pars_vertex:nx,displacementmap_vertex:ax,emissivemap_fragment:ox,emissivemap_pars_fragment:sx,encodings_fragment:ux,encodings_pars_fragment:cx,envmap_fragment:fx,envmap_pars_fragment:lx,envmap_pars_vertex:hx,envmap_physical_pars_fragment:Ax,envmap_vertex:dx,fog_vertex:px,fog_pars_vertex:vx,fog_fragment:mx,fog_pars_fragment:gx,gradientmap_pars_fragment:yx,lightmap_fragment:bx,lightmap_pars_fragment:xx,lights_lambert_vertex:_x,lights_pars_begin:wx,lights_phong_fragment:Sx,lights_phong_pars_fragment:Mx,lights_physical_fragment:Cx,lights_physical_pars_fragment:Px,lights_fragment_begin:Tx,lights_fragment_maps:Ex,lights_fragment_end:Ix,logdepthbuf_fragment:Rx,logdepthbuf_pars_fragment:Lx,logdepthbuf_pars_vertex:Ox,logdepthbuf_vertex:Dx,map_fragment:Fx,map_pars_fragment:Bx,map_particle_fragment:Nx,map_particle_pars_fragment:kx,metalnessmap_fragment:zx,metalnessmap_pars_fragment:Ux,morphnormal_vertex:Gx,morphtarget_pars_vertex:Hx,morphtarget_vertex:Vx,normal_fragment_begin:Wx,normal_fragment_maps:jx,normalmap_pars_fragment:Xx,packing:qx,premultiplied_alpha_fragment:Yx,project_vertex:Zx,dithering_fragment:Kx,dithering_pars_fragment:Jx,roughnessmap_fragment:Qx,roughnessmap_pars_fragment:$x,shadowmap_pars_fragment:e_,shadowmap_pars_vertex:t_,shadowmap_vertex:r_,shadowmask_pars_fragment:i_,skinbase_vertex:n_,skinning_pars_vertex:a_,skinning_vertex:o_,skinnormal_vertex:s_,specularmap_fragment:u_,specularmap_pars_fragment:c_,tonemapping_fragment:f_,tonemapping_pars_fragment:l_,uv_pars_fragment:h_,uv_pars_vertex:d_,uv_vertex:p_,uv2_pars_fragment:v_,uv2_pars_vertex:m_,uv2_vertex:g_,worldpos_vertex:y_,cube_frag:b_,cube_vert:x_,depth_frag:__,depth_vert:w_,distanceRGBA_frag:A_,distanceRGBA_vert:S_,equirect_frag:M_,equirect_vert:C_,linedashed_frag:P_,linedashed_vert:T_,meshbasic_frag:E_,meshbasic_vert:I_,meshlambert_frag:R_,meshlambert_vert:L_,meshphong_frag:O_,meshphong_vert:D_,meshphysical_frag:F_,meshphysical_vert:B_,normal_frag:N_,normal_vert:k_,points_frag:z_,points_vert:U_,shadow_frag:G_,shadow_vert:H_,sprite_frag:V_,sprite_vert:W_},Lr={merge:function(e){for(var t=this,r={},i=0;i<e.length;i++){var n=t.clone(e[i]);for(var a in n)r[a]=n[a]}return r},clone:function(e){var t={};for(var r in e){t[r]={};for(var i in e[r]){var n=e[r][i];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture)?t[r][i]=n.clone():Array.isArray(n)?t[r][i]=n.slice():t[r][i]=n}}return t}},j_={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Oe(e,t,r){return t===void 0&&r===void 0?this.set(e):this.setRGB(e,t,r)}Object.assign(Oe.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(){function e(t,r,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+(r-t)*6*i:i<1/2?r:i<2/3?t+(r-t)*6*(2/3-i):t}return function(r,i,n){if(r=Pt.euclideanModulo(r,1),i=Pt.clamp(i,0,1),n=Pt.clamp(n,0,1),i===0)this.r=this.g=this.b=n;else{var a=n<=.5?n*(1+i):n+i-n*i,o=2*n-a;this.r=e(o,a,r+1/3),this.g=e(o,a,r),this.b=e(o,a,r-1/3)}return this}}(),setStyle:function(e){function t(l){l!==void 0&&parseFloat(l)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var i,n=r[1],a=r[2];switch(n){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)){var o=parseFloat(i[1])/360,s=parseInt(i[2],10)/100,u=parseInt(i[3],10)/100;return t(i[5]),this.setHSL(o,s,u)}break}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(e)){var c=r[1],f=c.length;if(f===3)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(f===6)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}if(e&&e.length>0){var c=j_[e];c!==void 0?this.setHex(c):console.warn("THREE.Color: Unknown color "+e)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return t===void 0&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){t===void 0&&(t=2);var r=t>0?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(){function e(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}return function(r){return this.r=e(r.r),this.g=e(r.g),this.b=e(r.b),this}}(),copyLinearToSRGB:function(){function e(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}return function(r){return this.r=e(r.r),this.g=e(r.g),this.b=e(r.b),this}}(),convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){e===void 0&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t=this.r,r=this.g,i=this.b,n=Math.max(t,r,i),a=Math.min(t,r,i),o,s,u=(a+n)/2;if(a===n)o=0,s=0;else{var c=n-a;switch(s=u<=.5?c/(n+a):c/(2-n-a),n){case t:o=(r-i)/c+(r<i?6:0);break;case r:o=(i-t)/c+2;break;case i:o=(t-r)/c+4;break}o/=6}return e.h=o,e.s=s,e.l=u,e},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(){var e={};return function(t,r,i){return this.getHSL(e),e.h+=t,e.s+=r,e.l+=i,this.setHSL(e.h,e.s,e.l),this}}(),add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return t===void 0&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}});var $e={common:{diffuse:{value:new Oe(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ur},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ee(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Oe(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Oe(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new Ur}},sprite:{diffuse:{value:new Oe(15658734)},opacity:{value:1},center:{value:new Ee(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new Ur}}},ho={basic:{uniforms:Lr.merge([$e.common,$e.specularmap,$e.envmap,$e.aomap,$e.lightmap,$e.fog]),vertexShader:Ht.meshbasic_vert,fragmentShader:Ht.meshbasic_frag},lambert:{uniforms:Lr.merge([$e.common,$e.specularmap,$e.envmap,$e.aomap,$e.lightmap,$e.emissivemap,$e.fog,$e.lights,{emissive:{value:new Oe(0)}}]),vertexShader:Ht.meshlambert_vert,fragmentShader:Ht.meshlambert_frag},phong:{uniforms:Lr.merge([$e.common,$e.specularmap,$e.envmap,$e.aomap,$e.lightmap,$e.emissivemap,$e.bumpmap,$e.normalmap,$e.displacementmap,$e.gradientmap,$e.fog,$e.lights,{emissive:{value:new Oe(0)},specular:{value:new Oe(1118481)},shininess:{value:30}}]),vertexShader:Ht.meshphong_vert,fragmentShader:Ht.meshphong_frag},standard:{uniforms:Lr.merge([$e.common,$e.envmap,$e.aomap,$e.lightmap,$e.emissivemap,$e.bumpmap,$e.normalmap,$e.displacementmap,$e.roughnessmap,$e.metalnessmap,$e.fog,$e.lights,{emissive:{value:new Oe(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Ht.meshphysical_vert,fragmentShader:Ht.meshphysical_frag},points:{uniforms:Lr.merge([$e.points,$e.fog]),vertexShader:Ht.points_vert,fragmentShader:Ht.points_frag},dashed:{uniforms:Lr.merge([$e.common,$e.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ht.linedashed_vert,fragmentShader:Ht.linedashed_frag},depth:{uniforms:Lr.merge([$e.common,$e.displacementmap]),vertexShader:Ht.depth_vert,fragmentShader:Ht.depth_frag},normal:{uniforms:Lr.merge([$e.common,$e.bumpmap,$e.normalmap,$e.displacementmap,{opacity:{value:1}}]),vertexShader:Ht.normal_vert,fragmentShader:Ht.normal_frag},sprite:{uniforms:Lr.merge([$e.sprite,$e.fog]),vertexShader:Ht.sprite_vert,fragmentShader:Ht.sprite_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ht.cube_vert,fragmentShader:Ht.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ht.equirect_vert,fragmentShader:Ht.equirect_frag},distanceRGBA:{uniforms:Lr.merge([$e.common,$e.displacementmap,{referencePosition:{value:new I},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ht.distanceRGBA_vert,fragmentShader:Ht.distanceRGBA_frag},shadow:{uniforms:Lr.merge([$e.lights,$e.fog,{color:{value:new Oe(0)},opacity:{value:1}}]),vertexShader:Ht.shadow_vert,fragmentShader:Ht.shadow_frag}};ho.physical={uniforms:Lr.merge([ho.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Ht.meshphysical_vert,fragmentShader:Ht.meshphysical_frag};function Id(){var e=null,t=!1,r=null;function i(n,a){t!==!1&&(r(n,a),e.requestAnimationFrame(i))}return{start:function(){t!==!0&&r!==null&&(e.requestAnimationFrame(i),t=!0)},stop:function(){t=!1},setAnimationLoop:function(n){r=n},setContext:function(n){e=n}}}function X_(e){var t=new WeakMap;function r(s,u){var c=s.array,f=s.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW,l=e.createBuffer();e.bindBuffer(u,l),e.bufferData(u,c,f),s.onUploadCallback();var h=e.FLOAT;return c instanceof Float32Array?h=e.FLOAT:c instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):c instanceof Uint16Array?h=e.UNSIGNED_SHORT:c instanceof Int16Array?h=e.SHORT:c instanceof Uint32Array?h=e.UNSIGNED_INT:c instanceof Int32Array?h=e.INT:c instanceof Int8Array?h=e.BYTE:c instanceof Uint8Array&&(h=e.UNSIGNED_BYTE),{buffer:l,type:h,bytesPerElement:c.BYTES_PER_ELEMENT,version:s.version}}function i(s,u,c){var f=u.array,l=u.updateRange;e.bindBuffer(c,s),u.dynamic===!1?e.bufferData(c,f,e.STATIC_DRAW):l.count===-1?e.bufferSubData(c,0,f):l.count===0?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(c,l.offset*f.BYTES_PER_ELEMENT,f.subarray(l.offset,l.offset+l.count)),l.count=-1)}function n(s){return s.isInterleavedBufferAttribute&&(s=s.data),t.get(s)}function a(s){s.isInterleavedBufferAttribute&&(s=s.data);var u=t.get(s);u&&(e.deleteBuffer(u.buffer),t.delete(s))}function o(s,u){s.isInterleavedBufferAttribute&&(s=s.data);var c=t.get(s);c===void 0?t.set(s,r(s,u)):c.version<s.version&&(i(c.buffer,s,u),c.version=s.version)}return{get:n,remove:a,update:o}}function ra(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._order=i||ra.DefaultOrder}ra.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];ra.DefaultOrder="XYZ";Object.defineProperties(ra.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}}});Object.assign(ra.prototype,{isEuler:!0,set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._order=i||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,r){var i=Pt.clamp,n=e.elements,a=n[0],o=n[4],s=n[8],u=n[1],c=n[5],f=n[9],l=n[2],h=n[6],d=n[10];return t=t||this._order,t==="XYZ"?(this._y=Math.asin(i(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-f,d),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(h,c),this._z=0)):t==="YXZ"?(this._x=Math.asin(-i(f,-1,1)),Math.abs(f)<.99999?(this._y=Math.atan2(s,d),this._z=Math.atan2(u,c)):(this._y=Math.atan2(-l,a),this._z=0)):t==="ZXY"?(this._x=Math.asin(i(h,-1,1)),Math.abs(h)<.99999?(this._y=Math.atan2(-l,d),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(u,a))):t==="ZYX"?(this._y=Math.asin(-i(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(h,d),this._z=Math.atan2(u,a)):(this._x=0,this._z=Math.atan2(-o,c))):t==="YZX"?(this._z=Math.asin(i(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(-f,c),this._y=Math.atan2(-l,a)):(this._x=0,this._y=Math.atan2(s,d))):t==="XZY"?(this._z=Math.asin(-i(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(h,c),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-f,d),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,r!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var e=new Ae;return function(r,i,n){return e.makeRotationFromQuaternion(r),this.setFromRotationMatrix(e,i,n)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new er;return function(r){return e.setFromEuler(this),this.setFromQuaternion(e,r)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new I(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}});function Cg(){this.mask=1}Object.assign(Cg.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},test:function(e){return(this.mask&e.mask)!==0}});var q_=0;function Ge(){Object.defineProperty(this,"id",{value:q_++}),this.uuid=Pt.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ge.DefaultUp.clone();var e=new I,t=new ra,r=new er,i=new I(1,1,1);function n(){r.setFromEuler(t,!1)}function a(){t.setFromQuaternion(r,void 0,!1)}t.onChange(n),r.onChange(a),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:r},scale:{enumerable:!0,value:i},modelViewMatrix:{value:new Ae},normalMatrix:{value:new Ur}}),this.matrix=new Ae,this.matrixWorld=new Ae,this.matrixAutoUpdate=Ge.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Cg,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}Ge.DefaultUp=new I(0,1,0);Ge.DefaultMatrixAutoUpdate=!0;Ge.prototype=Object.assign(Object.create(fa.prototype),{constructor:Ge,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new er;return function(r,i){return e.setFromAxisAngle(r,i),this.quaternion.multiply(e),this}}(),rotateOnWorldAxis:function(){var e=new er;return function(r,i){return e.setFromAxisAngle(r,i),this.quaternion.premultiply(e),this}}(),rotateX:function(){var e=new I(1,0,0);return function(r){return this.rotateOnAxis(e,r)}}(),rotateY:function(){var e=new I(0,1,0);return function(r){return this.rotateOnAxis(e,r)}}(),rotateZ:function(){var e=new I(0,0,1);return function(r){return this.rotateOnAxis(e,r)}}(),translateOnAxis:function(){var e=new I;return function(r,i){return e.copy(r).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(i)),this}}(),translateX:function(){var e=new I(1,0,0);return function(r){return this.translateOnAxis(e,r)}}(),translateY:function(){var e=new I(0,1,0);return function(r){return this.translateOnAxis(e,r)}}(),translateZ:function(){var e=new I(0,0,1);return function(r){return this.translateOnAxis(e,r)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new Ae;return function(r){return r.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new Ae,t=new I;return function(i,n,a){i.isVector3?t.copy(i):t.set(i,n,a),this.isCamera?e.lookAt(this.position,t,this.up):e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){var t=arguments,r=this;if(arguments.length>1){for(var i=0;i<arguments.length;i++)r.add(t[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){var t=arguments,r=this;if(arguments.length>1){for(var i=0;i<arguments.length;i++)r.remove(t[i]);return this}var n=this.children.indexOf(e);return n!==-1&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(n,1)),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){var r=this;if(this[e]===t)return this;for(var i=0,n=this.children.length;i<n;i++){var a=r.children[i],o=a.getObjectByProperty(e,t);if(o!==void 0)return o}},getWorldPosition:function(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new I),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new I,t=new I;return function(i){return i===void 0&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),i=new er),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,i,t),i}}(),getWorldScale:function(){var e=new I,t=new er;return function(i){return i===void 0&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),i=new I),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,i),i}}(),getWorldDirection:function(){var e=new er;return function(r){return r===void 0&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),r=new I),this.getWorldQuaternion(e),r.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].traverse(e)},traverseVisible:function(e){if(this.visible!==!1){e(this);for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].updateMatrixWorld(e)},toJSON:function(e){var t=this,r=e===void 0||typeof e=="string",i={};r&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1);function a(g,x){return g[x.uuid]===void 0&&(g[x.uuid]=x.toJSON(e)),x.uuid}if(this.isMesh||this.isLine||this.isPoints){n.geometry=a(e.geometries,this.geometry);var o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){var s=o.shapes;if(Array.isArray(s))for(var u=0,c=s.length;u<c;u++){var f=s[u];a(e.shapes,f)}else a(e.shapes,s)}}if(this.material!==void 0)if(Array.isArray(this.material)){for(var l=[],u=0,c=this.material.length;u<c;u++)l.push(a(e.materials,t.material[u]));n.material=l}else n.material=a(e.materials,this.material);if(this.children.length>0){n.children=[];for(var u=0;u<this.children.length;u++)n.children.push(t.children[u].toJSON(e).object)}if(r){var h=m(e.geometries),d=m(e.materials),p=m(e.textures),v=m(e.images),s=m(e.shapes);h.length>0&&(i.geometries=h),d.length>0&&(i.materials=d),p.length>0&&(i.textures=p),v.length>0&&(i.images=v),s.length>0&&(i.shapes=s)}return i.object=n,i;function m(g){var x=[];for(var y in g){var b=g[y];delete b.metadata,x.push(b)}return x}},clone:function(e){return new this.constructor().copy(this,e)},copy:function(e,t){var r=this;if(t===void 0&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(var i=0;i<e.children.length;i++){var n=e.children[i];r.add(n.clone())}return this}});function Ln(){Ge.call(this),this.type="Camera",this.matrixWorldInverse=new Ae,this.projectionMatrix=new Ae}Ln.prototype=Object.assign(Object.create(Ge.prototype),{constructor:Ln,isCamera:!0,copy:function(e,t){return Ge.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this},getWorldDirection:function(){var e=new er;return function(r){return r===void 0&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),r=new I),this.getWorldQuaternion(e),r.set(0,0,-1).applyQuaternion(e)}}(),updateMatrixWorld:function(e){Ge.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return new this.constructor().copy(this)}});function ia(e,t,r,i,n,a){Ln.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=n!==void 0?n:.1,this.far=a!==void 0?a:2e3,this.updateProjectionMatrix()}ia.prototype=Object.assign(Object.create(Ln.prototype),{constructor:ia,isOrthographicCamera:!0,copy:function(e,t){return Ln.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this},setViewOffset:function(e,t,r,i,n,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2,n=r-e,a=r+e,o=i+t,s=i-t;if(this.view!==null&&this.view.enabled){var u=this.zoom/(this.view.width/this.view.fullWidth),c=this.zoom/(this.view.height/this.view.fullHeight),f=(this.right-this.left)/this.view.width,l=(this.top-this.bottom)/this.view.height;n+=f*(this.view.offsetX/u),a=n+f*(this.view.width/u),o-=l*(this.view.offsetY/c),s=o-l*(this.view.height/c)}this.projectionMatrix.makeOrthographic(n,a,o,s,this.near,this.far)},toJSON:function(e){var t=Ge.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}});function nn(e,t,r,i,n,a){this.a=e,this.b=t,this.c=r,this.normal=i&&i.isVector3?i:new I,this.vertexNormals=Array.isArray(i)?i:[],this.color=n&&n.isColor?n:new Oe,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=a!==void 0?a:0}Object.assign(nn.prototype,{clone:function(){return new this.constructor().copy(this)},copy:function(e){var t=this;this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var r=0,i=e.vertexNormals.length;r<i;r++)t.vertexNormals[r]=e.vertexNormals[r].clone();for(var r=0,i=e.vertexColors.length;r<i;r++)t.vertexColors[r]=e.vertexColors[r].clone();return this}});var Y_=0;function st(){Object.defineProperty(this,"id",{value:Y_+=2}),this.uuid=Pt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}st.prototype=Object.assign(Object.create(fa.prototype),{constructor:st,isGeometry:!0,applyMatrix:function(e){for(var t=this,r=new Ur().getNormalMatrix(e),i=0,n=this.vertices.length;i<n;i++){var a=t.vertices[i];a.applyMatrix4(e)}for(var i=0,n=this.faces.length;i<n;i++){var o=t.faces[i];o.normal.applyMatrix3(r).normalize();for(var s=0,u=o.vertexNormals.length;s<u;s++)o.vertexNormals[s].applyMatrix3(r).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var e=new Ae;return function(r){return e.makeRotationX(r),this.applyMatrix(e),this}}(),rotateY:function(){var e=new Ae;return function(r){return e.makeRotationY(r),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new Ae;return function(r){return e.makeRotationZ(r),this.applyMatrix(e),this}}(),translate:function(){var e=new Ae;return function(r,i,n){return e.makeTranslation(r,i,n),this.applyMatrix(e),this}}(),scale:function(){var e=new Ae;return function(r,i,n){return e.makeScale(r,i,n),this.applyMatrix(e),this}}(),lookAt:function(){var e=new Ge;return function(r){e.lookAt(r),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){var t=this,r=e.index!==null?e.index.array:void 0,i=e.attributes,n=i.position.array,a=i.normal!==void 0?i.normal.array:void 0,o=i.color!==void 0?i.color.array:void 0,s=i.uv!==void 0?i.uv.array:void 0,u=i.uv2!==void 0?i.uv2.array:void 0;u!==void 0&&(this.faceVertexUvs[1]=[]);for(var c=[],f=[],l=[],h=0,d=0;h<n.length;h+=3,d+=2)t.vertices.push(new I(n[h],n[h+1],n[h+2])),a!==void 0&&c.push(new I(a[h],a[h+1],a[h+2])),o!==void 0&&t.colors.push(new Oe(o[h],o[h+1],o[h+2])),s!==void 0&&f.push(new Ee(s[d],s[d+1])),u!==void 0&&l.push(new Ee(u[d],u[d+1]));function p(b,_,w,A){var S=a!==void 0?[c[b].clone(),c[_].clone(),c[w].clone()]:[],M=o!==void 0?[t.colors[b].clone(),t.colors[_].clone(),t.colors[w].clone()]:[],E=new nn(b,_,w,S,M,A);t.faces.push(E),s!==void 0&&t.faceVertexUvs[0].push([f[b].clone(),f[_].clone(),f[w].clone()]),u!==void 0&&t.faceVertexUvs[1].push([l[b].clone(),l[_].clone(),l[w].clone()])}var v=e.groups;if(v.length>0)for(var h=0;h<v.length;h++)for(var m=v[h],g=m.start,x=m.count,d=g,y=g+x;d<y;d+=3)r!==void 0?p(r[d],r[d+1],r[d+2],m.materialIndex):p(d,d+1,d+2,m.materialIndex);else if(r!==void 0)for(var h=0;h<r.length;h+=3)p(r[h],r[h+1],r[h+2]);else for(var h=0;h<n.length/3;h+=3)p(h,h+1,h+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){var e=new I;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,r=t===0?1:1/t,i=new Ae;return i.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix(i),this},computeFaceNormals:function(){for(var e=this,t=new I,r=new I,i=0,n=this.faces.length;i<n;i++){var a=e.faces[i],o=e.vertices[a.a],s=e.vertices[a.b],u=e.vertices[a.c];t.subVectors(u,s),r.subVectors(o,s),t.cross(r),t.normalize(),a.normal.copy(t)}},computeVertexNormals:function(e){var t=this;e===void 0&&(e=!0);var r,i,n,a,o,s;for(s=new Array(this.vertices.length),r=0,i=this.vertices.length;r<i;r++)s[r]=new I;if(e){var u,c,f,l=new I,h=new I;for(n=0,a=this.faces.length;n<a;n++)o=t.faces[n],u=t.vertices[o.a],c=t.vertices[o.b],f=t.vertices[o.c],l.subVectors(f,c),h.subVectors(u,c),l.cross(h),s[o.a].add(l),s[o.b].add(l),s[o.c].add(l)}else for(this.computeFaceNormals(),n=0,a=this.faces.length;n<a;n++)o=t.faces[n],s[o.a].add(o.normal),s[o.b].add(o.normal),s[o.c].add(o.normal);for(r=0,i=this.vertices.length;r<i;r++)s[r].normalize();for(n=0,a=this.faces.length;n<a;n++){o=t.faces[n];var d=o.vertexNormals;d.length===3?(d[0].copy(s[o.a]),d[1].copy(s[o.b]),d[2].copy(s[o.c])):(d[0]=s[o.a].clone(),d[1]=s[o.b].clone(),d[2]=s[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e=this,t,r,i;for(this.computeFaceNormals(),t=0,r=this.faces.length;t<r;t++){i=e.faces[t];var n=i.vertexNormals;n.length===3?(n[0].copy(i.normal),n[1].copy(i.normal),n[2].copy(i.normal)):(n[0]=i.normal.clone(),n[1]=i.normal.clone(),n[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e=this,t,r,i,n,a;for(i=0,n=this.faces.length;i<n;i++)for(a=e.faces[i],a.__originalFaceNormal?a.__originalFaceNormal.copy(a.normal):a.__originalFaceNormal=a.normal.clone(),a.__originalVertexNormals||(a.__originalVertexNormals=[]),t=0,r=a.vertexNormals.length;t<r;t++)a.__originalVertexNormals[t]?a.__originalVertexNormals[t].copy(a.vertexNormals[t]):a.__originalVertexNormals[t]=a.vertexNormals[t].clone();var o=new st;for(o.faces=this.faces,t=0,r=this.morphTargets.length;t<r;t++){if(!e.morphNormals[t]){e.morphNormals[t]={},e.morphNormals[t].faceNormals=[],e.morphNormals[t].vertexNormals=[];var s=e.morphNormals[t].faceNormals,u=e.morphNormals[t].vertexNormals,f,l;for(i=0,n=this.faces.length;i<n;i++)f=new I,l={a:new I,b:new I,c:new I},s.push(f),u.push(l)}var c=e.morphNormals[t];o.vertices=e.morphTargets[t].vertices,o.computeFaceNormals(),o.computeVertexNormals();var f,l;for(i=0,n=this.faces.length;i<n;i++)a=e.faces[i],f=c.faceNormals[i],l=c.vertexNormals[i],f.copy(a.normal),l.a.copy(a.vertexNormals[0]),l.b.copy(a.vertexNormals[1]),l.c.copy(a.vertexNormals[2])}for(i=0,n=this.faces.length;i<n;i++)a=e.faces[i],a.normal=a.__originalFaceNormal,a.vertexNormals=a.__originalVertexNormals},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new ir),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new sn),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}var i,n=this.vertices.length,a=this.vertices,o=e.vertices,s=this.faces,u=e.faces,c=this.faceVertexUvs[0],f=e.faceVertexUvs[0],l=this.colors,h=e.colors;r===void 0&&(r=0),t!==void 0&&(i=new Ur().getNormalMatrix(t));for(var d=0,p=o.length;d<p;d++){var v=o[d],m=v.clone();t!==void 0&&m.applyMatrix4(t),a.push(m)}for(var d=0,p=h.length;d<p;d++)l.push(h[d].clone());for(d=0,p=u.length;d<p;d++){var g=u[d],x,y,b,_=g.vertexNormals,w=g.vertexColors;x=new nn(g.a+n,g.b+n,g.c+n),x.normal.copy(g.normal),i!==void 0&&x.normal.applyMatrix3(i).normalize();for(var A=0,S=_.length;A<S;A++)y=_[A].clone(),i!==void 0&&y.applyMatrix3(i).normalize(),x.vertexNormals.push(y);x.color.copy(g.color);for(var A=0,S=w.length;A<S;A++)b=w[A],x.vertexColors.push(b.clone());x.materialIndex=g.materialIndex+r,s.push(x)}for(d=0,p=f.length;d<p;d++){var M=f[d],E=[];if(M!==void 0){for(var A=0,S=M.length;A<S;A++)E.push(M[A].clone());c.push(E)}}},mergeMesh:function(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)},mergeVertices:function(){var e=this,t={},r=[],i=[],n,a,o=4,s=Math.pow(10,o),u,c,f,l,h,d;for(u=0,c=this.vertices.length;u<c;u++)n=e.vertices[u],a=Math.round(n.x*s)+"_"+Math.round(n.y*s)+"_"+Math.round(n.z*s),t[a]===void 0?(t[a]=u,r.push(e.vertices[u]),i[u]=r.length-1):i[u]=i[t[a]];var p=[];for(u=0,c=this.faces.length;u<c;u++){f=e.faces[u],f.a=i[f.a],f.b=i[f.b],f.c=i[f.c],l=[f.a,f.b,f.c];for(var v=0;v<3;v++)if(l[v]===l[(v+1)%3]){p.push(u);break}}for(u=p.length-1;u>=0;u--){var m=p[u];for(e.faces.splice(m,1),h=0,d=this.faceVertexUvs.length;h<d;h++)e.faceVertexUvs[h].splice(m,1)}var g=this.vertices.length-r.length;return this.vertices=r,g},setFromPoints:function(e){var t=this;this.vertices=[];for(var r=0,i=e.length;r<i;r++){var n=e[r];t.vertices.push(new I(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,r=0;r<t;r++)e[r]._id=r;function i(c,f){return c.materialIndex-f.materialIndex}e.sort(i);var n=this.faceVertexUvs[0],a=this.faceVertexUvs[1],o,s;n&&n.length===t&&(o=[]),a&&a.length===t&&(s=[]);for(var r=0;r<t;r++){var u=e[r]._id;o&&o.push(n[u]),s&&s.push(a[u])}o&&(this.faceVertexUvs[0]=o),s&&(this.faceVertexUvs[1]=s)},toJSON:function(){var e=this,t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),this.parameters!==void 0){var r=this.parameters;for(var i in r)r[i]!==void 0&&(t[i]=r[i]);return t}for(var n=[],a=0;a<this.vertices.length;a++){var o=e.vertices[a];n.push(o.x,o.y,o.z)}for(var s=[],u=[],c={},f=[],l={},h=[],d={},a=0;a<this.faces.length;a++){var p=e.faces[a],v=!0,m=!1,g=e.faceVertexUvs[0][a]!==void 0,x=p.normal.length()>0,y=p.vertexNormals.length>0,b=p.color.r!==1||p.color.g!==1||p.color.b!==1,_=p.vertexColors.length>0,w=0;if(w=E(w,0,0),w=E(w,1,v),w=E(w,2,m),w=E(w,3,g),w=E(w,4,x),w=E(w,5,y),w=E(w,6,b),w=E(w,7,_),s.push(w),s.push(p.a,p.b,p.c),s.push(p.materialIndex),g){var A=e.faceVertexUvs[0][a];s.push(X(A[0]),X(A[1]),X(A[2]))}if(x&&s.push(T(p.normal)),y){var S=p.vertexNormals;s.push(T(S[0]),T(S[1]),T(S[2]))}if(b&&s.push(H(p.color)),_){var M=p.vertexColors;s.push(H(M[0]),H(M[1]),H(M[2]))}}function E(q,Z,Q){return Q?q|1<<Z:q&~(1<<Z)}function T(q){var Z=q.x.toString()+q.y.toString()+q.z.toString();return c[Z]!==void 0||(c[Z]=u.length/3,u.push(q.x,q.y,q.z)),c[Z]}function H(q){var Z=q.r.toString()+q.g.toString()+q.b.toString();return l[Z]!==void 0||(l[Z]=f.length,f.push(q.getHex())),l[Z]}function X(q){var Z=q.x.toString()+q.y.toString();return d[Z]!==void 0||(d[Z]=h.length/2,h.push(q.x,q.y)),d[Z]}return t.data={},t.data.vertices=n,t.data.normals=u,f.length>0&&(t.data.colors=f),h.length>0&&(t.data.uvs=[h]),t.data.faces=s,t},clone:function(){return new st().copy(this)},copy:function(e){var t=this,r,i,n,a,o,s;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var u=e.vertices;for(r=0,i=u.length;r<i;r++)t.vertices.push(u[r].clone());var c=e.colors;for(r=0,i=c.length;r<i;r++)t.colors.push(c[r].clone());var f=e.faces;for(r=0,i=f.length;r<i;r++)t.faces.push(f[r].clone());for(r=0,i=e.faceVertexUvs.length;r<i;r++){var l=e.faceVertexUvs[r];for(t.faceVertexUvs[r]===void 0&&(t.faceVertexUvs[r]=[]),n=0,a=l.length;n<a;n++){var h=l[n],d=[];for(o=0,s=h.length;o<s;o++){var p=h[o];d.push(p.clone())}t.faceVertexUvs[r].push(d)}}var v=e.morphTargets;for(r=0,i=v.length;r<i;r++){var m={};if(m.name=v[r].name,v[r].vertices!==void 0)for(m.vertices=[],n=0,a=v[r].vertices.length;n<a;n++)m.vertices.push(v[r].vertices[n].clone());if(v[r].normals!==void 0)for(m.normals=[],n=0,a=v[r].normals.length;n<a;n++)m.normals.push(v[r].normals[n].clone());t.morphTargets.push(m)}var g=e.morphNormals;for(r=0,i=g.length;r<i;r++){var x={};if(g[r].vertexNormals!==void 0)for(x.vertexNormals=[],n=0,a=g[r].vertexNormals.length;n<a;n++){var y=g[r].vertexNormals[n],b={};b.a=y.a.clone(),b.b=y.b.clone(),b.c=y.c.clone(),x.vertexNormals.push(b)}if(g[r].faceNormals!==void 0)for(x.faceNormals=[],n=0,a=g[r].faceNormals.length;n<a;n++)x.faceNormals.push(g[r].faceNormals[n].clone());t.morphNormals.push(x)}var _=e.skinWeights;for(r=0,i=_.length;r<i;r++)t.skinWeights.push(_[r].clone());var w=e.skinIndices;for(r=0,i=w.length;r<i;r++)t.skinIndices.push(w[r].clone());var A=e.lineDistances;for(r=0,i=A.length;r<i;r++)t.lineDistances.push(A[r]);var S=e.boundingBox;S!==null&&(this.boundingBox=S.clone());var M=e.boundingSphere;return M!==null&&(this.boundingSphere=M.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});function ft(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=r===!0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}Object.defineProperty(ft.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}});Object.assign(ft.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=e!==void 0?e.length/this.itemSize:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){var i=this;e*=this.itemSize,r*=t.itemSize;for(var n=0,a=this.itemSize;n<a;n++)i.array[e+n]=t.array[r+n];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;i<n;i++){var a=e[i];a===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),a=new Oe),t[r++]=a.r,t[r++]=a.g,t[r++]=a.b}return this},copyVector2sArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;i<n;i++){var a=e[i];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),a=new Ee),t[r++]=a.x,t[r++]=a.y}return this},copyVector3sArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;i<n;i++){var a=e[i];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),a=new I),t[r++]=a.x,t[r++]=a.y,t[r++]=a.z}return this},copyVector4sArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;i<n;i++){var a=e[i];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),a=new $t),t[r++]=a.x,t[r++]=a.y,t[r++]=a.z,t[r++]=a.w}return this},set:function(e,t){return t===void 0&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this},setXYZW:function(e,t,r,i,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=n,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}});function Lh(e,t,r){ft.call(this,new Int8Array(e),t,r)}Lh.prototype=Object.create(ft.prototype);Lh.prototype.constructor=Lh;function Oh(e,t,r){ft.call(this,new Uint8Array(e),t,r)}Oh.prototype=Object.create(ft.prototype);Oh.prototype.constructor=Oh;function Dh(e,t,r){ft.call(this,new Uint8ClampedArray(e),t,r)}Dh.prototype=Object.create(ft.prototype);Dh.prototype.constructor=Dh;function Fh(e,t,r){ft.call(this,new Int16Array(e),t,r)}Fh.prototype=Object.create(ft.prototype);Fh.prototype.constructor=Fh;function zs(e,t,r){ft.call(this,new Uint16Array(e),t,r)}zs.prototype=Object.create(ft.prototype);zs.prototype.constructor=zs;function Bh(e,t,r){ft.call(this,new Int32Array(e),t,r)}Bh.prototype=Object.create(ft.prototype);Bh.prototype.constructor=Bh;function Us(e,t,r){ft.call(this,new Uint32Array(e),t,r)}Us.prototype=Object.create(ft.prototype);Us.prototype.constructor=Us;function ze(e,t,r){ft.call(this,new Float32Array(e),t,r)}ze.prototype=Object.create(ft.prototype);ze.prototype.constructor=ze;function Nh(e,t,r){ft.call(this,new Float64Array(e),t,r)}Nh.prototype=Object.create(ft.prototype);Nh.prototype.constructor=Nh;function Pg(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}Object.assign(Pg.prototype,{computeGroups:function(e){for(var t,r=[],i=void 0,n=e.faces,a=0;a<n.length;a++){var o=n[a];o.materialIndex!==i&&(i=o.materialIndex,t!==void 0&&(t.count=a*3-t.start,r.push(t)),t={start:a*3,materialIndex:i})}t!==void 0&&(t.count=a*3-t.start,r.push(t)),this.groups=r},fromGeometry:function(e){var t=this,r=e.faces,i=e.vertices,n=e.faceVertexUvs,a=n[0]&&n[0].length>0,o=n[1]&&n[1].length>0,s=e.morphTargets,u=s.length,c;if(u>0){c=[];for(var f=0;f<u;f++)c[f]=[];this.morphTargets.position=c}var l=e.morphNormals,h=l.length,d;if(h>0){d=[];for(var f=0;f<h;f++)d[f]=[];this.morphTargets.normal=d}var p=e.skinIndices,v=e.skinWeights,m=p.length===i.length,g=v.length===i.length;i.length>0&&r.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(var f=0;f<r.length;f++){var x=r[f];t.vertices.push(i[x.a],i[x.b],i[x.c]);var y=x.vertexNormals;if(y.length===3)t.normals.push(y[0],y[1],y[2]);else{var b=x.normal;t.normals.push(b,b,b)}var _=x.vertexColors;if(_.length===3)t.colors.push(_[0],_[1],_[2]);else{var w=x.color;t.colors.push(w,w,w)}if(a===!0){var A=n[0][f];A!==void 0?t.uvs.push(A[0],A[1],A[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",f),t.uvs.push(new Ee,new Ee,new Ee))}if(o===!0){var A=n[1][f];A!==void 0?t.uvs2.push(A[0],A[1],A[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",f),t.uvs2.push(new Ee,new Ee,new Ee))}for(var S=0;S<u;S++){var M=s[S].vertices;c[S].push(M[x.a],M[x.b],M[x.c])}for(var S=0;S<h;S++){var E=l[S].vertexNormals[f];d[S].push(E.a,E.b,E.c)}m&&t.skinIndices.push(p[x.a],p[x.b],p[x.c]),g&&t.skinWeights.push(v[x.a],v[x.b],v[x.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}});function Tg(e){if(e.length===0)return-1/0;for(var t=e[0],r=1,i=e.length;r<i;++r)e[r]>t&&(t=e[r]);return t}var Z_=1;function Ue(){Object.defineProperty(this,"id",{value:Z_+=2}),this.uuid=Pt.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Ue.prototype=Object.assign(Object.create(fa.prototype),{constructor:Ue,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(Tg(e)>65535?Us:zs)(e,1):this.index=e},addAttribute:function(e,t){return!(t&&t.isBufferAttribute)&&!(t&&t.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(e,new ft(arguments[1],arguments[2]))):e==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):(this.attributes[e]=t,this)},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:r!==void 0?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;t!==void 0&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var r=this.attributes.normal;if(r!==void 0){var i=new Ur().getNormalMatrix(e);i.applyToBufferAttribute(r),r.needsUpdate=!0}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this},rotateX:function(){var e=new Ae;return function(r){return e.makeRotationX(r),this.applyMatrix(e),this}}(),rotateY:function(){var e=new Ae;return function(r){return e.makeRotationY(r),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new Ae;return function(r){return e.makeRotationZ(r),this.applyMatrix(e),this}}(),translate:function(){var e=new Ae;return function(r,i,n){return e.makeTranslation(r,i,n),this.applyMatrix(e),this}}(),scale:function(){var e=new Ae;return function(r,i,n){return e.makeScale(r,i,n),this.applyMatrix(e),this}}(),lookAt:function(){var e=new Ge;return function(r){e.lookAt(r),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){var e=new I;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var r=new ze(t.vertices.length*3,3),i=new ze(t.colors.length*3,3);if(this.addAttribute("position",r.copyVector3sArray(t.vertices)),this.addAttribute("color",i.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var n=new ze(t.lineDistances.length,1);this.addAttribute("lineDistance",n.copyArray(t.lineDistances))}t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],r=0,i=e.length;r<i;r++){var n=e[r];t.push(n.x,n.y,n.z||0)}return this.addAttribute("position",new ze(t,3)),this},updateFromObject:function(e){var t=e.geometry;if(e.isMesh){var r=t.__directGeometry;if(t.elementsNeedUpdate===!0&&(r=void 0,t.elementsNeedUpdate=!1),r===void 0)return this.fromGeometry(t);r.verticesNeedUpdate=t.verticesNeedUpdate,r.normalsNeedUpdate=t.normalsNeedUpdate,r.colorsNeedUpdate=t.colorsNeedUpdate,r.uvsNeedUpdate=t.uvsNeedUpdate,r.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=r}var i;return t.verticesNeedUpdate===!0&&(i=this.attributes.position,i!==void 0&&(i.copyVector3sArray(t.vertices),i.needsUpdate=!0),t.verticesNeedUpdate=!1),t.normalsNeedUpdate===!0&&(i=this.attributes.normal,i!==void 0&&(i.copyVector3sArray(t.normals),i.needsUpdate=!0),t.normalsNeedUpdate=!1),t.colorsNeedUpdate===!0&&(i=this.attributes.color,i!==void 0&&(i.copyColorsArray(t.colors),i.needsUpdate=!0),t.colorsNeedUpdate=!1),t.uvsNeedUpdate&&(i=this.attributes.uv,i!==void 0&&(i.copyVector2sArray(t.uvs),i.needsUpdate=!0),t.uvsNeedUpdate=!1),t.lineDistancesNeedUpdate&&(i=this.attributes.lineDistance,i!==void 0&&(i.copyArray(t.lineDistances),i.needsUpdate=!0),t.lineDistancesNeedUpdate=!1),t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=new Pg().fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=this,r=new Float32Array(e.vertices.length*3);if(this.addAttribute("position",new ft(r,3).copyVector3sArray(e.vertices)),e.normals.length>0){var i=new Float32Array(e.normals.length*3);this.addAttribute("normal",new ft(i,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var n=new Float32Array(e.colors.length*3);this.addAttribute("color",new ft(n,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var a=new Float32Array(e.uvs.length*2);this.addAttribute("uv",new ft(a,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(e.uvs2.length*2);this.addAttribute("uv2",new ft(o,2).copyVector2sArray(e.uvs2))}this.groups=e.groups;for(var s in e.morphTargets){for(var u=[],c=e.morphTargets[s],f=0,l=c.length;f<l;f++){var h=c[f],d=new ze(h.length*3,3);u.push(d.copyVector3sArray(h))}t.morphAttributes[s]=u}if(e.skinIndices.length>0){var p=new ze(e.skinIndices.length*4,4);this.addAttribute("skinIndex",p.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var v=new ze(e.skinWeights.length*4,4);this.addAttribute("skinWeight",v.copyVector4sArray(e.skinWeights))}return e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new ir);var e=this.attributes.position;e!==void 0?this.boundingBox.setFromBufferAttribute(e):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var e=new ir,t=new I;return function(){this.boundingSphere===null&&(this.boundingSphere=new sn);var i=this.attributes.position;if(i){var n=this.boundingSphere.center;e.setFromBufferAttribute(i),e.getCenter(n);for(var a=0,o=0,s=i.count;o<s;o++)t.x=i.getX(o),t.y=i.getY(o),t.z=i.getZ(o),a=Math.max(a,n.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes,r=this.groups;if(t.position){var i=t.position.array;if(t.normal===void 0)this.addAttribute("normal",new ft(new Float32Array(i.length),3));else for(var n=t.normal.array,a=0,o=n.length;a<o;a++)n[a]=0;var s=t.normal.array,u,c,f,l=new I,h=new I,d=new I,p=new I,v=new I;if(e){var m=e.array;r.length===0&&this.addGroup(0,m.length);for(var g=0,x=r.length;g<x;++g)for(var y=r[g],b=y.start,_=y.count,a=b,o=b+_;a<o;a+=3)u=m[a+0]*3,c=m[a+1]*3,f=m[a+2]*3,l.fromArray(i,u),h.fromArray(i,c),d.fromArray(i,f),p.subVectors(d,h),v.subVectors(l,h),p.cross(v),s[u]+=p.x,s[u+1]+=p.y,s[u+2]+=p.z,s[c]+=p.x,s[c+1]+=p.y,s[c+2]+=p.z,s[f]+=p.x,s[f+1]+=p.y,s[f+2]+=p.z}else for(var a=0,o=i.length;a<o;a+=9)l.fromArray(i,a),h.fromArray(i,a+3),d.fromArray(i,a+6),p.subVectors(d,h),v.subVectors(l,h),p.cross(v),s[a]=p.x,s[a+1]=p.y,s[a+2]=p.z,s[a+3]=p.x,s[a+4]=p.y,s[a+5]=p.z,s[a+6]=p.x,s[a+7]=p.y,s[a+8]=p.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var i in r)if(e.attributes[i]!==void 0)for(var n=r[i],a=n.array,o=e.attributes[i],s=o.array,u=o.itemSize,c=0,f=u*t;c<s.length;c++,f++)a[f]=s[c];return this},normalizeNormals:function(){var e=new I;return function(){for(var r=this.attributes.normal,i=0,n=r.count;i<n;i++)e.x=r.getX(i),e.y=r.getY(i),e.z=r.getZ(i),e.normalize(),r.setXYZ(i,e.x,e.y,e.z)}}(),toNonIndexed:function(){if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new Ue,t=this.index.array,r=this.attributes;for(var i in r){for(var n=r[i],a=n.array,o=n.itemSize,s=new a.constructor(t.length*o),u=0,c=0,f=0,l=t.length;f<l;f++){u=t[f]*o;for(var h=0;h<o;h++)s[c++]=a[u++]}e.addAttribute(i,new ft(s,o))}for(var d=this.groups,f=0,l=d.length;f<l;f++){var p=d[f];e.addGroup(p.start,p.count,p.materialIndex)}return e},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){var t=this.parameters;for(var r in t)t[r]!==void 0&&(e[r]=t[r]);return e}e.data={attributes:{}};var i=this.index;if(i!==null){var n=Array.prototype.slice.call(i.array);e.data.index={type:i.array.constructor.name,array:n}}var a=this.attributes;for(var r in a){var o=a[r],n=Array.prototype.slice.call(o.array);e.data.attributes[r]={itemSize:o.itemSize,type:o.array.constructor.name,array:n,normalized:o.normalized}}var s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));var u=this.boundingSphere;return u!==null&&(e.data.boundingSphere={center:u.center.toArray(),radius:u.radius}),e},clone:function(){return new Ue().copy(this)},copy:function(e){var t=this,r,i,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var a=e.index;a!==null&&this.setIndex(a.clone());var o=e.attributes;for(r in o){var s=o[r];t.addAttribute(r,s.clone())}var u=e.morphAttributes;for(r in u){var c=[],f=u[r];for(i=0,n=f.length;i<n;i++)c.push(f[i].clone());t.morphAttributes[r]=c}var l=e.groups;for(i=0,n=l.length;i<n;i++){var h=l[i];t.addGroup(h.start,h.count,h.materialIndex)}var d=e.boundingBox;d!==null&&(this.boundingBox=d.clone());var p=e.boundingSphere;return p!==null&&(this.boundingSphere=p.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});function Fc(e,t,r,i,n,a){st.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:n,depthSegments:a},this.fromBufferGeometry(new Oa(e,t,r,i,n,a)),this.mergeVertices()}Fc.prototype=Object.create(st.prototype);Fc.prototype.constructor=Fc;function Oa(e,t,r,i,n,a){Ue.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:n,depthSegments:a};var o=this;e=e||1,t=t||1,r=r||1,i=Math.floor(i)||1,n=Math.floor(n)||1,a=Math.floor(a)||1;var s=[],u=[],c=[],f=[],l=0,h=0;d("z","y","x",-1,-1,r,t,e,a,n,0),d("z","y","x",1,-1,r,t,-e,a,n,1),d("x","z","y",1,1,e,r,t,i,a,2),d("x","z","y",1,-1,e,r,-t,i,a,3),d("x","y","z",1,-1,e,t,r,i,n,4),d("x","y","z",-1,-1,e,t,-r,i,n,5),this.setIndex(s),this.addAttribute("position",new ze(u,3)),this.addAttribute("normal",new ze(c,3)),this.addAttribute("uv",new ze(f,2));function d(p,v,m,g,x,y,b,_,w,A,S){var M=y/w,E=b/A,T=y/2,H=b/2,X=_/2,q=w+1,Z=A+1,Q=0,N=0,D,W,L=new I;for(W=0;W<Z;W++){var U=W*E-H;for(D=0;D<q;D++){var k=D*M-T;L[p]=k*g,L[v]=U*x,L[m]=X,u.push(L.x,L.y,L.z),L[p]=0,L[v]=0,L[m]=_>0?1:-1,c.push(L.x,L.y,L.z),f.push(D/w),f.push(1-W/A),Q+=1}}for(W=0;W<A;W++)for(D=0;D<w;D++){var ee=l+D+q*W,K=l+D+q*(W+1),te=l+(D+1)+q*(W+1),Y=l+(D+1)+q*W;s.push(ee,K,Y),s.push(K,te,Y),N+=6}o.addGroup(h,N,S),h+=N,l+=Q}}Oa.prototype=Object.create(Ue.prototype);Oa.prototype.constructor=Oa;function Gs(e,t,r,i){st.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i},this.fromBufferGeometry(new bo(e,t,r,i)),this.mergeVertices()}Gs.prototype=Object.create(st.prototype);Gs.prototype.constructor=Gs;function bo(e,t,r,i){Ue.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i},e=e||1,t=t||1;var n=e/2,a=t/2,o=Math.floor(r)||1,s=Math.floor(i)||1,u=o+1,c=s+1,f=e/o,l=t/s,h,d,p=[],v=[],m=[],g=[];for(d=0;d<c;d++){var x=d*l-a;for(h=0;h<u;h++){var y=h*f-n;v.push(y,-x,0),m.push(0,0,1),g.push(h/o),g.push(1-d/s)}}for(d=0;d<s;d++)for(h=0;h<o;h++){var b=h+u*d,_=h+u*(d+1),w=h+1+u*(d+1),A=h+1+u*d;p.push(b,_,A),p.push(_,w,A)}this.setIndex(p),this.addAttribute("position",new ze(v,3)),this.addAttribute("normal",new ze(m,3)),this.addAttribute("uv",new ze(g,2))}bo.prototype=Object.create(Ue.prototype);bo.prototype.constructor=bo;var K_=0;function At(){Object.defineProperty(this,"id",{value:K_++}),this.uuid=Pt.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=$n,this.side=Mu,this.flatShading=!1,this.vertexColors=lg,this.opacity=1,this.transparent=!1,this.blendSrc=gg,this.blendDst=yg,this.blendEquation=mg,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Eh,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.userData={},this.needsUpdate=!0}At.prototype=Object.assign(Object.create(fa.prototype),{constructor:At,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){var t=this;if(e!==void 0)for(var r in e){var i=e[r];if(i===void 0){console.warn("THREE.Material: '"+r+"' parameter is undefined.");continue}if(r==="shading"){console.warn("THREE."+t.type+": .shading has been removed. Use the boolean .flatShading instead."),t.flatShading=i===fg;continue}var n=t[r];if(n===void 0){console.warn("THREE."+t.type+": '"+r+"' is not a property of this material.");continue}n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):r==="overdraw"?t[r]=Number(i):t[r]=i}},toJSON:function(e){var t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearCoat!==void 0&&(r.clearCoat=this.clearCoat),this.clearCoatRoughness!==void 0&&(r.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,r.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.size!==void 0&&(r.size=this.size),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==$n&&(r.blending=this.blending),this.flatShading===!0&&(r.flatShading=this.flatShading),this.side!==Mu&&(r.side=this.side),this.vertexColors!==lg&&(r.vertexColors=this.vertexColors),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,this.rotation!==0&&(r.rotation=this.rotation),this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(r.morphTargets=!0),this.skinning===!0&&(r.skinning=!0),this.visible===!1&&(r.visible=!1),JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData);function i(o){var s=[];for(var u in o){var c=o[u];delete c.metadata,s.push(c)}return s}if(t){var n=i(e.textures),a=i(e.images);n.length>0&&(r.textures=n),a.length>0&&(r.images=a)}return r},clone:function(){return new this.constructor().copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.overdraw=e.overdraw,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,r=null;if(t!==null){var i=t.length;r=new Array(i);for(var n=0;n!==i;++n)r[n]=t[n].clone()}return this.clippingPlanes=r,this.shadowSide=e.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});function Ai(e){At.call(this),this.type="MeshBasicMaterial",this.color=new Oe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Df,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}Ai.prototype=Object.create(At.prototype);Ai.prototype.constructor=Ai;Ai.prototype.isMeshBasicMaterial=!0;Ai.prototype.copy=function(e){return At.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};function Gr(e){At.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}Gr.prototype=Object.create(At.prototype);Gr.prototype.constructor=Gr;Gr.prototype.isShaderMaterial=!0;Gr.prototype.copy=function(e){return At.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Lr.clone(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this};Gr.prototype.toJSON=function(e){var t=At.prototype.toJSON.call(this,e);return t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t};function zo(e,t){this.origin=e!==void 0?e:new I,this.direction=t!==void 0?t:new I}Object.assign(zo.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return t===void 0&&(console.warn("THREE.Ray: .at() target is now required"),t=new I),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new I;return function(r){return this.origin.copy(this.at(r,e)),this}}(),closestPointToPoint:function(e,t){t===void 0&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new I),t.subVectors(e,this.origin);var r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new I;return function(r){var i=e.subVectors(r,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(r):(e.copy(this.direction).multiplyScalar(i).add(this.origin),e.distanceToSquared(r))}}(),distanceSqToSegment:function(){var e=new I,t=new I,r=new I;return function(n,a,o,s){e.copy(n).add(a).multiplyScalar(.5),t.copy(a).sub(n).normalize(),r.copy(this.origin).sub(e);var u=n.distanceTo(a)*.5,c=-this.direction.dot(t),f=r.dot(this.direction),l=-r.dot(t),h=r.lengthSq(),d=Math.abs(1-c*c),p,v,m,g;if(d>0)if(p=c*l-f,v=c*f-l,g=u*d,p>=0)if(v>=-g)if(v<=g){var x=1/d;p*=x,v*=x,m=p*(p+c*v+2*f)+v*(c*p+v+2*l)+h}else v=u,p=Math.max(0,-(c*v+f)),m=-p*p+v*(v+2*l)+h;else v=-u,p=Math.max(0,-(c*v+f)),m=-p*p+v*(v+2*l)+h;else v<=-g?(p=Math.max(0,-(-c*u+f)),v=p>0?-u:Math.min(Math.max(-u,-l),u),m=-p*p+v*(v+2*l)+h):v<=g?(p=0,v=Math.min(Math.max(-u,-l),u),m=v*(v+2*l)+h):(p=Math.max(0,-(c*u+f)),v=p>0?u:Math.min(Math.max(-u,-l),u),m=-p*p+v*(v+2*l)+h);else v=c>0?-u:u,p=Math.max(0,-(c*v+f)),m=-p*p+v*(v+2*l)+h;return o&&o.copy(this.direction).multiplyScalar(p).add(this.origin),s&&s.copy(t).multiplyScalar(v).add(e),m}}(),intersectSphere:function(){var e=new I;return function(r,i){e.subVectors(r.center,this.origin);var n=e.dot(this.direction),a=e.dot(e)-n*n,o=r.radius*r.radius;if(a>o)return null;var s=Math.sqrt(o-a),u=n-s,c=n+s;return u<0&&c<0?null:u<0?this.at(c,i):this.at(u,i)}}(),intersectsSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return r===null?null:this.at(r,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);if(t===0)return!0;var r=e.normal.dot(this.direction);return r*t<0},intersectBox:function(e,t){var r,i,n,a,o,s,u=1/this.direction.x,c=1/this.direction.y,f=1/this.direction.z,l=this.origin;return u>=0?(r=(e.min.x-l.x)*u,i=(e.max.x-l.x)*u):(r=(e.max.x-l.x)*u,i=(e.min.x-l.x)*u),c>=0?(n=(e.min.y-l.y)*c,a=(e.max.y-l.y)*c):(n=(e.max.y-l.y)*c,a=(e.min.y-l.y)*c),r>a||n>i||((n>r||r!==r)&&(r=n),(a<i||i!==i)&&(i=a),f>=0?(o=(e.min.z-l.z)*f,s=(e.max.z-l.z)*f):(o=(e.max.z-l.z)*f,s=(e.min.z-l.z)*f),r>s||o>i)||((o>r||r!==r)&&(r=o),(s<i||i!==i)&&(i=s),i<0)?null:this.at(r>=0?r:i,t)},intersectsBox:function(){var e=new I;return function(r){return this.intersectBox(r,e)!==null}}(),intersectTriangle:function(){var e=new I,t=new I,r=new I,i=new I;return function(a,o,s,u,c){t.subVectors(o,a),r.subVectors(s,a),i.crossVectors(t,r);var f=this.direction.dot(i),l;if(f>0){if(u)return null;l=1}else if(f<0)l=-1,f=-f;else return null;e.subVectors(this.origin,a);var h=l*this.direction.dot(r.crossVectors(e,r));if(h<0)return null;var d=l*this.direction.dot(t.cross(e));if(d<0||h+d>f)return null;var p=-l*e.dot(i);return p<0?null:this.at(p/f,c)}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}});function xi(e,t,r){this.a=e!==void 0?e:new I,this.b=t!==void 0?t:new I,this.c=r!==void 0?r:new I}Object.assign(xi,{getNormal:function(){var e=new I;return function(r,i,n,a){a===void 0&&(console.warn("THREE.Triangle: .getNormal() target is now required"),a=new I),a.subVectors(n,i),e.subVectors(r,i),a.cross(e);var o=a.lengthSq();return o>0?a.multiplyScalar(1/Math.sqrt(o)):a.set(0,0,0)}}(),getBarycoord:function(){var e=new I,t=new I,r=new I;return function(n,a,o,s,u){e.subVectors(s,a),t.subVectors(o,a),r.subVectors(n,a);var c=e.dot(e),f=e.dot(t),l=e.dot(r),h=t.dot(t),d=t.dot(r),p=c*h-f*f;if(u===void 0&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),u=new I),p===0)return u.set(-2,-1,-1);var v=1/p,m=(h*l-f*d)*v,g=(c*d-f*l)*v;return u.set(1-m-g,g,m)}}(),containsPoint:function(){var e=new I;return function(r,i,n,a){return xi.getBarycoord(r,i,n,a,e),e.x>=0&&e.y>=0&&e.x+e.y<=1}}()});Object.assign(xi.prototype,{set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){var e=new I,t=new I;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),e.cross(t).length()*.5}}(),getMidpoint:function(e){return e===void 0&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new I),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return xi.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return e===void 0&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new I),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return xi.getBarycoord(e,this.a,this.b,this.c,t)},containsPoint:function(e){return xi.containsPoint(e,this.a,this.b,this.c)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(){var e=new I,t=new I,r=new I,i=new I,n=new I,a=new I;return function(s,u){u===void 0&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),u=new I);var c=this.a,f=this.b,l=this.c,h,d;e.subVectors(f,c),t.subVectors(l,c),i.subVectors(s,c);var p=e.dot(i),v=t.dot(i);if(p<=0&&v<=0)return u.copy(c);n.subVectors(s,f);var m=e.dot(n),g=t.dot(n);if(m>=0&&g<=m)return u.copy(f);var x=p*g-m*v;if(x<=0&&p>=0&&m<=0)return h=p/(p-m),u.copy(c).addScaledVector(e,h);a.subVectors(s,l);var y=e.dot(a),b=t.dot(a);if(b>=0&&y<=b)return u.copy(l);var _=y*v-p*b;if(_<=0&&v>=0&&b<=0)return d=v/(v-b),u.copy(c).addScaledVector(t,d);var w=m*b-y*g;if(w<=0&&g-m>=0&&y-b>=0)return r.subVectors(l,f),d=(g-m)/(g-m+(y-b)),u.copy(f).addScaledVector(r,d);var A=1/(w+_+x);return h=_*A,d=x*A,u.copy(c).addScaledVector(e,h).addScaledVector(t,d)}}(),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});function Jr(e,t){Ge.call(this),this.type="Mesh",this.geometry=e!==void 0?e:new Ue,this.material=t!==void 0?t:new Ai({color:Math.random()*16777215}),this.drawMode=Sg,this.updateMorphTargets()}Jr.prototype=Object.assign(Object.create(Ge.prototype),{constructor:Jr,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return Ge.prototype.copy.call(this,e),this.drawMode=e.drawMode,e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e=this,t=this.geometry,r,i,n;if(t.isBufferGeometry){var a=t.morphAttributes,o=Object.keys(a);if(o.length>0){var s=a[o[0]];if(s!==void 0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},r=0,i=s.length;r<i;r++)n=s[r].name||String(r),e.morphTargetInfluences.push(0),e.morphTargetDictionary[n]=r}}else{var u=t.morphTargets;if(u!==void 0&&u.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},r=0,i=u.length;r<i;r++)n=u[r].name||String(r),e.morphTargetInfluences.push(0),e.morphTargetDictionary[n]=r}},raycast:function(){var e=new Ae,t=new zo,r=new sn,i=new I,n=new I,a=new I,o=new I,s=new I,u=new I,c=new Ee,f=new Ee,l=new Ee,h=new I,d=new I,p=new I;function v(x,y,b,_,w,A,S){return xi.getBarycoord(x,y,b,_,h),w.multiplyScalar(h.x),A.multiplyScalar(h.y),S.multiplyScalar(h.z),w.add(A).add(S),w.clone()}function m(x,y,b,_,w,A,S,M){var E;if(y.side===ni?E=_.intersectTriangle(S,A,w,!0,M):E=_.intersectTriangle(w,A,S,y.side!==Ra,M),E===null)return null;p.copy(M),p.applyMatrix4(x.matrixWorld);var T=b.ray.origin.distanceTo(p);return T<b.near||T>b.far?null:{distance:T,point:p.clone(),object:x}}function g(x,y,b,_,w,A,S,M,E){i.fromBufferAttribute(w,S),n.fromBufferAttribute(w,M),a.fromBufferAttribute(w,E);var T=m(x,y,b,_,i,n,a,d);if(T){A&&(c.fromBufferAttribute(A,S),f.fromBufferAttribute(A,M),l.fromBufferAttribute(A,E),T.uv=v(d,i,n,a,c,f,l));var H=new nn(S,M,E);xi.getNormal(i,n,a,H.normal),T.face=H}return T}return function(y,b){var _=this,w=this.geometry,A=this.material,S=this.matrixWorld;if(A!==void 0&&(w.boundingSphere===null&&w.computeBoundingSphere(),r.copy(w.boundingSphere),r.applyMatrix4(S),y.ray.intersectsSphere(r)!==!1&&(e.getInverse(S),t.copy(y.ray).applyMatrix4(e),!(w.boundingBox!==null&&t.intersectsBox(w.boundingBox)===!1)))){var M;if(w.isBufferGeometry){var E,T,H,X=w.index,q=w.attributes.position,Z=w.attributes.uv,Q=w.groups,N=w.drawRange,D,W,L,U,k,ee,K,te;if(X!==null)if(Array.isArray(A))for(D=0,L=Q.length;D<L;D++)for(k=Q[D],ee=A[k.materialIndex],K=Math.max(k.start,N.start),te=Math.min(k.start+k.count,N.start+N.count),W=K,U=te;W<U;W+=3)E=X.getX(W),T=X.getX(W+1),H=X.getX(W+2),M=g(_,ee,y,t,q,Z,E,T,H),M&&(M.faceIndex=Math.floor(W/3),b.push(M));else for(K=Math.max(0,N.start),te=Math.min(X.count,N.start+N.count),D=K,L=te;D<L;D+=3)E=X.getX(D),T=X.getX(D+1),H=X.getX(D+2),M=g(_,A,y,t,q,Z,E,T,H),M&&(M.faceIndex=Math.floor(D/3),b.push(M));else if(q!==void 0)if(Array.isArray(A))for(D=0,L=Q.length;D<L;D++)for(k=Q[D],ee=A[k.materialIndex],K=Math.max(k.start,N.start),te=Math.min(k.start+k.count,N.start+N.count),W=K,U=te;W<U;W+=3)E=W,T=W+1,H=W+2,M=g(_,ee,y,t,q,Z,E,T,H),M&&(M.faceIndex=Math.floor(W/3),b.push(M));else for(K=Math.max(0,N.start),te=Math.min(q.count,N.start+N.count),D=K,L=te;D<L;D+=3)E=D,T=D+1,H=D+2,M=g(_,A,y,t,q,Z,E,T,H),M&&(M.faceIndex=Math.floor(D/3),b.push(M))}else if(w.isGeometry){var Y,J,j,ae=Array.isArray(A),re=w.vertices,le=w.faces,Se,_e=w.faceVertexUvs[0];_e.length>0&&(Se=_e);for(var ne=0,ve=le.length;ne<ve;ne++){var se=le[ne],xe=ae?A[se.materialIndex]:A;if(xe!==void 0){if(Y=re[se.a],J=re[se.b],j=re[se.c],xe.morphTargets===!0){var he=w.morphTargets,ye=_.morphTargetInfluences;i.set(0,0,0),n.set(0,0,0),a.set(0,0,0);for(var pe=0,Pe=he.length;pe<Pe;pe++){var He=ye[pe];if(He!==0){var Je=he[pe].vertices;i.addScaledVector(o.subVectors(Je[se.a],Y),He),n.addScaledVector(s.subVectors(Je[se.b],J),He),a.addScaledVector(u.subVectors(Je[se.c],j),He)}}i.add(Y),n.add(J),a.add(j),Y=i,J=n,j=a}if(M=m(_,xe,y,t,Y,J,j,d),M){if(Se&&Se[ne]){var We=Se[ne];c.copy(We[0]),f.copy(We[1]),l.copy(We[2]),M.uv=v(d,Y,J,j,c,f,l)}M.face=se,M.faceIndex=ne,b.push(M)}}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});function J_(e,t,r,i){var n=new Oe(0),a=0,o,s,u;function c(l,h,d,p){var v=h.background;v===null?f(n,a):v&&v.isColor&&(f(v,1),p=!0),(e.autoClear||p)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),v&&v.isCubeTexture?(u===void 0&&(u=new Jr(new Oa(1,1,1),new Gr({uniforms:ho.cube.uniforms,vertexShader:ho.cube.vertexShader,fragmentShader:ho.cube.fragmentShader,side:ni,depthTest:!0,depthWrite:!1,fog:!1})),u.geometry.removeAttribute("normal"),u.geometry.removeAttribute("uv"),u.onBeforeRender=function(m,g,x){this.matrixWorld.copyPosition(x.matrixWorld)},r.update(u)),u.material.uniforms.tCube.value=v,l.push(u,u.geometry,u.material,0,null)):v&&v.isTexture&&(o===void 0&&(o=new ia(-1,1,1,-1,0,1),s=new Jr(new bo(2,2),new Ai({depthTest:!1,depthWrite:!1,fog:!1})),r.update(s)),s.material.map=v,e.renderBufferDirect(o,null,s.geometry,s.material,s,null))}function f(l,h){t.buffers.color.setClear(l.r,l.g,l.b,h,i)}return{getClearColor:function(){return n},setClearColor:function(l,h){n.set(l),a=h!==void 0?h:1,f(n,a)},getClearAlpha:function(){return a},setClearAlpha:function(l){a=l,f(n,a)},render:c}}function Q_(e,t,r,i){var n;function a(u){n=u}function o(u,c){e.drawArrays(n,u,c),r.update(c,n)}function s(u,c,f){var l;if(i.isWebGL2)l=e;else if(l=t.get("ANGLE_instanced_arrays"),l===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}l[i.isWebGL2?"drawArraysInstanced":"drawArraysInstancedANGLE"](n,c,f,u.maxInstancedCount),r.update(f,n,u.maxInstancedCount)}this.setMode=a,this.render=o,this.renderInstances=s}function $_(e,t,r){var i;function n(){if(i!==void 0)return i;var _=t.get("EXT_texture_filter_anisotropic");return _!==null?i=e.getParameter(_.MAX_TEXTURE_MAX_ANISOTROPY_EXT):i=0,i}function a(_){if(_==="highp"){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";_="mediump"}return _==="mediump"&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var o=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext,s=r.precision!==void 0?r.precision:"highp",u=a(s);u!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",u,"instead."),s=u);var c=r.logarithmicDepthBuffer===!0,f=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),l=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_TEXTURE_SIZE),d=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),p=e.getParameter(e.MAX_VERTEX_ATTRIBS),v=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),m=e.getParameter(e.MAX_VARYING_VECTORS),g=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),x=l>0,y=o||!!t.get("OES_texture_float"),b=x&&y;return{isWebGL2:o,getMaxAnisotropy:n,getMaxPrecision:a,precision:s,logarithmicDepthBuffer:c,maxTextures:f,maxVertexTextures:l,maxTextureSize:h,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:v,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:x,floatFragmentTextures:y,floatVertexTextures:b}}function ew(){var e=this,t=null,r=0,i=!1,n=!1,a=new Pn,o=new Ur,s={value:null,needsUpdate:!1};this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(f,l,h){var d=f.length!==0||l||r!==0||i;return i=l,t=c(f,h,0),r=f.length,d},this.beginShadows=function(){n=!0,c(null)},this.endShadows=function(){n=!1,u()},this.setState=function(f,l,h,d,p,v){if(!i||f===null||f.length===0||n&&!h)n?c(null):u();else{var m=n?0:r,g=m*4,x=p.clippingState||null;s.value=x,x=c(f,d,g,v);for(var y=0;y!==g;++y)x[y]=t[y];p.clippingState=x,this.numIntersection=l?this.numPlanes:0,this.numPlanes+=m}};function u(){s.value!==t&&(s.value=t,s.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function c(f,l,h,d){var p=f!==null?f.length:0,v=null;if(p!==0){if(v=s.value,d!==!0||v===null){var m=h+p*4,g=l.matrixWorldInverse;o.getNormalMatrix(g),(v===null||v.length<m)&&(v=new Float32Array(m));for(var x=0,y=h;x!==p;++x,y+=4)a.copy(f[x]).applyMatrix4(g,o),a.normal.toArray(v,y),v[y+3]=a.constant}s.value=v,s.needsUpdate=!0}return e.numPlanes=p,v}}function tw(e){var t={};return{get:function(r){if(t[r]!==void 0)return t[r];var i;switch(r){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(r)}return i===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),t[r]=i,i}}}function rw(e,t,r){var i={},n={};function a(c){var f=c.target,l=i[f.id];l.index!==null&&t.remove(l.index);for(var h in l.attributes)t.remove(l.attributes[h]);f.removeEventListener("dispose",a),delete i[f.id];var d=n[l.id];d&&(t.remove(d),delete n[l.id]),r.memory.geometries--}function o(c,f){var l=i[f.id];return l||(f.addEventListener("dispose",a),f.isBufferGeometry?l=f:f.isGeometry&&(f._bufferGeometry===void 0&&(f._bufferGeometry=new Ue().setFromObject(c)),l=f._bufferGeometry),i[f.id]=l,r.memory.geometries++,l)}function s(c){var f=c.index,l=c.attributes;f!==null&&t.update(f,e.ELEMENT_ARRAY_BUFFER);for(var h in l)t.update(l[h],e.ARRAY_BUFFER);var d=c.morphAttributes;for(var h in d)for(var p=d[h],v=0,m=p.length;v<m;v++)t.update(p[v],e.ARRAY_BUFFER)}function u(c){var f=n[c.id];if(f)return f;var l=[],h=c.index,d=c.attributes;if(h!==null)for(var p=h.array,v=0,m=p.length;v<m;v+=3){var g=p[v+0],x=p[v+1],y=p[v+2];l.push(g,x,x,y,y,g)}else for(var p=d.position.array,v=0,m=p.length/3-1;v<m;v+=3){var g=v+0,x=v+1,y=v+2;l.push(g,x,x,y,y,g)}return f=new(Tg(l)>65535?Us:zs)(l,1),t.update(f,e.ELEMENT_ARRAY_BUFFER),n[c.id]=f,f}return{get:o,update:s,getWireframeAttribute:u}}function iw(e,t,r,i){var n;function a(l){n=l}var o,s;function u(l){o=l.type,s=l.bytesPerElement}function c(l,h){e.drawElements(n,h,o,l*s),r.update(h,n)}function f(l,h,d){var p;if(i.isWebGL2)p=e;else{var p=t.get("ANGLE_instanced_arrays");if(p===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}}p[i.isWebGL2?"drawElementsInstanced":"drawElementsInstancedANGLE"](n,d,o,h*s,l.maxInstancedCount),r.update(d,n,l.maxInstancedCount)}this.setMode=a,this.setIndex=u,this.render=c,this.renderInstances=f}function nw(e){var t={geometries:0,textures:0},r={frame:0,calls:0,triangles:0,points:0,lines:0};function i(a,o,s){switch(s=s||1,r.calls++,o){case e.TRIANGLES:r.triangles+=s*(a/3);break;case e.TRIANGLE_STRIP:case e.TRIANGLE_FAN:r.triangles+=s*(a-2);break;case e.LINES:r.lines+=s*(a/2);break;case e.LINE_STRIP:r.lines+=s*(a-1);break;case e.LINE_LOOP:r.lines+=s*a;break;case e.POINTS:r.points+=s*a;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function n(){r.frame++,r.calls=0,r.triangles=0,r.points=0,r.lines=0}return{memory:t,render:r,programs:null,autoReset:!0,reset:n,update:i}}function aw(e,t){return Math.abs(t[1])-Math.abs(e[1])}function ow(e){var t={},r=new Float32Array(8);function i(n,a,o,s){var u=n.morphTargetInfluences,c=u.length,f=t[a.id];if(f===void 0){f=[];for(var l=0;l<c;l++)f[l]=[l,0];t[a.id]=f}for(var h=o.morphTargets&&a.morphAttributes.position,d=o.morphNormals&&a.morphAttributes.normal,l=0;l<c;l++){var p=f[l];p[1]!==0&&(h&&a.removeAttribute("morphTarget"+l),d&&a.removeAttribute("morphNormal"+l))}for(var l=0;l<c;l++){var p=f[l];p[0]=l,p[1]=u[l]}f.sort(aw);for(var l=0;l<8;l++){var p=f[l];if(p){var v=p[0],m=p[1];if(m){h&&a.addAttribute("morphTarget"+l,h[v]),d&&a.addAttribute("morphNormal"+l,d[v]),r[l]=m;continue}}r[l]=0}s.getUniforms().setValue(e,"morphTargetInfluences",r)}return{update:i}}function sw(e,t){var r={};function i(a){var o=t.render.frame,s=a.geometry,u=e.get(a,s);return r[u.id]!==o&&(s.isGeometry&&u.updateFromObject(a),e.update(u),r[u.id]=o),u}function n(){r={}}return{update:i,dispose:n}}function na(e,t,r,i,n,a,o,s,u,c){e=e!==void 0?e:[],t=t!==void 0?t:wd,hr.call(this,e,t,r,i,n,a,o,s,u,c),this.flipY=!1}na.prototype=Object.create(hr.prototype);na.prototype.constructor=na;na.prototype.isCubeTexture=!0;Object.defineProperty(na.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});var Eg=new hr,Ig=new na;function Rg(){this.seq=[],this.map={}}var Vp=[],Wp=[],jp=new Float32Array(16),Xp=new Float32Array(9),qp=new Float32Array(4);function Uo(e,t,r){var i=e[0];if(i<=0||i>0)return e;var n=t*r,a=Vp[n];if(a===void 0&&(a=new Float32Array(n),Vp[n]=a),t!==0){i.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=r,e[o].toArray(a,s)}return a}function yr(e,t){if(e.length!==t.length)return!1;for(var r=0,i=e.length;r<i;r++)if(e[r]!==t[r])return!1;return!0}function Fr(e,t){for(var r=0,i=t.length;r<i;r++)e[r]=t[r]}function Lg(e,t){var r=Wp[t];r===void 0&&(r=new Int32Array(t),Wp[t]=r);for(var i=0;i!==t;++i)r[i]=e.allocTextureUnit();return r}function uw(e,t){var r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function cw(e,t){var r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function fw(e,t){var r=this.cache;if(t.x!==void 0)(r[0]!==t.x||r[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(yr(r,t))return;e.uniform2fv(this.addr,t),Fr(r,t)}}function lw(e,t){var r=this.cache;if(t.x!==void 0)(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else if(t.r!==void 0)(r[0]!==t.r||r[1]!==t.g||r[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b);else{if(yr(r,t))return;e.uniform3fv(this.addr,t),Fr(r,t)}}function hw(e,t){var r=this.cache;if(t.x!==void 0)(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z||r[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(yr(r,t))return;e.uniform4fv(this.addr,t),Fr(r,t)}}function dw(e,t){var r=this.cache,i=t.elements;if(i===void 0){if(yr(r,t))return;e.uniformMatrix2fv(this.addr,!1,t),Fr(r,t)}else{if(yr(r,i))return;qp.set(i),e.uniformMatrix2fv(this.addr,!1,qp),Fr(r,i)}}function pw(e,t){var r=this.cache,i=t.elements;if(i===void 0){if(yr(r,t))return;e.uniformMatrix3fv(this.addr,!1,t),Fr(r,t)}else{if(yr(r,i))return;Xp.set(i),e.uniformMatrix3fv(this.addr,!1,Xp),Fr(r,i)}}function vw(e,t){var r=this.cache,i=t.elements;if(i===void 0){if(yr(r,t))return;e.uniformMatrix4fv(this.addr,!1,t),Fr(r,t)}else{if(yr(r,i))return;jp.set(i),e.uniformMatrix4fv(this.addr,!1,jp),Fr(r,i)}}function mw(e,t,r){var i=this.cache,n=r.allocTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture2D(t||Eg,n)}function gw(e,t,r){var i=this.cache,n=r.allocTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTextureCube(t||Ig,n)}function Og(e,t){var r=this.cache;yr(r,t)||(e.uniform2iv(this.addr,t),Fr(r,t))}function Dg(e,t){var r=this.cache;yr(r,t)||(e.uniform3iv(this.addr,t),Fr(r,t))}function Fg(e,t){var r=this.cache;yr(r,t)||(e.uniform4iv(this.addr,t),Fr(r,t))}function yw(e){switch(e){case 5126:return uw;case 35664:return fw;case 35665:return lw;case 35666:return hw;case 35674:return dw;case 35675:return pw;case 35676:return vw;case 35678:case 36198:return mw;case 35680:return gw;case 5124:case 35670:return cw;case 35667:case 35671:return Og;case 35668:case 35672:return Dg;case 35669:case 35673:return Fg}}function bw(e,t){var r=this.cache;yr(r,t)||(e.uniform1fv(this.addr,t),Fr(r,t))}function xw(e,t){var r=this.cache;yr(r,t)||(e.uniform1iv(this.addr,t),Fr(r,t))}function _w(e,t){var r=this.cache,i=Uo(t,this.size,2);yr(r,i)||(e.uniform2fv(this.addr,i),this.updateCache(i))}function ww(e,t){var r=this.cache,i=Uo(t,this.size,3);yr(r,i)||(e.uniform3fv(this.addr,i),this.updateCache(i))}function Aw(e,t){var r=this.cache,i=Uo(t,this.size,4);yr(r,i)||(e.uniform4fv(this.addr,i),this.updateCache(i))}function Sw(e,t){var r=this.cache,i=Uo(t,this.size,4);yr(r,i)||(e.uniformMatrix2fv(this.addr,!1,i),this.updateCache(i))}function Mw(e,t){var r=this.cache,i=Uo(t,this.size,9);yr(r,i)||(e.uniformMatrix3fv(this.addr,!1,i),this.updateCache(i))}function Cw(e,t){var r=this.cache,i=Uo(t,this.size,16);yr(r,i)||(e.uniformMatrix4fv(this.addr,!1,i),this.updateCache(i))}function Pw(e,t,r){var i=this.cache,n=t.length,a=Lg(r,n);yr(i,a)===!1&&(e.uniform1iv(this.addr,a),Fr(i,a));for(var o=0;o!==n;++o)r.setTexture2D(t[o]||Eg,a[o])}function Tw(e,t,r){var i=this.cache,n=t.length,a=Lg(r,n);yr(i,a)===!1&&(e.uniform1iv(this.addr,a),Fr(i,a));for(var o=0;o!==n;++o)r.setTextureCube(t[o]||Ig,a[o])}function Ew(e){switch(e){case 5126:return bw;case 35664:return _w;case 35665:return ww;case 35666:return Aw;case 35674:return Sw;case 35675:return Mw;case 35676:return Cw;case 35678:return Pw;case 35680:return Tw;case 5124:case 35670:return xw;case 35667:case 35671:return Og;case 35668:case 35672:return Dg;case 35669:case 35673:return Fg}}function Iw(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=yw(t.type)}function Bg(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=Ew(t.type)}Bg.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Fr(t,e)};function Ng(e){this.id=e,Rg.call(this)}Ng.prototype.setValue=function(e,t,r){for(var i=this.seq,n=0,a=i.length;n!==a;++n){var o=i[n];o.setValue(e,t[o.id],r)}};var Sl=/([\w\d_]+)(\])?(\[|\.)?/g;function Yp(e,t){e.seq.push(t),e.map[t.id]=t}function Rw(e,t,r){var i=e.name,n=i.length;for(Sl.lastIndex=0;;){var a=Sl.exec(i),o=Sl.lastIndex,s=a[1],u=a[2]==="]",c=a[3];if(u&&(s=s|0),c===void 0||c==="["&&o+2===n){Yp(r,c===void 0?new Iw(s,e,t):new Bg(s,e,t));break}else{var f=r.map,l=f[s];l===void 0&&(l=new Ng(s),Yp(r,l)),r=l}}}function ea(e,t,r){var i=this;Rg.call(this),this.renderer=r;for(var n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),a=0;a<n;++a){var o=e.getActiveUniform(t,a),s=e.getUniformLocation(t,o.name);Rw(o,s,i)}}ea.prototype.setValue=function(e,t,r){var i=this.map[t];i!==void 0&&i.setValue(e,r,this.renderer)};ea.prototype.setOptional=function(e,t,r){var i=t[r];i!==void 0&&this.setValue(e,r,i)};ea.upload=function(e,t,r,i){for(var n=0,a=t.length;n!==a;++n){var o=t[n],s=r[o.id];s.needsUpdate!==!1&&o.setValue(e,s.value,i)}};ea.seqWithValue=function(e,t){for(var r=[],i=0,n=e.length;i!==n;++i){var a=e[i];a.id in t&&r.push(a)}return r};function Lw(e){for(var t=e.split(`
`),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t.join(`
`)}function Zp(e,t,r){var i=e.createShader(t);return e.shaderSource(i,r),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)===!1&&console.error("THREE.WebGLShader: Shader couldn't compile."),e.getShaderInfoLog(i)!==""&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t===e.VERTEX_SHADER?"vertex":"fragment",e.getShaderInfoLog(i),Lw(r)),i}var Ow=0;function kg(e){switch(e){case Dc:return["Linear","( value )"];case Eb:return["sRGB","( value )"];case Ib:return["RGBE","( value )"];case Rb:return["RGBM","( value, 7.0 )"];case Lb:return["RGBM","( value, 16.0 )"];case Ob:return["RGBD","( value, 256.0 )"];case Mg:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}}function Ml(e,t){var r=kg(t);return"vec4 "+e+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function Dw(e,t){var r=kg(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+r[0]+r[1]+"; }"}function Fw(e,t){var r;switch(t){case bg:r="Linear";break;case J1:r="Reinhard";break;case Q1:r="Uncharted2";break;case $1:r="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function Bw(e,t,r){e=e||{};var i=[e.derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap&&!t.objectSpaceNormalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&r.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&r.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&r.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""];return i.filter(Ms).join(`
`)}function Nw(e){var t=[];for(var r in e){var i=e[r];i!==!1&&t.push("#define "+r+" "+i)}return t.join(`
`)}function kw(e,t){for(var r={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),n=0;n<i;n++){var a=e.getActiveAttrib(t,n),o=a.name;r[o]=e.getAttribLocation(t,o)}return r}function Ms(e){return e!==""}function Kp(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function Jp(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function kh(e){var t=/^[ \t]*#include +<([\w\d./]+)>/gm;function r(i,n){var a=Ht[n];if(a===void 0)throw new Error("Can not resolve #include <"+n+">");return kh(a)}return e.replace(t,r)}function Qp(e){var t=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function r(i,n,a,o){for(var s="",u=parseInt(n);u<parseInt(a);u++)s+=o.replace(/\[ i \]/g,"[ "+u+" ]");return s}return e.replace(t,r)}function zw(e,t,r,i,n,a,o){var s=e.context,u=i.defines,c=n.vertexShader,f=n.fragmentShader,l="SHADOWMAP_TYPE_BASIC";a.shadowMapType===cg?l="SHADOWMAP_TYPE_PCF":a.shadowMapType===I1&&(l="SHADOWMAP_TYPE_PCF_SOFT");var h="ENVMAP_TYPE_CUBE",d="ENVMAP_MODE_REFLECTION",p="ENVMAP_BLENDING_MULTIPLY";if(a.envMap){switch(i.envMap.mapping){case wd:case Ih:h="ENVMAP_TYPE_CUBE";break;case Ad:case Sd:h="ENVMAP_TYPE_CUBE_UV";break;case xg:case Rh:h="ENVMAP_TYPE_EQUIREC";break;case _g:h="ENVMAP_TYPE_SPHERE";break}switch(i.envMap.mapping){case Ih:case Rh:d="ENVMAP_MODE_REFRACTION";break}switch(i.combine){case Df:p="ENVMAP_BLENDING_MULTIPLY";break;case Z1:p="ENVMAP_BLENDING_MIX";break;case K1:p="ENVMAP_BLENDING_ADD";break}}var v=e.gammaFactor>0?e.gammaFactor:1,m=o.isWebGL2?"":Bw(i.extensions,a,t),g=Nw(u),x=s.createProgram(),y,b;if(i.isRawShaderMaterial?(y=[g].filter(Ms).join(`
`),y.length>0&&(y+=`
`),b=[m,g].filter(Ms).join(`
`),b.length>0&&(b+=`
`)):(y=["precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+n.name,g,a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+v,"#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+d:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&a.flatShading===!1?"#define USE_MORPHNORMALS":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+l:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(o.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Ms).join(`
`),b=[m,"precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+n.name,g,a.alphaTest?"#define ALPHATEST "+a.alphaTest+(a.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+v,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+h:"",a.envMap?"#define "+d:"",a.envMap?"#define "+p:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+l:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(o.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",a.envMap&&(o.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",a.toneMapping!==wl?"#define TONE_MAPPING":"",a.toneMapping!==wl?Ht.tonemapping_pars_fragment:"",a.toneMapping!==wl?Fw("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.outputEncoding||a.mapEncoding||a.envMapEncoding||a.emissiveMapEncoding?Ht.encodings_pars_fragment:"",a.mapEncoding?Ml("mapTexelToLinear",a.mapEncoding):"",a.envMapEncoding?Ml("envMapTexelToLinear",a.envMapEncoding):"",a.emissiveMapEncoding?Ml("emissiveMapTexelToLinear",a.emissiveMapEncoding):"",a.outputEncoding?Dw("linearToOutputTexel",a.outputEncoding):"",a.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(Ms).join(`
`)),c=kh(c),c=Kp(c,a),c=Jp(c,a),f=kh(f),f=Kp(f,a),f=Jp(f,a),c=Qp(c),f=Qp(f),o.isWebGL2&&!i.isRawShaderMaterial){var _=!1,w=/^\s*#version\s+300\s+es\s*\n/;i.isShaderMaterial&&c.match(w)!==null&&f.match(w)!==null&&(_=!0,c=c.replace(w,""),f=f.replace(w,"")),y=[`#version 300 es
`,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+y,b=[`#version 300 es
`,"#define varying in",_?"":"out highp vec4 pc_fragColor;",_?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+b}var A=y+c,S=b+f,M=Zp(s,s.VERTEX_SHADER,A),E=Zp(s,s.FRAGMENT_SHADER,S);s.attachShader(x,M),s.attachShader(x,E),i.index0AttributeName!==void 0?s.bindAttribLocation(x,0,i.index0AttributeName):a.morphTargets===!0&&s.bindAttribLocation(x,0,"position"),s.linkProgram(x);var T=s.getProgramInfoLog(x).trim(),H=s.getShaderInfoLog(M).trim(),X=s.getShaderInfoLog(E).trim(),q=!0,Z=!0;s.getProgramParameter(x,s.LINK_STATUS)===!1?(q=!1,console.error("THREE.WebGLProgram: shader error: ",s.getError(),"gl.VALIDATE_STATUS",s.getProgramParameter(x,s.VALIDATE_STATUS),"gl.getProgramInfoLog",T,H,X)):T!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",T):(H===""||X==="")&&(Z=!1),Z&&(this.diagnostics={runnable:q,material:i,programLog:T,vertexShader:{log:H,prefix:y},fragmentShader:{log:X,prefix:b}}),s.deleteShader(M),s.deleteShader(E);var Q;this.getUniforms=function(){return Q===void 0&&(Q=new ea(s,x,e)),Q};var N;return this.getAttributes=function(){return N===void 0&&(N=kw(s,x)),N},this.destroy=function(){s.deleteProgram(x),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.name=n.name,this.id=Ow++,this.code=r,this.usedTimes=1,this.program=x,this.vertexShader=M,this.fragmentShader=E,this}function Uw(e,t,r){var i=[],n={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},a=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function o(u){var c=u.skeleton,f=c.bones;if(r.floatVertexTextures)return 1024;var l=r.maxVertexUniforms,h=Math.floor((l-20)/4),d=Math.min(h,f.length);return d<f.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+f.length+" bones. This GPU supports "+d+"."),0):d}function s(u,c){var f;return u?u.isTexture?f=u.encoding:u.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),f=u.texture.encoding):f=Dc,f===Dc&&c&&(f=Mg),f}this.getParameters=function(u,c,f,l,h,d,p){var v=n[u.type],m=p.isSkinnedMesh?o(p):0,g=r.precision;u.precision!==null&&(g=r.getMaxPrecision(u.precision),g!==u.precision&&console.warn("THREE.WebGLProgram.getParameters:",u.precision,"not supported, using",g,"instead."));var x=e.getRenderTarget(),y={shaderID:v,precision:g,supportsVertexTextures:r.vertexTextures,outputEncoding:s(x?x.texture:null,e.gammaOutput),map:!!u.map,mapEncoding:s(u.map,e.gammaInput),envMap:!!u.envMap,envMapMode:u.envMap&&u.envMap.mapping,envMapEncoding:s(u.envMap,e.gammaInput),envMapCubeUV:!!u.envMap&&(u.envMap.mapping===Ad||u.envMap.mapping===Sd),lightMap:!!u.lightMap,aoMap:!!u.aoMap,emissiveMap:!!u.emissiveMap,emissiveMapEncoding:s(u.emissiveMap,e.gammaInput),bumpMap:!!u.bumpMap,normalMap:!!u.normalMap,objectSpaceNormalMap:u.normalMapType===Bb,displacementMap:!!u.displacementMap,roughnessMap:!!u.roughnessMap,metalnessMap:!!u.metalnessMap,specularMap:!!u.specularMap,alphaMap:!!u.alphaMap,gradientMap:!!u.gradientMap,combine:u.combine,vertexColors:u.vertexColors,fog:!!l,useFog:u.fog,fogExp:l&&l.isFogExp2,flatShading:u.flatShading,sizeAttenuation:u.sizeAttenuation,logarithmicDepthBuffer:r.logarithmicDepthBuffer,skinning:u.skinning&&m>0,maxBones:m,useVertexTexture:r.floatVertexTextures,morphTargets:u.morphTargets,morphNormals:u.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:c.directional.length,numPointLights:c.point.length,numSpotLights:c.spot.length,numRectAreaLights:c.rectArea.length,numHemiLights:c.hemi.length,numClippingPlanes:h,numClipIntersection:d,dithering:u.dithering,shadowMapEnabled:e.shadowMap.enabled&&p.receiveShadow&&f.length>0,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:u.premultipliedAlpha,alphaTest:u.alphaTest,doubleSided:u.side===Ra,flipSided:u.side===ni,depthPacking:u.depthPacking!==void 0?u.depthPacking:!1};return y},this.getProgramCode=function(u,c){var f=[];if(c.shaderID?f.push(c.shaderID):(f.push(u.fragmentShader),f.push(u.vertexShader)),u.defines!==void 0)for(var l in u.defines)f.push(l),f.push(u.defines[l]);for(var h=0;h<a.length;h++)f.push(c[a[h]]);return f.push(u.onBeforeCompile.toString()),f.push(e.gammaOutput),f.join()},this.acquireProgram=function(u,c,f,l){for(var h,d=0,p=i.length;d<p;d++){var v=i[d];if(v.code===l){h=v,++h.usedTimes;break}}return h===void 0&&(h=new zw(e,t,l,u,c,f,r),i.push(h)),h},this.releaseProgram=function(u){if(--u.usedTimes===0){var c=i.indexOf(u);i[c]=i[i.length-1],i.pop(),u.destroy()}},this.programs=i}function Gw(){var e=new WeakMap;function t(a){var o=e.get(a);return o===void 0&&(o={},e.set(a,o)),o}function r(a){e.delete(a)}function i(a,o,s){e.get(a)[o]=s}function n(){e=new WeakMap}return{get:t,remove:r,update:i,dispose:n}}function Hw(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program&&t.program&&e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Vw(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Ww(){var e=[],t=0,r=[],i=[];function n(){t=0,r.length=0,i.length=0}function a(s,u,c,f,l){var h=e[t];h===void 0?(h={id:s.id,object:s,geometry:u,material:c,program:c.program,renderOrder:s.renderOrder,z:f,group:l},e[t]=h):(h.id=s.id,h.object=s,h.geometry=u,h.material=c,h.program=c.program,h.renderOrder=s.renderOrder,h.z=f,h.group=l),(c.transparent===!0?i:r).push(h),t++}function o(){r.length>1&&r.sort(Hw),i.length>1&&i.sort(Vw)}return{opaque:r,transparent:i,init:n,push:a,sort:o}}function jw(){var e={};function t(i,n){var a=i.id+","+n.id,o=e[a];return o===void 0&&(o=new Ww,e[a]=o),o}function r(){e={}}return{get:t,dispose:r}}function Xw(){var e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];var r;switch(t.type){case"DirectionalLight":r={direction:new I,color:new Oe,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Ee};break;case"SpotLight":r={position:new I,direction:new I,color:new Oe,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Ee};break;case"PointLight":r={position:new I,color:new Oe,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Ee,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":r={direction:new I,skyColor:new Oe,groundColor:new Oe};break;case"RectAreaLight":r={color:new Oe,position:new I,halfWidth:new I,halfHeight:new I};break}return e[t.id]=r,r}}}var qw=0;function Yw(){var e=new Xw,t={id:qw++,hash:{stateID:-1,directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},r=new I,i=new Ae,n=new Ae;function a(o,s,u){for(var c=0,f=0,l=0,h=0,d=0,p=0,v=0,m=0,g=u.matrixWorldInverse,x=0,y=o.length;x<y;x++){var b=o[x],_=b.color,w=b.intensity,A=b.distance,S=b.shadow&&b.shadow.map?b.shadow.map.texture:null;if(b.isAmbientLight)c+=_.r*w,f+=_.g*w,l+=_.b*w;else if(b.isDirectionalLight){var M=e.get(b);if(M.color.copy(b.color).multiplyScalar(b.intensity),M.direction.setFromMatrixPosition(b.matrixWorld),r.setFromMatrixPosition(b.target.matrixWorld),M.direction.sub(r),M.direction.transformDirection(g),M.shadow=b.castShadow,b.castShadow){var E=b.shadow;M.shadowBias=E.bias,M.shadowRadius=E.radius,M.shadowMapSize=E.mapSize}t.directionalShadowMap[h]=S,t.directionalShadowMatrix[h]=b.shadow.matrix,t.directional[h]=M,h++}else if(b.isSpotLight){var M=e.get(b);if(M.position.setFromMatrixPosition(b.matrixWorld),M.position.applyMatrix4(g),M.color.copy(_).multiplyScalar(w),M.distance=A,M.direction.setFromMatrixPosition(b.matrixWorld),r.setFromMatrixPosition(b.target.matrixWorld),M.direction.sub(r),M.direction.transformDirection(g),M.coneCos=Math.cos(b.angle),M.penumbraCos=Math.cos(b.angle*(1-b.penumbra)),M.decay=b.distance===0?0:b.decay,M.shadow=b.castShadow,b.castShadow){var E=b.shadow;M.shadowBias=E.bias,M.shadowRadius=E.radius,M.shadowMapSize=E.mapSize}t.spotShadowMap[p]=S,t.spotShadowMatrix[p]=b.shadow.matrix,t.spot[p]=M,p++}else if(b.isRectAreaLight){var M=e.get(b);M.color.copy(_).multiplyScalar(w),M.position.setFromMatrixPosition(b.matrixWorld),M.position.applyMatrix4(g),n.identity(),i.copy(b.matrixWorld),i.premultiply(g),n.extractRotation(i),M.halfWidth.set(b.width*.5,0,0),M.halfHeight.set(0,b.height*.5,0),M.halfWidth.applyMatrix4(n),M.halfHeight.applyMatrix4(n),t.rectArea[v]=M,v++}else if(b.isPointLight){var M=e.get(b);if(M.position.setFromMatrixPosition(b.matrixWorld),M.position.applyMatrix4(g),M.color.copy(b.color).multiplyScalar(b.intensity),M.distance=b.distance,M.decay=b.distance===0?0:b.decay,M.shadow=b.castShadow,b.castShadow){var E=b.shadow;M.shadowBias=E.bias,M.shadowRadius=E.radius,M.shadowMapSize=E.mapSize,M.shadowCameraNear=E.camera.near,M.shadowCameraFar=E.camera.far}t.pointShadowMap[d]=S,t.pointShadowMatrix[d]=b.shadow.matrix,t.point[d]=M,d++}else if(b.isHemisphereLight){var M=e.get(b);M.direction.setFromMatrixPosition(b.matrixWorld),M.direction.transformDirection(g),M.direction.normalize(),M.skyColor.copy(b.color).multiplyScalar(w),M.groundColor.copy(b.groundColor).multiplyScalar(w),t.hemi[m]=M,m++}}t.ambient[0]=c,t.ambient[1]=f,t.ambient[2]=l,t.directional.length=h,t.spot.length=p,t.rectArea.length=v,t.point.length=d,t.hemi.length=m,t.hash.stateID=t.id,t.hash.directionalLength=h,t.hash.pointLength=d,t.hash.spotLength=p,t.hash.rectAreaLength=v,t.hash.hemiLength=m,t.hash.shadowsLength=s.length}return{setup:a,state:t}}function $p(){var e=new Yw,t=[],r=[];function i(){t.length=0,r.length=0}function n(u){t.push(u)}function a(u){r.push(u)}function o(u){e.setup(t,r,u)}var s={lightsArray:t,shadowsArray:r,lights:e};return{init:i,state:s,setupLights:o,pushLight:n,pushShadow:a}}function Zw(){var e={};function t(i,n){var a;return e[i.id]===void 0?(a=new $p,e[i.id]={},e[i.id][n.id]=a):e[i.id][n.id]===void 0?(a=new $p,e[i.id][n.id]=a):a=e[i.id][n.id],a}function r(){e={}}return{get:t,dispose:r}}function Da(e){At.call(this),this.type="MeshDepthMaterial",this.depthPacking=Db,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}Da.prototype=Object.create(At.prototype);Da.prototype.constructor=Da;Da.prototype.isMeshDepthMaterial=!0;Da.prototype.copy=function(e){return At.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this};function Fa(e){At.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new I,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(e)}Fa.prototype=Object.create(At.prototype);Fa.prototype.constructor=Fa;Fa.prototype.isMeshDistanceMaterial=!0;Fa.prototype.copy=function(e){return At.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};function zg(e,t,r){for(var i=new Ed,n=new Ae,a=new Ee,o=new Ee(r,r),s=new I,u=new I,c=1,f=2,l=(c|f)+1,h=new Array(l),d=new Array(l),p={},v={0:ni,1:Mu,2:Ra},m=[new I(1,0,0),new I(-1,0,0),new I(0,0,1),new I(0,0,-1),new I(0,1,0),new I(0,-1,0)],g=[new I(0,1,0),new I(0,1,0),new I(0,1,0),new I(0,1,0),new I(0,0,1),new I(0,0,-1)],x=[new $t,new $t,new $t,new $t,new $t,new $t],y=0;y!==l;++y){var b=(y&c)!==0,_=(y&f)!==0,w=new Da({depthPacking:Fb,morphTargets:b,skinning:_});h[y]=w;var A=new Fa({morphTargets:b,skinning:_});d[y]=A}var S=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=cg,this.render=function(T,H,X){if(S.enabled!==!1&&!(S.autoUpdate===!1&&S.needsUpdate===!1)&&T.length!==0){var q=e.context,Z=e.state;Z.disable(q.BLEND),Z.buffers.color.setClear(1,1,1,1),Z.buffers.depth.setTest(!0),Z.setScissorTest(!1);for(var Q,N=0,D=T.length;N<D;N++){var W=T[N],L=W.shadow,U=W&&W.isPointLight;if(L===void 0){console.warn("THREE.WebGLShadowMap:",W,"has no shadow.");continue}var k=L.camera;if(a.copy(L.mapSize),a.min(o),U){var ee=a.x,K=a.y;x[0].set(ee*2,K,ee,K),x[1].set(0,K,ee,K),x[2].set(ee*3,K,ee,K),x[3].set(ee,K,ee,K),x[4].set(ee*3,0,ee,K),x[5].set(ee,0,ee,K),a.x*=4,a.y*=2}if(L.map===null){var te={minFilter:vr,magFilter:vr,format:zi};L.map=new En(a.x,a.y,te),L.map.texture.name=W.name+".shadowMap",k.updateProjectionMatrix()}L.isSpotLightShadow&&L.update(W);var Y=L.map,J=L.matrix;u.setFromMatrixPosition(W.matrixWorld),k.position.copy(u),U?(Q=6,J.makeTranslation(-u.x,-u.y,-u.z)):(Q=1,s.setFromMatrixPosition(W.target.matrixWorld),k.lookAt(s),k.updateMatrixWorld(),J.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),J.multiply(k.projectionMatrix),J.multiply(k.matrixWorldInverse)),e.setRenderTarget(Y),e.clear();for(var j=0;j<Q;j++){if(U){s.copy(k.position),s.add(m[j]),k.up.copy(g[j]),k.lookAt(s),k.updateMatrixWorld();var ae=x[j];Z.viewport(ae)}n.multiplyMatrices(k.projectionMatrix,k.matrixWorldInverse),i.setFromMatrix(n),E(H,X,k,U)}}S.needsUpdate=!1}};function M(T,H,X,q,Z,Q){var N=T.geometry,D=null,W=h,L=T.customDepthMaterial;if(X&&(W=d,L=T.customDistanceMaterial),L)D=L;else{var U=!1;H.morphTargets&&(N&&N.isBufferGeometry?U=N.morphAttributes&&N.morphAttributes.position&&N.morphAttributes.position.length>0:N&&N.isGeometry&&(U=N.morphTargets&&N.morphTargets.length>0)),T.isSkinnedMesh&&H.skinning===!1&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",T);var k=T.isSkinnedMesh&&H.skinning,ee=0;U&&(ee|=c),k&&(ee|=f),D=W[ee]}if(e.localClippingEnabled&&H.clipShadows===!0&&H.clippingPlanes.length!==0){var K=D.uuid,te=H.uuid,Y=p[K];Y===void 0&&(Y={},p[K]=Y);var J=Y[te];J===void 0&&(J=D.clone(),Y[te]=J),D=J}return D.visible=H.visible,D.wireframe=H.wireframe,D.side=H.shadowSide!=null?H.shadowSide:v[H.side],D.clipShadows=H.clipShadows,D.clippingPlanes=H.clippingPlanes,D.clipIntersection=H.clipIntersection,D.wireframeLinewidth=H.wireframeLinewidth,D.linewidth=H.linewidth,X&&D.isMeshDistanceMaterial&&(D.referencePosition.copy(q),D.nearDistance=Z,D.farDistance=Q),D}function E(T,H,X,q){if(T.visible!==!1){var Z=T.layers.test(H.layers);if(Z&&(T.isMesh||T.isLine||T.isPoints)&&T.castShadow&&(!T.frustumCulled||i.intersectsObject(T))){T.modelViewMatrix.multiplyMatrices(X.matrixWorldInverse,T.matrixWorld);var Q=t.update(T),N=T.material;if(Array.isArray(N))for(var D=Q.groups,W=0,L=D.length;W<L;W++){var U=D[W],k=N[U.materialIndex];if(k&&k.visible){var ee=M(T,k,q,u,X.near,X.far);e.renderBufferDirect(X,null,Q,ee,T,U)}}else if(N.visible){var ee=M(T,N,q,u,X.near,X.far);e.renderBufferDirect(X,null,Q,ee,T,null)}}for(var K=T.children,te=0,Y=K.length;te<Y;te++)E(K[te],H,X,q)}}}function Kw(e,t,r,i){function n(){var ie=!1,we=new $t,Ie=null,qe=new $t(0,0,0,0);return{setMask:function(Ce){Ie!==Ce&&!ie&&(e.colorMask(Ce,Ce,Ce,Ce),Ie=Ce)},setLocked:function(Ce){ie=Ce},setClear:function(Ce,Ne,Ze,Ve,Qe){Qe===!0&&(Ce*=Ve,Ne*=Ve,Ze*=Ve),we.set(Ce,Ne,Ze,Ve),qe.equals(we)===!1&&(e.clearColor(Ce,Ne,Ze,Ve),qe.copy(we))},reset:function(){ie=!1,Ie=null,qe.set(-1,0,0,0)}}}function a(){var ie=!1,we=null,Ie=null,qe=null;return{setTest:function(Ce){Ce?j(e.DEPTH_TEST):ae(e.DEPTH_TEST)},setMask:function(Ce){we!==Ce&&!ie&&(e.depthMask(Ce),we=Ce)},setFunc:function(Ce){if(Ie!==Ce){if(Ce)switch(Ce){case H1:e.depthFunc(e.NEVER);break;case V1:e.depthFunc(e.ALWAYS);break;case W1:e.depthFunc(e.LESS);break;case Eh:e.depthFunc(e.LEQUAL);break;case j1:e.depthFunc(e.EQUAL);break;case X1:e.depthFunc(e.GEQUAL);break;case q1:e.depthFunc(e.GREATER);break;case Y1:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);Ie=Ce}},setLocked:function(Ce){ie=Ce},setClear:function(Ce){qe!==Ce&&(e.clearDepth(Ce),qe=Ce)},reset:function(){ie=!1,we=null,Ie=null,qe=null}}}function o(){var ie=!1,we=null,Ie=null,qe=null,Ce=null,Ne=null,Ze=null,Ve=null,Qe=null;return{setTest:function(Ye){Ye?j(e.STENCIL_TEST):ae(e.STENCIL_TEST)},setMask:function(Ye){we!==Ye&&!ie&&(e.stencilMask(Ye),we=Ye)},setFunc:function(Ye,vt,Nt){(Ie!==Ye||qe!==vt||Ce!==Nt)&&(e.stencilFunc(Ye,vt,Nt),Ie=Ye,qe=vt,Ce=Nt)},setOp:function(Ye,vt,Nt){(Ne!==Ye||Ze!==vt||Ve!==Nt)&&(e.stencilOp(Ye,vt,Nt),Ne=Ye,Ze=vt,Ve=Nt)},setLocked:function(Ye){ie=Ye},setClear:function(Ye){Qe!==Ye&&(e.clearStencil(Ye),Qe=Ye)},reset:function(){ie=!1,we=null,Ie=null,qe=null,Ce=null,Ne=null,Ze=null,Ve=null,Qe=null}}}var s=new n,u=new a,c=new o,f=e.getParameter(e.MAX_VERTEX_ATTRIBS),l=new Uint8Array(f),h=new Uint8Array(f),d=new Uint8Array(f),p={},v=null,m=null,g=null,x=null,y=null,b=null,_=null,w=null,A=null,S=!1,M=null,E=null,T=null,H=null,X=null,q=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),Z=!1,Q=0,N=e.getParameter(e.VERSION);N.indexOf("WebGL")!==-1?(Q=parseFloat(/^WebGL\ ([0-9])/.exec(N)[1]),Z=Q>=1):N.indexOf("OpenGL ES")!==-1&&(Q=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(N)[1]),Z=Q>=2);var D=null,W={},L=new $t,U=new $t;function k(ie,we,Ie){var qe=new Uint8Array(4),Ce=e.createTexture();e.bindTexture(ie,Ce),e.texParameteri(ie,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(ie,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var Ne=0;Ne<Ie;Ne++)e.texImage2D(we+Ne,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,qe);return Ce}var ee={};ee[e.TEXTURE_2D]=k(e.TEXTURE_2D,e.TEXTURE_2D,1),ee[e.TEXTURE_CUBE_MAP]=k(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),s.setClear(0,0,0,1),u.setClear(1),c.setClear(0),j(e.DEPTH_TEST),u.setFunc(Eh),ne(!1),ve(Dp),j(e.CULL_FACE),j(e.BLEND),Se($n);function K(){for(var ie=0,we=l.length;ie<we;ie++)l[ie]=0}function te(ie){Y(ie,0)}function Y(ie,we){if(l[ie]=1,h[ie]===0&&(e.enableVertexAttribArray(ie),h[ie]=1),d[ie]!==we){var Ie=i.isWebGL2?e:t.get("ANGLE_instanced_arrays");Ie[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](ie,we),d[ie]=we}}function J(){for(var ie=0,we=h.length;ie!==we;++ie)h[ie]!==l[ie]&&(e.disableVertexAttribArray(ie),h[ie]=0)}function j(ie){p[ie]!==!0&&(e.enable(ie),p[ie]=!0)}function ae(ie){p[ie]!==!1&&(e.disable(ie),p[ie]=!1)}function re(){if(v===null&&(v=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")||t.get("WEBGL_compressed_texture_astc")))for(var ie=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),we=0;we<ie.length;we++)v.push(ie[we]);return v}function le(ie){return m!==ie?(e.useProgram(ie),m=ie,!0):!1}function Se(ie,we,Ie,qe,Ce,Ne,Ze,Ve){if(ie!==Ec?j(e.BLEND):ae(e.BLEND),ie!==vg){if(ie!==g||Ve!==S)switch(ie){case xd:Ve?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE,e.ONE,e.ONE)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE));break;case dg:Ve?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR));break;case pg:Ve?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR));break;default:Ve?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA))}x=null,y=null,b=null,_=null,w=null,A=null}else Ce=Ce||we,Ne=Ne||Ie,Ze=Ze||qe,(we!==x||Ce!==_)&&(e.blendEquationSeparate(r.convert(we),r.convert(Ce)),x=we,_=Ce),(Ie!==y||qe!==b||Ne!==w||Ze!==A)&&(e.blendFuncSeparate(r.convert(Ie),r.convert(qe),r.convert(Ne),r.convert(Ze)),y=Ie,b=qe,w=Ne,A=Ze);g=ie,S=Ve}function _e(ie,we){ie.side===Ra?ae(e.CULL_FACE):j(e.CULL_FACE);var Ie=ie.side===ni;we&&(Ie=!Ie),ne(Ie),ie.blending===$n&&ie.transparent===!1?Se(Ec):Se(ie.blending,ie.blendEquation,ie.blendSrc,ie.blendDst,ie.blendEquationAlpha,ie.blendSrcAlpha,ie.blendDstAlpha,ie.premultipliedAlpha),u.setFunc(ie.depthFunc),u.setTest(ie.depthTest),u.setMask(ie.depthWrite),s.setMask(ie.colorWrite),xe(ie.polygonOffset,ie.polygonOffsetFactor,ie.polygonOffsetUnits)}function ne(ie){M!==ie&&(ie?e.frontFace(e.CW):e.frontFace(e.CCW),M=ie)}function ve(ie){ie!==T1?(j(e.CULL_FACE),ie!==E&&(ie===Dp?e.cullFace(e.BACK):ie===E1?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):ae(e.CULL_FACE),E=ie}function se(ie){ie!==T&&(Z&&e.lineWidth(ie),T=ie)}function xe(ie,we,Ie){ie?(j(e.POLYGON_OFFSET_FILL),(H!==we||X!==Ie)&&(e.polygonOffset(we,Ie),H=we,X=Ie)):ae(e.POLYGON_OFFSET_FILL)}function he(ie){ie?j(e.SCISSOR_TEST):ae(e.SCISSOR_TEST)}function ye(ie){ie===void 0&&(ie=e.TEXTURE0+q-1),D!==ie&&(e.activeTexture(ie),D=ie)}function pe(ie,we){D===null&&ye();var Ie=W[D];Ie===void 0&&(Ie={type:void 0,texture:void 0},W[D]=Ie),(Ie.type!==ie||Ie.texture!==we)&&(e.bindTexture(ie,we||ee[ie]),Ie.type=ie,Ie.texture=we)}function Pe(){try{e.compressedTexImage2D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function He(){try{e.texImage2D.apply(e,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}}function Je(ie){L.equals(ie)===!1&&(e.scissor(ie.x,ie.y,ie.z,ie.w),L.copy(ie))}function We(ie){U.equals(ie)===!1&&(e.viewport(ie.x,ie.y,ie.z,ie.w),U.copy(ie))}function Be(){for(var ie=0;ie<h.length;ie++)h[ie]===1&&(e.disableVertexAttribArray(ie),h[ie]=0);p={},v=null,D=null,W={},m=null,g=null,M=null,E=null,s.reset(),u.reset(),c.reset()}return{buffers:{color:s,depth:u,stencil:c},initAttributes:K,enableAttribute:te,enableAttributeAndDivisor:Y,disableUnusedAttributes:J,enable:j,disable:ae,getCompressedTextureFormats:re,useProgram:le,setBlending:Se,setMaterial:_e,setFlipSided:ne,setCullFace:ve,setLineWidth:se,setPolygonOffset:xe,setScissorTest:he,activeTexture:ye,bindTexture:pe,compressedTexImage2D:Pe,texImage2D:He,scissor:Je,viewport:We,reset:Be}}function Jw(e,t,r,i,n,a,o){var s={},u;function c(N,D){if(N.width>D||N.height>D){if("data"in N){console.warn("THREE.WebGLRenderer: image in DataTexture is too big ("+N.width+"x"+N.height+").");return}var W=D/Math.max(N.width,N.height),L=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");L.width=Math.floor(N.width*W),L.height=Math.floor(N.height*W);var U=L.getContext("2d");return U.drawImage(N,0,0,N.width,N.height,0,0,L.width,L.height),console.warn("THREE.WebGLRenderer: image is too big ("+N.width+"x"+N.height+"). Resized to "+L.width+"x"+L.height),L}return N}function f(N){return Pt.isPowerOfTwo(N.width)&&Pt.isPowerOfTwo(N.height)}function l(N){if(N instanceof HTMLImageElement||N instanceof HTMLCanvasElement||N instanceof ImageBitmap){u===void 0&&(u=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),u.width=Pt.floorPowerOfTwo(N.width),u.height=Pt.floorPowerOfTwo(N.height);var D=u.getContext("2d");return D.drawImage(N,0,0,u.width,u.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+N.width+"x"+N.height+"). Resized to "+u.width+"x"+u.height),u}return N}function h(N){return n.isWebGL2?!1:N.wrapS!==bi||N.wrapT!==bi||N.minFilter!==vr&&N.minFilter!==Dr}function d(N,D){return N.generateMipmaps&&D&&N.minFilter!==vr&&N.minFilter!==Dr}function p(N,D,W,L){e.generateMipmap(N);var U=i.get(D);U.__maxMipLevel=Math.log(Math.max(W,L))*Math.LOG2E}function v(N,D){if(!n.isWebGL2)return N;if(N===e.RGB){if(D===e.FLOAT)return e.RGB32F;if(D===e.HALF_FLOAT)return e.RGB16F;if(D===e.UNSIGNED_BYTE)return e.RGB8}if(N===e.RGBA){if(D===e.FLOAT)return e.RGBA32F;if(D===e.HALF_FLOAT)return e.RGBA16F;if(D===e.UNSIGNED_BYTE)return e.RGBA8}return N}function m(N){return N===vr||N===Md||N===Cd?e.NEAREST:e.LINEAR}function g(N){var D=N.target;D.removeEventListener("dispose",g),y(D),D.isVideoTexture&&delete s[D.id],o.memory.textures--}function x(N){var D=N.target;D.removeEventListener("dispose",x),b(D),o.memory.textures--}function y(N){var D=i.get(N);if(N.image&&D.__image__webglTextureCube)e.deleteTexture(D.__image__webglTextureCube);else{if(D.__webglInit===void 0)return;e.deleteTexture(D.__webglTexture)}i.remove(N)}function b(N){var D=i.get(N),W=i.get(N.texture);if(N){if(W.__webglTexture!==void 0&&e.deleteTexture(W.__webglTexture),N.depthTexture&&N.depthTexture.dispose(),N.isWebGLRenderTargetCube)for(var L=0;L<6;L++)e.deleteFramebuffer(D.__webglFramebuffer[L]),D.__webglDepthbuffer&&e.deleteRenderbuffer(D.__webglDepthbuffer[L]);else e.deleteFramebuffer(D.__webglFramebuffer),D.__webglDepthbuffer&&e.deleteRenderbuffer(D.__webglDepthbuffer);i.remove(N.texture),i.remove(N)}}function _(N,D){var W=i.get(N);if(N.isVideoTexture&&Q(N),N.version>0&&W.__version!==N.version){var L=N.image;if(L===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(L.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{M(W,N,D);return}}r.activeTexture(e.TEXTURE0+D),r.bindTexture(e.TEXTURE_2D,W.__webglTexture)}function w(N,D){var W=i.get(N);if(N.image.length===6)if(N.version>0&&W.__version!==N.version){W.__image__webglTextureCube||(N.addEventListener("dispose",g),W.__image__webglTextureCube=e.createTexture(),o.memory.textures++),r.activeTexture(e.TEXTURE0+D),r.bindTexture(e.TEXTURE_CUBE_MAP,W.__image__webglTextureCube),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,N.flipY);for(var L=N&&N.isCompressedTexture,U=N.image[0]&&N.image[0].isDataTexture,k=[],ee=0;ee<6;ee++)!L&&!U?k[ee]=c(N.image[ee],n.maxCubemapSize):k[ee]=U?N.image[ee].image:N.image[ee];var K=k[0],te=f(K),Y=a.convert(N.format),J=a.convert(N.type),j=v(Y,J);S(e.TEXTURE_CUBE_MAP,N,te);for(var ee=0;ee<6;ee++)if(!L)U?r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ee,0,j,k[ee].width,k[ee].height,0,Y,J,k[ee].data):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ee,0,j,Y,J,k[ee]);else for(var ae,re=k[ee].mipmaps,le=0,Se=re.length;le<Se;le++)ae=re[le],N.format!==zi&&N.format!==Bs?r.getCompressedTextureFormats().indexOf(Y)>-1?r.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ee,le,j,ae.width,ae.height,0,ae.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+ee,le,j,ae.width,ae.height,0,Y,J,ae.data);L?W.__maxMipLevel=re.length-1:W.__maxMipLevel=0,d(N,te)&&p(e.TEXTURE_CUBE_MAP,N,K.width,K.height),W.__version=N.version,N.onUpdate&&N.onUpdate(N)}else r.activeTexture(e.TEXTURE0+D),r.bindTexture(e.TEXTURE_CUBE_MAP,W.__image__webglTextureCube)}function A(N,D){r.activeTexture(e.TEXTURE0+D),r.bindTexture(e.TEXTURE_CUBE_MAP,i.get(N).__webglTexture)}function S(N,D,W){var L;if(W?(e.texParameteri(N,e.TEXTURE_WRAP_S,a.convert(D.wrapS)),e.texParameteri(N,e.TEXTURE_WRAP_T,a.convert(D.wrapT)),e.texParameteri(N,e.TEXTURE_MAG_FILTER,a.convert(D.magFilter)),e.texParameteri(N,e.TEXTURE_MIN_FILTER,a.convert(D.minFilter))):(e.texParameteri(N,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(N,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),(D.wrapS!==bi||D.wrapT!==bi)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(N,e.TEXTURE_MAG_FILTER,m(D.magFilter)),e.texParameteri(N,e.TEXTURE_MIN_FILTER,m(D.minFilter)),D.minFilter!==vr&&D.minFilter!==Dr&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),L=t.get("EXT_texture_filter_anisotropic"),L){if(D.type===go&&t.get("OES_texture_float_linear")===null||D.type===Pd&&(n.isWebGL2||t.get("OES_texture_half_float_linear"))===null)return;(D.anisotropy>1||i.get(D).__currentAnisotropy)&&(e.texParameterf(N,L.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(D.anisotropy,n.getMaxAnisotropy())),i.get(D).__currentAnisotropy=D.anisotropy)}}function M(N,D,W){N.__webglInit===void 0&&(N.__webglInit=!0,D.addEventListener("dispose",g),N.__webglTexture=e.createTexture(),o.memory.textures++),r.activeTexture(e.TEXTURE0+W),r.bindTexture(e.TEXTURE_2D,N.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,D.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,D.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,D.unpackAlignment);var L=c(D.image,n.maxTextureSize);h(D)&&f(L)===!1&&(L=l(L));var U=f(L),k=a.convert(D.format),ee=a.convert(D.type),K=v(k,ee);S(e.TEXTURE_2D,D,U);var te,Y=D.mipmaps;if(D.isDepthTexture){if(K=e.DEPTH_COMPONENT,D.type===go){if(!n.isWebGL2)throw new Error("Float Depth Texture only supported in WebGL2.0");K=e.DEPTH_COMPONENT32F}else n.isWebGL2&&(K=e.DEPTH_COMPONENT16);D.format===lo&&K===e.DEPTH_COMPONENT&&D.type!==Ic&&D.type!==Ag&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),D.type=Ic,ee=a.convert(D.type)),D.format===Ns&&(K=e.DEPTH_STENCIL,D.type!==Rc&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),D.type=Rc,ee=a.convert(D.type))),r.texImage2D(e.TEXTURE_2D,0,K,L.width,L.height,0,k,ee,null)}else if(D.isDataTexture)if(Y.length>0&&U){for(var J=0,j=Y.length;J<j;J++)te=Y[J],r.texImage2D(e.TEXTURE_2D,J,K,te.width,te.height,0,k,ee,te.data);D.generateMipmaps=!1,N.__maxMipLevel=Y.length-1}else r.texImage2D(e.TEXTURE_2D,0,K,L.width,L.height,0,k,ee,L.data),N.__maxMipLevel=0;else if(D.isCompressedTexture){for(var J=0,j=Y.length;J<j;J++)te=Y[J],D.format!==zi&&D.format!==Bs?r.getCompressedTextureFormats().indexOf(k)>-1?r.compressedTexImage2D(e.TEXTURE_2D,J,K,te.width,te.height,0,te.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(e.TEXTURE_2D,J,K,te.width,te.height,0,k,ee,te.data);N.__maxMipLevel=Y.length-1}else if(Y.length>0&&U){for(var J=0,j=Y.length;J<j;J++)te=Y[J],r.texImage2D(e.TEXTURE_2D,J,K,k,ee,te);D.generateMipmaps=!1,N.__maxMipLevel=Y.length-1}else r.texImage2D(e.TEXTURE_2D,0,K,k,ee,L),N.__maxMipLevel=0;d(D,U)&&p(e.TEXTURE_2D,D,L.width,L.height),N.__version=D.version,D.onUpdate&&D.onUpdate(D)}function E(N,D,W,L){var U=a.convert(D.texture.format),k=a.convert(D.texture.type),ee=v(U,k);r.texImage2D(L,0,ee,D.width,D.height,0,U,k,null),e.bindFramebuffer(e.FRAMEBUFFER,N),e.framebufferTexture2D(e.FRAMEBUFFER,W,L,i.get(D.texture).__webglTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null)}function T(N,D){e.bindRenderbuffer(e.RENDERBUFFER,N),D.depthBuffer&&!D.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,D.width,D.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,N)):D.depthBuffer&&D.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,D.width,D.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,N)):e.renderbufferStorage(e.RENDERBUFFER,e.RGBA4,D.width,D.height),e.bindRenderbuffer(e.RENDERBUFFER,null)}function H(N,D){var W=D&&D.isWebGLRenderTargetCube;if(W)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(e.FRAMEBUFFER,N),!(D.depthTexture&&D.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(D.depthTexture).__webglTexture||D.depthTexture.image.width!==D.width||D.depthTexture.image.height!==D.height)&&(D.depthTexture.image.width=D.width,D.depthTexture.image.height=D.height,D.depthTexture.needsUpdate=!0),_(D.depthTexture,0);var L=i.get(D.depthTexture).__webglTexture;if(D.depthTexture.format===lo)e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,L,0);else if(D.depthTexture.format===Ns)e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,L,0);else throw new Error("Unknown depthTexture format")}function X(N){var D=i.get(N),W=N.isWebGLRenderTargetCube===!0;if(N.depthTexture){if(W)throw new Error("target.depthTexture not supported in Cube render targets");H(D.__webglFramebuffer,N)}else if(W){D.__webglDepthbuffer=[];for(var L=0;L<6;L++)e.bindFramebuffer(e.FRAMEBUFFER,D.__webglFramebuffer[L]),D.__webglDepthbuffer[L]=e.createRenderbuffer(),T(D.__webglDepthbuffer[L],N)}else e.bindFramebuffer(e.FRAMEBUFFER,D.__webglFramebuffer),D.__webglDepthbuffer=e.createRenderbuffer(),T(D.__webglDepthbuffer,N);e.bindFramebuffer(e.FRAMEBUFFER,null)}function q(N){var D=i.get(N),W=i.get(N.texture);N.addEventListener("dispose",x),W.__webglTexture=e.createTexture(),o.memory.textures++;var L=N.isWebGLRenderTargetCube===!0,U=f(N);if(L){D.__webglFramebuffer=[];for(var k=0;k<6;k++)D.__webglFramebuffer[k]=e.createFramebuffer()}else D.__webglFramebuffer=e.createFramebuffer();if(L){r.bindTexture(e.TEXTURE_CUBE_MAP,W.__webglTexture),S(e.TEXTURE_CUBE_MAP,N.texture,U);for(var k=0;k<6;k++)E(D.__webglFramebuffer[k],N,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+k);d(N.texture,U)&&p(e.TEXTURE_CUBE_MAP,N.texture,N.width,N.height),r.bindTexture(e.TEXTURE_CUBE_MAP,null)}else r.bindTexture(e.TEXTURE_2D,W.__webglTexture),S(e.TEXTURE_2D,N.texture,U),E(D.__webglFramebuffer,N,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),d(N.texture,U)&&p(e.TEXTURE_2D,N.texture,N.width,N.height),r.bindTexture(e.TEXTURE_2D,null);N.depthBuffer&&X(N)}function Z(N){var D=N.texture,W=f(N);if(d(D,W)){var L=N.isWebGLRenderTargetCube?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,U=i.get(D).__webglTexture;r.bindTexture(L,U),p(L,D,N.width,N.height),r.bindTexture(L,null)}}function Q(N){var D=N.id,W=o.render.frame;s[D]!==W&&(s[D]=W,N.update())}this.setTexture2D=_,this.setTextureCube=w,this.setTextureCubeDynamic=A,this.setupRenderTarget=q,this.updateRenderTargetMipmap=Z}function Qw(e,t,r){function i(n){var a;if(n===Jn)return e.REPEAT;if(n===bi)return e.CLAMP_TO_EDGE;if(n===mo)return e.MIRRORED_REPEAT;if(n===vr)return e.NEAREST;if(n===Md)return e.NEAREST_MIPMAP_NEAREST;if(n===Cd)return e.NEAREST_MIPMAP_LINEAR;if(n===Dr)return e.LINEAR;if(n===wg)return e.LINEAR_MIPMAP_NEAREST;if(n===Ff)return e.LINEAR_MIPMAP_LINEAR;if(n===Fs)return e.UNSIGNED_BYTE;if(n===ib)return e.UNSIGNED_SHORT_4_4_4_4;if(n===nb)return e.UNSIGNED_SHORT_5_5_5_1;if(n===ab)return e.UNSIGNED_SHORT_5_6_5;if(n===eb)return e.BYTE;if(n===tb)return e.SHORT;if(n===Ic)return e.UNSIGNED_SHORT;if(n===rb)return e.INT;if(n===Ag)return e.UNSIGNED_INT;if(n===go)return e.FLOAT;if(n===Pd){if(r.isWebGL2)return e.HALF_FLOAT;if(a=t.get("OES_texture_half_float"),a!==null)return a.HALF_FLOAT_OES}if(n===ob)return e.ALPHA;if(n===Bs)return e.RGB;if(n===zi)return e.RGBA;if(n===sb)return e.LUMINANCE;if(n===ub)return e.LUMINANCE_ALPHA;if(n===lo)return e.DEPTH_COMPONENT;if(n===Ns)return e.DEPTH_STENCIL;if(n===mg)return e.FUNC_ADD;if(n===R1)return e.FUNC_SUBTRACT;if(n===L1)return e.FUNC_REVERSE_SUBTRACT;if(n===O1)return e.ZERO;if(n===D1)return e.ONE;if(n===F1)return e.SRC_COLOR;if(n===B1)return e.ONE_MINUS_SRC_COLOR;if(n===gg)return e.SRC_ALPHA;if(n===yg)return e.ONE_MINUS_SRC_ALPHA;if(n===N1)return e.DST_ALPHA;if(n===k1)return e.ONE_MINUS_DST_ALPHA;if(n===z1)return e.DST_COLOR;if(n===U1)return e.ONE_MINUS_DST_COLOR;if(n===G1)return e.SRC_ALPHA_SATURATE;if((n===Fp||n===Bp||n===Np||n===kp)&&(a=t.get("WEBGL_compressed_texture_s3tc"),a!==null)){if(n===Fp)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Bp)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Np)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===kp)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((n===zp||n===Up||n===Gp||n===Hp)&&(a=t.get("WEBGL_compressed_texture_pvrtc"),a!==null)){if(n===zp)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Up)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===Gp)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Hp)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===cb&&(a=t.get("WEBGL_compressed_texture_etc1"),a!==null))return a.COMPRESSED_RGB_ETC1_WEBGL;if((n===fb||n===lb||n===hb||n===db||n===pb||n===vb||n===mb||n===gb||n===yb||n===bb||n===xb||n===_b||n===wb||n===Ab)&&(a=t.get("WEBGL_compressed_texture_astc"),a!==null))return n;if(n===xl||n===_l){if(r.isWebGL2){if(n===xl)return e.MIN;if(n===_l)return e.MAX}if(a=t.get("EXT_blend_minmax"),a!==null){if(n===xl)return a.MIN_EXT;if(n===_l)return a.MAX_EXT}}if(n===Rc){if(r.isWebGL2)return e.UNSIGNED_INT_24_8;if(a=t.get("WEBGL_depth_texture"),a!==null)return a.UNSIGNED_INT_24_8_WEBGL}return 0}return{convert:i}}function Jt(){Ge.call(this),this.type="Group"}Jt.prototype=Object.assign(Object.create(Ge.prototype),{constructor:Jt,isGroup:!0});function xr(e,t,r,i){Ln.call(this),this.type="PerspectiveCamera",this.fov=e!==void 0?e:50,this.zoom=1,this.near=r!==void 0?r:.1,this.far=i!==void 0?i:2e3,this.focus=10,this.aspect=t!==void 0?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}xr.prototype=Object.assign(Object.create(Ln.prototype),{constructor:xr,isPerspectiveCamera:!0,copy:function(e,t){return Ln.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=Pt.RAD2DEG*2*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(Pt.DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/e},getEffectiveFOV:function(){return Pt.RAD2DEG*2*Math.atan(Math.tan(Pt.DEG2RAD*.5*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,r,i,n,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(Pt.DEG2RAD*.5*this.fov)/this.zoom,r=2*t,i=this.aspect*r,n=-.5*i,a=this.view;if(this.view!==null&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;n+=a.offsetX*i/o,t-=a.offsetY*r/s,i*=a.width/o,r*=a.height/s}var u=this.filmOffset;u!==0&&(n+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+i,t,t-r,e,this.far)},toJSON:function(e){var t=Ge.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});function Bc(e){xr.call(this),this.cameras=e||[]}Bc.prototype=Object.assign(Object.create(xr.prototype),{constructor:Bc,isArrayCamera:!0});function Ug(e){var t=this,r=null,i=null,n=null,a=[],o=new Ae,s=new Ae;typeof window<"u"&&"VRFrameData"in window&&(i=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",g,!1));var u=new Ae,c=new er,f=new I,l=new xr;l.bounds=new $t(0,0,.5,1),l.layers.enable(1);var h=new xr;h.bounds=new $t(.5,0,.5,1),h.layers.enable(2);var d=new Bc([l,h]);d.layers.enable(1),d.layers.enable(2);function p(){return r!==null&&r.isPresenting===!0}var v,m;function g(){if(p()){var w=r.getEyeParameters("left"),A=w.renderWidth,S=w.renderHeight;m=e.getPixelRatio(),v=e.getSize(),e.setDrawingBufferSize(A*2,S,1),_.start()}else t.enabled&&(e.setDrawingBufferSize(v.width,v.height,m),_.stop())}var x=[];function y(w){for(var A=navigator.getGamepads&&navigator.getGamepads(),S=0,M=0,E=A.length;S<E;S++){var T=A[S];if(T&&(T.id==="Daydream Controller"||T.id==="Gear VR Controller"||T.id==="Oculus Go Controller"||T.id==="OpenVR Gamepad"||T.id.startsWith("Oculus Touch")||T.id.startsWith("Spatial Controller"))){if(M===w)return T;M++}}}function b(){for(var w=0;w<a.length;w++){var A=a[w],S=y(w);if(S!==void 0&&S.pose!==void 0){if(S.pose===null)return;var M=S.pose;M.hasPosition===!1&&A.position.set(.2,-.6,-.05),M.position!==null&&A.position.fromArray(M.position),M.orientation!==null&&A.quaternion.fromArray(M.orientation),A.matrix.compose(A.position,A.quaternion,A.scale),A.matrix.premultiply(o),A.matrix.decompose(A.position,A.quaternion,A.scale),A.matrixWorldNeedsUpdate=!0,A.visible=!0;var E=S.id==="Daydream Controller"?0:1;x[w]!==S.buttons[E].pressed&&(x[w]=S.buttons[E].pressed,x[w]===!0?A.dispatchEvent({type:"selectstart"}):(A.dispatchEvent({type:"selectend"}),A.dispatchEvent({type:"select"})))}else A.visible=!1}}this.enabled=!1,this.userHeight=1.6,this.getController=function(w){var A=a[w];return A===void 0&&(A=new Jt,A.matrixAutoUpdate=!1,A.visible=!1,a[w]=A),A},this.getDevice=function(){return r},this.setDevice=function(w){w!==void 0&&(r=w),_.setContext(w)},this.setPoseTarget=function(w){w!==void 0&&(n=w)},this.getCamera=function(w){if(r===null)return w.position.set(0,t.userHeight,0),w;r.depthNear=w.near,r.depthFar=w.far,r.getFrameData(i);var A=r.stageParameters;A?o.fromArray(A.sittingToStandingTransform):o.makeTranslation(0,t.userHeight,0);var S=i.pose,M=n!==null?n:w;if(M.matrix.copy(o),M.matrix.decompose(M.position,M.quaternion,M.scale),S.orientation!==null&&(c.fromArray(S.orientation),M.quaternion.multiply(c)),S.position!==null&&(c.setFromRotationMatrix(o),f.fromArray(S.position),f.applyQuaternion(c),M.position.add(f)),M.updateMatrixWorld(),r.isPresenting===!1)return w;l.near=w.near,h.near=w.near,l.far=w.far,h.far=w.far,d.matrixWorld.copy(w.matrixWorld),d.matrixWorldInverse.copy(w.matrixWorldInverse),l.matrixWorldInverse.fromArray(i.leftViewMatrix),h.matrixWorldInverse.fromArray(i.rightViewMatrix),s.getInverse(o),l.matrixWorldInverse.multiply(s),h.matrixWorldInverse.multiply(s);var E=M.parent;E!==null&&(u.getInverse(E.matrixWorld),l.matrixWorldInverse.multiply(u),h.matrixWorldInverse.multiply(u)),l.matrixWorld.getInverse(l.matrixWorldInverse),h.matrixWorld.getInverse(h.matrixWorldInverse),l.projectionMatrix.fromArray(i.leftProjectionMatrix),h.projectionMatrix.fromArray(i.rightProjectionMatrix),d.projectionMatrix.copy(l.projectionMatrix);var T=r.getLayers();if(T.length){var H=T[0];H.leftBounds!==null&&H.leftBounds.length===4&&l.bounds.fromArray(H.leftBounds),H.rightBounds!==null&&H.rightBounds.length===4&&h.bounds.fromArray(H.rightBounds)}return b(),d},this.getStandingMatrix=function(){return o},this.isPresenting=p;var _=new Id;this.setAnimationLoop=function(w){_.setAnimationLoop(w)},this.submitFrame=function(){p()&&r.submitFrame()},this.dispose=function(){typeof window<"u"&&window.removeEventListener("vrdisplaypresentchange",g)}}function $w(e){var t=e.context,r=null,i=null,n=null,a=null,o=[],s=[];function u(){return i!==null&&n!==null}var c=new xr;c.layers.enable(1),c.viewport=new $t;var f=new xr;f.layers.enable(2),f.viewport=new $t;var l=new Bc([c,f]);l.layers.enable(1),l.layers.enable(2),this.enabled=!1,this.getController=function(x){var y=o[x];return y===void 0&&(y=new Jt,y.matrixAutoUpdate=!1,y.visible=!1,o[x]=y),y},this.getDevice=function(){return r},this.setDevice=function(x){x!==void 0&&(r=x),x instanceof XRDevice&&t.setCompatibleXRDevice(x)};function h(x){var y=o[s.indexOf(x.inputSource)];y&&y.dispatchEvent({type:x.type})}function d(){e.setFramebuffer(null),g.stop()}this.setSession=function(x,y){i=x,i!==null&&(i.addEventListener("select",h),i.addEventListener("selectstart",h),i.addEventListener("selectend",h),i.addEventListener("end",d),i.baseLayer=new XRWebGLLayer(i,t),i.requestFrameOfReference(y.frameOfReferenceType).then(function(b){n=b,e.setFramebuffer(i.baseLayer.framebuffer),g.setContext(i),g.start()}),s=i.getInputSources(),i.addEventListener("inputsourceschange",function(){s=i.getInputSources(),console.log(s)}))};function p(x,y){y===null?x.matrixWorld.copy(x.matrix):x.matrixWorld.multiplyMatrices(y.matrixWorld,x.matrix),x.matrixWorldInverse.getInverse(x.matrixWorld)}this.getCamera=function(x){if(u()){var y=x.parent,b=l.cameras;p(l,y);for(var _=0;_<b.length;_++)p(b[_],y);x.matrixWorld.copy(l.matrixWorld);for(var w=x.children,_=0,A=w.length;_<A;_++)w[_].updateMatrixWorld(!0);return l}return x},this.isPresenting=u;var v=null;function m(x,y){if(a=y.getDevicePose(n),a!==null)for(var b=i.baseLayer,_=y.views,w=0;w<_.length;w++){var A=_[w],S=b.getViewport(A),M=a.getViewMatrix(A),E=l.cameras[w];E.matrix.fromArray(M).getInverse(E.matrix),E.projectionMatrix.fromArray(A.projectionMatrix),E.viewport.set(S.x,S.y,S.width,S.height),w===0&&(l.matrix.copy(E.matrix),l.projectionMatrix.copy(E.projectionMatrix))}for(var w=0;w<o.length;w++){var T=o[w],H=s[w];if(H){var X=y.getInputPose(H,n);if(X!==null){T.matrix.elements=X.pointerMatrix,T.matrix.decompose(T.position,T.rotation,T.scale),T.visible=!0;continue}}T.visible=!1}v&&v(x)}var g=new Id;g.setAnimationLoop(m),this.setAnimationLoop=function(x){v=x},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new THREE.Matrix4},this.submitFrame=function(){}}function Rd(e){console.log("THREE.WebGLRenderer",P1),e=e||{};var t=e.canvas!==void 0?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r=e.context!==void 0?e.context:null,i=e.alpha!==void 0?e.alpha:!1,n=e.depth!==void 0?e.depth:!0,a=e.stencil!==void 0?e.stencil:!0,o=e.antialias!==void 0?e.antialias:!1,s=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,u=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,c=e.powerPreference!==void 0?e.powerPreference:"default",f=null,l=null;this.domElement=t,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=bg,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var h=this,d=!1,p=null,v=null,m=null,g=-1,x={geometry:null,program:null,wireframe:!1},y=null,b=null,_=new $t,w=new $t,A=null,S=0,M=t.width,E=t.height,T=1,H=new $t(0,0,M,E),X=new $t(0,0,M,E),q=!1,Z=new Ed,Q=new ew,N=!1,D=!1,W=new Ae,L=new I;function U(){return v===null?T:1}var k;try{var ee={alpha:i,depth:n,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:u,powerPreference:c};if(t.addEventListener("webglcontextlost",We,!1),t.addEventListener("webglcontextrestored",Be,!1),k=r||t.getContext("webgl",ee)||t.getContext("experimental-webgl",ee),k===null)throw t.getContext("webgl")!==null?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");k.getShaderPrecisionFormat===void 0&&(k.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(C){console.error("THREE.WebGLRenderer: "+C.message)}var K,te,Y,J,j,ae,re,le,Se,_e,ne,ve,se,xe,he,ye,pe;function Pe(){K=new tw(k),te=new $_(k,K,e),te.isWebGL2||(K.get("WEBGL_depth_texture"),K.get("OES_texture_float"),K.get("OES_texture_half_float"),K.get("OES_texture_half_float_linear"),K.get("OES_standard_derivatives"),K.get("OES_element_index_uint"),K.get("ANGLE_instanced_arrays")),K.get("OES_texture_float_linear"),pe=new Qw(k,K,te),Y=new Kw(k,K,pe,te),Y.scissor(w.copy(X).multiplyScalar(T)),Y.viewport(_.copy(H).multiplyScalar(T)),J=new nw(k),j=new Gw,ae=new Jw(k,K,Y,j,te,pe,J),re=new X_(k),le=new rw(k,re,J),Se=new sw(le,J),xe=new ow(k),_e=new Uw(h,K,te),ne=new jw,ve=new Zw,se=new J_(h,Y,Se,s),he=new Q_(k,K,J,te),ye=new iw(k,K,J,te),J.programs=_e.programs,h.context=k,h.capabilities=te,h.extensions=K,h.properties=j,h.renderLists=ne,h.state=Y,h.info=J}Pe();var He="xr"in navigator?new $w(h):new Ug(h);this.vr=He;var Je=new zg(h,Se,te.maxTextureSize);this.shadowMap=Je,this.getContext=function(){return k},this.getContextAttributes=function(){return k.getContextAttributes()},this.forceContextLoss=function(){var C=K.get("WEBGL_lose_context");C&&C.loseContext()},this.forceContextRestore=function(){var C=K.get("WEBGL_lose_context");C&&C.restoreContext()},this.getPixelRatio=function(){return T},this.setPixelRatio=function(C){C!==void 0&&(T=C,this.setSize(M,E,!1))},this.getSize=function(){return{width:M,height:E}},this.setSize=function(C,R,z){if(He.isPresenting()){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}M=C,E=R,t.width=C*T,t.height=R*T,z!==!1&&(t.style.width=C+"px",t.style.height=R+"px"),this.setViewport(0,0,C,R)},this.getDrawingBufferSize=function(){return{width:M*T,height:E*T}},this.setDrawingBufferSize=function(C,R,z){M=C,E=R,T=z,t.width=C*z,t.height=R*z,this.setViewport(0,0,C,R)},this.getCurrentViewport=function(){return _},this.setViewport=function(C,R,z,oe){H.set(C,E-R-oe,z,oe),Y.viewport(_.copy(H).multiplyScalar(T))},this.setScissor=function(C,R,z,oe){X.set(C,E-R-oe,z,oe),Y.scissor(w.copy(X).multiplyScalar(T))},this.setScissorTest=function(C){Y.setScissorTest(q=C)},this.getClearColor=function(){return se.getClearColor()},this.setClearColor=function(){se.setClearColor.apply(se,arguments)},this.getClearAlpha=function(){return se.getClearAlpha()},this.setClearAlpha=function(){se.setClearAlpha.apply(se,arguments)},this.clear=function(C,R,z){var oe=0;(C===void 0||C)&&(oe|=k.COLOR_BUFFER_BIT),(R===void 0||R)&&(oe|=k.DEPTH_BUFFER_BIT),(z===void 0||z)&&(oe|=k.STENCIL_BUFFER_BIT),k.clear(oe)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(C,R,z,oe){this.setRenderTarget(C),this.clear(R,z,oe)},this.dispose=function(){t.removeEventListener("webglcontextlost",We,!1),t.removeEventListener("webglcontextrestored",Be,!1),ne.dispose(),ve.dispose(),j.dispose(),Se.dispose(),He.dispose(),Ve.stop()};function We(C){C.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),d=!0}function Be(){console.log("THREE.WebGLRenderer: Context Restored."),d=!1,Pe()}function ie(C){var R=C.target;R.removeEventListener("dispose",ie),we(R)}function we(C){Ie(C),j.remove(C)}function Ie(C){var R=j.get(C).program;C.program=void 0,R!==void 0&&_e.releaseProgram(R)}function qe(C,R){C.render(function(z){h.renderBufferImmediate(z,R)})}this.renderBufferImmediate=function(C,R){Y.initAttributes();var z=j.get(C);C.hasPositions&&!z.position&&(z.position=k.createBuffer()),C.hasNormals&&!z.normal&&(z.normal=k.createBuffer()),C.hasUvs&&!z.uv&&(z.uv=k.createBuffer()),C.hasColors&&!z.color&&(z.color=k.createBuffer());var oe=R.getAttributes();C.hasPositions&&(k.bindBuffer(k.ARRAY_BUFFER,z.position),k.bufferData(k.ARRAY_BUFFER,C.positionArray,k.DYNAMIC_DRAW),Y.enableAttribute(oe.position),k.vertexAttribPointer(oe.position,3,k.FLOAT,!1,0,0)),C.hasNormals&&(k.bindBuffer(k.ARRAY_BUFFER,z.normal),k.bufferData(k.ARRAY_BUFFER,C.normalArray,k.DYNAMIC_DRAW),Y.enableAttribute(oe.normal),k.vertexAttribPointer(oe.normal,3,k.FLOAT,!1,0,0)),C.hasUvs&&(k.bindBuffer(k.ARRAY_BUFFER,z.uv),k.bufferData(k.ARRAY_BUFFER,C.uvArray,k.DYNAMIC_DRAW),Y.enableAttribute(oe.uv),k.vertexAttribPointer(oe.uv,2,k.FLOAT,!1,0,0)),C.hasColors&&(k.bindBuffer(k.ARRAY_BUFFER,z.color),k.bufferData(k.ARRAY_BUFFER,C.colorArray,k.DYNAMIC_DRAW),Y.enableAttribute(oe.color),k.vertexAttribPointer(oe.color,3,k.FLOAT,!1,0,0)),Y.disableUnusedAttributes(),k.drawArrays(k.TRIANGLES,0,C.count),C.count=0},this.renderBufferDirect=function(C,R,z,oe,ce,Te){var de=ce.isMesh&&ce.normalMatrix.determinant()<0;Y.setMaterial(oe,de);var ue=Rt(C,R,oe,ce),Me=!1;(x.geometry!==z.id||x.program!==ue.id||x.wireframe!==(oe.wireframe===!0))&&(x.geometry=z.id,x.program=ue.id,x.wireframe=oe.wireframe===!0,Me=!0),ce.morphTargetInfluences&&(xe.update(ce,z,oe,ue),Me=!0);var Le=z.index,De=z.attributes.position,Fe=1;oe.wireframe===!0&&(Le=le.getWireframeAttribute(z),Fe=2);var wt,ke=he;Le!==null&&(wt=re.get(Le),ke=ye,ke.setIndex(wt)),Me&&(Ce(oe,ue,z),Le!==null&&k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,wt.buffer));var je=1/0;Le!==null?je=Le.count:De!==void 0&&(je=De.count);var pt=z.drawRange.start*Fe,Xe=z.drawRange.count*Fe,be=Te!==null?Te.start*Fe:0,Re=Te!==null?Te.count*Fe:1/0,et=Math.max(pt,be),mt=Math.min(je,pt+Xe,be+Re)-1,it=Math.max(0,mt-et+1);if(it!==0){if(ce.isMesh)if(oe.wireframe===!0)Y.setLineWidth(oe.wireframeLinewidth*U()),ke.setMode(k.LINES);else switch(ce.drawMode){case Sg:ke.setMode(k.TRIANGLES);break;case Pb:ke.setMode(k.TRIANGLE_STRIP);break;case Tb:ke.setMode(k.TRIANGLE_FAN);break}else if(ce.isLine){var xt=oe.linewidth;xt===void 0&&(xt=1),Y.setLineWidth(xt*U()),ce.isLineSegments?ke.setMode(k.LINES):ce.isLineLoop?ke.setMode(k.LINE_LOOP):ke.setMode(k.LINE_STRIP)}else ce.isPoints?ke.setMode(k.POINTS):ce.isSprite&&ke.setMode(k.TRIANGLES);z&&z.isInstancedBufferGeometry?z.maxInstancedCount>0&&ke.renderInstances(z,et,it):ke.render(et,it)}};function Ce(C,R,z){if(z&&z.isInstancedBufferGeometry&!te.isWebGL2&&K.get("ANGLE_instanced_arrays")===null){console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}Y.initAttributes();var oe=z.attributes,ce=R.getAttributes(),Te=C.defaultAttributeValues;for(var de in ce){var ue=ce[de];if(ue>=0){var Me=oe[de];if(Me!==void 0){var Le=Me.normalized,De=Me.itemSize,Fe=re.get(Me);if(Fe===void 0)continue;var wt=Fe.buffer,ke=Fe.type,je=Fe.bytesPerElement;if(Me.isInterleavedBufferAttribute){var pt=Me.data,Xe=pt.stride,be=Me.offset;pt&&pt.isInstancedInterleavedBuffer?(Y.enableAttributeAndDivisor(ue,pt.meshPerAttribute),z.maxInstancedCount===void 0&&(z.maxInstancedCount=pt.meshPerAttribute*pt.count)):Y.enableAttribute(ue),k.bindBuffer(k.ARRAY_BUFFER,wt),k.vertexAttribPointer(ue,De,ke,Le,Xe*je,be*je)}else Me.isInstancedBufferAttribute?(Y.enableAttributeAndDivisor(ue,Me.meshPerAttribute),z.maxInstancedCount===void 0&&(z.maxInstancedCount=Me.meshPerAttribute*Me.count)):Y.enableAttribute(ue),k.bindBuffer(k.ARRAY_BUFFER,wt),k.vertexAttribPointer(ue,De,ke,Le,0,0)}else if(Te!==void 0){var Re=Te[de];if(Re!==void 0)switch(Re.length){case 2:k.vertexAttrib2fv(ue,Re);break;case 3:k.vertexAttrib3fv(ue,Re);break;case 4:k.vertexAttrib4fv(ue,Re);break;default:k.vertexAttrib1fv(ue,Re)}}}}Y.disableUnusedAttributes()}this.compile=function(C,R){l=ve.get(C,R),l.init(),C.traverse(function(z){z.isLight&&(l.pushLight(z),z.castShadow&&l.pushShadow(z))}),l.setupLights(R),C.traverse(function(z){if(z.material)if(Array.isArray(z.material))for(var oe=0;oe<z.material.length;oe++)Nt(z.material[oe],C.fog,z);else Nt(z.material,C.fog,z)})};var Ne=null;function Ze(C){He.isPresenting()||Ne&&Ne(C)}var Ve=new Id;Ve.setAnimationLoop(Ze),typeof window<"u"&&Ve.setContext(window),this.setAnimationLoop=function(C){Ne=C,He.setAnimationLoop(C),Ve.start()},this.render=function(C,R,z,oe){if(!(R&&R.isCamera)){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(!d){x.geometry=null,x.program=null,x.wireframe=!1,g=-1,y=null,C.autoUpdate===!0&&C.updateMatrixWorld(),R.parent===null&&R.updateMatrixWorld(),He.enabled&&(R=He.getCamera(R)),l=ve.get(C,R),l.init(),C.onBeforeRender(h,C,R,z),W.multiplyMatrices(R.projectionMatrix,R.matrixWorldInverse),Z.setFromMatrix(W),D=this.localClippingEnabled,N=Q.init(this.clippingPlanes,D,R),f=ne.get(C,R),f.init(),Qe(C,R,h.sortObjects),h.sortObjects===!0&&f.sort(),N&&Q.beginShadows();var ce=l.state.shadowsArray;Je.render(ce,C,R),l.setupLights(R),N&&Q.endShadows(),this.info.autoReset&&this.info.reset(),z===void 0&&(z=null),this.setRenderTarget(z),se.render(f,C,R,oe);var Te=f.opaque,de=f.transparent;if(C.overrideMaterial){var ue=C.overrideMaterial;Te.length&&Ye(Te,C,R,ue),de.length&&Ye(de,C,R,ue)}else Te.length&&Ye(Te,C,R),de.length&&Ye(de,C,R);z&&ae.updateRenderTargetMipmap(z),Y.buffers.depth.setTest(!0),Y.buffers.depth.setMask(!0),Y.buffers.color.setMask(!0),Y.setPolygonOffset(!1),C.onAfterRender(h,C,R),He.enabled&&He.submitFrame(),f=null,l=null}};function Qe(C,R,z){if(C.visible!==!1){var oe=C.layers.test(R.layers);if(oe){if(C.isLight)l.pushLight(C),C.castShadow&&l.pushShadow(C);else if(C.isSprite){if(!C.frustumCulled||Z.intersectsSprite(C)){z&&L.setFromMatrixPosition(C.matrixWorld).applyMatrix4(W);var ce=Se.update(C),Te=C.material;f.push(C,ce,Te,L.z,null)}}else if(C.isImmediateRenderObject)z&&L.setFromMatrixPosition(C.matrixWorld).applyMatrix4(W),f.push(C,null,C.material,L.z,null);else if((C.isMesh||C.isLine||C.isPoints)&&(C.isSkinnedMesh&&C.skeleton.update(),!C.frustumCulled||Z.intersectsObject(C))){z&&L.setFromMatrixPosition(C.matrixWorld).applyMatrix4(W);var ce=Se.update(C),Te=C.material;if(Array.isArray(Te))for(var de=ce.groups,ue=0,Me=de.length;ue<Me;ue++){var Le=de[ue],De=Te[Le.materialIndex];De&&De.visible&&f.push(C,ce,De,L.z,Le)}else Te.visible&&f.push(C,ce,Te,L.z,null)}}for(var Fe=C.children,ue=0,Me=Fe.length;ue<Me;ue++)Qe(Fe[ue],R,z)}}function Ye(C,R,z,oe){for(var ce=0,Te=C.length;ce<Te;ce++){var de=C[ce],ue=de.object,Me=de.geometry,Le=oe===void 0?de.material:oe,De=de.group;if(z.isArrayCamera){b=z;for(var Fe=z.cameras,wt=0,ke=Fe.length;wt<ke;wt++){var je=Fe[wt];if(ue.layers.test(je.layers)){if("viewport"in je)Y.viewport(_.copy(je.viewport));else{var pt=je.bounds,Xe=pt.x*M,be=pt.y*E,Re=pt.z*M,et=pt.w*E;Y.viewport(_.set(Xe,be,Re,et).multiplyScalar(T))}vt(ue,R,je,Me,Le,De)}}}else b=null,vt(ue,R,z,Me,Le,De)}}function vt(C,R,z,oe,ce,Te){if(C.onBeforeRender(h,R,z,oe,ce,Te),l=ve.get(R,b||z),C.modelViewMatrix.multiplyMatrices(z.matrixWorldInverse,C.matrixWorld),C.normalMatrix.getNormalMatrix(C.modelViewMatrix),C.isImmediateRenderObject){Y.setMaterial(ce);var de=Rt(z,R.fog,ce,C);x.geometry=null,x.program=null,x.wireframe=!1,qe(C,de)}else h.renderBufferDirect(z,R.fog,oe,ce,C,Te);C.onAfterRender(h,R,z,oe,ce,Te),l=ve.get(R,b||z)}function Nt(C,R,z){var oe=j.get(C),ce=l.state.lights,Te=l.state.shadowsArray,de=oe.lightsHash,ue=ce.state.hash,Me=_e.getParameters(C,ce.state,Te,R,Q.numPlanes,Q.numIntersection,z),Le=_e.getProgramCode(C,Me),De=oe.program,Fe=!0;if(De===void 0)C.addEventListener("dispose",ie);else if(De.code!==Le)Ie(C);else if(de.stateID!==ue.stateID||de.directionalLength!==ue.directionalLength||de.pointLength!==ue.pointLength||de.spotLength!==ue.spotLength||de.rectAreaLength!==ue.rectAreaLength||de.hemiLength!==ue.hemiLength||de.shadowsLength!==ue.shadowsLength)de.stateID=ue.stateID,de.directionalLength=ue.directionalLength,de.pointLength=ue.pointLength,de.spotLength=ue.spotLength,de.rectAreaLength=ue.rectAreaLength,de.hemiLength=ue.hemiLength,de.shadowsLength=ue.shadowsLength,Fe=!1;else{if(Me.shaderID!==void 0)return;Fe=!1}if(Fe){if(Me.shaderID){var wt=ho[Me.shaderID];oe.shader={name:C.type,uniforms:Lr.clone(wt.uniforms),vertexShader:wt.vertexShader,fragmentShader:wt.fragmentShader}}else oe.shader={name:C.type,uniforms:C.uniforms,vertexShader:C.vertexShader,fragmentShader:C.fragmentShader};C.onBeforeCompile(oe.shader,h),Le=_e.getProgramCode(C,Me),De=_e.acquireProgram(C,oe.shader,Me,Le),oe.program=De,C.program=De}var ke=De.getAttributes();if(C.morphTargets){C.numSupportedMorphTargets=0;for(var je=0;je<h.maxMorphTargets;je++)ke["morphTarget"+je]>=0&&C.numSupportedMorphTargets++}if(C.morphNormals){C.numSupportedMorphNormals=0;for(var je=0;je<h.maxMorphNormals;je++)ke["morphNormal"+je]>=0&&C.numSupportedMorphNormals++}var pt=oe.shader.uniforms;(!C.isShaderMaterial&&!C.isRawShaderMaterial||C.clipping===!0)&&(oe.numClippingPlanes=Q.numPlanes,oe.numIntersection=Q.numIntersection,pt.clippingPlanes=Q.uniform),oe.fog=R,de===void 0&&(oe.lightsHash=de={}),de.stateID=ue.stateID,de.directionalLength=ue.directionalLength,de.pointLength=ue.pointLength,de.spotLength=ue.spotLength,de.rectAreaLength=ue.rectAreaLength,de.hemiLength=ue.hemiLength,de.shadowsLength=ue.shadowsLength,C.lights&&(pt.ambientLightColor.value=ce.state.ambient,pt.directionalLights.value=ce.state.directional,pt.spotLights.value=ce.state.spot,pt.rectAreaLights.value=ce.state.rectArea,pt.pointLights.value=ce.state.point,pt.hemisphereLights.value=ce.state.hemi,pt.directionalShadowMap.value=ce.state.directionalShadowMap,pt.directionalShadowMatrix.value=ce.state.directionalShadowMatrix,pt.spotShadowMap.value=ce.state.spotShadowMap,pt.spotShadowMatrix.value=ce.state.spotShadowMatrix,pt.pointShadowMap.value=ce.state.pointShadowMap,pt.pointShadowMatrix.value=ce.state.pointShadowMatrix);var Xe=oe.program.getUniforms(),be=ea.seqWithValue(Xe.seq,pt);oe.uniformsList=be}function Rt(C,R,z,oe){S=0;var ce=j.get(z),Te=l.state.lights,de=ce.lightsHash,ue=Te.state.hash;if(N&&(D||C!==y)){var Me=C===y&&z.id===g;Q.setState(z.clippingPlanes,z.clipIntersection,z.clipShadows,C,ce,Me)}z.needsUpdate===!1&&(ce.program===void 0||z.fog&&ce.fog!==R||z.lights&&(de.stateID!==ue.stateID||de.directionalLength!==ue.directionalLength||de.pointLength!==ue.pointLength||de.spotLength!==ue.spotLength||de.rectAreaLength!==ue.rectAreaLength||de.hemiLength!==ue.hemiLength||de.shadowsLength!==ue.shadowsLength)||ce.numClippingPlanes!==void 0&&(ce.numClippingPlanes!==Q.numPlanes||ce.numIntersection!==Q.numIntersection))&&(z.needsUpdate=!0),z.needsUpdate&&(Nt(z,R,oe),z.needsUpdate=!1);var Le=!1,De=!1,Fe=!1,wt=ce.program,ke=wt.getUniforms(),je=ce.shader.uniforms;if(Y.useProgram(wt.program)&&(Le=!0,De=!0,Fe=!0),z.id!==g&&(g=z.id,De=!0),Le||C!==y){if(ke.setValue(k,"projectionMatrix",C.projectionMatrix),te.logarithmicDepthBuffer&&ke.setValue(k,"logDepthBufFC",2/(Math.log(C.far+1)/Math.LN2)),y!==(b||C)&&(y=b||C,De=!0,Fe=!0),z.isShaderMaterial||z.isMeshPhongMaterial||z.isMeshStandardMaterial||z.envMap){var pt=ke.map.cameraPosition;pt!==void 0&&pt.setValue(k,L.setFromMatrixPosition(C.matrixWorld))}(z.isMeshPhongMaterial||z.isMeshLambertMaterial||z.isMeshBasicMaterial||z.isMeshStandardMaterial||z.isShaderMaterial||z.skinning)&&ke.setValue(k,"viewMatrix",C.matrixWorldInverse)}if(z.skinning){ke.setOptional(k,oe,"bindMatrix"),ke.setOptional(k,oe,"bindMatrixInverse");var Xe=oe.skeleton;if(Xe){var be=Xe.bones;if(te.floatVertexTextures){if(Xe.boneTexture===void 0){var Re=Math.sqrt(be.length*4);Re=Pt.ceilPowerOfTwo(Re),Re=Math.max(Re,4);var et=new Float32Array(Re*Re*4);et.set(Xe.boneMatrices);var mt=new Rn(et,Re,Re,zi,go);mt.needsUpdate=!0,Xe.boneMatrices=et,Xe.boneTexture=mt,Xe.boneTextureSize=Re}ke.setValue(k,"boneTexture",Xe.boneTexture),ke.setValue(k,"boneTextureSize",Xe.boneTextureSize)}else ke.setOptional(k,Xe,"boneMatrices")}}return De&&(ke.setValue(k,"toneMappingExposure",h.toneMappingExposure),ke.setValue(k,"toneMappingWhitePoint",h.toneMappingWhitePoint),z.lights&&V(je,Fe),R&&z.fog&&Ke(je,R),z.isMeshBasicMaterial?Gt(je,z):z.isMeshLambertMaterial?(Gt(je,z),Ft(je,z)):z.isMeshPhongMaterial?(Gt(je,z),z.isMeshToonMaterial?dr(je,z):Zt(je,z)):z.isMeshStandardMaterial?(Gt(je,z),z.isMeshPhysicalMaterial?P(je,z):Xt(je,z)):z.isMeshDepthMaterial?(Gt(je,z),F(je,z)):z.isMeshDistanceMaterial?(Gt(je,z),B(je,z)):z.isMeshNormalMaterial?(Gt(je,z),G(je,z)):z.isLineBasicMaterial?(Et(je,z),z.isLineDashedMaterial&&Mt(je,z)):z.isPointsMaterial?bt(je,z):z.isSpriteMaterial?rt(je,z):z.isShadowMaterial&&(je.color.value=z.color,je.opacity.value=z.opacity),je.ltc_1!==void 0&&(je.ltc_1.value=$e.LTC_1),je.ltc_2!==void 0&&(je.ltc_2.value=$e.LTC_2),ea.upload(k,ce.uniformsList,je,h)),z.isShaderMaterial&&z.uniformsNeedUpdate===!0&&(ea.upload(k,ce.uniformsList,je,h),z.uniformsNeedUpdate=!1),z.isSpriteMaterial&&ke.setValue(k,"center",oe.center),ke.setValue(k,"modelViewMatrix",oe.modelViewMatrix),ke.setValue(k,"normalMatrix",oe.normalMatrix),ke.setValue(k,"modelMatrix",oe.matrixWorld),wt}function Gt(C,R){C.opacity.value=R.opacity,R.color&&(C.diffuse.value=R.color),R.emissive&&C.emissive.value.copy(R.emissive).multiplyScalar(R.emissiveIntensity),R.map&&(C.map.value=R.map),R.alphaMap&&(C.alphaMap.value=R.alphaMap),R.specularMap&&(C.specularMap.value=R.specularMap),R.envMap&&(C.envMap.value=R.envMap,C.flipEnvMap.value=R.envMap&&R.envMap.isCubeTexture?-1:1,C.reflectivity.value=R.reflectivity,C.refractionRatio.value=R.refractionRatio,C.maxMipLevel.value=j.get(R.envMap).__maxMipLevel),R.lightMap&&(C.lightMap.value=R.lightMap,C.lightMapIntensity.value=R.lightMapIntensity),R.aoMap&&(C.aoMap.value=R.aoMap,C.aoMapIntensity.value=R.aoMapIntensity);var z;R.map?z=R.map:R.specularMap?z=R.specularMap:R.displacementMap?z=R.displacementMap:R.normalMap?z=R.normalMap:R.bumpMap?z=R.bumpMap:R.roughnessMap?z=R.roughnessMap:R.metalnessMap?z=R.metalnessMap:R.alphaMap?z=R.alphaMap:R.emissiveMap&&(z=R.emissiveMap),z!==void 0&&(z.isWebGLRenderTarget&&(z=z.texture),z.matrixAutoUpdate===!0&&z.updateMatrix(),C.uvTransform.value.copy(z.matrix))}function Et(C,R){C.diffuse.value=R.color,C.opacity.value=R.opacity}function Mt(C,R){C.dashSize.value=R.dashSize,C.totalSize.value=R.dashSize+R.gapSize,C.scale.value=R.scale}function bt(C,R){C.diffuse.value=R.color,C.opacity.value=R.opacity,C.size.value=R.size*T,C.scale.value=E*.5,C.map.value=R.map,R.map!==null&&(R.map.matrixAutoUpdate===!0&&R.map.updateMatrix(),C.uvTransform.value.copy(R.map.matrix))}function rt(C,R){C.diffuse.value=R.color,C.opacity.value=R.opacity,C.rotation.value=R.rotation,C.map.value=R.map,R.map!==null&&(R.map.matrixAutoUpdate===!0&&R.map.updateMatrix(),C.uvTransform.value.copy(R.map.matrix))}function Ke(C,R){C.fogColor.value=R.color,R.isFog?(C.fogNear.value=R.near,C.fogFar.value=R.far):R.isFogExp2&&(C.fogDensity.value=R.density)}function Ft(C,R){R.emissiveMap&&(C.emissiveMap.value=R.emissiveMap)}function Zt(C,R){C.specular.value=R.specular,C.shininess.value=Math.max(R.shininess,1e-4),R.emissiveMap&&(C.emissiveMap.value=R.emissiveMap),R.bumpMap&&(C.bumpMap.value=R.bumpMap,C.bumpScale.value=R.bumpScale,R.side===ni&&(C.bumpScale.value*=-1)),R.normalMap&&(C.normalMap.value=R.normalMap,C.normalScale.value.copy(R.normalScale),R.side===ni&&C.normalScale.value.negate()),R.displacementMap&&(C.displacementMap.value=R.displacementMap,C.displacementScale.value=R.displacementScale,C.displacementBias.value=R.displacementBias)}function dr(C,R){Zt(C,R),R.gradientMap&&(C.gradientMap.value=R.gradientMap)}function Xt(C,R){C.roughness.value=R.roughness,C.metalness.value=R.metalness,R.roughnessMap&&(C.roughnessMap.value=R.roughnessMap),R.metalnessMap&&(C.metalnessMap.value=R.metalnessMap),R.emissiveMap&&(C.emissiveMap.value=R.emissiveMap),R.bumpMap&&(C.bumpMap.value=R.bumpMap,C.bumpScale.value=R.bumpScale,R.side===ni&&(C.bumpScale.value*=-1)),R.normalMap&&(C.normalMap.value=R.normalMap,C.normalScale.value.copy(R.normalScale),R.side===ni&&C.normalScale.value.negate()),R.displacementMap&&(C.displacementMap.value=R.displacementMap,C.displacementScale.value=R.displacementScale,C.displacementBias.value=R.displacementBias),R.envMap&&(C.envMapIntensity.value=R.envMapIntensity)}function P(C,R){Xt(C,R),C.reflectivity.value=R.reflectivity,C.clearCoat.value=R.clearCoat,C.clearCoatRoughness.value=R.clearCoatRoughness}function F(C,R){R.displacementMap&&(C.displacementMap.value=R.displacementMap,C.displacementScale.value=R.displacementScale,C.displacementBias.value=R.displacementBias)}function B(C,R){R.displacementMap&&(C.displacementMap.value=R.displacementMap,C.displacementScale.value=R.displacementScale,C.displacementBias.value=R.displacementBias),C.referencePosition.value.copy(R.referencePosition),C.nearDistance.value=R.nearDistance,C.farDistance.value=R.farDistance}function G(C,R){R.bumpMap&&(C.bumpMap.value=R.bumpMap,C.bumpScale.value=R.bumpScale,R.side===ni&&(C.bumpScale.value*=-1)),R.normalMap&&(C.normalMap.value=R.normalMap,C.normalScale.value.copy(R.normalScale),R.side===ni&&C.normalScale.value.negate()),R.displacementMap&&(C.displacementMap.value=R.displacementMap,C.displacementScale.value=R.displacementScale,C.displacementBias.value=R.displacementBias)}function V(C,R){C.ambientLightColor.needsUpdate=R,C.directionalLights.needsUpdate=R,C.pointLights.needsUpdate=R,C.spotLights.needsUpdate=R,C.rectAreaLights.needsUpdate=R,C.hemisphereLights.needsUpdate=R}function $(){var C=S;return C>=te.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+C+" texture units while this GPU supports only "+te.maxTextures),S+=1,C}this.allocTextureUnit=$,this.setTexture2D=function(){var C=!1;return function(z,oe){z&&z.isWebGLRenderTarget&&(C||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),C=!0),z=z.texture),ae.setTexture2D(z,oe)}}(),this.setTexture=function(){var C=!1;return function(z,oe){C||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),C=!0),ae.setTexture2D(z,oe)}}(),this.setTextureCube=function(){var C=!1;return function(z,oe){z&&z.isWebGLRenderTargetCube&&(C||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),C=!0),z=z.texture),z&&z.isCubeTexture||Array.isArray(z.image)&&z.image.length===6?ae.setTextureCube(z,oe):ae.setTextureCubeDynamic(z,oe)}}(),this.setFramebuffer=function(C){p=C},this.getRenderTarget=function(){return v},this.setRenderTarget=function(C){v=C,C&&j.get(C).__webglFramebuffer===void 0&&ae.setupRenderTarget(C);var R=p,z=!1;if(C){var oe=j.get(C).__webglFramebuffer;C.isWebGLRenderTargetCube?(R=oe[C.activeCubeFace],z=!0):R=oe,_.copy(C.viewport),w.copy(C.scissor),A=C.scissorTest}else _.copy(H).multiplyScalar(T),w.copy(X).multiplyScalar(T),A=q;if(m!==R&&(k.bindFramebuffer(k.FRAMEBUFFER,R),m=R),Y.viewport(_),Y.scissor(w),Y.setScissorTest(A),z){var ce=j.get(C.texture);k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_CUBE_MAP_POSITIVE_X+C.activeCubeFace,ce.__webglTexture,C.activeMipMapLevel)}},this.readRenderTargetPixels=function(C,R,z,oe,ce,Te){if(!(C&&C.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}var de=j.get(C).__webglFramebuffer;if(de){var ue=!1;de!==m&&(k.bindFramebuffer(k.FRAMEBUFFER,de),ue=!0);try{var Me=C.texture,Le=Me.format,De=Me.type;if(Le!==zi&&pe.convert(Le)!==k.getParameter(k.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(De!==Fs&&pe.convert(De)!==k.getParameter(k.IMPLEMENTATION_COLOR_READ_TYPE)&&!(De===go&&(te.isWebGL2||K.get("OES_texture_float")||K.get("WEBGL_color_buffer_float")))&&!(De===Pd&&(te.isWebGL2?K.get("EXT_color_buffer_float"):K.get("EXT_color_buffer_half_float")))){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}k.checkFramebufferStatus(k.FRAMEBUFFER)===k.FRAMEBUFFER_COMPLETE?R>=0&&R<=C.width-oe&&z>=0&&z<=C.height-ce&&k.readPixels(R,z,oe,ce,pe.convert(Le),pe.convert(De),Te):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{ue&&k.bindFramebuffer(k.FRAMEBUFFER,m)}}},this.copyFramebufferToTexture=function(C,R,z){var oe=R.image.width,ce=R.image.height,Te=pe.convert(R.format);this.setTexture2D(R,0),k.copyTexImage2D(k.TEXTURE_2D,z||0,Te,C.x,C.y,oe,ce,0)},this.copyTextureToTexture=function(C,R,z,oe){var ce=R.image.width,Te=R.image.height,de=pe.convert(z.format),ue=pe.convert(z.type);this.setTexture2D(z,0),R.isDataTexture?k.texSubImage2D(k.TEXTURE_2D,oe||0,C.x,C.y,ce,Te,de,ue,R.image.data):k.texSubImage2D(k.TEXTURE_2D,oe||0,C.x,C.y,de,ue,R.image)}}function Hs(e,t){this.name="",this.color=new Oe(e),this.density=t!==void 0?t:25e-5}Hs.prototype.isFogExp2=!0;Hs.prototype.clone=function(){return new Hs(this.color,this.density)};Hs.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}};function xo(e,t,r){this.name="",this.color=new Oe(e),this.near=t!==void 0?t:1,this.far=r!==void 0?r:1e3}xo.prototype.isFog=!0;xo.prototype.clone=function(){return new xo(this.color,this.near,this.far)};xo.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}};function Vs(){Ge.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}Vs.prototype=Object.assign(Object.create(Ge.prototype),{constructor:Vs,copy:function(e,t){return Ge.prototype.copy.call(this,e,t),e.background!==null&&(this.background=e.background.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=Ge.prototype.toJSON.call(this,e);return this.background!==null&&(t.object.background=this.background.toJSON(e)),this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}});function _o(e,t){this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}Object.defineProperty(_o.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}});Object.assign(_o.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=e!==void 0?e.length/this.stride:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){var i=this;e*=this.stride,r*=t.stride;for(var n=0,a=this.stride;n<a;n++)i.array[e+n]=t.array[r+n];return this},set:function(e,t){return t===void 0&&(t=0),this.array.set(e,t),this},clone:function(){return new this.constructor().copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}});function Nc(e,t,r,i){this.data=e,this.itemSize=t,this.offset=r,this.normalized=i===!0}Object.defineProperties(Nc.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}});Object.assign(Nc.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function(e,t,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this},setXYZW:function(e,t,r,i,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=n,this}});function Ba(e){At.call(this),this.type="SpriteMaterial",this.color=new Oe(16777215),this.map=null,this.rotation=0,this.lights=!1,this.transparent=!0,this.setValues(e)}Ba.prototype=Object.create(At.prototype);Ba.prototype.constructor=Ba;Ba.prototype.isSpriteMaterial=!0;Ba.prototype.copy=function(e){return At.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this};var Qa;function zh(e){if(Ge.call(this),this.type="Sprite",Qa===void 0){Qa=new Ue;var t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new _o(t,5);Qa.setIndex([0,1,2,0,2,3]),Qa.addAttribute("position",new Nc(r,3,0,!1)),Qa.addAttribute("uv",new Nc(r,2,3,!1))}this.geometry=Qa,this.material=e!==void 0?e:new Ba,this.center=new Ee(.5,.5)}zh.prototype=Object.assign(Object.create(Ge.prototype),{constructor:zh,isSprite:!0,raycast:function(){var e=new I,t=new I,r=new I,i=new Ee,n=new Ee,a=new Ae,o=new I,s=new I,u=new I;function c(f,l,h,d,p,v){i.subVectors(f,h).addScalar(.5).multiply(d),p!==void 0?(n.x=v*i.x-p*i.y,n.y=p*i.x+v*i.y):n.copy(i),f.copy(l),f.x+=n.x,f.y+=n.y,f.applyMatrix4(a)}return function(l,h){t.setFromMatrixScale(this.matrixWorld),a.getInverse(this.modelViewMatrix).premultiply(this.matrixWorld),r.setFromMatrixPosition(this.modelViewMatrix);var d=this.material.rotation,p,v;d!==0&&(v=Math.cos(d),p=Math.sin(d));var m=this.center;c(o.set(-.5,-.5,0),r,m,t,p,v),c(s.set(.5,-.5,0),r,m,t,p,v),c(u.set(.5,.5,0),r,m,t,p,v);var g=l.ray.intersectTriangle(o,s,u,!1,e);if(!(g===null&&(c(s.set(-.5,.5,0),r,m,t,p,v),g=l.ray.intersectTriangle(o,u,s,!1,e),g===null))){var x=l.ray.origin.distanceTo(e);x<l.near||x>l.far||h.push({distance:x,point:e.clone(),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return Ge.prototype.copy.call(this,e),e.center!==void 0&&this.center.copy(e.center),this}});function kc(){Ge.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}kc.prototype=Object.assign(Object.create(Ge.prototype),{constructor:kc,copy:function(e){var t=this;Ge.prototype.copy.call(this,e,!1);for(var r=e.levels,i=0,n=r.length;i<n;i++){var a=r[i];t.addLevel(a.object.clone(),a.distance)}return this},addLevel:function(e,t){t===void 0&&(t=0),t=Math.abs(t);for(var r=this.levels,i=0;i<r.length&&!(t<r[i].distance);i++);r.splice(i,0,{distance:t,object:e}),this.add(e)},getObjectForDistance:function(e){for(var t=this.levels,r=1,i=t.length;r<i&&!(e<t[r].distance);r++);return t[r-1].object},raycast:function(){var e=new I;return function(r,i){e.setFromMatrixPosition(this.matrixWorld);var n=r.ray.origin.distanceTo(e);this.getObjectForDistance(n).raycast(r,i)}}(),update:function(){var e=new I,t=new I;return function(i){var n=this.levels;if(n.length>1){e.setFromMatrixPosition(i.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var a=e.distanceTo(t);n[0].object.visible=!0;for(var o=1,s=n.length;o<s&&a>=n[o].distance;o++)n[o-1].object.visible=!1,n[o].object.visible=!0;for(;o<s;o++)n[o].object.visible=!1}}}(),toJSON:function(e){var t=Ge.prototype.toJSON.call(this,e);t.object.levels=[];for(var r=this.levels,i=0,n=r.length;i<n;i++){var a=r[i];t.object.levels.push({object:a.object.uuid,distance:a.distance})}return t}});function zc(e,t){var r=this;if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(this.bones.length*16),t===void 0)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var i=0,n=this.bones.length;i<n;i++)r.boneInverses.push(new Ae)}}Object.assign(zc.prototype,{calculateInverses:function(){var e=this;this.boneInverses=[];for(var t=0,r=this.bones.length;t<r;t++){var i=new Ae;e.bones[t]&&i.getInverse(e.bones[t].matrixWorld),e.boneInverses.push(i)}},pose:function(){var e=this,t,r,i;for(r=0,i=this.bones.length;r<i;r++)t=e.bones[r],t&&t.matrixWorld.getInverse(e.boneInverses[r]);for(r=0,i=this.bones.length;r<i;r++)t=e.bones[r],t&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){var e=new Ae,t=new Ae;return function(){for(var i=this.bones,n=this.boneInverses,a=this.boneMatrices,o=this.boneTexture,s=0,u=i.length;s<u;s++){var c=i[s]?i[s].matrixWorld:t;e.multiplyMatrices(c,n[s]),e.toArray(a,s*16)}o!==void 0&&(o.needsUpdate=!0)}}(),clone:function(){return new zc(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=this,r=0,i=this.bones.length;r<i;r++){var n=t.bones[r];if(n.name===e)return n}}});function Uh(){Ge.call(this),this.type="Bone"}Uh.prototype=Object.assign(Object.create(Ge.prototype),{constructor:Uh,isBone:!0});function Gh(e,t){Jr.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Ae,this.bindMatrixInverse=new Ae;var r=this.initBones(),i=new zc(r);this.bind(i,this.matrixWorld),this.normalizeSkinWeights()}Gh.prototype=Object.assign(Object.create(Jr.prototype),{constructor:Gh,isSkinnedMesh:!0,initBones:function(){var e=this,t=[],r,i,n,a;if(this.geometry&&this.geometry.bones!==void 0){for(n=0,a=this.geometry.bones.length;n<a;n++)i=e.geometry.bones[n],r=new Uh,t.push(r),r.name=i.name,r.position.fromArray(i.pos),r.quaternion.fromArray(i.rotq),i.scl!==void 0&&r.scale.fromArray(i.scl);for(n=0,a=this.geometry.bones.length;n<a;n++)i=e.geometry.bones[n],i.parent!==-1&&i.parent!==null&&t[i.parent]!==void 0?t[i.parent].add(t[n]):e.add(t[n])}return this.updateMatrixWorld(!0),t},bind:function(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var e=this,t,r;if(this.geometry&&this.geometry.isGeometry)for(r=0;r<this.geometry.skinWeights.length;r++){var i=e.geometry.skinWeights[r];t=1/i.manhattanLength(),t!==1/0?i.multiplyScalar(t):i.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){var n=new $t,a=this.geometry.attributes.skinWeight;for(r=0;r<a.count;r++)n.x=a.getX(r),n.y=a.getY(r),n.z=a.getZ(r),n.w=a.getW(r),t=1/n.manhattanLength(),t!==1/0?n.multiplyScalar(t):n.set(1,0,0,0),a.setXYZW(r,n.x,n.y,n.z,n.w)}},updateMatrixWorld:function(e){Jr.prototype.updateMatrixWorld.call(this,e),this.bindMode==="attached"?this.bindMatrixInverse.getInverse(this.matrixWorld):this.bindMode==="detached"?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});function fr(e){At.call(this),this.type="LineBasicMaterial",this.color=new Oe(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)}fr.prototype=Object.create(At.prototype);fr.prototype.constructor=fr;fr.prototype.isLineBasicMaterial=!0;fr.prototype.copy=function(e){return At.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this};function li(e,t,r){r===1&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),Ge.call(this),this.type="Line",this.geometry=e!==void 0?e:new Ue,this.material=t!==void 0?t:new fr({color:Math.random()*16777215})}li.prototype=Object.assign(Object.create(Ge.prototype),{constructor:li,isLine:!0,computeLineDistances:function(){var e=new I,t=new I;return function(){var i=this.geometry;if(i.isBufferGeometry)if(i.index===null){for(var n=i.attributes.position,a=[0],o=1,s=n.count;o<s;o++)e.fromBufferAttribute(n,o-1),t.fromBufferAttribute(n,o),a[o]=a[o-1],a[o]+=e.distanceTo(t);i.addAttribute("lineDistance",new ze(a,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(i.isGeometry){var u=i.vertices,a=i.lineDistances;a[0]=0;for(var o=1,s=u.length;o<s;o++)a[o]=a[o-1],a[o]+=u[o-1].distanceTo(u[o])}return this}}(),raycast:function(){var e=new Ae,t=new zo,r=new sn;return function(n,a){var o=this,s=n.linePrecision,u=s*s,c=this.geometry,f=this.matrixWorld;if(c.boundingSphere===null&&c.computeBoundingSphere(),r.copy(c.boundingSphere),r.applyMatrix4(f),n.ray.intersectsSphere(r)!==!1){e.getInverse(f),t.copy(n.ray).applyMatrix4(e);var l=new I,h=new I,d=new I,p=new I,v=this&&this.isLineSegments?2:1;if(c.isBufferGeometry){var m=c.index,g=c.attributes,x=g.position.array;if(m!==null)for(var y=m.array,b=0,_=y.length-1;b<_;b+=v){var w=y[b],A=y[b+1];l.fromArray(x,w*3),h.fromArray(x,A*3);var S=t.distanceSqToSegment(l,h,p,d);if(!(S>u)){p.applyMatrix4(o.matrixWorld);var M=n.ray.origin.distanceTo(p);M<n.near||M>n.far||a.push({distance:M,point:d.clone().applyMatrix4(o.matrixWorld),index:b,face:null,faceIndex:null,object:o})}}else for(var b=0,_=x.length/3-1;b<_;b+=v){l.fromArray(x,3*b),h.fromArray(x,3*b+3);var S=t.distanceSqToSegment(l,h,p,d);if(!(S>u)){p.applyMatrix4(o.matrixWorld);var M=n.ray.origin.distanceTo(p);M<n.near||M>n.far||a.push({distance:M,point:d.clone().applyMatrix4(o.matrixWorld),index:b,face:null,faceIndex:null,object:o})}}}else if(c.isGeometry)for(var E=c.vertices,T=E.length,b=0;b<T-1;b+=v){var S=t.distanceSqToSegment(E[b],E[b+1],p,d);if(!(S>u)){p.applyMatrix4(o.matrixWorld);var M=n.ray.origin.distanceTo(p);M<n.near||M>n.far||a.push({distance:M,point:d.clone().applyMatrix4(o.matrixWorld),index:b,face:null,faceIndex:null,object:o})}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});function ar(e,t){li.call(this,e,t),this.type="LineSegments"}ar.prototype=Object.assign(Object.create(li.prototype),{constructor:ar,isLineSegments:!0,computeLineDistances:function(){var e=new I,t=new I;return function(){var i=this.geometry;if(i.isBufferGeometry)if(i.index===null){for(var n=i.attributes.position,a=[],o=0,s=n.count;o<s;o+=2)e.fromBufferAttribute(n,o),t.fromBufferAttribute(n,o+1),a[o]=o===0?0:a[o-1],a[o+1]=a[o]+e.distanceTo(t);i.addAttribute("lineDistance",new ze(a,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(i.isGeometry)for(var u=i.vertices,a=i.lineDistances,o=0,s=u.length;o<s;o+=2)e.copy(u[o]),t.copy(u[o+1]),a[o]=o===0?0:a[o-1],a[o+1]=a[o]+e.distanceTo(t);return this}}()});function Hh(e,t){li.call(this,e,t),this.type="LineLoop"}Hh.prototype=Object.assign(Object.create(li.prototype),{constructor:Hh,isLineLoop:!0});function Na(e){At.call(this),this.type="PointsMaterial",this.color=new Oe(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.lights=!1,this.setValues(e)}Na.prototype=Object.create(At.prototype);Na.prototype.constructor=Na;Na.prototype.isPointsMaterial=!0;Na.prototype.copy=function(e){return At.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};function Ws(e,t){Ge.call(this),this.type="Points",this.geometry=e!==void 0?e:new Ue,this.material=t!==void 0?t:new Na({color:Math.random()*16777215})}Ws.prototype=Object.assign(Object.create(Ge.prototype),{constructor:Ws,isPoints:!0,raycast:function(){var e=new Ae,t=new zo,r=new sn;return function(n,a){var o=this,s=this.geometry,u=this.matrixWorld,c=n.params.Points.threshold;if(s.boundingSphere===null&&s.computeBoundingSphere(),r.copy(s.boundingSphere),r.applyMatrix4(u),r.radius+=c,n.ray.intersectsSphere(r)===!1)return;e.getInverse(u),t.copy(n.ray).applyMatrix4(e);var f=c/((this.scale.x+this.scale.y+this.scale.z)/3),l=f*f,h=new I,d=new I;function p(S,M){var E=t.distanceSqToPoint(S);if(E<l){t.closestPointToPoint(S,d),d.applyMatrix4(u);var T=n.ray.origin.distanceTo(d);if(T<n.near||T>n.far)return;a.push({distance:T,distanceToRay:Math.sqrt(E),point:d.clone(),index:M,face:null,object:o})}}if(s.isBufferGeometry){var v=s.index,m=s.attributes,g=m.position.array;if(v!==null)for(var x=v.array,y=0,b=x.length;y<b;y++){var _=x[y];h.fromArray(g,_*3),p(h,_)}else for(var y=0,w=g.length/3;y<w;y++)h.fromArray(g,y*3),p(h,y)}else for(var A=s.vertices,y=0,w=A.length;y<w;y++)p(A[y],y)}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});function ev(e,t,r,i,n,a,o,s,u){hr.call(this,e,t,r,i,n,a,o,s,u),this.generateMipmaps=!1}ev.prototype=Object.assign(Object.create(hr.prototype),{constructor:ev,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}});function js(e,t,r,i,n,a,o,s,u,c,f,l){hr.call(this,null,a,o,s,u,c,i,n,f,l),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}js.prototype=Object.create(hr.prototype);js.prototype.constructor=js;js.prototype.isCompressedTexture=!0;function Xs(e,t,r,i,n,a,o,s,u){hr.call(this,e,t,r,i,n,a,o,s,u),this.needsUpdate=!0}Xs.prototype=Object.create(hr.prototype);Xs.prototype.constructor=Xs;Xs.prototype.isCanvasTexture=!0;function Uc(e,t,r,i,n,a,o,s,u,c){if(c=c!==void 0?c:lo,c!==lo&&c!==Ns)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&c===lo&&(r=Ic),r===void 0&&c===Ns&&(r=Rc),hr.call(this,null,i,n,a,o,s,c,r,u),this.image={width:e,height:t},this.magFilter=o!==void 0?o:vr,this.minFilter=s!==void 0?s:vr,this.flipY=!1,this.generateMipmaps=!1}Uc.prototype=Object.create(hr.prototype);Uc.prototype.constructor=Uc;Uc.prototype.isDepthTexture=!0;function Gc(e){Ue.call(this),this.type="WireframeGeometry";var t=[],r,i,n,a,o,s=[0,0],u={},c,f,l,h,d=["a","b","c"],p;if(e&&e.isGeometry){var v=e.faces;for(r=0,n=v.length;r<n;r++){var m=v[r];for(i=0;i<3;i++)f=m[d[i]],l=m[d[(i+1)%3]],s[0]=Math.min(f,l),s[1]=Math.max(f,l),h=s[0]+","+s[1],u[h]===void 0&&(u[h]={index1:s[0],index2:s[1]})}for(h in u)c=u[h],p=e.vertices[c.index1],t.push(p.x,p.y,p.z),p=e.vertices[c.index2],t.push(p.x,p.y,p.z)}else if(e&&e.isBufferGeometry){var g,x,y,b,_,w,A,S;if(p=new I,e.index!==null){for(g=e.attributes.position,x=e.index,y=e.groups,y.length===0&&(y=[{start:0,count:x.count,materialIndex:0}]),a=0,o=y.length;a<o;++a)for(b=y[a],_=b.start,w=b.count,r=_,n=_+w;r<n;r+=3)for(i=0;i<3;i++)f=x.getX(r+i),l=x.getX(r+(i+1)%3),s[0]=Math.min(f,l),s[1]=Math.max(f,l),h=s[0]+","+s[1],u[h]===void 0&&(u[h]={index1:s[0],index2:s[1]});for(h in u)c=u[h],p.fromBufferAttribute(g,c.index1),t.push(p.x,p.y,p.z),p.fromBufferAttribute(g,c.index2),t.push(p.x,p.y,p.z)}else for(g=e.attributes.position,r=0,n=g.count/3;r<n;r++)for(i=0;i<3;i++)A=3*r+i,p.fromBufferAttribute(g,A),t.push(p.x,p.y,p.z),S=3*r+(i+1)%3,p.fromBufferAttribute(g,S),t.push(p.x,p.y,p.z)}this.addAttribute("position",new ze(t,3))}Gc.prototype=Object.create(Ue.prototype);Gc.prototype.constructor=Gc;function Hc(e,t,r){st.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r},this.fromBufferGeometry(new qs(e,t,r)),this.mergeVertices()}Hc.prototype=Object.create(st.prototype);Hc.prototype.constructor=Hc;function qs(e,t,r){Ue.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:r};var i=[],n=[],a=[],o=[],s=1e-5,u=new I,c=new I,f=new I,l=new I,h=new I,d,p;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var v=t+1;for(d=0;d<=r;d++){var m=d/r;for(p=0;p<=t;p++){var g=p/t;e(g,m,c),n.push(c.x,c.y,c.z),g-s>=0?(e(g-s,m,f),l.subVectors(c,f)):(e(g+s,m,f),l.subVectors(f,c)),m-s>=0?(e(g,m-s,f),h.subVectors(c,f)):(e(g,m+s,f),h.subVectors(f,c)),u.crossVectors(l,h).normalize(),a.push(u.x,u.y,u.z),o.push(g,m)}}for(d=0;d<r;d++)for(p=0;p<t;p++){var x=d*v+p,y=d*v+p+1,b=(d+1)*v+p+1,_=(d+1)*v+p;i.push(x,y,_),i.push(y,b,_)}this.setIndex(i),this.addAttribute("position",new ze(n,3)),this.addAttribute("normal",new ze(a,3)),this.addAttribute("uv",new ze(o,2))}qs.prototype=Object.create(Ue.prototype);qs.prototype.constructor=qs;function Vc(e,t,r,i){st.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i},this.fromBufferGeometry(new hi(e,t,r,i)),this.mergeVertices()}Vc.prototype=Object.create(st.prototype);Vc.prototype.constructor=Vc;function hi(e,t,r,i){Ue.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i},r=r||1,i=i||0;var n=[],a=[];o(i),u(r),c(),this.addAttribute("position",new ze(n,3)),this.addAttribute("normal",new ze(n.slice(),3)),this.addAttribute("uv",new ze(a,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function o(g){for(var x=new I,y=new I,b=new I,_=0;_<t.length;_+=3)h(t[_+0],x),h(t[_+1],y),h(t[_+2],b),s(x,y,b,g)}function s(g,x,y,b){var _=Math.pow(2,b),w=[],A,S;for(A=0;A<=_;A++){w[A]=[];var M=g.clone().lerp(y,A/_),E=x.clone().lerp(y,A/_),T=_-A;for(S=0;S<=T;S++)S===0&&A===_?w[A][S]=M:w[A][S]=M.clone().lerp(E,S/T)}for(A=0;A<_;A++)for(S=0;S<2*(_-A)-1;S++){var H=Math.floor(S/2);S%2===0?(l(w[A][H+1]),l(w[A+1][H]),l(w[A][H])):(l(w[A][H+1]),l(w[A+1][H+1]),l(w[A+1][H]))}}function u(g){for(var x=new I,y=0;y<n.length;y+=3)x.x=n[y+0],x.y=n[y+1],x.z=n[y+2],x.normalize().multiplyScalar(g),n[y+0]=x.x,n[y+1]=x.y,n[y+2]=x.z}function c(){for(var g=new I,x=0;x<n.length;x+=3){g.x=n[x+0],g.y=n[x+1],g.z=n[x+2];var y=v(g)/2/Math.PI+.5,b=m(g)/Math.PI+.5;a.push(y,1-b)}d(),f()}function f(){for(var g=0;g<a.length;g+=6){var x=a[g+0],y=a[g+2],b=a[g+4],_=Math.max(x,y,b),w=Math.min(x,y,b);_>.9&&w<.1&&(x<.2&&(a[g+0]+=1),y<.2&&(a[g+2]+=1),b<.2&&(a[g+4]+=1))}}function l(g){n.push(g.x,g.y,g.z)}function h(g,x){var y=g*3;x.x=e[y+0],x.y=e[y+1],x.z=e[y+2]}function d(){for(var g=new I,x=new I,y=new I,b=new I,_=new Ee,w=new Ee,A=new Ee,S=0,M=0;S<n.length;S+=9,M+=6){g.set(n[S+0],n[S+1],n[S+2]),x.set(n[S+3],n[S+4],n[S+5]),y.set(n[S+6],n[S+7],n[S+8]),_.set(a[M+0],a[M+1]),w.set(a[M+2],a[M+3]),A.set(a[M+4],a[M+5]),b.copy(g).add(x).add(y).divideScalar(3);var E=v(b);p(_,M+0,g,E),p(w,M+2,x,E),p(A,M+4,y,E)}}function p(g,x,y,b){b<0&&g.x===1&&(a[x]=g.x-1),y.x===0&&y.z===0&&(a[x]=b/2/Math.PI+.5)}function v(g){return Math.atan2(g.z,-g.x)}function m(g){return Math.atan2(-g.y,Math.sqrt(g.x*g.x+g.z*g.z))}}hi.prototype=Object.create(Ue.prototype);hi.prototype.constructor=hi;function Wc(e,t){st.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new wo(e,t)),this.mergeVertices()}Wc.prototype=Object.create(st.prototype);Wc.prototype.constructor=Wc;function wo(e,t){var r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];hi.call(this,r,i,e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}wo.prototype=Object.create(hi.prototype);wo.prototype.constructor=wo;function jc(e,t){st.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new ka(e,t)),this.mergeVertices()}jc.prototype=Object.create(st.prototype);jc.prototype.constructor=jc;function ka(e,t){var r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];hi.call(this,r,i,e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}ka.prototype=Object.create(hi.prototype);ka.prototype.constructor=ka;function Xc(e,t){st.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new za(e,t)),this.mergeVertices()}Xc.prototype=Object.create(st.prototype);Xc.prototype.constructor=Xc;function za(e,t){var r=(1+Math.sqrt(5))/2,i=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];hi.call(this,i,n,e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}za.prototype=Object.create(hi.prototype);za.prototype.constructor=za;function qc(e,t){st.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Ys(e,t)),this.mergeVertices()}qc.prototype=Object.create(st.prototype);qc.prototype.constructor=qc;function Ys(e,t){var r=(1+Math.sqrt(5))/2,i=1/r,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];hi.call(this,n,a,e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}Ys.prototype=Object.create(hi.prototype);Ys.prototype.constructor=Ys;function Yc(e,t,r,i,n,a){st.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:i,closed:n},a!==void 0&&console.warn("THREE.TubeGeometry: taper has been removed.");var o=new Zs(e,t,r,i,n);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals,this.fromBufferGeometry(o),this.mergeVertices()}Yc.prototype=Object.create(st.prototype);Yc.prototype.constructor=Yc;function Zs(e,t,r,i,n){Ue.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:i,closed:n},t=t||64,r=r||1,i=i||8,n=n||!1;var a=e.computeFrenetFrames(t,n);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;var o=new I,s=new I,u=new Ee,c=new I,f,l,h=[],d=[],p=[],v=[];m(),this.setIndex(v),this.addAttribute("position",new ze(h,3)),this.addAttribute("normal",new ze(d,3)),this.addAttribute("uv",new ze(p,2));function m(){for(f=0;f<t;f++)g(f);g(n===!1?t:0),y(),x()}function g(b){c=e.getPointAt(b/t,c);var _=a.normals[b],w=a.binormals[b];for(l=0;l<=i;l++){var A=l/i*Math.PI*2,S=Math.sin(A),M=-Math.cos(A);s.x=M*_.x+S*w.x,s.y=M*_.y+S*w.y,s.z=M*_.z+S*w.z,s.normalize(),d.push(s.x,s.y,s.z),o.x=c.x+r*s.x,o.y=c.y+r*s.y,o.z=c.z+r*s.z,h.push(o.x,o.y,o.z)}}function x(){for(l=1;l<=t;l++)for(f=1;f<=i;f++){var b=(i+1)*(l-1)+(f-1),_=(i+1)*l+(f-1),w=(i+1)*l+f,A=(i+1)*(l-1)+f;v.push(b,_,A),v.push(_,w,A)}}function y(){for(f=0;f<=t;f++)for(l=0;l<=i;l++)u.x=f/t,u.y=l/i,p.push(u.x,u.y)}}Zs.prototype=Object.create(Ue.prototype);Zs.prototype.constructor=Zs;function Zc(e,t,r,i,n,a,o){st.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:i,p:n,q:a},o!==void 0&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Ks(e,t,r,i,n,a)),this.mergeVertices()}Zc.prototype=Object.create(st.prototype);Zc.prototype.constructor=Zc;function Ks(e,t,r,i,n,a){Ue.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:i,p:n,q:a},e=e||1,t=t||.4,r=Math.floor(r)||64,i=Math.floor(i)||8,n=n||2,a=a||3;var o=[],s=[],u=[],c=[],f,l,h=new I,d=new I,p=new I,v=new I,m=new I,g=new I,x=new I;for(f=0;f<=r;++f){var y=f/r*n*Math.PI*2;for(T(y,n,a,e,p),T(y+.01,n,a,e,v),g.subVectors(v,p),x.addVectors(v,p),m.crossVectors(g,x),x.crossVectors(m,g),m.normalize(),x.normalize(),l=0;l<=i;++l){var b=l/i*Math.PI*2,_=-t*Math.cos(b),w=t*Math.sin(b);h.x=p.x+(_*x.x+w*m.x),h.y=p.y+(_*x.y+w*m.y),h.z=p.z+(_*x.z+w*m.z),s.push(h.x,h.y,h.z),d.subVectors(h,p).normalize(),u.push(d.x,d.y,d.z),c.push(f/r),c.push(l/i)}}for(l=1;l<=r;l++)for(f=1;f<=i;f++){var A=(i+1)*(l-1)+(f-1),S=(i+1)*l+(f-1),M=(i+1)*l+f,E=(i+1)*(l-1)+f;o.push(A,S,E),o.push(S,M,E)}this.setIndex(o),this.addAttribute("position",new ze(s,3)),this.addAttribute("normal",new ze(u,3)),this.addAttribute("uv",new ze(c,2));function T(H,X,q,Z,Q){var N=Math.cos(H),D=Math.sin(H),W=q/X*H,L=Math.cos(W);Q.x=Z*(2+L)*.5*N,Q.y=Z*(2+L)*D*.5,Q.z=Z*Math.sin(W)*.5}}Ks.prototype=Object.create(Ue.prototype);Ks.prototype.constructor=Ks;function Kc(e,t,r,i,n){st.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:n},this.fromBufferGeometry(new Ao(e,t,r,i,n)),this.mergeVertices()}Kc.prototype=Object.create(st.prototype);Kc.prototype.constructor=Kc;function Ao(e,t,r,i,n){Ue.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:n},e=e||1,t=t||.4,r=Math.floor(r)||8,i=Math.floor(i)||6,n=n||Math.PI*2;var a=[],o=[],s=[],u=[],c=new I,f=new I,l=new I,h,d;for(h=0;h<=r;h++)for(d=0;d<=i;d++){var p=d/i*n,v=h/r*Math.PI*2;f.x=(e+t*Math.cos(v))*Math.cos(p),f.y=(e+t*Math.cos(v))*Math.sin(p),f.z=t*Math.sin(v),o.push(f.x,f.y,f.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),l.subVectors(f,c).normalize(),s.push(l.x,l.y,l.z),u.push(d/i),u.push(h/r)}for(h=1;h<=r;h++)for(d=1;d<=i;d++){var m=(i+1)*h+d-1,g=(i+1)*(h-1)+d-1,x=(i+1)*(h-1)+d,y=(i+1)*h+d;a.push(m,g,y),a.push(g,x,y)}this.setIndex(a),this.addAttribute("position",new ze(o,3)),this.addAttribute("normal",new ze(s,3)),this.addAttribute("uv",new ze(u,2))}Ao.prototype=Object.create(Ue.prototype);Ao.prototype.constructor=Ao;var e2={triangulate:function(e,t,r){r=r||2;var i=t&&t.length,n=i?t[0]*r:e.length,a=Gg(e,0,n,r,!0),o=[];if(!a)return o;var s,u,c,f,l,h,d;if(i&&(a=a2(e,t,a,r)),e.length>80*r){s=c=e[0],u=f=e[1];for(var p=r;p<n;p+=r)l=e[p],h=e[p+1],l<s&&(s=l),h<u&&(u=h),l>c&&(c=l),h>f&&(f=h);d=Math.max(c-s,f-u),d=d!==0?1/d:0}return Qs(a,o,r,s,u,d),o}};function Gg(e,t,r,i,n){var a,o;if(n===v2(e,t,r,i)>0)for(a=t;a<r;a+=i)o=tv(a,e[a],e[a+1],o);else for(a=r-i;a>=t;a-=i)o=tv(a,e[a],e[a+1],o);return o&&Pa(o,o.next)&&(eu(o),o=o.next),o}function Js(e,t){if(!e)return e;t||(t=e);var r=e,i;do if(i=!1,!r.steiner&&(Pa(r,r.next)||Yr(r.prev,r,r.next)===0)){if(eu(r),r=t=r.prev,r===r.next)break;i=!0}else r=r.next;while(i||r!==t);return t}function Qs(e,t,r,i,n,a,o){if(e){!o&&a&&c2(e,i,n,a);for(var s=e,u,c;e.prev!==e.next;){if(u=e.prev,c=e.next,a?r2(e,i,n,a):t2(e)){t.push(u.i/r),t.push(e.i/r),t.push(c.i/r),eu(e),e=c.next,s=c.next;continue}if(e=c,e===s){o?o===1?(e=i2(e,t,r),Qs(e,t,r,i,n,a,2)):o===2&&n2(e,t,r,i,n,a):Qs(Js(e),t,r,i,n,a,1);break}}}}function t2(e){var t=e.prev,r=e,i=e.next;if(Yr(t,r,i)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(Jc(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&Yr(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function r2(e,t,r,i){var n=e.prev,a=e,o=e.next;if(Yr(n,a,o)>=0)return!1;for(var s=n.x<a.x?n.x<o.x?n.x:o.x:a.x<o.x?a.x:o.x,u=n.y<a.y?n.y<o.y?n.y:o.y:a.y<o.y?a.y:o.y,c=n.x>a.x?n.x>o.x?n.x:o.x:a.x>o.x?a.x:o.x,f=n.y>a.y?n.y>o.y?n.y:o.y:a.y>o.y?a.y:o.y,l=Vh(s,u,t,r,i),h=Vh(c,f,t,r,i),d=e.nextZ;d&&d.z<=h;){if(d!==e.prev&&d!==e.next&&Jc(n.x,n.y,a.x,a.y,o.x,o.y,d.x,d.y)&&Yr(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(d=e.prevZ;d&&d.z>=l;){if(d!==e.prev&&d!==e.next&&Jc(n.x,n.y,a.x,a.y,o.x,o.y,d.x,d.y)&&Yr(d.prev,d,d.next)>=0)return!1;d=d.prevZ}return!0}function i2(e,t,r){var i=e;do{var n=i.prev,a=i.next.next;!Pa(n,a)&&Hg(n,i,i.next,a)&&$s(n,a)&&$s(a,n)&&(t.push(n.i/r),t.push(i.i/r),t.push(a.i/r),eu(i),eu(i.next),i=e=a),i=i.next}while(i!==e);return i}function n2(e,t,r,i,n,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&h2(o,s)){var u=Vg(o,s);o=Js(o,o.next),u=Js(u,u.next),Qs(o,t,r,i,n,a),Qs(u,t,r,i,n,a);return}s=s.next}o=o.next}while(o!==e)}function a2(e,t,r,i){var n=[],a,o,s,u,c;for(a=0,o=t.length;a<o;a++)s=t[a]*i,u=a<o-1?t[a+1]*i:e.length,c=Gg(e,s,u,i,!1),c===c.next&&(c.steiner=!0),n.push(l2(c));for(n.sort(o2),a=0;a<n.length;a++)s2(n[a],r),r=Js(r,r.next);return r}function o2(e,t){return e.x-t.x}function s2(e,t){if(t=u2(e,t),t){var r=Vg(t,e);Js(r,r.next)}}function u2(e,t){var r=t,i=e.x,n=e.y,a=-1/0,o;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var s=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(n===r.y)return r;if(n===r.next.y)return r.next}o=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!o)return null;if(i===a)return o.prev;var u=o,c=o.x,f=o.y,l=1/0,h;for(r=o.next;r!==u;)i>=r.x&&r.x>=c&&i!==r.x&&Jc(n<f?i:a,n,c,f,n<f?a:i,n,r.x,r.y)&&(h=Math.abs(n-r.y)/(i-r.x),(h<l||h===l&&r.x>o.x)&&$s(r,e)&&(o=r,l=h)),r=r.next;return o}function c2(e,t,r,i){var n=e;do n.z===null&&(n.z=Vh(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,f2(n)}function f2(e){var t,r,i,n,a,o,s,u,c=1;do{for(r=e,e=null,a=null,o=0;r;){for(o++,i=r,s=0,t=0;t<c&&(s++,i=i.nextZ,!!i);t++);for(u=c;s>0||u>0&&i;)s!==0&&(u===0||!i||r.z<=i.z)?(n=r,r=r.nextZ,s--):(n=i,i=i.nextZ,u--),a?a.nextZ=n:e=n,n.prevZ=a,a=n;r=i}a.nextZ=null,c*=2}while(o>1);return e}function Vh(e,t,r,i,n){return e=32767*(e-r)*n,t=32767*(t-i)*n,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function l2(e){var t=e,r=e;do t.x<r.x&&(r=t),t=t.next;while(t!==e);return r}function Jc(e,t,r,i,n,a,o,s){return(n-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(i-s)-(r-o)*(t-s)>=0&&(r-o)*(a-s)-(n-o)*(i-s)>=0}function h2(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!d2(e,t)&&$s(e,t)&&$s(t,e)&&p2(e,t)}function Yr(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Pa(e,t){return e.x===t.x&&e.y===t.y}function Hg(e,t,r,i){return Pa(e,t)&&Pa(r,i)||Pa(e,i)&&Pa(r,t)?!0:Yr(e,t,r)>0!=Yr(e,t,i)>0&&Yr(r,i,e)>0!=Yr(r,i,t)>0}function d2(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&Hg(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function $s(e,t){return Yr(e.prev,e,e.next)<0?Yr(e,t,e.next)>=0&&Yr(e,e.prev,t)>=0:Yr(e,t,e.prev)<0||Yr(e,e.next,t)<0}function p2(e,t){var r=e,i=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;do r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next;while(r!==e);return i}function Vg(e,t){var r=new Wh(e.i,e.x,e.y),i=new Wh(t.i,t.x,t.y),n=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,a.next=i,i.prev=a,i}function tv(e,t,r,i){var n=new Wh(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function eu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Wh(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function v2(e,t,r,i){for(var n=0,a=t,o=r-i;a<r;a+=i)n+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return n}var ta={area:function(e){for(var t=e.length,r=0,i=t-1,n=0;n<t;i=n++)r+=e[i].x*e[n].y-e[n].x*e[i].y;return r*.5},isClockWise:function(e){return ta.area(e)<0},triangulateShape:function(e,t){var r=[],i=[],n=[];rv(e),iv(r,e);var a=e.length;t.forEach(rv);for(var o=0;o<t.length;o++)i.push(a),a+=t[o].length,iv(r,t[o]);for(var s=e2.triangulate(r,i),o=0;o<s.length;o+=3)n.push(s.slice(o,o+3));return n}};function rv(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function iv(e,t){for(var r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}function So(e,t){st.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new On(e,t)),this.mergeVertices()}So.prototype=Object.create(st.prototype);So.prototype.constructor=So;So.prototype.toJSON=function(){var e=st.prototype.toJSON.call(this),t=this.parameters.shapes,r=this.parameters.options;return Wg(t,r,e)};function On(e,t){Ue.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var r=this,i=[],n=[],a=0,o=e.length;a<o;a++){var s=e[a];u(s)}this.addAttribute("position",new ze(i,3)),this.addAttribute("uv",new ze(n,2)),this.computeVertexNormals();function u(c){var f=[],l=t.curveSegments!==void 0?t.curveSegments:12,h=t.steps!==void 0?t.steps:1,d=t.depth!==void 0?t.depth:100,p=t.bevelEnabled!==void 0?t.bevelEnabled:!0,v=t.bevelThickness!==void 0?t.bevelThickness:6,m=t.bevelSize!==void 0?t.bevelSize:v-2,g=t.bevelSegments!==void 0?t.bevelSegments:3,x=t.extrudePath,y=t.UVGenerator!==void 0?t.UVGenerator:m2;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),d=t.amount);var b,_=!1,w,A,S,M;x&&(b=x.getSpacedPoints(h),_=!0,p=!1,w=x.computeFrenetFrames(h,!1),A=new I,S=new I,M=new I),p||(g=0,v=0,m=0);var E,T,H,X=c.extractPoints(l),q=X.shape,Z=X.holes,Q=!ta.isClockWise(q);if(Q)for(q=q.reverse(),T=0,H=Z.length;T<H;T++)E=Z[T],ta.isClockWise(E)&&(Z[T]=E.reverse());var N=ta.triangulateShape(q,Z),D=q;for(T=0,H=Z.length;T<H;T++)E=Z[T],q=q.concat(E);function W(ie,we,Ie){return we||console.error("THREE.ExtrudeGeometry: vec does not exist"),we.clone().multiplyScalar(Ie).add(ie)}var L,U,k,ee,K,te=q.length,Y,J=N.length;function j(ie,we,Ie){var qe,Ce,Ne,Ze=ie.x-we.x,Ve=ie.y-we.y,Qe=Ie.x-ie.x,Ye=Ie.y-ie.y,vt=Ze*Ze+Ve*Ve,Nt=Ze*Ye-Ve*Qe;if(Math.abs(Nt)>Number.EPSILON){var Rt=Math.sqrt(vt),Gt=Math.sqrt(Qe*Qe+Ye*Ye),Et=we.x-Ve/Rt,Mt=we.y+Ze/Rt,bt=Ie.x-Ye/Gt,rt=Ie.y+Qe/Gt,Ke=((bt-Et)*Ye-(rt-Mt)*Qe)/(Ze*Ye-Ve*Qe);qe=Et+Ze*Ke-ie.x,Ce=Mt+Ve*Ke-ie.y;var Ft=qe*qe+Ce*Ce;if(Ft<=2)return new Ee(qe,Ce);Ne=Math.sqrt(Ft/2)}else{var Zt=!1;Ze>Number.EPSILON?Qe>Number.EPSILON&&(Zt=!0):Ze<-Number.EPSILON?Qe<-Number.EPSILON&&(Zt=!0):Math.sign(Ve)===Math.sign(Ye)&&(Zt=!0),Zt?(qe=-Ve,Ce=Ze,Ne=Math.sqrt(vt)):(qe=Ze,Ce=Ve,Ne=Math.sqrt(vt/2))}return new Ee(qe/Ne,Ce/Ne)}for(var ae=[],re=0,le=D.length,Se=le-1,_e=re+1;re<le;re++,Se++,_e++)Se===le&&(Se=0),_e===le&&(_e=0),ae[re]=j(D[re],D[Se],D[_e]);var ne=[],ve,se=ae.concat();for(T=0,H=Z.length;T<H;T++){for(E=Z[T],ve=[],re=0,le=E.length,Se=le-1,_e=re+1;re<le;re++,Se++,_e++)Se===le&&(Se=0),_e===le&&(_e=0),ve[re]=j(E[re],E[Se],E[_e]);ne.push(ve),se=se.concat(ve)}for(L=0;L<g;L++){for(k=L/g,ee=v*Math.cos(k*Math.PI/2),U=m*Math.sin(k*Math.PI/2),re=0,le=D.length;re<le;re++)K=W(D[re],ae[re],U),Pe(K.x,K.y,-ee);for(T=0,H=Z.length;T<H;T++)for(E=Z[T],ve=ne[T],re=0,le=E.length;re<le;re++)K=W(E[re],ve[re],U),Pe(K.x,K.y,-ee)}for(U=m,re=0;re<te;re++)K=p?W(q[re],se[re],U):q[re],_?(S.copy(w.normals[0]).multiplyScalar(K.x),A.copy(w.binormals[0]).multiplyScalar(K.y),M.copy(b[0]).add(S).add(A),Pe(M.x,M.y,M.z)):Pe(K.x,K.y,0);var xe;for(xe=1;xe<=h;xe++)for(re=0;re<te;re++)K=p?W(q[re],se[re],U):q[re],_?(S.copy(w.normals[xe]).multiplyScalar(K.x),A.copy(w.binormals[xe]).multiplyScalar(K.y),M.copy(b[xe]).add(S).add(A),Pe(M.x,M.y,M.z)):Pe(K.x,K.y,d/h*xe);for(L=g-1;L>=0;L--){for(k=L/g,ee=v*Math.cos(k*Math.PI/2),U=m*Math.sin(k*Math.PI/2),re=0,le=D.length;re<le;re++)K=W(D[re],ae[re],U),Pe(K.x,K.y,d+ee);for(T=0,H=Z.length;T<H;T++)for(E=Z[T],ve=ne[T],re=0,le=E.length;re<le;re++)K=W(E[re],ve[re],U),_?Pe(K.x,K.y+b[h-1].y,b[h-1].x+ee):Pe(K.x,K.y,d+ee)}he(),ye();function he(){var ie=i.length/3;if(p){var we=0,Ie=te*we;for(re=0;re<J;re++)Y=N[re],He(Y[2]+Ie,Y[1]+Ie,Y[0]+Ie);for(we=h+g*2,Ie=te*we,re=0;re<J;re++)Y=N[re],He(Y[0]+Ie,Y[1]+Ie,Y[2]+Ie)}else{for(re=0;re<J;re++)Y=N[re],He(Y[2],Y[1],Y[0]);for(re=0;re<J;re++)Y=N[re],He(Y[0]+te*h,Y[1]+te*h,Y[2]+te*h)}r.addGroup(ie,i.length/3-ie,0)}function ye(){var ie=i.length/3,we=0;for(pe(D,we),we+=D.length,T=0,H=Z.length;T<H;T++)E=Z[T],pe(E,we),we+=E.length;r.addGroup(ie,i.length/3-ie,1)}function pe(ie,we){var Ie,qe;for(re=ie.length;--re>=0;){Ie=re,qe=re-1,qe<0&&(qe=ie.length-1);var Ce=0,Ne=h+g*2;for(Ce=0;Ce<Ne;Ce++){var Ze=te*Ce,Ve=te*(Ce+1),Qe=we+Ie+Ze,Ye=we+qe+Ze,vt=we+qe+Ve,Nt=we+Ie+Ve;Je(Qe,Ye,vt,Nt)}}}function Pe(ie,we,Ie){f.push(ie),f.push(we),f.push(Ie)}function He(ie,we,Ie){We(ie),We(we),We(Ie);var qe=i.length/3,Ce=y.generateTopUV(r,i,qe-3,qe-2,qe-1);Be(Ce[0]),Be(Ce[1]),Be(Ce[2])}function Je(ie,we,Ie,qe){We(ie),We(we),We(qe),We(we),We(Ie),We(qe);var Ce=i.length/3,Ne=y.generateSideWallUV(r,i,Ce-6,Ce-3,Ce-2,Ce-1);Be(Ne[0]),Be(Ne[1]),Be(Ne[3]),Be(Ne[1]),Be(Ne[2]),Be(Ne[3])}function We(ie){i.push(f[ie*3+0]),i.push(f[ie*3+1]),i.push(f[ie*3+2])}function Be(ie){n.push(ie.x),n.push(ie.y)}}}On.prototype=Object.create(Ue.prototype);On.prototype.constructor=On;On.prototype.toJSON=function(){var e=Ue.prototype.toJSON.call(this),t=this.parameters.shapes,r=this.parameters.options;return Wg(t,r,e)};var m2={generateTopUV:function(e,t,r,i,n){var a=t[r*3],o=t[r*3+1],s=t[i*3],u=t[i*3+1],c=t[n*3],f=t[n*3+1];return[new Ee(a,o),new Ee(s,u),new Ee(c,f)]},generateSideWallUV:function(e,t,r,i,n,a){var o=t[r*3],s=t[r*3+1],u=t[r*3+2],c=t[i*3],f=t[i*3+1],l=t[i*3+2],h=t[n*3],d=t[n*3+1],p=t[n*3+2],v=t[a*3],m=t[a*3+1],g=t[a*3+2];return Math.abs(s-f)<.01?[new Ee(o,1-u),new Ee(c,1-l),new Ee(h,1-p),new Ee(v,1-g)]:[new Ee(s,1-u),new Ee(f,1-l),new Ee(d,1-p),new Ee(m,1-g)]}};function Wg(e,t,r){if(r.shapes=[],Array.isArray(e))for(var i=0,n=e.length;i<n;i++){var a=e[i];r.shapes.push(a.uuid)}else r.shapes.push(e.uuid);return t.extrudePath!==void 0&&(r.options.extrudePath=t.extrudePath.toJSON()),r}function Qc(e,t){st.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new tu(e,t)),this.mergeVertices()}Qc.prototype=Object.create(st.prototype);Qc.prototype.constructor=Qc;function tu(e,t){t=t||{};var r=t.font;if(!(r&&r.isFont))return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new st;var i=r.generateShapes(e,t.size);t.depth=t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),On.call(this,i,t),this.type="TextBufferGeometry"}tu.prototype=Object.create(On.prototype);tu.prototype.constructor=tu;function $c(e,t,r,i,n,a,o){st.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:n,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new Mo(e,t,r,i,n,a,o)),this.mergeVertices()}$c.prototype=Object.create(st.prototype);$c.prototype.constructor=$c;function Mo(e,t,r,i,n,a,o){Ue.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:n,thetaStart:a,thetaLength:o},e=e||1,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),i=i!==void 0?i:0,n=n!==void 0?n:Math.PI*2,a=a!==void 0?a:0,o=o!==void 0?o:Math.PI;var s=a+o,u,c,f=0,l=[],h=new I,d=new I,p=[],v=[],m=[],g=[];for(c=0;c<=r;c++){var x=[],y=c/r;for(u=0;u<=t;u++){var b=u/t;h.x=-e*Math.cos(i+b*n)*Math.sin(a+y*o),h.y=e*Math.cos(a+y*o),h.z=e*Math.sin(i+b*n)*Math.sin(a+y*o),v.push(h.x,h.y,h.z),d.set(h.x,h.y,h.z).normalize(),m.push(d.x,d.y,d.z),g.push(b,1-y),x.push(f++)}l.push(x)}for(c=0;c<r;c++)for(u=0;u<t;u++){var _=l[c][u+1],w=l[c][u],A=l[c+1][u],S=l[c+1][u+1];(c!==0||a>0)&&p.push(_,w,S),(c!==r-1||s<Math.PI)&&p.push(w,A,S)}this.setIndex(p),this.addAttribute("position",new ze(v,3)),this.addAttribute("normal",new ze(m,3)),this.addAttribute("uv",new ze(g,2))}Mo.prototype=Object.create(Ue.prototype);Mo.prototype.constructor=Mo;function ef(e,t,r,i,n,a){st.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:n,thetaLength:a},this.fromBufferGeometry(new ru(e,t,r,i,n,a)),this.mergeVertices()}ef.prototype=Object.create(st.prototype);ef.prototype.constructor=ef;function ru(e,t,r,i,n,a){Ue.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:n,thetaLength:a},e=e||.5,t=t||1,n=n!==void 0?n:0,a=a!==void 0?a:Math.PI*2,r=r!==void 0?Math.max(3,r):8,i=i!==void 0?Math.max(1,i):1;var o=[],s=[],u=[],c=[],f,l=e,h=(t-e)/i,d=new I,p=new Ee,v,m;for(v=0;v<=i;v++){for(m=0;m<=r;m++)f=n+m/r*a,d.x=l*Math.cos(f),d.y=l*Math.sin(f),s.push(d.x,d.y,d.z),u.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,c.push(p.x,p.y);l+=h}for(v=0;v<i;v++){var g=v*(r+1);for(m=0;m<r;m++){f=m+g;var x=f,y=f+r+1,b=f+r+2,_=f+1;o.push(x,y,_),o.push(y,b,_)}}this.setIndex(o),this.addAttribute("position",new ze(s,3)),this.addAttribute("normal",new ze(u,3)),this.addAttribute("uv",new ze(c,2))}ru.prototype=Object.create(Ue.prototype);ru.prototype.constructor=ru;function tf(e,t,r,i){st.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:i},this.fromBufferGeometry(new iu(e,t,r,i)),this.mergeVertices()}tf.prototype=Object.create(st.prototype);tf.prototype.constructor=tf;function iu(e,t,r,i){Ue.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:i},t=Math.floor(t)||12,r=r||0,i=i||Math.PI*2,i=Pt.clamp(i,0,Math.PI*2);var n=[],a=[],o=[],s,u=1/t,c=new I,f=new Ee,l,h;for(l=0;l<=t;l++){var d=r+l*u*i,p=Math.sin(d),v=Math.cos(d);for(h=0;h<=e.length-1;h++)c.x=e[h].x*p,c.y=e[h].y,c.z=e[h].x*v,a.push(c.x,c.y,c.z),f.x=l/t,f.y=h/(e.length-1),o.push(f.x,f.y)}for(l=0;l<t;l++)for(h=0;h<e.length-1;h++){s=h+l*e.length;var m=s,g=s+e.length,x=s+e.length+1,y=s+1;n.push(m,g,y),n.push(g,x,y)}if(this.setIndex(n),this.addAttribute("position",new ze(a,3)),this.addAttribute("uv",new ze(o,2)),this.computeVertexNormals(),i===Math.PI*2){var b=this.attributes.normal.array,_=new I,w=new I,A=new I;for(s=t*e.length*3,l=0,h=0;l<e.length;l++,h+=3)_.x=b[h+0],_.y=b[h+1],_.z=b[h+2],w.x=b[s+h+0],w.y=b[s+h+1],w.z=b[s+h+2],A.addVectors(_,w).normalize(),b[h+0]=b[s+h+0]=A.x,b[h+1]=b[s+h+1]=A.y,b[h+2]=b[s+h+2]=A.z}}iu.prototype=Object.create(Ue.prototype);iu.prototype.constructor=iu;function Co(e,t){st.call(this),this.type="ShapeGeometry",typeof t=="object"&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new Po(e,t)),this.mergeVertices()}Co.prototype=Object.create(st.prototype);Co.prototype.constructor=Co;Co.prototype.toJSON=function(){var e=st.prototype.toJSON.call(this),t=this.parameters.shapes;return jg(t,e)};function Po(e,t){var r=this;Ue.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var i=[],n=[],a=[],o=[],s=0,u=0;if(Array.isArray(e)===!1)f(e);else for(var c=0;c<e.length;c++)f(e[c]),r.addGroup(s,u,c),s+=u,u=0;this.setIndex(i),this.addAttribute("position",new ze(n,3)),this.addAttribute("normal",new ze(a,3)),this.addAttribute("uv",new ze(o,2));function f(l){var h,d,p,v=n.length/3,m=l.extractPoints(t),g=m.shape,x=m.holes;if(ta.isClockWise(g)===!1)for(g=g.reverse(),h=0,d=x.length;h<d;h++)p=x[h],ta.isClockWise(p)===!0&&(x[h]=p.reverse());var y=ta.triangulateShape(g,x);for(h=0,d=x.length;h<d;h++)p=x[h],g=g.concat(p);for(h=0,d=g.length;h<d;h++){var b=g[h];n.push(b.x,b.y,0),a.push(0,0,1),o.push(b.x,b.y)}for(h=0,d=y.length;h<d;h++){var _=y[h],w=_[0]+v,A=_[1]+v,S=_[2]+v;i.push(w,A,S),u+=3}}}Po.prototype=Object.create(Ue.prototype);Po.prototype.constructor=Po;Po.prototype.toJSON=function(){var e=Ue.prototype.toJSON.call(this),t=this.parameters.shapes;return jg(t,e)};function jg(e,t){if(t.shapes=[],Array.isArray(e))for(var r=0,i=e.length;r<i;r++){var n=e[r];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}function rf(e,t){Ue.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=t!==void 0?t:1;var r=[],i=Math.cos(Pt.DEG2RAD*t),n=[0,0],a={},o,s,u,c=["a","b","c"],f;e.isBufferGeometry?(f=new st,f.fromBufferGeometry(e)):f=e.clone(),f.mergeVertices(),f.computeFaceNormals();for(var l=f.vertices,h=f.faces,d=0,p=h.length;d<p;d++)for(var v=h[d],m=0;m<3;m++)o=v[c[m]],s=v[c[(m+1)%3]],n[0]=Math.min(o,s),n[1]=Math.max(o,s),u=n[0]+","+n[1],a[u]===void 0?a[u]={index1:n[0],index2:n[1],face1:d,face2:void 0}:a[u].face2=d;for(u in a){var g=a[u];if(g.face2===void 0||h[g.face1].normal.dot(h[g.face2].normal)<=i){var x=l[g.index1];r.push(x.x,x.y,x.z),x=l[g.index2],r.push(x.x,x.y,x.z)}}this.addAttribute("position",new ze(r,3))}rf.prototype=Object.create(Ue.prototype);rf.prototype.constructor=rf;function To(e,t,r,i,n,a,o,s){st.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:n,openEnded:a,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new Dn(e,t,r,i,n,a,o,s)),this.mergeVertices()}To.prototype=Object.create(st.prototype);To.prototype.constructor=To;function Dn(e,t,r,i,n,a,o,s){Ue.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:n,openEnded:a,thetaStart:o,thetaLength:s};var u=this;e=e!==void 0?e:1,t=t!==void 0?t:1,r=r||1,i=Math.floor(i)||8,n=Math.floor(n)||1,a=a!==void 0?a:!1,o=o!==void 0?o:0,s=s!==void 0?s:Math.PI*2;var c=[],f=[],l=[],h=[],d=0,p=[],v=r/2,m=0;g(),a===!1&&(e>0&&x(!0),t>0&&x(!1)),this.setIndex(c),this.addAttribute("position",new ze(f,3)),this.addAttribute("normal",new ze(l,3)),this.addAttribute("uv",new ze(h,2));function g(){var y,b,_=new I,w=new I,A=0,S=(t-e)/r;for(b=0;b<=n;b++){var M=[],E=b/n,T=E*(t-e)+e;for(y=0;y<=i;y++){var H=y/i,X=H*s+o,q=Math.sin(X),Z=Math.cos(X);w.x=T*q,w.y=-E*r+v,w.z=T*Z,f.push(w.x,w.y,w.z),_.set(q,S,Z).normalize(),l.push(_.x,_.y,_.z),h.push(H,1-E),M.push(d++)}p.push(M)}for(y=0;y<i;y++)for(b=0;b<n;b++){var Q=p[b][y],N=p[b+1][y],D=p[b+1][y+1],W=p[b][y+1];c.push(Q,N,W),c.push(N,D,W),A+=6}u.addGroup(m,A,0),m+=A}function x(y){var b,_,w,A=new Ee,S=new I,M=0,E=y===!0?e:t,T=y===!0?1:-1;for(_=d,b=1;b<=i;b++)f.push(0,v*T,0),l.push(0,T,0),h.push(.5,.5),d++;for(w=d,b=0;b<=i;b++){var H=b/i,X=H*s+o,q=Math.cos(X),Z=Math.sin(X);S.x=E*Z,S.y=v*T,S.z=E*q,f.push(S.x,S.y,S.z),l.push(0,T,0),A.x=q*.5+.5,A.y=Z*.5*T+.5,h.push(A.x,A.y),d++}for(b=0;b<i;b++){var Q=_+b,N=w+b;y===!0?c.push(N,N+1,Q):c.push(N+1,N,Q),M+=3}u.addGroup(m,M,y===!0?1:2),m+=M}}Dn.prototype=Object.create(Ue.prototype);Dn.prototype.constructor=Dn;function nf(e,t,r,i,n,a,o){To.call(this,0,e,t,r,i,n,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:n,thetaStart:a,thetaLength:o}}nf.prototype=Object.create(To.prototype);nf.prototype.constructor=nf;function nu(e,t,r,i,n,a,o){Dn.call(this,0,e,t,r,i,n,a,o),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:n,thetaStart:a,thetaLength:o}}nu.prototype=Object.create(Dn.prototype);nu.prototype.constructor=nu;function af(e,t,r,i){st.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},this.fromBufferGeometry(new au(e,t,r,i)),this.mergeVertices()}af.prototype=Object.create(st.prototype);af.prototype.constructor=af;function au(e,t,r,i){Ue.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},e=e||1,t=t!==void 0?Math.max(3,t):8,r=r!==void 0?r:0,i=i!==void 0?i:Math.PI*2;var n=[],a=[],o=[],s=[],u,c,f=new I,l=new Ee;for(a.push(0,0,0),o.push(0,0,1),s.push(.5,.5),c=0,u=3;c<=t;c++,u+=3){var h=r+c/t*i;f.x=e*Math.cos(h),f.y=e*Math.sin(h),a.push(f.x,f.y,f.z),o.push(0,0,1),l.x=(a[u]/e+1)/2,l.y=(a[u+1]/e+1)/2,s.push(l.x,l.y)}for(u=1;u<=t;u++)n.push(u,u+1,0);this.setIndex(n),this.addAttribute("position",new ze(a,3)),this.addAttribute("normal",new ze(o,3)),this.addAttribute("uv",new ze(s,2))}au.prototype=Object.create(Ue.prototype);au.prototype.constructor=au;var ri=Object.freeze({WireframeGeometry:Gc,ParametricGeometry:Hc,ParametricBufferGeometry:qs,TetrahedronGeometry:Wc,TetrahedronBufferGeometry:wo,OctahedronGeometry:jc,OctahedronBufferGeometry:ka,IcosahedronGeometry:Xc,IcosahedronBufferGeometry:za,DodecahedronGeometry:qc,DodecahedronBufferGeometry:Ys,PolyhedronGeometry:Vc,PolyhedronBufferGeometry:hi,TubeGeometry:Yc,TubeBufferGeometry:Zs,TorusKnotGeometry:Zc,TorusKnotBufferGeometry:Ks,TorusGeometry:Kc,TorusBufferGeometry:Ao,TextGeometry:Qc,TextBufferGeometry:tu,SphereGeometry:$c,SphereBufferGeometry:Mo,RingGeometry:ef,RingBufferGeometry:ru,PlaneGeometry:Gs,PlaneBufferGeometry:bo,LatheGeometry:tf,LatheBufferGeometry:iu,ShapeGeometry:Co,ShapeBufferGeometry:Po,ExtrudeGeometry:So,ExtrudeBufferGeometry:On,EdgesGeometry:rf,ConeGeometry:nf,ConeBufferGeometry:nu,CylinderGeometry:To,CylinderBufferGeometry:Dn,CircleGeometry:af,CircleBufferGeometry:au,BoxGeometry:Fc,BoxBufferGeometry:Oa});function Eo(e){At.call(this),this.type="ShadowMaterial",this.color=new Oe(0),this.transparent=!0,this.setValues(e)}Eo.prototype=Object.create(At.prototype);Eo.prototype.constructor=Eo;Eo.prototype.isShadowMaterial=!0;Eo.prototype.copy=function(e){return At.prototype.copy.call(this,e),this.color.copy(e.color),this};function ou(e){Gr.call(this,e),this.type="RawShaderMaterial"}ou.prototype=Object.create(Gr.prototype);ou.prototype.constructor=ou;ou.prototype.isRawShaderMaterial=!0;function Fn(e){At.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Oe(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Oe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Td,this.normalScale=new Ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}Fn.prototype=Object.create(At.prototype);Fn.prototype.constructor=Fn;Fn.prototype.isMeshStandardMaterial=!0;Fn.prototype.copy=function(e){return At.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function Io(e){Fn.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(e)}Io.prototype=Object.create(Fn.prototype);Io.prototype.constructor=Io;Io.prototype.isMeshPhysicalMaterial=!0;Io.prototype.copy=function(e){return Fn.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this};function un(e){At.call(this),this.type="MeshPhongMaterial",this.color=new Oe(16777215),this.specular=new Oe(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Oe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Td,this.normalScale=new Ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Df,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}un.prototype=Object.create(At.prototype);un.prototype.constructor=un;un.prototype.isMeshPhongMaterial=!0;un.prototype.copy=function(e){return At.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function Ro(e){un.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}Ro.prototype=Object.create(un.prototype);Ro.prototype.constructor=Ro;Ro.prototype.isMeshToonMaterial=!0;Ro.prototype.copy=function(e){return un.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this};function Lo(e){At.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Td,this.normalScale=new Ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}Lo.prototype=Object.create(At.prototype);Lo.prototype.constructor=Lo;Lo.prototype.isMeshNormalMaterial=!0;Lo.prototype.copy=function(e){return At.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function Oo(e){At.call(this),this.type="MeshLambertMaterial",this.color=new Oe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Oe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Df,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}Oo.prototype=Object.create(At.prototype);Oo.prototype.constructor=Oo;Oo.prototype.isMeshLambertMaterial=!0;Oo.prototype.copy=function(e){return At.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function Do(e){fr.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}Do.prototype=Object.create(fr.prototype);Do.prototype.constructor=Do;Do.prototype.isLineDashedMaterial=!0;Do.prototype.copy=function(e){return fr.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var g2=Object.freeze({ShadowMaterial:Eo,SpriteMaterial:Ba,RawShaderMaterial:ou,ShaderMaterial:Gr,PointsMaterial:Na,MeshPhysicalMaterial:Io,MeshStandardMaterial:Fn,MeshPhongMaterial:un,MeshToonMaterial:Ro,MeshNormalMaterial:Lo,MeshLambertMaterial:Oo,MeshDepthMaterial:Da,MeshDistanceMaterial:Fa,MeshBasicMaterial:Ai,LineDashedMaterial:Do,LineBasicMaterial:fr,Material:At}),of={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function Xg(e,t,r){var i=this,n=!1,a=0,o=0,s=void 0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(u){o++,n===!1&&i.onStart!==void 0&&i.onStart(u,a,o),n=!0},this.itemEnd=function(u){a++,i.onProgress!==void 0&&i.onProgress(u,a,o),a===o&&(n=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(u){i.onError!==void 0&&i.onError(u)},this.resolveURL=function(u){return s?s(u):u},this.setURLModifier=function(u){return s=u,this}}var Ci=new Xg,_n={};function zn(e){this.manager=e!==void 0?e:Ci}Object.assign(zn.prototype,{load:function(e,t,r,i){var n=this;e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);var a=this,o=of.get(e);if(o!==void 0)return a.manager.itemStart(e),setTimeout(function(){t&&t(o),a.manager.itemEnd(e)},0),o;if(_n[e]!==void 0){_n[e].push({onLoad:t,onProgress:r,onError:i});return}var s=/^data:(.*?)(;base64)?,(.*)$/,u=e.match(s);if(u){var c=u[1],f=!!u[2],l=u[3];l=window.decodeURIComponent(l),f&&(l=window.atob(l));try{var h,d=(this.responseType||"").toLowerCase();switch(d){case"arraybuffer":case"blob":for(var p=new Uint8Array(l.length),v=0;v<l.length;v++)p[v]=l.charCodeAt(v);d==="blob"?h=new Blob([p.buffer],{type:c}):h=p.buffer;break;case"document":var m=new DOMParser;h=m.parseFromString(l,c);break;case"json":h=JSON.parse(l);break;default:h=l;break}window.setTimeout(function(){t&&t(h),a.manager.itemEnd(e)},0)}catch(y){window.setTimeout(function(){i&&i(y),a.manager.itemEnd(e),a.manager.itemError(e)},0)}}else{_n[e]=[],_n[e].push({onLoad:t,onProgress:r,onError:i});var g=new XMLHttpRequest;g.open("GET",e,!0),g.addEventListener("load",function(y){var b=this.response;of.add(e,b);var _=_n[e];if(delete _n[e],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var w=0,A=_.length;w<A;w++){var S=_[w];S.onLoad&&S.onLoad(b)}a.manager.itemEnd(e)}else{for(var w=0,A=_.length;w<A;w++){var S=_[w];S.onError&&S.onError(y)}a.manager.itemEnd(e),a.manager.itemError(e)}},!1),g.addEventListener("progress",function(y){for(var b=_n[e],_=0,w=b.length;_<w;_++){var A=b[_];A.onProgress&&A.onProgress(y)}},!1),g.addEventListener("error",function(y){var b=_n[e];delete _n[e];for(var _=0,w=b.length;_<w;_++){var A=b[_];A.onError&&A.onError(y)}a.manager.itemEnd(e),a.manager.itemError(e)},!1),this.responseType!==void 0&&(g.responseType=this.responseType),this.withCredentials!==void 0&&(g.withCredentials=this.withCredentials),g.overrideMimeType&&g.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(var x in n.requestHeader)g.setRequestHeader(x,n.requestHeader[x]);g.send(null)}return a.manager.itemStart(e),g},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}});function y2(e){this.manager=e!==void 0?e:Ci,this._parser=null}Object.assign(y2.prototype,{load:function(e,t,r,i){var n=this,a=[],o=new js;o.image=a;var s=new zn(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer");function u(h){s.load(e[h],function(d){var p=n._parser(d,!0);a[h]={width:p.width,height:p.height,format:p.format,mipmaps:p.mipmaps},c+=1,c===6&&(p.mipmapCount===1&&(o.minFilter=Dr),o.format=p.format,o.needsUpdate=!0,t&&t(o))},r,i)}if(Array.isArray(e))for(var c=0,f=0,l=e.length;f<l;++f)u(f);else s.load(e,function(h){var d=n._parser(h,!0);if(d.isCubemap)for(var p=d.mipmaps.length/d.mipmapCount,v=0;v<p;v++){a[v]={mipmaps:[]};for(var m=0;m<d.mipmapCount;m++)a[v].mipmaps.push(d.mipmaps[v*d.mipmapCount+m]),a[v].format=d.format,a[v].width=d.width,a[v].height=d.height}else o.image.width=d.width,o.image.height=d.height,o.mipmaps=d.mipmaps;d.mipmapCount===1&&(o.minFilter=Dr),o.format=d.format,o.needsUpdate=!0,t&&t(o)},r,i);return o},setPath:function(e){return this.path=e,this}});function b2(e){this.manager=e!==void 0?e:Ci,this._parser=null}Object.assign(b2.prototype,{load:function(e,t,r,i){var n=this,a=new Rn,o=new zn(this.manager);return o.setResponseType("arraybuffer"),o.load(e,function(s){var u=n._parser(s);u&&(u.image!==void 0?a.image=u.image:u.data!==void 0&&(a.image.width=u.width,a.image.height=u.height,a.image.data=u.data),a.wrapS=u.wrapS!==void 0?u.wrapS:bi,a.wrapT=u.wrapT!==void 0?u.wrapT:bi,a.magFilter=u.magFilter!==void 0?u.magFilter:Dr,a.minFilter=u.minFilter!==void 0?u.minFilter:Ff,a.anisotropy=u.anisotropy!==void 0?u.anisotropy:1,u.format!==void 0&&(a.format=u.format),u.type!==void 0&&(a.type=u.type),u.mipmaps!==void 0&&(a.mipmaps=u.mipmaps),u.mipmapCount===1&&(a.minFilter=Dr),a.needsUpdate=!0,t&&t(a,u))},r,i),a}});function Bf(e){this.manager=e!==void 0?e:Ci}Object.assign(Bf.prototype,{crossOrigin:"anonymous",load:function(e,t,r,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);var n=this,a=of.get(e);if(a!==void 0)return n.manager.itemStart(e),setTimeout(function(){t&&t(a),n.manager.itemEnd(e)},0),a;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){o.removeEventListener("load",s,!1),o.removeEventListener("error",u,!1),of.add(e,this),t&&t(this),n.manager.itemEnd(e)}function u(c){o.removeEventListener("load",s,!1),o.removeEventListener("error",u,!1),i&&i(c),n.manager.itemEnd(e),n.manager.itemError(e)}return o.addEventListener("load",s,!1),o.addEventListener("error",u,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),n.manager.itemStart(e),o.src=e,o},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}});function qg(e){this.manager=e!==void 0?e:Ci}Object.assign(qg.prototype,{crossOrigin:"anonymous",load:function(e,t,r,i){var n=new na,a=new Bf(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function s(c){a.load(e[c],function(f){n.images[c]=f,o++,o===6&&(n.needsUpdate=!0,t&&t(n))},void 0,i)}for(var u=0;u<e.length;++u)s(u);return n},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}});function Ld(e){this.manager=e!==void 0?e:Ci}Object.assign(Ld.prototype,{crossOrigin:"anonymous",load:function(e,t,r,i){var n=new hr,a=new Bf(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(o){n.image=o;var s=e.search(/\.(jpg|jpeg)$/)>0||e.search(/^data\:image\/jpeg/)===0;n.format=s?Bs:zi,n.needsUpdate=!0,t!==void 0&&t(n)},r,i),n},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}});function at(){this.type="Curve",this.arcLengthDivisions=200}Object.assign(at.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var r=this.getUtoTmapping(e);return this.getPoint(r,t)},getPoints:function(e){var t=this;e===void 0&&(e=5);for(var r=[],i=0;i<=e;i++)r.push(t.getPoint(i/e));return r},getSpacedPoints:function(e){var t=this;e===void 0&&(e=5);for(var r=[],i=0;i<=e;i++)r.push(t.getPointAt(i/e));return r},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){var t=this;if(e===void 0&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var r=[],i,n=this.getPoint(0),a,o=0;for(r.push(0),a=1;a<=e;a++)i=t.getPoint(a/e),o+=i.distanceTo(n),r.push(o),n=i;return this.cacheArcLengths=r,r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var r=this.getLengths(),i=0,n=r.length,a;t?a=t:a=e*r[n-1];for(var o=0,s=n-1,u;o<=s;)if(i=Math.floor(o+(s-o)/2),u=r[i]-a,u<0)o=i+1;else if(u>0)s=i-1;else{s=i;break}if(i=s,r[i]===a)return i/(n-1);var c=r[i],f=r[i+1],l=f-c,h=(a-c)/l,d=(i+h)/(n-1);return d},getTangent:function(e){var t=1e-4,r=e-t,i=e+t;r<0&&(r=0),i>1&&(i=1);var n=this.getPoint(r),a=this.getPoint(i),o=a.clone().sub(n);return o.normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var r=this,i=new I,n=[],a=[],o=[],s=new I,u=new Ae,c,f,l;for(c=0;c<=e;c++)f=c/e,n[c]=r.getTangentAt(f),n[c].normalize();a[0]=new I,o[0]=new I;var h=Number.MAX_VALUE,d=Math.abs(n[0].x),p=Math.abs(n[0].y),v=Math.abs(n[0].z);for(d<=h&&(h=d,i.set(1,0,0)),p<=h&&(h=p,i.set(0,1,0)),v<=h&&i.set(0,0,1),s.crossVectors(n[0],i).normalize(),a[0].crossVectors(n[0],s),o[0].crossVectors(n[0],a[0]),c=1;c<=e;c++)a[c]=a[c-1].clone(),o[c]=o[c-1].clone(),s.crossVectors(n[c-1],n[c]),s.length()>Number.EPSILON&&(s.normalize(),l=Math.acos(Pt.clamp(n[c-1].dot(n[c]),-1,1)),a[c].applyMatrix4(u.makeRotationAxis(s,l))),o[c].crossVectors(n[c],a[c]);if(t===!0)for(l=Math.acos(Pt.clamp(a[0].dot(a[e]),-1,1)),l/=e,n[0].dot(s.crossVectors(a[0],a[e]))>0&&(l=-l),c=1;c<=e;c++)a[c].applyMatrix4(u.makeRotationAxis(n[c],l*c)),o[c].crossVectors(n[c],a[c]);return{tangents:n,normals:a,binormals:o}},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}});function Si(e,t,r,i,n,a,o,s){at.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=r||1,this.yRadius=i||1,this.aStartAngle=n||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=o||!1,this.aRotation=s||0}Si.prototype=Object.create(at.prototype);Si.prototype.constructor=Si;Si.prototype.isEllipseCurve=!0;Si.prototype.getPoint=function(e,t){for(var r=t||new Ee,i=Math.PI*2,n=this.aEndAngle-this.aStartAngle,a=Math.abs(n)<Number.EPSILON;n<0;)n+=i;for(;n>i;)n-=i;n<Number.EPSILON&&(a?n=0:n=i),this.aClockwise===!0&&!a&&(n===i?n=-i:n=n-i);var o=this.aStartAngle+e*n,s=this.aX+this.xRadius*Math.cos(o),u=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){var c=Math.cos(this.aRotation),f=Math.sin(this.aRotation),l=s-this.aX,h=u-this.aY;s=l*c-h*f+this.aX,u=l*f+h*c+this.aY}return r.set(s,u)};Si.prototype.copy=function(e){return at.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this};Si.prototype.toJSON=function(){var e=at.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e};Si.prototype.fromJSON=function(e){return at.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this};function su(e,t,r,i,n,a){Si.call(this,e,t,r,r,i,n,a),this.type="ArcCurve"}su.prototype=Object.create(Si.prototype);su.prototype.constructor=su;su.prototype.isArcCurve=!0;function Od(){var e=0,t=0,r=0,i=0;function n(a,o,s,u){e=a,t=s,r=-3*a+3*o-2*s-u,i=2*a-2*o+s+u}return{initCatmullRom:function(a,o,s,u,c){n(o,s,c*(s-a),c*(u-o))},initNonuniformCatmullRom:function(a,o,s,u,c,f,l){var h=(o-a)/c-(s-a)/(c+f)+(s-o)/f,d=(s-o)/f-(u-o)/(f+l)+(u-s)/l;h*=f,d*=f,n(o,s,h,d)},calc:function(a){var o=a*a,s=o*a;return e+t*a+r*o+i*s}}}var Ku=new I,Cl=new Od,Pl=new Od,Tl=new Od;function Gi(e,t,r,i){at.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=r||"centripetal",this.tension=i||.5}Gi.prototype=Object.create(at.prototype);Gi.prototype.constructor=Gi;Gi.prototype.isCatmullRomCurve3=!0;Gi.prototype.getPoint=function(e,t){var r=t||new I,i=this.points,n=i.length,a=(n-(this.closed?0:1))*e,o=Math.floor(a),s=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/n)+1)*n:s===0&&o===n-1&&(o=n-2,s=1);var u,c,f,l;if(this.closed||o>0?u=i[(o-1)%n]:(Ku.subVectors(i[0],i[1]).add(i[0]),u=Ku),c=i[o%n],f=i[(o+1)%n],this.closed||o+2<n?l=i[(o+2)%n]:(Ku.subVectors(i[n-1],i[n-2]).add(i[n-1]),l=Ku),this.curveType==="centripetal"||this.curveType==="chordal"){var h=this.curveType==="chordal"?.5:.25,d=Math.pow(u.distanceToSquared(c),h),p=Math.pow(c.distanceToSquared(f),h),v=Math.pow(f.distanceToSquared(l),h);p<1e-4&&(p=1),d<1e-4&&(d=p),v<1e-4&&(v=p),Cl.initNonuniformCatmullRom(u.x,c.x,f.x,l.x,d,p,v),Pl.initNonuniformCatmullRom(u.y,c.y,f.y,l.y,d,p,v),Tl.initNonuniformCatmullRom(u.z,c.z,f.z,l.z,d,p,v)}else this.curveType==="catmullrom"&&(Cl.initCatmullRom(u.x,c.x,f.x,l.x,this.tension),Pl.initCatmullRom(u.y,c.y,f.y,l.y,this.tension),Tl.initCatmullRom(u.z,c.z,f.z,l.z,this.tension));return r.set(Cl.calc(s),Pl.calc(s),Tl.calc(s)),r};Gi.prototype.copy=function(e){var t=this;at.prototype.copy.call(this,e),this.points=[];for(var r=0,i=e.points.length;r<i;r++){var n=e.points[r];t.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this};Gi.prototype.toJSON=function(){var e=this,t=at.prototype.toJSON.call(this);t.points=[];for(var r=0,i=this.points.length;r<i;r++){var n=e.points[r];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t};Gi.prototype.fromJSON=function(e){var t=this;at.prototype.fromJSON.call(this,e),this.points=[];for(var r=0,i=e.points.length;r<i;r++){var n=e.points[r];t.points.push(new I().fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this};function nv(e,t,r,i,n){var a=(i-t)*.5,o=(n-r)*.5,s=e*e,u=e*s;return(2*r-2*i+a+o)*u+(-3*r+3*i-2*a-o)*s+a*e+r}function x2(e,t){var r=1-e;return r*r*t}function _2(e,t){return 2*(1-e)*e*t}function w2(e,t){return e*e*t}function Es(e,t,r,i){return x2(e,t)+_2(e,r)+w2(e,i)}function A2(e,t){var r=1-e;return r*r*r*t}function S2(e,t){var r=1-e;return 3*r*r*e*t}function M2(e,t){return 3*(1-e)*e*e*t}function C2(e,t){return e*e*e*t}function Is(e,t,r,i,n){return A2(e,t)+S2(e,r)+M2(e,i)+C2(e,n)}function cn(e,t,r,i){at.call(this),this.type="CubicBezierCurve",this.v0=e||new Ee,this.v1=t||new Ee,this.v2=r||new Ee,this.v3=i||new Ee}cn.prototype=Object.create(at.prototype);cn.prototype.constructor=cn;cn.prototype.isCubicBezierCurve=!0;cn.prototype.getPoint=function(e,t){var r=t||new Ee,i=this.v0,n=this.v1,a=this.v2,o=this.v3;return r.set(Is(e,i.x,n.x,a.x,o.x),Is(e,i.y,n.y,a.y,o.y)),r};cn.prototype.copy=function(e){return at.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this};cn.prototype.toJSON=function(){var e=at.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e};cn.prototype.fromJSON=function(e){return at.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this};function Bn(e,t,r,i){at.call(this),this.type="CubicBezierCurve3",this.v0=e||new I,this.v1=t||new I,this.v2=r||new I,this.v3=i||new I}Bn.prototype=Object.create(at.prototype);Bn.prototype.constructor=Bn;Bn.prototype.isCubicBezierCurve3=!0;Bn.prototype.getPoint=function(e,t){var r=t||new I,i=this.v0,n=this.v1,a=this.v2,o=this.v3;return r.set(Is(e,i.x,n.x,a.x,o.x),Is(e,i.y,n.y,a.y,o.y),Is(e,i.z,n.z,a.z,o.z)),r};Bn.prototype.copy=function(e){return at.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this};Bn.prototype.toJSON=function(){var e=at.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e};Bn.prototype.fromJSON=function(e){return at.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this};function di(e,t){at.call(this),this.type="LineCurve",this.v1=e||new Ee,this.v2=t||new Ee}di.prototype=Object.create(at.prototype);di.prototype.constructor=di;di.prototype.isLineCurve=!0;di.prototype.getPoint=function(e,t){var r=t||new Ee;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r};di.prototype.getPointAt=function(e,t){return this.getPoint(e,t)};di.prototype.getTangent=function(){var e=this.v2.clone().sub(this.v1);return e.normalize()};di.prototype.copy=function(e){return at.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this};di.prototype.toJSON=function(){var e=at.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e};di.prototype.fromJSON=function(e){return at.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this};function fn(e,t){at.call(this),this.type="LineCurve3",this.v1=e||new I,this.v2=t||new I}fn.prototype=Object.create(at.prototype);fn.prototype.constructor=fn;fn.prototype.isLineCurve3=!0;fn.prototype.getPoint=function(e,t){var r=t||new I;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r};fn.prototype.getPointAt=function(e,t){return this.getPoint(e,t)};fn.prototype.copy=function(e){return at.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this};fn.prototype.toJSON=function(){var e=at.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e};fn.prototype.fromJSON=function(e){return at.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this};function ln(e,t,r){at.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Ee,this.v1=t||new Ee,this.v2=r||new Ee}ln.prototype=Object.create(at.prototype);ln.prototype.constructor=ln;ln.prototype.isQuadraticBezierCurve=!0;ln.prototype.getPoint=function(e,t){var r=t||new Ee,i=this.v0,n=this.v1,a=this.v2;return r.set(Es(e,i.x,n.x,a.x),Es(e,i.y,n.y,a.y)),r};ln.prototype.copy=function(e){return at.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this};ln.prototype.toJSON=function(){var e=at.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e};ln.prototype.fromJSON=function(e){return at.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this};function Nn(e,t,r){at.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new I,this.v1=t||new I,this.v2=r||new I}Nn.prototype=Object.create(at.prototype);Nn.prototype.constructor=Nn;Nn.prototype.isQuadraticBezierCurve3=!0;Nn.prototype.getPoint=function(e,t){var r=t||new I,i=this.v0,n=this.v1,a=this.v2;return r.set(Es(e,i.x,n.x,a.x),Es(e,i.y,n.y,a.y),Es(e,i.z,n.z,a.z)),r};Nn.prototype.copy=function(e){return at.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this};Nn.prototype.toJSON=function(){var e=at.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e};Nn.prototype.fromJSON=function(e){return at.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this};function hn(e){at.call(this),this.type="SplineCurve",this.points=e||[]}hn.prototype=Object.create(at.prototype);hn.prototype.constructor=hn;hn.prototype.isSplineCurve=!0;hn.prototype.getPoint=function(e,t){var r=t||new Ee,i=this.points,n=(i.length-1)*e,a=Math.floor(n),o=n-a,s=i[a===0?a:a-1],u=i[a],c=i[a>i.length-2?i.length-1:a+1],f=i[a>i.length-3?i.length-1:a+2];return r.set(nv(o,s.x,u.x,c.x,f.x),nv(o,s.y,u.y,c.y,f.y)),r};hn.prototype.copy=function(e){var t=this;at.prototype.copy.call(this,e),this.points=[];for(var r=0,i=e.points.length;r<i;r++){var n=e.points[r];t.points.push(n.clone())}return this};hn.prototype.toJSON=function(){var e=this,t=at.prototype.toJSON.call(this);t.points=[];for(var r=0,i=this.points.length;r<i;r++){var n=e.points[r];t.points.push(n.toArray())}return t};hn.prototype.fromJSON=function(e){var t=this;at.prototype.fromJSON.call(this,e),this.points=[];for(var r=0,i=e.points.length;r<i;r++){var n=e.points[r];t.points.push(new Ee().fromArray(n))}return this};var Yg=Object.freeze({ArcCurve:su,CatmullRomCurve3:Gi,CubicBezierCurve:cn,CubicBezierCurve3:Bn,EllipseCurve:Si,LineCurve:di,LineCurve3:fn,QuadraticBezierCurve:ln,QuadraticBezierCurve3:Nn,SplineCurve:hn});function Qn(){at.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}Qn.prototype=Object.assign(Object.create(at.prototype),{constructor:Qn,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new di(t,e))},getPoint:function(e){for(var t=this,r=e*this.getLength(),i=this.getCurveLengths(),n=0;n<i.length;){if(i[n]>=r){var a=i[n]-r,o=t.curves[n],s=o.getLength(),u=s===0?0:1-a/s;return o.getPointAt(u)}n++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){var e=this;if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],r=0,i=0,n=this.curves.length;i<n;i++)r+=e.curves[i].getLength(),t.push(r);return this.cacheLengths=t,t},getSpacedPoints:function(e){var t=this;e===void 0&&(e=40);for(var r=[],i=0;i<=e;i++)r.push(t.getPoint(i/e));return this.autoClose&&r.push(r[0]),r},getPoints:function(e){e=e||12;for(var t=[],r,i=0,n=this.curves;i<n.length;i++)for(var a=n[i],o=a&&a.isEllipseCurve?e*2:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?e*a.points.length:e,s=a.getPoints(o),u=0;u<s.length;u++){var c=s[u];r&&r.equals(c)||(t.push(c),r=c)}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t},copy:function(e){var t=this;at.prototype.copy.call(this,e),this.curves=[];for(var r=0,i=e.curves.length;r<i;r++){var n=e.curves[r];t.curves.push(n.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=this,t=at.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var r=0,i=this.curves.length;r<i;r++){var n=e.curves[r];t.curves.push(n.toJSON())}return t},fromJSON:function(e){var t=this;at.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var r=0,i=e.curves.length;r<i;r++){var n=e.curves[r];t.curves.push(new Yg[n.type]().fromJSON(n))}return this}});function tn(e){Qn.call(this),this.type="Path",this.currentPoint=new Ee,e&&this.setFromPoints(e)}tn.prototype=Object.assign(Object.create(Qn.prototype),{constructor:tn,setFromPoints:function(e){var t=this;this.moveTo(e[0].x,e[0].y);for(var r=1,i=e.length;r<i;r++)t.lineTo(e[r].x,e[r].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,t){var r=new di(this.currentPoint.clone(),new Ee(e,t));this.curves.push(r),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,r,i){var n=new ln(this.currentPoint.clone(),new Ee(e,t),new Ee(r,i));this.curves.push(n),this.currentPoint.set(r,i)},bezierCurveTo:function(e,t,r,i,n,a){var o=new cn(this.currentPoint.clone(),new Ee(e,t),new Ee(r,i),new Ee(n,a));this.curves.push(o),this.currentPoint.set(n,a)},splineThru:function(e){var t=[this.currentPoint.clone()].concat(e),r=new hn(t);this.curves.push(r),this.currentPoint.copy(e[e.length-1])},arc:function(e,t,r,i,n,a){var o=this.currentPoint.x,s=this.currentPoint.y;this.absarc(e+o,t+s,r,i,n,a)},absarc:function(e,t,r,i,n,a){this.absellipse(e,t,r,r,i,n,a)},ellipse:function(e,t,r,i,n,a,o,s){var u=this.currentPoint.x,c=this.currentPoint.y;this.absellipse(e+u,t+c,r,i,n,a,o,s)},absellipse:function(e,t,r,i,n,a,o,s){var u=new Si(e,t,r,i,n,a,o,s);if(this.curves.length>0){var c=u.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(u);var f=u.getPoint(1);this.currentPoint.copy(f)},copy:function(e){return Qn.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=Qn.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return Qn.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}});function Ta(e){tn.call(this,e),this.uuid=Pt.generateUUID(),this.type="Shape",this.holes=[]}Ta.prototype=Object.assign(Object.create(tn.prototype),{constructor:Ta,getPointsHoles:function(e){for(var t=this,r=[],i=0,n=this.holes.length;i<n;i++)r[i]=t.holes[i].getPoints(e);return r},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){var t=this;tn.prototype.copy.call(this,e),this.holes=[];for(var r=0,i=e.holes.length;r<i;r++){var n=e.holes[r];t.holes.push(n.clone())}return this},toJSON:function(){var e=this,t=tn.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var r=0,i=this.holes.length;r<i;r++){var n=e.holes[r];t.holes.push(n.toJSON())}return t},fromJSON:function(e){var t=this;tn.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var r=0,i=e.holes.length;r<i;r++){var n=e.holes[r];t.holes.push(new tn().fromJSON(n))}return this}});function _r(e,t){Ge.call(this),this.type="Light",this.color=new Oe(e),this.intensity=t!==void 0?t:1,this.receiveShadow=void 0}_r.prototype=Object.assign(Object.create(Ge.prototype),{constructor:_r,isLight:!0,copy:function(e){return Ge.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=Ge.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}});function jh(e,t,r){_r.call(this,e,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Ge.DefaultUp),this.updateMatrix(),this.groundColor=new Oe(t)}jh.prototype=Object.assign(Object.create(_r.prototype),{constructor:jh,isHemisphereLight:!0,copy:function(e){return _r.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}});function Go(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new Ee(512,512),this.map=null,this.matrix=new Ae}Object.assign(Go.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var e={};return this.bias!==0&&(e.bias=this.bias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}});function Xh(){Go.call(this,new xr(50,1,.5,500))}Xh.prototype=Object.assign(Object.create(Go.prototype),{constructor:Xh,isSpotLightShadow:!0,update:function(e){var t=this.camera,r=Pt.RAD2DEG*2*e.angle,i=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;(r!==t.fov||i!==t.aspect||n!==t.far)&&(t.fov=r,t.aspect=i,t.far=n,t.updateProjectionMatrix())}});function sf(e,t,r,i,n,a){_r.call(this,e,t),this.type="SpotLight",this.position.copy(Ge.DefaultUp),this.updateMatrix(),this.target=new Ge,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(o){this.intensity=o/Math.PI}}),this.distance=r!==void 0?r:0,this.angle=i!==void 0?i:Math.PI/3,this.penumbra=n!==void 0?n:0,this.decay=a!==void 0?a:1,this.shadow=new Xh}sf.prototype=Object.assign(Object.create(_r.prototype),{constructor:sf,isSpotLight:!0,copy:function(e){return _r.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}});function qh(e,t,r,i){_r.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return this.intensity*4*Math.PI},set:function(n){this.intensity=n/(4*Math.PI)}}),this.distance=r!==void 0?r:0,this.decay=i!==void 0?i:1,this.shadow=new Go(new xr(90,1,.5,500))}qh.prototype=Object.assign(Object.create(_r.prototype),{constructor:qh,isPointLight:!0,copy:function(e){return _r.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}});function Yh(){Go.call(this,new ia(-5,5,5,-5,.5,500))}Yh.prototype=Object.assign(Object.create(Go.prototype),{constructor:Yh});function Zh(e,t){_r.call(this,e,t),this.type="DirectionalLight",this.position.copy(Ge.DefaultUp),this.updateMatrix(),this.target=new Ge,this.shadow=new Yh}Zh.prototype=Object.assign(Object.create(_r.prototype),{constructor:Zh,isDirectionalLight:!0,copy:function(e){return _r.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}});function uf(e,t){_r.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}uf.prototype=Object.assign(Object.create(_r.prototype),{constructor:uf,isAmbientLight:!0});function Kh(e,t,r,i){_r.call(this,e,t),this.type="RectAreaLight",this.width=r!==void 0?r:10,this.height=i!==void 0?i:10}Kh.prototype=Object.assign(Object.create(_r.prototype),{constructor:Kh,isRectAreaLight:!0,copy:function(e){return _r.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=_r.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}});var Zr={arraySlice:function(e,t,r){return Zr.isTypedArray(e)?new e.constructor(e.subarray(t,r!==void 0?r:e.length)):e.slice(t,r)},convertArray:function(e,t,r){return!e||!r&&e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){function t(a,o){return e[a]-e[o]}for(var r=e.length,i=new Array(r),n=0;n!==r;++n)i[n]=n;return i.sort(t),i},sortedArray:function(e,t,r){for(var i=e.length,n=new e.constructor(i),a=0,o=0;o!==i;++a)for(var s=r[a]*t,u=0;u!==t;++u)n[o++]=e[s+u];return n},flattenJSON:function(e,t,r,i){for(var n=1,a=e[0];a!==void 0&&a[i]===void 0;)a=e[n++];if(a!==void 0){var o=a[i];if(o!==void 0)if(Array.isArray(o))do o=a[i],o!==void 0&&(t.push(a.time),r.push.apply(r,o)),a=e[n++];while(a!==void 0);else if(o.toArray!==void 0)do o=a[i],o!==void 0&&(t.push(a.time),o.toArray(r,r.length)),a=e[n++];while(a!==void 0);else do o=a[i],o!==void 0&&(t.push(a.time),r.push(o)),a=e[n++];while(a!==void 0)}}};function _i(e,t,r,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(r),this.sampleValues=t,this.valueSize=r}Object.assign(_i.prototype,{evaluate:function(e){var t=this,r=this.parameterPositions,i=this._cachedIndex,n=r[i],a=r[i-1];e:{t:{var o;r:{i:if(!(e<n)){for(var s=i+2;;){if(n===void 0){if(e<a)break i;return i=r.length,t._cachedIndex=i,t.afterEnd_(i-1,e,a)}if(i===s)break;if(a=n,n=r[++i],e<n)break t}o=r.length;break r}if(!(e>=a)){var u=r[1];e<u&&(i=2,a=u);for(var s=i-2;;){if(a===void 0)return t._cachedIndex=0,t.beforeStart_(0,e,n);if(i===s)break;if(n=a,a=r[--i-1],e>=a)break t}o=i,i=0;break r}break e}for(;i<o;){var c=i+o>>>1;e<r[c]?o=c:i=c+1}if(n=r[i],a=r[i-1],a===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(n===void 0)return i=r.length,this._cachedIndex=i,this.afterEnd_(i-1,a,e)}this._cachedIndex=i,this.intervalChanged_(i,a,n)}return this.interpolate_(i,a,e,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i,a=0;a!==i;++a)t[a]=r[n+a];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}});//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(_i.prototype,{beforeStart_:_i.prototype.copySampleValue_,afterEnd_:_i.prototype.copySampleValue_});function Jh(e,t,r,i){_i.call(this,e,t,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}Jh.prototype=Object.assign(Object.create(_i.prototype),{constructor:Jh,DefaultSettings_:{endingStart:yo,endingEnd:yo},intervalChanged_:function(e,t,r){var i=this.parameterPositions,n=e-2,a=e+1,o=i[n],s=i[a];if(o===void 0)switch(this.getSettings_().endingStart){case uo:n=e,o=2*t-r;break;case Oc:n=i.length-2,o=t+i[n]-i[n+1];break;default:n=e,o=r}if(s===void 0)switch(this.getSettings_().endingEnd){case uo:a=e,s=2*r-t;break;case Oc:a=1,s=r+i[1]-i[0];break;default:a=e-1,s=t}var u=(r-t)*.5,c=this.valueSize;this._weightPrev=u/(t-o),this._weightNext=u/(s-r),this._offsetPrev=n*c,this._offsetNext=a*c},interpolate_:function(e,t,r,i){for(var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,c=this._offsetPrev,f=this._offsetNext,l=this._weightPrev,h=this._weightNext,d=(r-t)/(i-t),p=d*d,v=p*d,m=-l*v+2*l*p-l*d,g=(1+l)*v+(-1.5-2*l)*p+(-.5+l)*d+1,x=(-1-h)*v+(1.5+h)*p+.5*d,y=h*v-h*p,b=0;b!==o;++b)n[b]=m*a[c+b]+g*a[u+b]+x*a[s+b]+y*a[f+b];return n}});function cf(e,t,r,i){_i.call(this,e,t,r,i)}cf.prototype=Object.assign(Object.create(_i.prototype),{constructor:cf,interpolate_:function(e,t,r,i){for(var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,c=(r-t)/(i-t),f=1-c,l=0;l!==o;++l)n[l]=a[u+l]*f+a[s+l]*c;return n}});function Qh(e,t,r,i){_i.call(this,e,t,r,i)}Qh.prototype=Object.assign(Object.create(_i.prototype),{constructor:Qh,interpolate_:function(e){return this.copySampleValue_(e-1)}});function Hr(e,t,r,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Zr.convertArray(t,this.TimeBufferType),this.values=Zr.convertArray(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}Object.assign(Hr,{toJSON:function(e){var t=e.constructor,r;if(t.toJSON!==void 0)r=t.toJSON(e);else{r={name:e.name,times:Zr.convertArray(e.times,Array),values:Zr.convertArray(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(r.interpolation=i)}return r.type=e.ValueTypeName,r}});Object.assign(Hr.prototype,{constructor:Hr,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:_c,InterpolantFactoryMethodDiscrete:function(e){return new Qh(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new cf(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Jh(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case Lc:t=this.InterpolantFactoryMethodDiscrete;break;case _c:t=this.InterpolantFactoryMethodLinear;break;case Al:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Lc;case this.InterpolantFactoryMethodLinear:return _c;case this.InterpolantFactoryMethodSmooth:return Al}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(e!==0)for(var t=this.times,r=0,i=t.length;r!==i;++r)t[r]+=e;return this},scale:function(e){if(e!==1)for(var t=this.times,r=0,i=t.length;r!==i;++r)t[r]*=e;return this},trim:function(e,t){for(var r=this.times,i=r.length,n=0,a=i-1;n!==i&&r[n]<e;)++n;for(;a!==-1&&r[a]>t;)--a;if(++a,n!==0||a!==i){n>=a&&(a=Math.max(a,1),n=a-1);var o=this.getValueSize();this.times=Zr.arraySlice(r,n,a),this.values=Zr.arraySlice(this.values,n*o,a*o)}return this},validate:function(){var e=this,t=!0,r=this.getValueSize();r-Math.floor(r)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var i=this.times,n=this.values,a=i.length;a===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var o=null,s=0;s!==a;s++){var u=i[s];if(typeof u=="number"&&isNaN(u)){console.error("THREE.KeyframeTrack: Time is not a valid number.",e,s,u),t=!1;break}if(o!==null&&o>u){console.error("THREE.KeyframeTrack: Out of order keys.",e,s,u,o),t=!1;break}o=u}if(n!==void 0&&Zr.isTypedArray(n))for(var s=0,c=n.length;s!==c;++s){var f=n[s];if(isNaN(f)){console.error("THREE.KeyframeTrack: Value is not a valid number.",e,s,f),t=!1;break}}return t},optimize:function(){for(var e=this.times,t=this.values,r=this.getValueSize(),i=this.getInterpolation()===Al,n=1,a=e.length-1,o=1;o<a;++o){var s=!1,u=e[o],c=e[o+1];if(u!==c&&(o!==1||u!==u[0]))if(i)s=!0;else for(var f=o*r,l=f-r,h=f+r,d=0;d!==r;++d){var p=t[f+d];if(p!==t[l+d]||p!==t[h+d]){s=!0;break}}if(s){if(o!==n){e[n]=e[o];for(var v=o*r,m=n*r,d=0;d!==r;++d)t[m+d]=t[v+d]}++n}}if(a>0){e[n]=e[a];for(var v=a*r,m=n*r,d=0;d!==r;++d)t[m+d]=t[v+d];++n}return n!==e.length&&(this.times=Zr.arraySlice(e,0,n),this.values=Zr.arraySlice(t,0,n*r)),this}});function $h(e,t,r){Hr.call(this,e,t,r)}$h.prototype=Object.assign(Object.create(Hr.prototype),{constructor:$h,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Lc,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});function ed(e,t,r,i){Hr.call(this,e,t,r,i)}ed.prototype=Object.assign(Object.create(Hr.prototype),{constructor:ed,ValueTypeName:"color"});function uu(e,t,r,i){Hr.call(this,e,t,r,i)}uu.prototype=Object.assign(Object.create(Hr.prototype),{constructor:uu,ValueTypeName:"number"});function td(e,t,r,i){_i.call(this,e,t,r,i)}td.prototype=Object.assign(Object.create(_i.prototype),{constructor:td,interpolate_:function(e,t,r,i){for(var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,u=(r-t)/(i-t),c=s+o;s!==c;s+=4)er.slerpFlat(n,0,a,s-o,a,s,u);return n}});function ff(e,t,r,i){Hr.call(this,e,t,r,i)}ff.prototype=Object.assign(Object.create(Hr.prototype),{constructor:ff,ValueTypeName:"quaternion",DefaultInterpolation:_c,InterpolantFactoryMethodLinear:function(e){return new td(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0});function rd(e,t,r,i){Hr.call(this,e,t,r,i)}rd.prototype=Object.assign(Object.create(Hr.prototype),{constructor:rd,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Lc,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});function cu(e,t,r,i){Hr.call(this,e,t,r,i)}cu.prototype=Object.assign(Object.create(Hr.prototype),{constructor:cu,ValueTypeName:"vector"});function Ni(e,t,r){this.name=e,this.tracks=r,this.duration=t!==void 0?t:-1,this.uuid=Pt.generateUUID(),this.duration<0&&this.resetDuration()}function P2(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return uu;case"vector":case"vector2":case"vector3":case"vector4":return cu;case"color":return ed;case"quaternion":return ff;case"bool":case"boolean":return $h;case"string":return rd}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function T2(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=P2(e.type);if(e.times===void 0){var r=[],i=[];Zr.flattenJSON(e.keys,r,i,"value"),e.times=r,e.values=i}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(Ni,{parse:function(e){for(var t=[],r=e.tracks,i=1/(e.fps||1),n=0,a=r.length;n!==a;++n)t.push(T2(r[n]).scale(i));return new Ni(e.name,e.duration,t)},toJSON:function(e){for(var t=[],r=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},n=0,a=r.length;n!==a;++n)t.push(Hr.toJSON(r[n]));return i},CreateFromMorphTargetSequence:function(e,t,r,i){for(var n=t.length,a=[],o=0;o<n;o++){var s=[],u=[];s.push((o+n-1)%n,o,(o+1)%n),u.push(0,1,0);var c=Zr.getKeyframeOrder(s);s=Zr.sortedArray(s,1,c),u=Zr.sortedArray(u,1,c),!i&&s[0]===0&&(s.push(n),u.push(u[0])),a.push(new uu(".morphTargetInfluences["+t[o].name+"]",s,u).scale(1/r))}return new Ni(e,-1,a)},findByName:function(e,t){var r=e;if(!Array.isArray(e)){var i=e;r=i.geometry&&i.geometry.animations||i.animations}for(var n=0;n<r.length;n++)if(r[n].name===t)return r[n];return null},CreateClipsFromMorphTargetSequences:function(e,t,r){for(var i={},n=/^([\w-]*?)([\d]+)$/,a=0,o=e.length;a<o;a++){var s=e[a],u=s.name.match(n);if(u&&u.length>1){var c=u[1],f=i[c];f||(i[c]=f=[]),f.push(s)}}var l=[];for(var c in i)l.push(Ni.CreateFromMorphTargetSequence(c,i[c],t,r));return l},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function(y,b,_,w,A){if(_.length!==0){var S=[],M=[];Zr.flattenJSON(_,S,M,w),S.length!==0&&A.push(new y(b,S,M))}},i=[],n=e.name||"default",a=e.length||-1,o=e.fps||30,s=e.hierarchy||[],u=0;u<s.length;u++){var c=s[u].keys;if(!(!c||c.length===0))if(c[0].morphTargets){for(var f={},l=0;l<c.length;l++)if(c[l].morphTargets)for(var h=0;h<c[l].morphTargets.length;h++)f[c[l].morphTargets[h]]=-1;for(var d in f){for(var p=[],v=[],h=0;h!==c[l].morphTargets.length;++h){var m=c[l];p.push(m.time),v.push(m.morphTarget===d?1:0)}i.push(new uu(".morphTargetInfluence["+d+"]",p,v))}a=f.length*(o||1)}else{var g=".bones["+t[u].name+"]";r(cu,g+".position",c,"pos",i),r(ff,g+".quaternion",c,"rot",i),r(cu,g+".scale",c,"scl",i)}}if(i.length===0)return null;var x=new Ni(n,a,i);return x}});Object.assign(Ni.prototype,{resetDuration:function(){for(var e=this,t=this.tracks,r=0,i=0,n=t.length;i!==n;++i){var a=e.tracks[i];r=Math.max(r,a.times[a.times.length-1])}return this.duration=r,this},trim:function(){for(var e=this,t=0;t<this.tracks.length;t++)e.tracks[t].trim(0,e.duration);return this},validate:function(){for(var e=this,t=!0,r=0;r<this.tracks.length;r++)t=t&&e.tracks[r].validate();return t},optimize:function(){for(var e=this,t=0;t<this.tracks.length;t++)e.tracks[t].optimize();return this}});function Dd(e){this.manager=e!==void 0?e:Ci,this.textures={}}Object.assign(Dd.prototype,{load:function(e,t,r,i){var n=this,a=new zn(n.manager);a.load(e,function(o){t(n.parse(JSON.parse(o)))},r,i)},setTextures:function(e){this.textures=e},parse:function(e){var t=this.textures;function r(a){return t[a]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",a),t[a]}var i=new g2[e.type];if(e.uuid!==void 0&&(i.uuid=e.uuid),e.name!==void 0&&(i.name=e.name),e.color!==void 0&&i.color.setHex(e.color),e.roughness!==void 0&&(i.roughness=e.roughness),e.metalness!==void 0&&(i.metalness=e.metalness),e.emissive!==void 0&&i.emissive.setHex(e.emissive),e.specular!==void 0&&i.specular.setHex(e.specular),e.shininess!==void 0&&(i.shininess=e.shininess),e.clearCoat!==void 0&&(i.clearCoat=e.clearCoat),e.clearCoatRoughness!==void 0&&(i.clearCoatRoughness=e.clearCoatRoughness),e.uniforms!==void 0&&(i.uniforms=e.uniforms),e.vertexShader!==void 0&&(i.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(i.fragmentShader=e.fragmentShader),e.vertexColors!==void 0&&(i.vertexColors=e.vertexColors),e.fog!==void 0&&(i.fog=e.fog),e.flatShading!==void 0&&(i.flatShading=e.flatShading),e.blending!==void 0&&(i.blending=e.blending),e.side!==void 0&&(i.side=e.side),e.opacity!==void 0&&(i.opacity=e.opacity),e.transparent!==void 0&&(i.transparent=e.transparent),e.alphaTest!==void 0&&(i.alphaTest=e.alphaTest),e.depthTest!==void 0&&(i.depthTest=e.depthTest),e.depthWrite!==void 0&&(i.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(i.colorWrite=e.colorWrite),e.wireframe!==void 0&&(i.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(i.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(i.rotation=e.rotation),e.linewidth!==1&&(i.linewidth=e.linewidth),e.dashSize!==void 0&&(i.dashSize=e.dashSize),e.gapSize!==void 0&&(i.gapSize=e.gapSize),e.scale!==void 0&&(i.scale=e.scale),e.polygonOffset!==void 0&&(i.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=e.polygonOffsetUnits),e.skinning!==void 0&&(i.skinning=e.skinning),e.morphTargets!==void 0&&(i.morphTargets=e.morphTargets),e.dithering!==void 0&&(i.dithering=e.dithering),e.visible!==void 0&&(i.visible=e.visible),e.userData!==void 0&&(i.userData=e.userData),e.shading!==void 0&&(i.flatShading=e.shading===1),e.size!==void 0&&(i.size=e.size),e.sizeAttenuation!==void 0&&(i.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(i.map=r(e.map)),e.alphaMap!==void 0&&(i.alphaMap=r(e.alphaMap),i.transparent=!0),e.bumpMap!==void 0&&(i.bumpMap=r(e.bumpMap)),e.bumpScale!==void 0&&(i.bumpScale=e.bumpScale),e.normalMap!==void 0&&(i.normalMap=r(e.normalMap)),e.normalMapType!==void 0&&(i.normalMapType=e.normalMapType),e.normalScale!==void 0){var n=e.normalScale;Array.isArray(n)===!1&&(n=[n,n]),i.normalScale=new Ee().fromArray(n)}return e.displacementMap!==void 0&&(i.displacementMap=r(e.displacementMap)),e.displacementScale!==void 0&&(i.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(i.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(i.roughnessMap=r(e.roughnessMap)),e.metalnessMap!==void 0&&(i.metalnessMap=r(e.metalnessMap)),e.emissiveMap!==void 0&&(i.emissiveMap=r(e.emissiveMap)),e.emissiveIntensity!==void 0&&(i.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(i.specularMap=r(e.specularMap)),e.envMap!==void 0&&(i.envMap=r(e.envMap)),e.reflectivity!==void 0&&(i.reflectivity=e.reflectivity),e.lightMap!==void 0&&(i.lightMap=r(e.lightMap)),e.lightMapIntensity!==void 0&&(i.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(i.aoMap=r(e.aoMap)),e.aoMapIntensity!==void 0&&(i.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(i.gradientMap=r(e.gradientMap)),i}});function Zg(e){this.manager=e!==void 0?e:Ci}Object.assign(Zg.prototype,{load:function(e,t,r,i){var n=this,a=new zn(n.manager);a.load(e,function(o){t(n.parse(JSON.parse(o)))},r,i)},parse:function(e){var t=new Ue,r=e.data.index;if(r!==void 0){var i=new av[r.type](r.array);t.setIndex(new ft(i,1))}var n=e.data.attributes;for(var a in n){var o=n[a],i=new av[o.type](o.array);t.addAttribute(a,new ft(i,o.itemSize,o.normalized))}var s=e.data.groups||e.data.drawcalls||e.data.offsets;if(s!==void 0)for(var u=0,c=s.length;u!==c;++u){var f=s[u];t.addGroup(f.start,f.count,f.materialIndex)}var l=e.data.boundingSphere;if(l!==void 0){var h=new I;l.center!==void 0&&h.fromArray(l.center),t.boundingSphere=new sn(h,l.radius)}return t}});var av={Int8Array,Uint8Array,Uint8ClampedArray:typeof Uint8ClampedArray<"u"?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function fu(){}fu.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,r=0,i=t.length;r<i;r+=2){var n=t[r],a=t[r+1];if(n.test(e))return a}return null}};Object.assign(fu.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(e,t,r){for(var i=this,n=[],a=0;a<e.length;++a)n[a]=i.createMaterial(e[a],t,r);return n},createMaterial:function(){var e={NoBlending:Ec,NormalBlending:$n,AdditiveBlending:xd,SubtractiveBlending:dg,MultiplyBlending:pg,CustomBlending:vg},t=new Oe,r=new Ld,i=new Dd;return function(a,o,s){var u={};function c(d,p,v,m,g){var x=o+d,y=fu.Handlers.get(x),b;y!==null?b=y.load(x):(r.setCrossOrigin(s),b=r.load(x)),p!==void 0&&(b.repeat.fromArray(p),p[0]!==1&&(b.wrapS=Jn),p[1]!==1&&(b.wrapT=Jn)),v!==void 0&&b.offset.fromArray(v),m!==void 0&&(m[0]==="repeat"&&(b.wrapS=Jn),m[0]==="mirror"&&(b.wrapS=mo),m[1]==="repeat"&&(b.wrapT=Jn),m[1]==="mirror"&&(b.wrapT=mo)),g!==void 0&&(b.anisotropy=g);var _=Pt.generateUUID();return u[_]=b,_}var f={uuid:Pt.generateUUID(),type:"MeshLambertMaterial"};for(var l in a){var h=a[l];switch(l){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":f.name=h;break;case"blending":f.blending=e[h];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",l,"is no longer supported.");break;case"colorDiffuse":f.color=t.fromArray(h).getHex();break;case"colorSpecular":f.specular=t.fromArray(h).getHex();break;case"colorEmissive":f.emissive=t.fromArray(h).getHex();break;case"specularCoef":f.shininess=h;break;case"shading":h.toLowerCase()==="basic"&&(f.type="MeshBasicMaterial"),h.toLowerCase()==="phong"&&(f.type="MeshPhongMaterial"),h.toLowerCase()==="standard"&&(f.type="MeshStandardMaterial");break;case"mapDiffuse":f.map=c(h,a.mapDiffuseRepeat,a.mapDiffuseOffset,a.mapDiffuseWrap,a.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":f.emissiveMap=c(h,a.mapEmissiveRepeat,a.mapEmissiveOffset,a.mapEmissiveWrap,a.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":f.lightMap=c(h,a.mapLightRepeat,a.mapLightOffset,a.mapLightWrap,a.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":f.aoMap=c(h,a.mapAORepeat,a.mapAOOffset,a.mapAOWrap,a.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":f.bumpMap=c(h,a.mapBumpRepeat,a.mapBumpOffset,a.mapBumpWrap,a.mapBumpAnisotropy);break;case"mapBumpScale":f.bumpScale=h;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":f.normalMap=c(h,a.mapNormalRepeat,a.mapNormalOffset,a.mapNormalWrap,a.mapNormalAnisotropy);break;case"mapNormalFactor":f.normalScale=h;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":f.specularMap=c(h,a.mapSpecularRepeat,a.mapSpecularOffset,a.mapSpecularWrap,a.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":f.metalnessMap=c(h,a.mapMetalnessRepeat,a.mapMetalnessOffset,a.mapMetalnessWrap,a.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":f.roughnessMap=c(h,a.mapRoughnessRepeat,a.mapRoughnessOffset,a.mapRoughnessWrap,a.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":f.alphaMap=c(h,a.mapAlphaRepeat,a.mapAlphaOffset,a.mapAlphaWrap,a.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":f.side=ni;break;case"doubleSided":f.side=Ra;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),f.opacity=h;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":f[l]=h;break;case"vertexColors":h===!0&&(f.vertexColors=Tn),h==="face"&&(f.vertexColors=hg);break;default:console.error("THREE.Loader.createMaterial: Unsupported",l,h);break}}return f.type==="MeshBasicMaterial"&&delete f.emissive,f.type!=="MeshPhongMaterial"&&delete f.specular,f.opacity<1&&(f.transparent=!0),i.setTextures(u),i.parse(f)}}()});var Kg={decodeText:function(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);for(var t="",r=0,i=e.length;r<i;r++)t+=String.fromCharCode(e[r]);return decodeURIComponent(escape(t))},extractUrlBase:function(e){var t=e.lastIndexOf("/");return t===-1?"./":e.substr(0,t+1)}};function Jg(e){typeof e=="boolean"&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=e!==void 0?e:Ci,this.withCredentials=!1}Object.assign(Jg.prototype,{crossOrigin:"anonymous",load:function(e,t,r,i){var n=this,a=this.texturePath&&typeof this.texturePath=="string"?this.texturePath:Kg.extractUrlBase(e),o=new zn(this.manager);o.setWithCredentials(this.withCredentials),o.load(e,function(s){var u=JSON.parse(s),c=u.metadata;if(c!==void 0){var f=c.type;if(f!==void 0&&f.toLowerCase()==="object"){console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.");return}}var l=n.parse(u,a);t(l.geometry,l.materials)},r,i)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setTexturePath:function(e){return this.texturePath=e,this},parse:function(){function e(n,a){function o(K,te){return K&1<<te}var s,u,c,f,l,h,d,p,v,m,g,x,y,b,_,w,A,S,M,E,T,H,X,q,Z,Q,N,D=n.faces,W=n.vertices,L=n.normals,U=n.colors,k=n.scale,ee=0;if(n.uvs!==void 0){for(s=0;s<n.uvs.length;s++)n.uvs[s].length&&ee++;for(s=0;s<ee;s++)a.faceVertexUvs[s]=[]}for(f=0,l=W.length;f<l;)S=new I,S.x=W[f++]*k,S.y=W[f++]*k,S.z=W[f++]*k,a.vertices.push(S);for(f=0,l=D.length;f<l;)if(m=D[f++],g=o(m,0),x=o(m,1),y=o(m,3),b=o(m,4),_=o(m,5),w=o(m,6),A=o(m,7),g){if(E=new nn,E.a=D[f],E.b=D[f+1],E.c=D[f+3],T=new nn,T.a=D[f+1],T.b=D[f+2],T.c=D[f+3],f+=4,x&&(v=D[f++],E.materialIndex=v,T.materialIndex=v),c=a.faces.length,y)for(s=0;s<ee;s++)for(q=n.uvs[s],a.faceVertexUvs[s][c]=[],a.faceVertexUvs[s][c+1]=[],u=0;u<4;u++)p=D[f++],Q=q[p*2],N=q[p*2+1],Z=new Ee(Q,N),u!==2&&a.faceVertexUvs[s][c].push(Z),u!==0&&a.faceVertexUvs[s][c+1].push(Z);if(b&&(d=D[f++]*3,E.normal.set(L[d++],L[d++],L[d]),T.normal.copy(E.normal)),_)for(s=0;s<4;s++)d=D[f++]*3,X=new I(L[d++],L[d++],L[d]),s!==2&&E.vertexNormals.push(X),s!==0&&T.vertexNormals.push(X);if(w&&(h=D[f++],H=U[h],E.color.setHex(H),T.color.setHex(H)),A)for(s=0;s<4;s++)h=D[f++],H=U[h],s!==2&&E.vertexColors.push(new Oe(H)),s!==0&&T.vertexColors.push(new Oe(H));a.faces.push(E),a.faces.push(T)}else{if(M=new nn,M.a=D[f++],M.b=D[f++],M.c=D[f++],x&&(v=D[f++],M.materialIndex=v),c=a.faces.length,y)for(s=0;s<ee;s++)for(q=n.uvs[s],a.faceVertexUvs[s][c]=[],u=0;u<3;u++)p=D[f++],Q=q[p*2],N=q[p*2+1],Z=new Ee(Q,N),a.faceVertexUvs[s][c].push(Z);if(b&&(d=D[f++]*3,M.normal.set(L[d++],L[d++],L[d])),_)for(s=0;s<3;s++)d=D[f++]*3,X=new I(L[d++],L[d++],L[d]),M.vertexNormals.push(X);if(w&&(h=D[f++],M.color.setHex(U[h])),A)for(s=0;s<3;s++)h=D[f++],M.vertexColors.push(new Oe(U[h]));a.faces.push(M)}}function t(n,a){var o=n.influencesPerVertex!==void 0?n.influencesPerVertex:2;if(n.skinWeights)for(var s=0,u=n.skinWeights.length;s<u;s+=o){var c=n.skinWeights[s],f=o>1?n.skinWeights[s+1]:0,l=o>2?n.skinWeights[s+2]:0,h=o>3?n.skinWeights[s+3]:0;a.skinWeights.push(new $t(c,f,l,h))}if(n.skinIndices)for(var s=0,u=n.skinIndices.length;s<u;s+=o){var d=n.skinIndices[s],p=o>1?n.skinIndices[s+1]:0,v=o>2?n.skinIndices[s+2]:0,m=o>3?n.skinIndices[s+3]:0;a.skinIndices.push(new $t(d,p,v,m))}a.bones=n.bones,a.bones&&a.bones.length>0&&(a.skinWeights.length!==a.skinIndices.length||a.skinIndices.length!==a.vertices.length)&&console.warn("When skinning, number of vertices ("+a.vertices.length+"), skinIndices ("+a.skinIndices.length+"), and skinWeights ("+a.skinWeights.length+") should match.")}function r(n,a){var o=n.scale;if(n.morphTargets!==void 0)for(var s=0,u=n.morphTargets.length;s<u;s++){a.morphTargets[s]={},a.morphTargets[s].name=n.morphTargets[s].name,a.morphTargets[s].vertices=[];for(var c=a.morphTargets[s].vertices,f=n.morphTargets[s].vertices,l=0,h=f.length;l<h;l+=3){var d=new I;d.x=f[l]*o,d.y=f[l+1]*o,d.z=f[l+2]*o,c.push(d)}}if(n.morphColors!==void 0&&n.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');for(var p=a.faces,v=n.morphColors[0].colors,s=0,u=p.length;s<u;s++)p[s].color.fromArray(v,s*3)}}function i(n,a){var o=[],s=[];n.animation!==void 0&&s.push(n.animation),n.animations!==void 0&&(n.animations.length?s=s.concat(n.animations):s.push(n.animations));for(var u=0;u<s.length;u++){var c=Ni.parseAnimation(s[u],a.bones);c&&o.push(c)}if(a.morphTargets){var f=Ni.CreateClipsFromMorphTargetSequences(a.morphTargets,10);o=o.concat(f)}o.length>0&&(a.animations=o)}return function(a,o){a.data!==void 0&&(a=a.data),a.scale!==void 0?a.scale=1/a.scale:a.scale=1;var s=new st;if(e(a,s),t(a,s),r(a,s),i(a,s),s.computeFaceNormals(),s.computeBoundingSphere(),a.materials===void 0||a.materials.length===0)return{geometry:s};var u=fu.prototype.initMaterials(a.materials,o,this.crossOrigin);return{geometry:s,materials:u}}}()});function E2(e){this.manager=e!==void 0?e:Ci,this.texturePath=""}Object.assign(E2.prototype,{crossOrigin:"anonymous",load:function(e,t,r,i){this.texturePath===""&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var n=this,a=new zn(n.manager);a.load(e,function(o){var s=null;try{s=JSON.parse(o)}catch(c){i!==void 0&&i(c),console.error("THREE:ObjectLoader: Can't parse "+e+".",c.message);return}var u=s.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){console.error("THREE.ObjectLoader: Can't load "+e+". Use THREE.JSONLoader instead.");return}n.parse(s,t)},r,i)},setTexturePath:function(e){return this.texturePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){var r=this.parseShape(e.shapes),i=this.parseGeometries(e.geometries,r),n=this.parseImages(e.images,function(){t!==void 0&&t(s)}),a=this.parseTextures(e.textures,n),o=this.parseMaterials(e.materials,a),s=this.parseObject(e.object,i,o);return e.animations&&(s.animations=this.parseAnimations(e.animations)),(e.images===void 0||e.images.length===0)&&t!==void 0&&t(s),s},parseShape:function(e){var t={};if(e!==void 0)for(var r=0,i=e.length;r<i;r++){var n=new Ta().fromJSON(e[r]);t[n.uuid]=n}return t},parseGeometries:function(e,t){var r=this,i={};if(e!==void 0)for(var n=new Jg,a=new Zg,o=0,s=e.length;o<s;o++){var u,c=e[o];switch(c.type){case"PlaneGeometry":case"PlaneBufferGeometry":u=new ri[c.type](c.width,c.height,c.widthSegments,c.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":u=new ri[c.type](c.width,c.height,c.depth,c.widthSegments,c.heightSegments,c.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":u=new ri[c.type](c.radius,c.segments,c.thetaStart,c.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":u=new ri[c.type](c.radiusTop,c.radiusBottom,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":u=new ri[c.type](c.radius,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":u=new ri[c.type](c.radius,c.widthSegments,c.heightSegments,c.phiStart,c.phiLength,c.thetaStart,c.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":u=new ri[c.type](c.radius,c.detail);break;case"RingGeometry":case"RingBufferGeometry":u=new ri[c.type](c.innerRadius,c.outerRadius,c.thetaSegments,c.phiSegments,c.thetaStart,c.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":u=new ri[c.type](c.radius,c.tube,c.radialSegments,c.tubularSegments,c.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":u=new ri[c.type](c.radius,c.tube,c.tubularSegments,c.radialSegments,c.p,c.q);break;case"LatheGeometry":case"LatheBufferGeometry":u=new ri[c.type](c.points,c.segments,c.phiStart,c.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":u=new ri[c.type](c.vertices,c.indices,c.radius,c.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var d=[],f=0,l=c.shapes.length;f<l;f++){var h=t[c.shapes[f]];d.push(h)}u=new ri[c.type](d,c.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(var d=[],f=0,l=c.shapes.length;f<l;f++){var h=t[c.shapes[f]];d.push(h)}var p=c.options.extrudePath;p!==void 0&&(c.options.extrudePath=new Yg[p.type]().fromJSON(p)),u=new ri[c.type](d,c.options);break;case"BufferGeometry":u=a.parse(c);break;case"Geometry":u=n.parse(c,r.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+c.type+'"');continue}u.uuid=c.uuid,c.name!==void 0&&(u.name=c.name),u.isBufferGeometry===!0&&c.userData!==void 0&&(u.userData=c.userData),i[c.uuid]=u}return i},parseMaterials:function(e,t){var r={};if(e!==void 0){var i=new Dd;i.setTextures(t);for(var n=0,a=e.length;n<a;n++){var o=e[n];if(o.type==="MultiMaterial"){for(var s=[],u=0;u<o.materials.length;u++)s.push(i.parse(o.materials[u]));r[o.uuid]=s}else r[o.uuid]=i.parse(o)}}return r},parseAnimations:function(e){for(var t=[],r=0;r<e.length;r++){var i=e[r],n=Ni.parse(i);i.uuid!==void 0&&(n.uuid=i.uuid),t.push(n)}return t},parseImages:function(e,t){var r=this,i={};function n(v){return r.manager.itemStart(v),o.load(v,function(){r.manager.itemEnd(v)},void 0,function(){r.manager.itemEnd(v),r.manager.itemError(v)})}if(e!==void 0&&e.length>0){var a=new Xg(t),o=new Bf(a);o.setCrossOrigin(this.crossOrigin);for(var s=0,u=e.length;s<u;s++){var c=e[s],f=c.url;if(Array.isArray(f)){i[c.uuid]=[];for(var l=0,h=f.length;l<h;l++){var d=f[l],p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(d)?d:r.texturePath+d;i[c.uuid].push(n(p))}}else{var p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c.url)?c.url:r.texturePath+c.url;i[c.uuid]=n(p)}}}return i},parseTextures:function(e,t){function r(u,c){return typeof u=="number"?u:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",u),c[u])}var i={};if(e!==void 0)for(var n=0,a=e.length;n<a;n++){var o=e[n];o.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),t[o.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",o.image);var s;Array.isArray(t[o.image])?s=new na(t[o.image]):s=new hr(t[o.image]),s.needsUpdate=!0,s.uuid=o.uuid,o.name!==void 0&&(s.name=o.name),o.mapping!==void 0&&(s.mapping=r(o.mapping,I2)),o.offset!==void 0&&s.offset.fromArray(o.offset),o.repeat!==void 0&&s.repeat.fromArray(o.repeat),o.center!==void 0&&s.center.fromArray(o.center),o.rotation!==void 0&&(s.rotation=o.rotation),o.wrap!==void 0&&(s.wrapS=r(o.wrap[0],ov),s.wrapT=r(o.wrap[1],ov)),o.format!==void 0&&(s.format=o.format),o.minFilter!==void 0&&(s.minFilter=r(o.minFilter,sv)),o.magFilter!==void 0&&(s.magFilter=r(o.magFilter,sv)),o.anisotropy!==void 0&&(s.anisotropy=o.anisotropy),o.flipY!==void 0&&(s.flipY=o.flipY),i[o.uuid]=s}return i},parseObject:function(e,t,r){var i=this,n;function a(v){return t[v]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",v),t[v]}function o(v){if(v!==void 0){if(Array.isArray(v)){for(var m=[],g=0,x=v.length;g<x;g++){var y=v[g];r[y]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",y),m.push(r[y])}return m}return r[v]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",v),r[v]}}switch(e.type){case"Scene":n=new Vs,e.background!==void 0&&Number.isInteger(e.background)&&(n.background=new Oe(e.background)),e.fog!==void 0&&(e.fog.type==="Fog"?n.fog=new xo(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(n.fog=new Hs(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":n=new xr(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(n.focus=e.focus),e.zoom!==void 0&&(n.zoom=e.zoom),e.filmGauge!==void 0&&(n.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(n.filmOffset=e.filmOffset),e.view!==void 0&&(n.view=Object.assign({},e.view));break;case"OrthographicCamera":n=new ia(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(n.zoom=e.zoom),e.view!==void 0&&(n.view=Object.assign({},e.view));break;case"AmbientLight":n=new uf(e.color,e.intensity);break;case"DirectionalLight":n=new Zh(e.color,e.intensity);break;case"PointLight":n=new qh(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":n=new Kh(e.color,e.intensity,e.width,e.height);break;case"SpotLight":n=new sf(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":n=new jh(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var s=a(e.geometry),u=o(e.material);s.bones&&s.bones.length>0?n=new Gh(s,u):n=new Jr(s,u);break;case"LOD":n=new kc;break;case"Line":n=new li(a(e.geometry),o(e.material),e.mode);break;case"LineLoop":n=new Hh(a(e.geometry),o(e.material));break;case"LineSegments":n=new ar(a(e.geometry),o(e.material));break;case"PointCloud":case"Points":n=new Ws(a(e.geometry),o(e.material));break;case"Sprite":n=new zh(o(e.material));break;case"Group":n=new Jt;break;default:n=new Ge}if(n.uuid=e.uuid,e.name!==void 0&&(n.name=e.name),e.matrix!==void 0?(n.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(n.matrixAutoUpdate=e.matrixAutoUpdate),n.matrixAutoUpdate&&n.matrix.decompose(n.position,n.quaternion,n.scale)):(e.position!==void 0&&n.position.fromArray(e.position),e.rotation!==void 0&&n.rotation.fromArray(e.rotation),e.quaternion!==void 0&&n.quaternion.fromArray(e.quaternion),e.scale!==void 0&&n.scale.fromArray(e.scale)),e.castShadow!==void 0&&(n.castShadow=e.castShadow),e.receiveShadow!==void 0&&(n.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(n.shadow.bias=e.shadow.bias),e.shadow.radius!==void 0&&(n.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&n.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(n.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(n.visible=e.visible),e.frustumCulled!==void 0&&(n.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(n.renderOrder=e.renderOrder),e.userData!==void 0&&(n.userData=e.userData),e.layers!==void 0&&(n.layers.mask=e.layers),e.children!==void 0)for(var c=e.children,f=0;f<c.length;f++)n.add(i.parseObject(c[f],t,r));if(e.type==="LOD")for(var l=e.levels,h=0;h<l.length;h++){var d=l[h],p=n.getObjectByProperty("uuid",d.object);p!==void 0&&n.addLevel(p,d.distance)}return n}});var I2={UVMapping:_d,CubeReflectionMapping:wd,CubeRefractionMapping:Ih,EquirectangularReflectionMapping:xg,EquirectangularRefractionMapping:Rh,SphericalReflectionMapping:_g,CubeUVReflectionMapping:Ad,CubeUVRefractionMapping:Sd},ov={RepeatWrapping:Jn,ClampToEdgeWrapping:bi,MirroredRepeatWrapping:mo},sv={NearestFilter:vr,NearestMipMapNearestFilter:Md,NearestMipMapLinearFilter:Cd,LinearFilter:Dr,LinearMipMapNearestFilter:wg,LinearMipMapLinearFilter:Ff};function Qg(){this.type="ShapePath",this.color=new Oe,this.subPaths=[],this.currentPath=null}Object.assign(Qg.prototype,{moveTo:function(e,t){this.currentPath=new tn,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,r,i){this.currentPath.quadraticCurveTo(e,t,r,i)},bezierCurveTo:function(e,t,r,i,n,a){this.currentPath.bezierCurveTo(e,t,r,i,n,a)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function r(Z){for(var Q=[],N=0,D=Z.length;N<D;N++){var W=Z[N],L=new Ta;L.curves=W.curves,Q.push(L)}return Q}function i(Z,Q){for(var N=Q.length,D=!1,W=N-1,L=0;L<N;W=L++){var U=Q[W],k=Q[L],ee=k.x-U.x,K=k.y-U.y;if(Math.abs(K)>Number.EPSILON){if(K<0&&(U=Q[L],ee=-ee,k=Q[W],K=-K),Z.y<U.y||Z.y>k.y)continue;if(Z.y===U.y){if(Z.x===U.x)return!0}else{var te=K*(Z.x-U.x)-ee*(Z.y-U.y);if(te===0)return!0;if(te<0)continue;D=!D}}else{if(Z.y!==U.y)continue;if(k.x<=Z.x&&Z.x<=U.x||U.x<=Z.x&&Z.x<=k.x)return!0}}return D}var n=ta.isClockWise,a=this.subPaths;if(a.length===0)return[];if(t===!0)return r(a);var o,s,u,c=[];if(a.length===1)return s=a[0],u=new Ta,u.curves=s.curves,c.push(u),c;var f=!n(a[0].getPoints());f=e?!f:f;var l=[],h=[],d=[],p=0,v;h[p]=void 0,d[p]=[];for(var m=0,g=a.length;m<g;m++)s=a[m],v=s.getPoints(),o=n(v),o=e?!o:o,o?(!f&&h[p]&&p++,h[p]={s:new Ta,p:v},h[p].s.curves=s.curves,f&&p++,d[p]=[]):d[p].push({h:s,p:v[0]});if(!h[0])return r(a);if(h.length>1){for(var x=!1,y=[],b=0,_=h.length;b<_;b++)l[b]=[];for(var b=0,_=h.length;b<_;b++)for(var w=d[b],A=0;A<w.length;A++){for(var S=w[A],M=!0,E=0;E<h.length;E++)i(S.p,h[E].p)&&(b!==E&&y.push({froms:b,tos:E,hole:A}),M?(M=!1,l[E].push(S)):x=!0);M&&l[b].push(S)}y.length>0&&(x||(d=l))}for(var T,m=0,H=h.length;m<H;m++){u=h[m].s,c.push(u),T=d[m];for(var X=0,q=T.length;X<q;X++)u.holes.push(T[X].h)}return c}});function $g(e){this.type="Font",this.data=e}Object.assign($g.prototype,{isFont:!0,generateShapes:function(e,t){t===void 0&&(t=100);for(var r=[],i=R2(e,t,this.data),n=0,a=i.length;n<a;n++)Array.prototype.push.apply(r,i[n].toShapes());return r}});function R2(e,t,r){for(var i=Array.from?Array.from(e):String(e).split(""),n=t/r.resolution,a=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*n,o=[],s=0,u=0,c=0;c<i.length;c++){var f=i[c];if(f===`
`)s=0,u-=a;else{var l=L2(f,n,s,u,r);s+=l.offsetX,o.push(l.path)}}return o}function L2(e,t,r,i,n){var a=n.glyphs[e]||n.glyphs["?"];if(a){var o=new Qg,s,u,c,f,l,h,d,p;if(a.o)for(var v=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),m=0,g=v.length;m<g;){var x=v[m++];switch(x){case"m":s=v[m++]*t+r,u=v[m++]*t+i,o.moveTo(s,u);break;case"l":s=v[m++]*t+r,u=v[m++]*t+i,o.lineTo(s,u);break;case"q":c=v[m++]*t+r,f=v[m++]*t+i,l=v[m++]*t+r,h=v[m++]*t+i,o.quadraticCurveTo(l,h,c,f);break;case"b":c=v[m++]*t+r,f=v[m++]*t+i,l=v[m++]*t+r,h=v[m++]*t+i,d=v[m++]*t+r,p=v[m++]*t+i,o.bezierCurveTo(l,h,d,p,c,f);break}}return{offsetX:a.ha*t,path:o}}}function O2(e){this.manager=e!==void 0?e:Ci}Object.assign(O2.prototype,{load:function(e,t,r,i){var n=this,a=new zn(this.manager);a.setPath(this.path),a.load(e,function(o){var s;try{s=JSON.parse(o)}catch{console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),s=JSON.parse(o.substring(65,o.length-2))}var u=n.parse(s);t&&t(u)},r,i)},parse:function(e){return new $g(e)},setPath:function(e){return this.path=e,this}});var Ju,e0={getContext:function(){return Ju===void 0&&(Ju=new(window.AudioContext||window.webkitAudioContext)),Ju},setContext:function(e){Ju=e}};function t0(e){this.manager=e!==void 0?e:Ci}Object.assign(t0.prototype,{load:function(e,t,r,i){var n=new zn(this.manager);n.setResponseType("arraybuffer"),n.load(e,function(a){var o=a.slice(0),s=e0.getContext();s.decodeAudioData(o,function(u){t(u)})},r,i)}});function r0(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new xr,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new xr,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}Object.assign(r0.prototype,{update:function(){var e,t,r,i,n,a,o,s,u=new Ae,c=new Ae;return function(l){var h=e!==this||t!==l.focus||r!==l.fov||i!==l.aspect*this.aspect||n!==l.near||a!==l.far||o!==l.zoom||s!==this.eyeSep;if(h){e=this,t=l.focus,r=l.fov,i=l.aspect*this.aspect,n=l.near,a=l.far,o=l.zoom;var d=l.projectionMatrix.clone();s=this.eyeSep/2;var p=s*n/t,v=n*Math.tan(Pt.DEG2RAD*r*.5)/o,m,g;c.elements[12]=-s,u.elements[12]=s,m=-v*i+p,g=v*i+p,d.elements[0]=2*n/(g-m),d.elements[8]=(g+m)/(g-m),this.cameraL.projectionMatrix.copy(d),m=-v*i-p,g=v*i-p,d.elements[0]=2*n/(g-m),d.elements[8]=(g+m)/(g-m),this.cameraR.projectionMatrix.copy(d)}this.cameraL.matrixWorld.copy(l.matrixWorld).multiply(c),this.cameraR.matrixWorld.copy(l.matrixWorld).multiply(u)}}()});function lf(e,t,r){Ge.call(this),this.type="CubeCamera";var i=90,n=1,a=new xr(i,n,e,t);a.up.set(0,-1,0),a.lookAt(new I(1,0,0)),this.add(a);var o=new xr(i,n,e,t);o.up.set(0,-1,0),o.lookAt(new I(-1,0,0)),this.add(o);var s=new xr(i,n,e,t);s.up.set(0,0,1),s.lookAt(new I(0,1,0)),this.add(s);var u=new xr(i,n,e,t);u.up.set(0,0,-1),u.lookAt(new I(0,-1,0)),this.add(u);var c=new xr(i,n,e,t);c.up.set(0,-1,0),c.lookAt(new I(0,0,1)),this.add(c);var f=new xr(i,n,e,t);f.up.set(0,-1,0),f.lookAt(new I(0,0,-1)),this.add(f);var l={format:Bs,magFilter:Dr,minFilter:Dr};this.renderTarget=new ks(r,r,l),this.renderTarget.texture.name="CubeCamera",this.update=function(h,d){this.parent===null&&this.updateMatrixWorld();var p=this.renderTarget,v=p.texture.generateMipmaps;p.texture.generateMipmaps=!1,p.activeCubeFace=0,h.render(d,a,p),p.activeCubeFace=1,h.render(d,o,p),p.activeCubeFace=2,h.render(d,s,p),p.activeCubeFace=3,h.render(d,u,p),p.activeCubeFace=4,h.render(d,c,p),p.texture.generateMipmaps=v,p.activeCubeFace=5,h.render(d,f,p),h.setRenderTarget(null)},this.clear=function(h,d,p,v){for(var m=this.renderTarget,g=0;g<6;g++)m.activeCubeFace=g,h.setRenderTarget(m),h.clear(d,p,v);h.setRenderTarget(null)}}lf.prototype=Object.create(Ge.prototype);lf.prototype.constructor=lf;function uv(){Ge.call(this),this.type="AudioListener",this.context=e0.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}uv.prototype=Object.assign(Object.create(Ge.prototype),{constructor:uv,getInput:function(){return this.gain},removeFilter:function(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(){var e=new I,t=new er,r=new I,i=new I;return function(a){Ge.prototype.updateMatrixWorld.call(this,a);var o=this.context.listener,s=this.up;this.matrixWorld.decompose(e,t,r),i.set(0,0,-1).applyQuaternion(t),o.positionX?(o.positionX.setValueAtTime(e.x,this.context.currentTime),o.positionY.setValueAtTime(e.y,this.context.currentTime),o.positionZ.setValueAtTime(e.z,this.context.currentTime),o.forwardX.setValueAtTime(i.x,this.context.currentTime),o.forwardY.setValueAtTime(i.y,this.context.currentTime),o.forwardZ.setValueAtTime(i.z,this.context.currentTime),o.upX.setValueAtTime(s.x,this.context.currentTime),o.upY.setValueAtTime(s.y,this.context.currentTime),o.upZ.setValueAtTime(s.z,this.context.currentTime)):(o.setPosition(e.x,e.y,e.z),o.setOrientation(i.x,i.y,i.z,s.x,s.y,s.z))}}()});function lu(e){Ge.call(this),this.type="Audio",this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}lu.prototype=Object.assign(Object.create(Ge.prototype),{constructor:lu,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),e.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset),this.isPlaying=!0,this.source=e,this.connect()},pause:function(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this},stop:function(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this},connect:function(){var e=this;if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,r=this.filters.length;t<r;t++)e.filters[t-1].connect(e.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){var e=this;if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,r=this.filters.length;t<r;t++)e.filters[t-1].disconnect(e.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),this.isPlaying===!0?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}});function cv(e){lu.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}cv.prototype=Object.assign(Object.create(lu.prototype),{constructor:cv,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this},updateMatrixWorld:function(){var e=new I,t=new er,r=new I,i=new I;return function(a){Ge.prototype.updateMatrixWorld.call(this,a);var o=this.panner;this.matrixWorld.decompose(e,t,r),i.set(0,0,1).applyQuaternion(t),o.setPosition(e.x,e.y,e.z),o.setOrientation(i.x,i.y,i.z)}}()});function i0(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t!==void 0?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}Object.assign(i0.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),r=0;r<t.length;r++)e+=t[r];return e/t.length}});function n0(e,t,r){this.binding=e,this.valueSize=r;var i=Float64Array,n;switch(t){case"quaternion":n=this._slerp;break;case"string":case"bool":i=Array,n=this._select;break;default:n=this._lerp}this.buffer=new i(r*4),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Object.assign(n0.prototype,{accumulate:function(e,t){var r=this.buffer,i=this.valueSize,n=e*i+i,a=this.cumulativeWeight;if(a===0){for(var o=0;o!==i;++o)r[n+o]=r[o];a=t}else{a+=t;var s=t/a;this._mixBufferRegion(r,n,0,s,i)}this.cumulativeWeight=a},apply:function(e){var t=this.valueSize,r=this.buffer,i=e*t+t,n=this.cumulativeWeight,a=this.binding;if(this.cumulativeWeight=0,n<1){var o=t*3;this._mixBufferRegion(r,i,o,1-n,t)}for(var s=t,u=t+t;s!==u;++s)if(r[s]!==r[s+t]){a.setValue(r,i);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,r=this.valueSize,i=r*3;e.getValue(t,i);for(var n=r,a=i;n!==a;++n)t[n]=t[i+n%r];this.cumulativeWeight=0},restoreOriginalState:function(){var e=this.valueSize*3;this.binding.setValue(this.buffer,e)},_select:function(e,t,r,i,n){if(i>=.5)for(var a=0;a!==n;++a)e[t+a]=e[r+a]},_slerp:function(e,t,r,i){er.slerpFlat(e,t,e,t,e,r,i)},_lerp:function(e,t,r,i,n){for(var a=1-i,o=0;o!==n;++o){var s=t+o;e[s]=e[s]*a+e[r+o]*i}}});var El="\\[\\]\\.:\\/";function a0(e,t,r){var i=r||Kr.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}Object.assign(a0.prototype,{getValue:function(e,t){this.bind();var r=this._targetGroup.nCachedObjects_,i=this._bindings[r];i!==void 0&&i.getValue(e,t)},setValue:function(e,t){for(var r=this._bindings,i=this._targetGroup.nCachedObjects_,n=r.length;i!==n;++i)r[i].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}});function Kr(e,t,r){this.path=t,this.parsedPath=r||Kr.parseTrackName(t),this.node=Kr.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}Object.assign(Kr,{Composite:a0,create:function(e,t,r){return e&&e.isAnimationObjectGroup?new Kr.Composite(e,t,r):new Kr(e,t,r)},sanitizeNodeName:function(){var e=new RegExp("["+El+"]","g");return function(r){return r.replace(/\s/g,"_").replace(e,"")}}(),parseTrackName:function(){var e="[^"+El+"]",t="[^"+El.replace("\\.","")+"]",r=/((?:WC+[\/:])*)/.source.replace("WC",e),i=/(WCOD+)?/.source.replace("WCOD",t),n=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",e),a=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",e),o=new RegExp("^"+r+i+n+a+"$"),s=["material","materials","bones"];return function(c){var f=o.exec(c);if(!f)throw new Error("PropertyBinding: Cannot parse trackName: "+c);var l={nodeName:f[2],objectName:f[3],objectIndex:f[4],propertyName:f[5],propertyIndex:f[6]},h=l.nodeName&&l.nodeName.lastIndexOf(".");if(h!==void 0&&h!==-1){var d=l.nodeName.substring(h+1);s.indexOf(d)!==-1&&(l.nodeName=l.nodeName.substring(0,h),l.objectName=d)}if(l.propertyName===null||l.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+c);return l}}(),findNode:function(e,t){if(!t||t===""||t==="root"||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){var r=e.skeleton.getBoneByName(t);if(r!==void 0)return r}if(e.children){var i=function(a){for(var o=0;o<a.length;o++){var s=a[o];if(s.name===t||s.uuid===t)return s;var u=i(s.children);if(u)return u}return null},n=i(e.children);if(n)return n}return null}});Object.assign(Kr.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,r){t[r]=this.node[this.propertyName]},function(t,r){for(var i=this.resolvedProperty,n=0,a=i.length;n!==a;++n)t[r++]=i[n]},function(t,r){t[r]=this.resolvedProperty[this.propertyIndex]},function(t,r){this.resolvedProperty.toArray(t,r)}],SetterByBindingTypeAndVersioning:[[function(t,r){this.targetObject[this.propertyName]=t[r]},function(t,r){this.targetObject[this.propertyName]=t[r],this.targetObject.needsUpdate=!0},function(t,r){this.targetObject[this.propertyName]=t[r],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,r){for(var i=this.resolvedProperty,n=0,a=i.length;n!==a;++n)i[n]=t[r++]},function(t,r){for(var i=this.resolvedProperty,n=0,a=i.length;n!==a;++n)i[n]=t[r++];this.targetObject.needsUpdate=!0},function(t,r){for(var i=this.resolvedProperty,n=0,a=i.length;n!==a;++n)i[n]=t[r++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,r){this.resolvedProperty[this.propertyIndex]=t[r]},function(t,r){this.resolvedProperty[this.propertyIndex]=t[r],this.targetObject.needsUpdate=!0},function(t,r){this.resolvedProperty[this.propertyIndex]=t[r],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,r){this.resolvedProperty.fromArray(t,r)},function(t,r){this.resolvedProperty.fromArray(t,r),this.targetObject.needsUpdate=!0},function(t,r){this.resolvedProperty.fromArray(t,r),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,r){this.bind(),this.getValue(t,r)},setValue:function(t,r){this.bind(),this.setValue(t,r)},bind:function(){var e=this.node,t=this.parsedPath,r=t.objectName,i=t.propertyName,n=t.propertyIndex;if(e||(e=Kr.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(r){var a=t.objectIndex;switch(r){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(var o=0;o<e.length;o++)if(e[o].name===a){a=o;break}break;default:if(e[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(a!==void 0){if(e[a]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[a]}}var s=e[i];if(s===void 0){var u=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+i+" but it wasn't found.",e);return}var c=this.Versioning.None;e.needsUpdate!==void 0?(c=this.Versioning.NeedsUpdate,this.targetObject=e):e.matrixWorldNeedsUpdate!==void 0&&(c=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=e);var f=this.BindingType.Direct;if(n!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}for(var o=0;o<this.node.geometry.morphAttributes.position.length;o++)if(e.geometry.morphAttributes.position[o].name===n){n=o;break}}else{if(!e.geometry.morphTargets){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);return}for(var o=0;o<this.node.geometry.morphTargets.length;o++)if(e.geometry.morphTargets[o].name===n){n=o;break}}}f=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else s.fromArray!==void 0&&s.toArray!==void 0?(f=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(f=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[f],this.setValue=this.SetterByBindingTypeAndVersioning[f][c]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}});//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(Kr.prototype,{_getValue_unbound:Kr.prototype.getValue,_setValue_unbound:Kr.prototype.setValue});function D2(){var e=arguments;this.uuid=Pt.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var r=0,i=arguments.length;r!==i;++r)t[e[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}Object.assign(D2.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=arguments,t=this._objects,r=t.length,i=this.nCachedObjects_,n=this._indicesByUUID,a=this._paths,o=this._parsedPaths,s=this._bindings,u=s.length,c=void 0,f=0,l=arguments.length;f!==l;++f){var h=e[f],d=h.uuid,p=n[d];if(p===void 0){p=r++,n[d]=p,t.push(h);for(var v=0,m=u;v!==m;++v)s[v].push(new Kr(h,a[v],o[v]))}else if(p<i){c=t[p];var g=--i,x=t[g];n[x.uuid]=p,t[p]=x,n[d]=g,t[g]=h;for(var v=0,m=u;v!==m;++v){var y=s[v],b=y[g],_=y[p];y[p]=b,_===void 0&&(_=new Kr(h,a[v],o[v])),y[g]=_}}else t[p]!==c&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=i},remove:function(){for(var e=arguments,t=this._objects,r=this.nCachedObjects_,i=this._indicesByUUID,n=this._bindings,a=n.length,o=0,s=arguments.length;o!==s;++o){var u=e[o],c=u.uuid,f=i[c];if(f!==void 0&&f>=r){var l=r++,h=t[l];i[h.uuid]=f,t[f]=h,i[c]=l,t[l]=u;for(var d=0,p=a;d!==p;++d){var v=n[d],m=v[l],g=v[f];v[f]=m,v[l]=g}}}this.nCachedObjects_=r},uncache:function(){for(var e=arguments,t=this._objects,r=t.length,i=this.nCachedObjects_,n=this._indicesByUUID,a=this._bindings,o=a.length,s=0,u=arguments.length;s!==u;++s){var c=e[s],f=c.uuid,l=n[f];if(l!==void 0)if(delete n[f],l<i){var h=--i,d=t[h],p=--r,v=t[p];n[d.uuid]=l,t[l]=d,n[v.uuid]=h,t[h]=v,t.pop();for(var m=0,g=o;m!==g;++m){var x=a[m],y=x[h],b=x[p];x[l]=y,x[h]=b,x.pop()}}else{var p=--r,v=t[p];n[v.uuid]=l,t[l]=v,t.pop();for(var m=0,g=o;m!==g;++m){var x=a[m];x[l]=x[p],x.pop()}}}this.nCachedObjects_=i},subscribe_:function(e,t){var r=this._bindingsIndicesByPath,i=r[e],n=this._bindings;if(i!==void 0)return n[i];var a=this._paths,o=this._parsedPaths,s=this._objects,u=s.length,c=this.nCachedObjects_,f=new Array(u);i=n.length,r[e]=i,a.push(e),o.push(t),n.push(f);for(var l=c,h=s.length;l!==h;++l){var d=s[l];f[l]=new Kr(d,e,t)}return f},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,r=t[e];if(r!==void 0){var i=this._paths,n=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o],u=e[o];t[u]=r,a[r]=s,a.pop(),n[r]=n[o],n.pop(),i[r]=i[o],i.pop()}}});function o0(e,t,r){this._mixer=e,this._clip=t,this._localRoot=r||null;for(var i=t.tracks,n=i.length,a=new Array(n),o={endingStart:yo,endingEnd:yo},s=0;s!==n;++s){var u=i[s].createInterpolant(null);a[s]=u,u.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(n),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Mb,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}Object.assign(o0.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){var i=this._clip.duration,n=e._clip.duration,a=n/i,o=i/n;e.warp(1,a,t),this.warp(o,1,t)}return this},crossFadeTo:function(e,t,r){return e.crossFadeFrom(this,t,r)},stopFading:function(){var e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,r){var i=this._mixer,n=i.time,a=this._timeScaleInterpolant,o=this.timeScale;a===null&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);var s=a.parameterPositions,u=a.sampleValues;return s[0]=n,s[1]=n+r,u[0]=e/o,u[1]=t/o,this},stopWarping:function(){var e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,r,i){if(!this.enabled){this._updateWeight(e);return}var n=this._startTime;if(n!==null){var a=(e-n)*r;if(a<0||r===0)return;this._startTime=null,t=r*a}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var u=this._interpolants,c=this._propertyBindings,f=0,l=u.length;f!==l;++f)u[f].evaluate(o),c[f].accumulate(i,s)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var r=this._weightInterpolant;if(r!==null){var i=r.evaluate(e)[0];t*=i,e>r.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var r=this._timeScaleInterpolant;if(r!==null){var i=r.evaluate(e)[0];t*=i,e>r.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e,r=this._clip.duration,i=this.loop,n=this._loopCount,a=i===Cb;if(e===0)return n===-1?t:a&&(n&1)===1?r-t:t;if(i===Sb){n===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=r)t=r;else if(t<0)t=0;else break e;this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(n===-1&&(e>=0?(n=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),t>=r||t<0){var o=Math.floor(t/r);t-=r*o,n+=Math.abs(o);var s=this.repetitions-n;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?r:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(s===1){var u=e<0;this._setEndings(u,!u,a)}else this._setEndings(!1,!1,a);this._loopCount=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}if(a&&(n&1)===1)return this.time=t,r-t}return this.time=t,t},_setEndings:function(e,t,r){var i=this._interpolantSettings;r?(i.endingStart=uo,i.endingEnd=uo):(e?i.endingStart=this.zeroSlopeAtStart?uo:yo:i.endingStart=Oc,t?i.endingEnd=this.zeroSlopeAtEnd?uo:yo:i.endingEnd=Oc)},_scheduleFading:function(e,t,r){var i=this._mixer,n=i.time,a=this._weightInterpolant;a===null&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=n,s[0]=t,o[1]=n+e,s[1]=r,this}});function fv(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}fv.prototype=Object.assign(Object.create(fa.prototype),{constructor:fv,_bindAction:function(e,t){var r=this,i=e._localRoot||this._root,n=e._clip.tracks,a=n.length,o=e._propertyBindings,s=e._interpolants,u=i.uuid,c=this._bindingsByRootAndName,f=c[u];f===void 0&&(f={},c[u]=f);for(var l=0;l!==a;++l){var h=n[l],d=h.name,p=f[d];if(p!==void 0)o[l]=p;else{if(p=o[l],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,r._addInactiveBinding(p,u,d));continue}var v=t&&t._propertyBindings[l].binding.parsedPath;p=new n0(Kr.create(i,d,v),h.ValueTypeName,h.getValueSize()),++p.referenceCount,r._addInactiveBinding(p,u,d),o[l]=p}s[l].resultBuffer=p.buffer}},_activateAction:function(e){var t=this;if(!this._isActiveAction(e)){if(e._cacheIndex===null){var r=(e._localRoot||this._root).uuid,i=e._clip.uuid,n=this._actionsByClip[i];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,i,r)}for(var a=e._propertyBindings,o=0,s=a.length;o!==s;++o){var u=a[o];u.useCount++===0&&(t._lendBinding(u),u.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){var t=this;if(this._isActiveAction(e)){for(var r=e._propertyBindings,i=0,n=r.length;i!==n;++i){var a=r[i];--a.useCount===0&&(a.restoreOriginalState(),t._takeBackBinding(a))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return t!==null&&t<this._nActiveActions},_addInactiveAction:function(e,t,r){var i=this._actions,n=this._actionsByClip,a=n[t];if(a===void 0)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=a;else{var o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[r]=e},_removeInactiveAction:function(e){var t=this._actions,r=t[t.length-1],i=e._cacheIndex;r._cacheIndex=i,t[i]=r,t.pop(),e._cacheIndex=null;var n=e._clip.uuid,a=this._actionsByClip,o=a[n],s=o.knownActions,u=s[s.length-1],c=e._byClipCacheIndex;u._byClipCacheIndex=c,s[c]=u,s.pop(),e._byClipCacheIndex=null;var f=o.actionByRoot,l=(e._localRoot||this._root).uuid;delete f[l],s.length===0&&delete a[n],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=this,r=e._propertyBindings,i=0,n=r.length;i!==n;++i){var a=r[i];--a.referenceCount===0&&t._removeInactiveBinding(a)}},_lendAction:function(e){var t=this._actions,r=e._cacheIndex,i=this._nActiveActions++,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n},_takeBackAction:function(e){var t=this._actions,r=e._cacheIndex,i=--this._nActiveActions,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n},_addInactiveBinding:function(e,t,r){var i=this._bindingsByRootAndName,n=i[t],a=this._bindings;n===void 0&&(n={},i[t]=n),n[r]=e,e._cacheIndex=a.length,a.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,r=e.binding,i=r.rootNode.uuid,n=r.path,a=this._bindingsByRootAndName,o=a[i],s=t[t.length-1],u=e._cacheIndex;s._cacheIndex=u,t[u]=s,t.pop(),delete o[n];e:{for(var c in o)break e;delete a[i]}},_lendBinding:function(e){var t=this._bindings,r=e._cacheIndex,i=this._nActiveBindings++,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n},_takeBackBinding:function(e){var t=this._bindings,r=e._cacheIndex,i=--this._nActiveBindings,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return r===void 0&&(r=new cf(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),r.__cacheIndex=t,e[t]=r),r},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,r=e.__cacheIndex,i=--this._nActiveControlInterpolants,n=t[i];e.__cacheIndex=i,t[i]=e,n.__cacheIndex=r,t[r]=n},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var r=t||this._root,i=r.uuid,n=typeof e=="string"?Ni.findByName(r,e):e,a=n!==null?n.uuid:e,o=this._actionsByClip[a],s=null;if(o!==void 0){var u=o.actionByRoot[i];if(u!==void 0)return u;s=o.knownActions[0],n===null&&(n=s._clip)}if(n===null)return null;var c=new o0(this,n,t);return this._bindAction(c,s),this._addInactiveAction(c,a,i),c},existingAction:function(e,t){var r=t||this._root,i=r.uuid,n=typeof e=="string"?Ni.findByName(r,e):e,a=n?n.uuid:e,o=this._actionsByClip[a];return o!==void 0&&o.actionByRoot[i]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,r=this._bindings,i=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var n=0;n!==t;++n)e[n].reset();for(var n=0;n!==i;++n)r[n].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,r=this._nActiveActions,i=this.time+=e,n=Math.sign(e),a=this._accuIndex^=1,o=0;o!==r;++o){var s=t[o];s._update(i,e,n,a)}for(var u=this._bindings,c=this._nActiveBindings,o=0;o!==c;++o)u[o].apply(a);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this,r=this._actions,i=e.uuid,n=this._actionsByClip,a=n[i];if(a!==void 0){for(var o=a.knownActions,s=0,u=o.length;s!==u;++s){var c=o[s];t._deactivateAction(c);var f=c._cacheIndex,l=r[r.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,l._cacheIndex=f,r[f]=l,r.pop(),t._removeInactiveBindingsForAction(c)}delete n[i]}},uncacheRoot:function(e){var t=this,r=e.uuid,i=this._actionsByClip;for(var n in i){var a=i[n].actionByRoot,o=a[r];o!==void 0&&(t._deactivateAction(o),t._removeInactiveAction(o))}var s=this._bindingsByRootAndName,u=s[r];if(u!==void 0)for(var c in u){var f=u[c];f.restoreOriginalState(),t._removeInactiveBinding(f)}},uncacheAction:function(e,t){var r=this.existingAction(e,t);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}});function hu(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}hu.prototype.clone=function(){return new hu(this.value.clone===void 0?this.value:this.value.clone())};function lv(){Ue.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}lv.prototype=Object.assign(Object.create(Ue.prototype),{constructor:lv,isInstancedBufferGeometry:!0,copy:function(e){return Ue.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return new this.constructor().copy(this)}});function hv(e,t,r){_o.call(this,e,t),this.meshPerAttribute=r||1}hv.prototype=Object.assign(Object.create(_o.prototype),{constructor:hv,isInstancedInterleavedBuffer:!0,copy:function(e){return _o.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}});function dv(e,t,r){ft.call(this,e,t),this.meshPerAttribute=r||1}dv.prototype=Object.assign(Object.create(ft.prototype),{constructor:dv,isInstancedBufferAttribute:!0,copy:function(e){return ft.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}});function F2(e,t,r,i){this.ray=new zo(e,t),this.near=r||0,this.far=i||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function pv(e,t){return e.distance-t.distance}function id(e,t,r,i){if(e.visible!==!1&&(e.raycast(t,r),i===!0))for(var n=e.children,a=0,o=n.length;a<o;a++)id(n[a],t,r,!0)}Object.assign(F2.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,r){var i=r||[];return id(e,this,i,t),i.sort(pv),i},intersectObjects:function(e,t,r){var i=this,n=r||[];if(Array.isArray(e)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var a=0,o=e.length;a<o;a++)id(e[a],i,n,t);return n.sort(pv),n}});function B2(e){this.autoStart=e!==void 0?e:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(B2.prototype,{start:function(){this.startTime=(typeof performance>"u"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=(typeof performance>"u"?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}});function N2(e,t,r){return this.radius=e!==void 0?e:1,this.phi=t!==void 0?t:0,this.theta=r!==void 0?r:0,this}Object.assign(N2.prototype,{set:function(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){var e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this},setFromVector3:function(e){return this.radius=e.length(),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e.x,e.z),this.phi=Math.acos(Pt.clamp(e.y/this.radius,-1,1))),this}});function k2(e,t,r){return this.radius=e!==void 0?e:1,this.theta=t!==void 0?t:0,this.y=r!==void 0?r:0,this}Object.assign(k2.prototype,{set:function(e,t,r){return this.radius=e,this.theta=t,this.y=r,this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.radius=Math.sqrt(e.x*e.x+e.z*e.z),this.theta=Math.atan2(e.x,e.z),this.y=e.y,this}});function s0(e,t){this.min=e!==void 0?e:new Ee(1/0,1/0),this.max=t!==void 0?t:new Ee(-1/0,-1/0)}Object.assign(s0.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){var t=this;this.makeEmpty();for(var r=0,i=e.length;r<i;r++)t.expandByPoint(e[r]);return this},setFromCenterAndSize:function(){var e=new Ee;return function(r,i){var n=e.copy(i).multiplyScalar(.5);return this.min.copy(r).sub(n),this.max.copy(r).add(n),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return e===void 0&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Ee),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return e===void 0&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Ee),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return t===void 0&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Ee),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return t===void 0&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Ee),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Ee;return function(r){var i=e.copy(r).clamp(this.min,this.max);return i.sub(r).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});function u0(e,t){this.start=e!==void 0?e:new I,this.end=t!==void 0?t:new I}Object.assign(u0.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return e===void 0&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new I),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return e===void 0&&(console.warn("THREE.Line3: .delta() target is now required"),e=new I),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return t===void 0&&(console.warn("THREE.Line3: .at() target is now required"),t=new I),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new I,t=new I;return function(i,n){e.subVectors(i,this.start),t.subVectors(this.end,this.start);var a=t.dot(t),o=t.dot(e),s=o/a;return n&&(s=Pt.clamp(s,0,1)),s}}(),closestPointToPoint:function(e,t,r){var i=this.closestPointToPointParameter(e,t);return r===void 0&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new I),this.delta(r).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}});function hf(e){Ge.call(this),this.material=e,this.render=function(){}}hf.prototype=Object.create(Ge.prototype);hf.prototype.constructor=hf;hf.prototype.isImmediateRenderObject=!0;function df(e,t,r,i){this.object=e,this.size=t!==void 0?t:1;var n=r!==void 0?r:16711680,a=i!==void 0?i:1,o=0,s=this.object.geometry;s&&s.isGeometry?o=s.faces.length*3:s&&s.isBufferGeometry&&(o=s.attributes.normal.count);var u=new Ue,c=new ze(o*2*3,3);u.addAttribute("position",c),ar.call(this,u,new fr({color:n,linewidth:a})),this.matrixAutoUpdate=!1,this.update()}df.prototype=Object.create(ar.prototype);df.prototype.constructor=df;df.prototype.update=function(){var e=new I,t=new I,r=new Ur;return function(){var n=this,a=["a","b","c"];this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);var o=this.object.matrixWorld,s=this.geometry.attributes.position,u=this.object.geometry;if(u&&u.isGeometry)for(var c=u.vertices,f=u.faces,l=0,h=0,d=f.length;h<d;h++)for(var p=f[h],v=0,m=p.vertexNormals.length;v<m;v++){var g=c[p[a[v]]],x=p.vertexNormals[v];e.copy(g).applyMatrix4(o),t.copy(x).applyMatrix3(r).normalize().multiplyScalar(n.size).add(e),s.setXYZ(l,e.x,e.y,e.z),l=l+1,s.setXYZ(l,t.x,t.y,t.z),l=l+1}else if(u&&u.isBufferGeometry)for(var y=u.attributes.position,b=u.attributes.normal,l=0,v=0,m=y.count;v<m;v++)e.set(y.getX(v),y.getY(v),y.getZ(v)).applyMatrix4(o),t.set(b.getX(v),b.getY(v),b.getZ(v)),t.applyMatrix3(r).normalize().multiplyScalar(n.size).add(e),s.setXYZ(l,e.x,e.y,e.z),l=l+1,s.setXYZ(l,t.x,t.y,t.z),l=l+1;s.needsUpdate=!0}}();function du(e,t){Ge.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var r=new Ue,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],n=0,a=1,o=32;n<o;n++,a++){var s=n/o*Math.PI*2,u=a/o*Math.PI*2;i.push(Math.cos(s),Math.sin(s),1,Math.cos(u),Math.sin(u),1)}r.addAttribute("position",new ze(i,3));var c=new fr({fog:!1});this.cone=new ar(r,c),this.add(this.cone),this.update()}du.prototype=Object.create(Ge.prototype);du.prototype.constructor=du;du.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()};du.prototype.update=function(){var e=new I,t=new I;return function(){this.light.updateMatrixWorld();var i=this.light.distance?this.light.distance:1e3,n=i*Math.tan(this.light.angle);this.cone.scale.set(n,n,i),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}();function c0(e){var t=[];e&&e.isBone&&t.push(e);for(var r=0;r<e.children.length;r++)t.push.apply(t,c0(e.children[r]));return t}function pu(e){for(var t=c0(e),r=new Ue,i=[],n=[],a=new Oe(0,0,1),o=new Oe(0,1,0),s=0;s<t.length;s++){var u=t[s];u.parent&&u.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),n.push(a.r,a.g,a.b),n.push(o.r,o.g,o.b))}r.addAttribute("position",new ze(i,3)),r.addAttribute("color",new ze(n,3));var c=new fr({vertexColors:Tn,depthTest:!1,depthWrite:!1,transparent:!0});ar.call(this,r,c),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}pu.prototype=Object.create(ar.prototype);pu.prototype.constructor=pu;pu.prototype.updateMatrixWorld=function(){var e=new I,t=new Ae,r=new Ae;return function(n){var a=this.bones,o=this.geometry,s=o.getAttribute("position");r.getInverse(this.root.matrixWorld);for(var u=0,c=0;u<a.length;u++){var f=a[u];f.parent&&f.parent.isBone&&(t.multiplyMatrices(r,f.matrixWorld),e.setFromMatrixPosition(t),s.setXYZ(c,e.x,e.y,e.z),t.multiplyMatrices(r,f.parent.matrixWorld),e.setFromMatrixPosition(t),s.setXYZ(c+1,e.x,e.y,e.z),c+=2)}o.getAttribute("position").needsUpdate=!0,Ge.prototype.updateMatrixWorld.call(this,n)}}();function vu(e,t,r){this.light=e,this.light.updateMatrixWorld(),this.color=r;var i=new Mo(t,4,2),n=new Ai({wireframe:!0,fog:!1});Jr.call(this,i,n),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}vu.prototype=Object.create(Jr.prototype);vu.prototype.constructor=vu;vu.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()};vu.prototype.update=function(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)};function mu(e,t){Ge.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;var r=new fr({fog:!1}),i=new Ue;i.addAttribute("position",new ft(new Float32Array(5*3),3)),this.line=new li(i,r),this.add(this.line),this.update()}mu.prototype=Object.create(Ge.prototype);mu.prototype.constructor=mu;mu.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()};mu.prototype.update=function(){var e=this.light.width*.5,t=this.light.height*.5,r=this.line.geometry.attributes.position,i=r.array;i[0]=e,i[1]=-t,i[2]=0,i[3]=e,i[4]=t,i[5]=0,i[6]=-e,i[7]=t,i[8]=0,i[9]=-e,i[10]=-t,i[11]=0,i[12]=e,i[13]=-t,i[14]=0,r.needsUpdate=!0,this.color!==void 0?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)};function gu(e,t,r){Ge.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var i=new ka(t);i.rotateY(Math.PI*.5),this.material=new Ai({wireframe:!0,fog:!1}),this.color===void 0&&(this.material.vertexColors=Tn);var n=i.getAttribute("position"),a=new Float32Array(n.count*3);i.addAttribute("color",new ft(a,3)),this.add(new Jr(i,this.material)),this.update()}gu.prototype=Object.create(Ge.prototype);gu.prototype.constructor=gu;gu.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()};gu.prototype.update=function(){var e=new I,t=new Oe,r=new Oe;return function(){var n=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{var a=n.geometry.getAttribute("color");t.copy(this.light.color),r.copy(this.light.groundColor);for(var o=0,s=a.count;o<s;o++){var u=o<s/2?t:r;a.setXYZ(o,u.r,u.g,u.b)}a.needsUpdate=!0}n.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate())}}();function pf(e,t,r,i){e=e||10,t=t||10,r=new Oe(r!==void 0?r:4473924),i=new Oe(i!==void 0?i:8947848);for(var n=t/2,a=e/t,o=e/2,s=[],u=[],c=0,f=0,l=-o;c<=t;c++,l+=a){s.push(-o,0,l,o,0,l),s.push(l,0,-o,l,0,o);var h=c===n?r:i;h.toArray(u,f),f+=3,h.toArray(u,f),f+=3,h.toArray(u,f),f+=3,h.toArray(u,f),f+=3}var d=new Ue;d.addAttribute("position",new ze(s,3)),d.addAttribute("color",new ze(u,3));var p=new fr({vertexColors:Tn});ar.call(this,d,p)}pf.prototype=Object.create(ar.prototype);pf.prototype.constructor=pf;function nd(e,t,r,i,n,a){e=e||10,t=t||16,r=r||8,i=i||64,n=new Oe(n!==void 0?n:4473924),a=new Oe(a!==void 0?a:8947848);var o=[],s=[],u,c,f,l,h,d,p;for(l=0;l<=t;l++)f=l/t*(Math.PI*2),u=Math.sin(f)*e,c=Math.cos(f)*e,o.push(0,0,0),o.push(u,0,c),p=l&1?n:a,s.push(p.r,p.g,p.b),s.push(p.r,p.g,p.b);for(l=0;l<=r;l++)for(p=l&1?n:a,d=e-e/r*l,h=0;h<i;h++)f=h/i*(Math.PI*2),u=Math.sin(f)*d,c=Math.cos(f)*d,o.push(u,0,c),s.push(p.r,p.g,p.b),f=(h+1)/i*(Math.PI*2),u=Math.sin(f)*d,c=Math.cos(f)*d,o.push(u,0,c),s.push(p.r,p.g,p.b);var v=new Ue;v.addAttribute("position",new ze(o,3)),v.addAttribute("color",new ze(s,3));var m=new fr({vertexColors:Tn});ar.call(this,v,m)}nd.prototype=Object.create(ar.prototype);nd.prototype.constructor=nd;function vf(e,t,r,i){this.object=e,this.size=t!==void 0?t:1;var n=r!==void 0?r:16776960,a=i!==void 0?i:1,o=0,s=this.object.geometry;s&&s.isGeometry?o=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var u=new Ue,c=new ze(o*2*3,3);u.addAttribute("position",c),ar.call(this,u,new fr({color:n,linewidth:a})),this.matrixAutoUpdate=!1,this.update()}vf.prototype=Object.create(ar.prototype);vf.prototype.constructor=vf;vf.prototype.update=function(){var e=new I,t=new I,r=new Ur;return function(){var n=this;this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);for(var a=this.object.matrixWorld,o=this.geometry.attributes.position,s=this.object.geometry,u=s.vertices,c=s.faces,f=0,l=0,h=c.length;l<h;l++){var d=c[l],p=d.normal;e.copy(u[d.a]).add(u[d.b]).add(u[d.c]).divideScalar(3).applyMatrix4(a),t.copy(p).applyMatrix3(r).normalize().multiplyScalar(n.size).add(e),o.setXYZ(f,e.x,e.y,e.z),f=f+1,o.setXYZ(f,t.x,t.y,t.z),f=f+1}o.needsUpdate=!0}}();function yu(e,t,r){Ge.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,t===void 0&&(t=1);var i=new Ue;i.addAttribute("position",new ze([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var n=new fr({fog:!1});this.lightPlane=new li(i,n),this.add(this.lightPlane),i=new Ue,i.addAttribute("position",new ze([0,0,0,0,0,1],3)),this.targetLine=new li(i,n),this.add(this.targetLine),this.update()}yu.prototype=Object.create(Ge.prototype);yu.prototype.constructor=yu;yu.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()};yu.prototype.update=function(){var e=new I,t=new I,r=new I;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(t,e),this.lightPlane.lookAt(r),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(r),this.targetLine.scale.z=r.length()}}();function mf(e){var t=new Ue,r=new fr({color:16777215,vertexColors:hg}),i=[],n=[],a={},o=new Oe(16755200),s=new Oe(16711680),u=new Oe(43775),c=new Oe(16777215),f=new Oe(3355443);l("n1","n2",o),l("n2","n4",o),l("n4","n3",o),l("n3","n1",o),l("f1","f2",o),l("f2","f4",o),l("f4","f3",o),l("f3","f1",o),l("n1","f1",o),l("n2","f2",o),l("n3","f3",o),l("n4","f4",o),l("p","n1",s),l("p","n2",s),l("p","n3",s),l("p","n4",s),l("u1","u2",u),l("u2","u3",u),l("u3","u1",u),l("c","t",c),l("p","c",f),l("cn1","cn2",f),l("cn3","cn4",f),l("cf1","cf2",f),l("cf3","cf4",f);function l(d,p,v){h(d,v),h(p,v)}function h(d,p){i.push(0,0,0),n.push(p.r,p.g,p.b),a[d]===void 0&&(a[d]=[]),a[d].push(i.length/3-1)}t.addAttribute("position",new ze(i,3)),t.addAttribute("color",new ze(n,3)),ar.call(this,t,r),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}mf.prototype=Object.create(ar.prototype);mf.prototype.constructor=mf;mf.prototype.update=function(){var e,t,r=new I,i=new Ln;function n(a,o,s,u){r.set(o,s,u).unproject(i);var c=t[a];if(c!==void 0)for(var f=e.getAttribute("position"),l=0,h=c.length;l<h;l++)f.setXYZ(c[l],r.x,r.y,r.z)}return function(){e=this.geometry,t=this.pointMap;var o=1,s=1;i.projectionMatrix.copy(this.camera.projectionMatrix),n("c",0,0,-1),n("t",0,0,1),n("n1",-o,-s,-1),n("n2",o,-s,-1),n("n3",-o,s,-1),n("n4",o,s,-1),n("f1",-o,-s,1),n("f2",o,-s,1),n("f3",-o,s,1),n("f4",o,s,1),n("u1",o*.7,s*1.1,-1),n("u2",-o*.7,s*1.1,-1),n("u3",0,s*2,-1),n("cf1",-o,0,1),n("cf2",o,0,1),n("cf3",0,-s,1),n("cf4",0,s,1),n("cn1",-o,0,-1),n("cn2",o,0,-1),n("cn3",0,-s,-1),n("cn4",0,s,-1),e.getAttribute("position").needsUpdate=!0}}();function bu(e,t){this.object=e,t===void 0&&(t=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(8*3),n=new Ue;n.setIndex(new ft(r,1)),n.addAttribute("position",new ft(i,3)),ar.call(this,n,new fr({color:t})),this.matrixAutoUpdate=!1,this.update()}bu.prototype=Object.create(ar.prototype);bu.prototype.constructor=bu;bu.prototype.update=function(){var e=new ir;return function(r){if(r!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&e.setFromObject(this.object),!e.isEmpty()){var i=e.min,n=e.max,a=this.geometry.attributes.position,o=a.array;o[0]=n.x,o[1]=n.y,o[2]=n.z,o[3]=i.x,o[4]=n.y,o[5]=n.z,o[6]=i.x,o[7]=i.y,o[8]=n.z,o[9]=n.x,o[10]=i.y,o[11]=n.z,o[12]=n.x,o[13]=n.y,o[14]=i.z,o[15]=i.x,o[16]=n.y,o[17]=i.z,o[18]=i.x,o[19]=i.y,o[20]=i.z,o[21]=n.x,o[22]=i.y,o[23]=i.z,a.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}();bu.prototype.setFromObject=function(e){return this.object=e,this.update(),this};function gf(e,t){this.type="Box3Helper",this.box=e;var r=t!==void 0?t:16776960,i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],a=new Ue;a.setIndex(new ft(i,1)),a.addAttribute("position",new ze(n,3)),ar.call(this,a,new fr({color:r})),this.geometry.computeBoundingSphere()}gf.prototype=Object.create(ar.prototype);gf.prototype.constructor=gf;gf.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),Ge.prototype.updateMatrixWorld.call(this,e))};function yf(e,t,r){this.type="PlaneHelper",this.plane=e,this.size=t===void 0?1:t;var i=r!==void 0?r:16776960,n=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],a=new Ue;a.addAttribute("position",new ze(n,3)),a.computeBoundingSphere(),li.call(this,a,new fr({color:i}));var o=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],s=new Ue;s.addAttribute("position",new ze(o,3)),s.computeBoundingSphere(),this.add(new Jr(s,new Ai({color:i,opacity:.2,transparent:!0,depthWrite:!1})))}yf.prototype=Object.create(li.prototype);yf.prototype.constructor=yf;yf.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?ni:Mu,this.lookAt(this.plane.normal),Ge.prototype.updateMatrixWorld.call(this,e)};var Qu,Il;function Fo(e,t,r,i,n,a){Ge.call(this),i===void 0&&(i=16776960),r===void 0&&(r=1),n===void 0&&(n=.2*r),a===void 0&&(a=.2*n),Qu===void 0&&(Qu=new Ue,Qu.addAttribute("position",new ze([0,0,0,0,1,0],3)),Il=new Dn(0,.5,1,5,1),Il.translate(0,-.5,0)),this.position.copy(t),this.line=new li(Qu,new fr({color:i})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Jr(Il,new Ai({color:i})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,n,a)}Fo.prototype=Object.create(Ge.prototype);Fo.prototype.constructor=Fo;Fo.prototype.setDirection=function(){var e=new I,t;return function(i){i.y>.99999?this.quaternion.set(0,0,0,1):i.y<-.99999?this.quaternion.set(1,0,0,0):(e.set(i.z,0,-i.x).normalize(),t=Math.acos(i.y),this.quaternion.setFromAxisAngle(e,t))}}();Fo.prototype.setLength=function(e,t,r){t===void 0&&(t=.2*e),r===void 0&&(r=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()};Fo.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)};function ad(e){e=e||1;var t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new Ue;i.addAttribute("position",new ze(t,3)),i.addAttribute("color",new ze(r,3));var n=new fr({vertexColors:Tn});ar.call(this,i,n)}ad.prototype=Object.create(ar.prototype);ad.prototype.constructor=ad;at.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(at.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e};Object.assign(Qn.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new st,r=0,i=e.length;r<i;r++){var n=e[r];t.vertices.push(new I(n.x,n.y,n.z||0))}return t}});Object.assign(tn.prototype,{fromPoints:function(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}});function f0(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Gi.call(this,e),this.type="catmullrom"}f0.prototype=Object.create(Gi.prototype);Object.assign(f0.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}});pf.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};pu.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Object.assign(fu.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Kg.extractUrlBase(e)}});Object.assign(s0.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}});Object.assign(ir.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}});u0.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)};Object.assign(Pt,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Pt.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Pt.ceilPowerOfTwo(e)}});Object.assign(Ur.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}});Object.assign(Ae.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){var e;return function(){return e===void 0&&(e=new I),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,r,i,n,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,r,n,a)}});Pn.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)};er.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)};Object.assign(zo.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}});Object.assign(xi.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}});Object.assign(xi,{barycoordFromPoint:function(e,t,r,i,n){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),xi.getBarycoord(e,t,r,i,n)},normal:function(e,t,r,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),xi.getNormal(e,t,r,i)}});Object.assign(Ta.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new So(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Co(this,e)}});Object.assign(Ee.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}});Object.assign(I.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}});Object.assign($t.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}});Object.assign(st.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}});Object.assign(Ge.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}});Object.defineProperties(Ge.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Object.defineProperties(kc.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}});Object.defineProperty(zc.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}});Object.defineProperty(at.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}});xr.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),t!==void 0&&(this.filmGauge=t),this.setFocalLength(e)};Object.defineProperties(_r.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}});Object.defineProperties(ft.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}});Object.assign(Ue.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,r){r!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}});Object.defineProperties(Ue.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});Object.assign(On.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}});Object.defineProperties(hu.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}});Object.defineProperties(At.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Oe}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===fg}}});Object.defineProperties(un.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});Object.defineProperties(Gr.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}});Object.assign(Rd.prototype,{animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")}});Object.defineProperties(Rd.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(zg.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(En.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}});Object.defineProperties(Ug.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}}});lu.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this,r=new t0;return r.load(e,function(i){t.setBuffer(i)}),this};i0.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()};lf.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};La.crossOrigin=void 0;La.loadTexture=function(e,t,r,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var n=new Ld;n.setCrossOrigin(this.crossOrigin);var a=n.load(e,r,void 0,i);return t&&(a.mapping=t),a};La.loadTextureCube=function(e,t,r,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var n=new qg;n.setCrossOrigin(this.crossOrigin);var a=n.load(e,r,void 0,i);return t&&(a.mapping=t),a};La.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};La.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};function z2(e){if(!(typeof window>"u")){var t=new RegExp(e+"=([^&#=]*)"),r=t.exec(window.location.search);if(r)return decodeURIComponent(r[1])}}function U2(e){return e?typeof e=="string"?/^1|true|t|yes|y$/i.test(e):!0:!1}function O(e,t){return e!==void 0?e:t}function vi(e,t){var r=Object.assign({},e);for(var i in t){var n=e[i];n===void 0&&(r[i]=t[i])}return r}function l0(e,t){for(var r in t){var i=t[r];i!==void 0&&(e[r]=i)}return e}function h0(){var e=window.location.protocol;return e.match(/http(s)?:/gi)===null?"http:":e}function d0(){if(typeof window>"u")return!1;var e=window.navigator.userAgent;return/Opera|OPR/.test(e)?"Opera":/Chrome/i.test(e)?"Chrome":/Firefox/i.test(e)?"Firefox":/Mobile(\/.*)? Safari/i.test(e)?"Mobile Safari":/MSIE/i.test(e)?"Internet Explorer":/Safari/i.test(e)?"Safari":!1}function G2(e){var t=window.location,r=t.pathname,i=r.substring(0,r.lastIndexOf("/")+1);return t.origin+i+e}function vv(e){var t=window.open(e,"_blank");t||(window.location.href=e)}function H2(e,t){if(t===void 0&&(t="download"),!e)return;var r=d0()==="Safari",i=/CriOS\/[\d]+/.test(window.navigator.userAgent),n=document.createElement("a");function a(u){vv(i?u:u.replace(/^data:[^;]*;/,"data:attachment/file;"))}if(typeof navigator<"u"&&navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(e,t);else if((r||i)&&FileReader)if(e instanceof Blob){var o=new FileReader;o.onloadend=function(){a(o.result)},o.readAsDataURL(e)}else a(e);else{var s=!1;e instanceof Blob&&(e=URL.createObjectURL(e),s=!0),"download"in n?(n.style.display="hidden",document.body.appendChild(n),n.href=e,n.download=t,n.target="_blank",n.click(),document.body.removeChild(n)):vv(e),s&&window.URL.revokeObjectURL(e)}}function V2(e,t){return e<t?-1:e>t?1:0}function Aa(e,t,r){r===void 0&&(r=V2);for(var i=0,n=e.length-1;i<=n;){var a=i+n>>1,o=r(t,e[a]);if(o>0)i=a+1;else if(o<0)n=a-1;else return a}return-i-1}function W2(e,t){var r=e.length-1;if(e[r]<t)return-1;for(var i=0;i<=r;){var n=i+r>>1;e[n]>=t?r=n-1:i=n+1}return r+1}function j2(e,t){if(e[0]>t)return-1;for(var r=0,i=e.length-1;r<=i;){var n=r+i>>1;e[n]>t?i=n-1:r=n+1}return r-1}function Fd(e,t,r){var i=W2(e,t),n=j2(e,r);return i===-1||n===-1||i>n?0:n-i+1}function Bd(e){return e.sort().filter(function(t,r,i){return r===0||t!==i[r-1]})}function Nf(e){var t=28672;if(e.length>t){for(var r=[],i=0;i<e.length;i+=t)r.push(String.fromCharCode.apply(null,e.subarray(i,i+t)));return r.join("")}else return String.fromCharCode.apply(null,e)}function X2(e,t,r){t===void 0&&(t=1024*1024*10),r===void 0&&(r=`
`);for(var i="",n=[],a=0;a<e.length;a+=t){var o=Nf(e.subarray(a,a+t)),s=o.lastIndexOf(r);if(s===-1)i+=o;else{var u=i+o.substr(0,s);n=n.concat(u.split(r)),s===o.length-r.length?i="":i=o.substr(s+r.length)}}return i!==""&&n.push(i),n}function p0(e,t){switch(e){case"int8":return new Int8Array(t);case"int16":return new Int16Array(t);case"int32":return new Int32Array(t);case"uint8":return new Uint8Array(t);case"uint16":return new Uint16Array(t);case"uint32":return new Uint32Array(t);case"float32":return new Float32Array(t);default:throw new Error("arrayType unknown: "+e)}}function dn(e,t){var r=t>65535?Uint32Array:Uint16Array;return new r(e)}function q2(e){return Array.isArray(e)?e:[e]}function Ho(e){return e.buffer&&e.buffer instanceof ArrayBuffer?e.buffer:e}function Y2(e,t){return e instanceof t?e:new t(e)}function kf(e,t){return e===void 0?e=new t:Array.isArray(e)&&(e=new t().fromArray(e)),e}function Z2(e){return kf(e,Ee)}function Ua(e){return kf(e,I)}function Cu(e){return kf(e,Ae)}function od(e){return kf(e,er)}function Rl(e){return Y2(e,Float32Array)}function K2(e){var t=0,r=0,i=[];return{has:function(n){return i.indexOf(n)!==-1},get:function(n){return i[n]},push:function(n){i[t]=n,t=(e+t+1)%e,++r},get count(){return r},get data(){return i.slice(0,Math.min(r,e))},clear:function(){r=0,t=0,i.length=0}}}function J2(){var e={};return{has:function(t){return e[JSON.stringify(t)]!==void 0},add:function(t,r){e[JSON.stringify(t)]=r},del:function(t){delete e[JSON.stringify(t)]},get values(){return Object.keys(e).map(function(t){return e[t]})}}}function v0(e){return O(e,"").toString().toLowerCase()}var Vi=function(t){this.name=t,this._dict={}},m0={names:{configurable:!0}};Vi.prototype.add=function(t,r){this._dict[v0(t)]=r};Vi.prototype.get=function(t){return this._dict[v0(t)]};m0.names.get=function(){return Object.keys(this._dict)};Object.defineProperties(Vi.prototype,m0);function lr(e){return e*.01745}function Q2(e){return e*57.29578}var $2="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),$u=new Array(36);function Nd(){for(var e=0,t,r=0;r<36;r++)r===8||r===13||r===18||r===23?$u[r]="-":r===14?$u[r]="4":(e<=2&&(e=33554432+Math.random()*16777216|0),t=e&15,e=e>>4,$u[r]=$2[r===19?t&3|8:t]);return $u.join("")}function eA(e){return e=e-(e>>1&1431655765),e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>24}function tA(e,t,r){return(e-t)/(r-t)}function kd(e,t,r){return Math.max(t,Math.min(r,e))}function mv(e){return kd(e,0,100)}function rA(e){return kd(e,0,1)}function yi(e,t,r){return e+(t-e)*r}function In(e,t,r,i,n,a){var o=(r-e)*a,s=(i-t)*a,u=n*n,c=n*u;return(2*t-2*r+o+s)*c+(-3*t+3*r-2*o-s)*u+o*n+t}function Pu(e,t,r){return r=rA(tA(r,e,t)),r*r*(3-2*r)}function iA(e,t,r){if(e>t)return e;var i=2*r-t,n=2*t-3*r,a=e/t;return(i*a+n)*a*a+r}var g0=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function zd(e,t){return t={exports:{}},e(t,t.exports),t.exports}var nA=zd(function(e,t){/**
 * @license
 *
 * chroma.js - JavaScript library for color conversions
 * 
 * Copyright (c) 2011-2017, Gregor Aisch
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 * 
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */(function(){var r,i,n,a,o,s,u,c,f,l,h,d,p,v,m,g,x,y,b,_,w,A,S,M,E,T,H,X,q,Z,Q,N,D,W,L,U,k,ee,K,te,Y,J,j,ae,re,le,Se,_e,ne,ve,se,xe,he,ye,pe,Pe,He,Je,We,Be,ie,we,Ie,qe,Ce,Ne,Ze,Ve,Qe,Ye,vt,Nt,Rt,Gt,Et,Mt,bt,rt,Ke,Ft,Zt,dr,Xt=[].slice;rt=function(){var P,F,B,G,V;for(P={},V="Boolean Number String Function Array Date RegExp Undefined Null".split(" "),G=0,F=V.length;G<F;G++)B=V[G],P["[object "+B+"]"]=B.toLowerCase();return function($){var C;return C=Object.prototype.toString.call($),P[C]||"object"}}(),Se=function(P,F,B){return F==null&&(F=0),B==null&&(B=1),P<F&&(P=F),P>B&&(P=B),P},Ke=function(P){return P.length>=3?Array.prototype.slice.call(P):P[0]},w=function(P){var F,B;for(P._clipped=!1,P._unclipped=P.slice(0),F=B=0;B<3;F=++B)F<3?((P[F]<0||P[F]>255)&&(P._clipped=!0),P[F]<0&&(P[F]=0),P[F]>255&&(P[F]=255)):F===3&&(P[F]<0&&(P[F]=0),P[F]>1&&(P[F]=1));return P._clipped||delete P._unclipped,P},a=Math.PI,Rt=Math.round,S=Math.cos,X=Math.floor,Pe=Math.pow,_e=Math.log,Et=Math.sin,Mt=Math.sqrt,v=Math.atan2,se=Math.max,p=Math.abs,u=a*2,o=a/3,i=a/180,s=180/a,_=function(){return arguments[0]instanceof r?arguments[0]:function(P,F,B){B.prototype=P.prototype;var G=new B,V=P.apply(G,F);return Object(V)===V?V:G}(r,arguments,function(){})},_.default=_,d=[],e!==null&&e.exports!=null&&(e.exports=_),Nt=t!==null?t:this,Nt.chroma=_,_.version="1.3.7",h={},f=[],l=!1,r=function(){function P(){var F=arguments,B,G,V,$,C,R,z,oe,ce;for(R=this,G=[],oe=0,$=arguments.length;oe<$;oe++)B=F[oe],B!=null&&G.push(B);if(G.length>1&&(z=G[G.length-1]),h[z]!=null)R._rgb=w(h[z](Ke(G.slice(0,-1))));else{for(l||(f=f.sort(function(Te,de){return de.p-Te.p}),l=!0),ce=0,C=f.length;ce<C&&(V=f[ce],z=V.test.apply(V,G),!z);ce++);z&&(R._rgb=w(h[z].apply(h,G)))}R._rgb==null&&console.warn("unknown format: "+G),R._rgb==null&&(R._rgb=[0,0,0]),R._rgb.length===3&&R._rgb.push(1)}return P.prototype.toString=function(){return this.hex()},P.prototype.clone=function(){return _(me._rgb)},P}(),_._input=h;/**
	ColorBrewer colors for chroma.js

	Copyright (c) 2002 Cynthia Brewer, Mark Harrower, and The 
	Pennsylvania State University.

	Licensed under the Apache License, Version 2.0 (the "License"); 
	you may not use this file except in compliance with the License.
	You may obtain a copy of the License at	
	http://www.apache.org/licenses/LICENSE-2.0

	Unless required by applicable law or agreed to in writing, software distributed
	under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
	CONDITIONS OF ANY KIND, either express or implied. See the License for the
	specific language governing permissions and limitations under the License.

    @preserve
 */_.brewer=y={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},function(){var P,F;F=[];for(P in y)F.push(y[P.toLowerCase()]=y[P]);return F}(),Ft={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},_.colors=Ft,J=function(){var P,F,B,G,V,$,C,R,z;return F=Ke(arguments),V=F[0],P=F[1],B=F[2],R=(V+16)/116,C=isNaN(P)?R:R+P/500,z=isNaN(B)?R:R-B/200,R=n.Yn*j(R),C=n.Xn*j(C),z=n.Zn*j(z),$=dr(3.2404542*C-1.5371385*R-.4985314*z),G=dr(-.969266*C+1.8760108*R+.041556*z),B=dr(.0556434*C-.2040259*R+1.0572252*z),[$,G,B,F.length>3?F[3]:1]},dr=function(P){return 255*(P<=.00304?12.92*P:1.055*Pe(P,1/2.4)-.055)},j=function(P){return P>n.t1?P*P*P:n.t2*(P-n.t0)},n={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},qe=function(){var P,F,B,G,V,$,C,R;return G=Ke(arguments),B=G[0],F=G[1],P=G[2],V=Qe(B,F,P),$=V[0],C=V[1],R=V[2],[116*C-16,500*($-C),200*(C-R)]},Ye=function(P){return(P/=255)<=.04045?P/12.92:Pe((P+.055)/1.055,2.4)},Zt=function(P){return P>n.t3?Pe(P,1/3):P/n.t2+n.t0},Qe=function(){var P,F,B,G,V,$,C;return G=Ke(arguments),B=G[0],F=G[1],P=G[2],B=Ye(B),F=Ye(F),P=Ye(P),V=Zt((.4124564*B+.3575761*F+.1804375*P)/n.Xn),$=Zt((.2126729*B+.7151522*F+.072175*P)/n.Yn),C=Zt((.0193339*B+.119192*F+.9503041*P)/n.Zn),[V,$,C]},_.lab=function(){return function(P,F,B){B.prototype=P.prototype;var G=new B,V=P.apply(G,F);return Object(V)===V?V:G}(r,Xt.call(arguments).concat(["lab"]),function(){})},h.lab=J,r.prototype.lab=function(){return qe(this._rgb)},m=function(P){var F,B,G,V,$,C,R,z,oe,ce,Te;return P=function(){var de,ue,Me;for(Me=[],ue=0,de=P.length;ue<de;ue++)V=P[ue],Me.push(_(V));return Me}(),P.length===2?(oe=function(){var de,ue,Me;for(Me=[],ue=0,de=P.length;ue<de;ue++)V=P[ue],Me.push(V.lab());return Me}(),$=oe[0],C=oe[1],F=function(de){var ue,Me;return Me=function(){var Le,De;for(De=[],ue=Le=0;Le<=2;ue=++Le)De.push($[ue]+de*(C[ue]-$[ue]));return De}(),_.lab.apply(_,Me)}):P.length===3?(ce=function(){var de,ue,Me;for(Me=[],ue=0,de=P.length;ue<de;ue++)V=P[ue],Me.push(V.lab());return Me}(),$=ce[0],C=ce[1],R=ce[2],F=function(de){var ue,Me;return Me=function(){var Le,De;for(De=[],ue=Le=0;Le<=2;ue=++Le)De.push((1-de)*(1-de)*$[ue]+2*(1-de)*de*C[ue]+de*de*R[ue]);return De}(),_.lab.apply(_,Me)}):P.length===4?(Te=function(){var de,ue,Me;for(Me=[],ue=0,de=P.length;ue<de;ue++)V=P[ue],Me.push(V.lab());return Me}(),$=Te[0],C=Te[1],R=Te[2],z=Te[3],F=function(de){var ue,Me;return Me=function(){var Le,De;for(De=[],ue=Le=0;Le<=2;ue=++Le)De.push((1-de)*(1-de)*(1-de)*$[ue]+3*(1-de)*(1-de)*de*C[ue]+3*(1-de)*de*de*R[ue]+de*de*de*z[ue]);return De}(),_.lab.apply(_,Me)}):P.length===5&&(B=m(P.slice(0,3)),G=m(P.slice(2,5)),F=function(de){return de<.5?B(de*2):G((de-.5)*2)}),F},_.bezier=function(P){var F;return F=m(P),F.scale=function(){return _.scale(F)},F},_.cubehelix=function(P,F,B,G,V){var $,C,R;return P==null&&(P=300),F==null&&(F=-1.5),B==null&&(B=1),G==null&&(G=1),V==null&&(V=[0,1]),$=0,rt(V)==="array"?C=V[1]-V[0]:(C=0,V=[V,V]),R=function(z){var oe,ce,Te,de,ue,Me,Le,De,Fe;return oe=u*((P+120)/360+F*z),Le=Pe(V[0]+C*z,G),Me=$!==0?B[0]+z*$:B,ce=Me*Le*(1-Le)/2,de=S(oe),Fe=Et(oe),De=Le+ce*(-.14861*de+1.78277*Fe),ue=Le+ce*(-.29227*de-.90649*Fe),Te=Le+ce*(1.97294*de),_(w([De*255,ue*255,Te*255]))},R.start=function(z){return z==null?P:(P=z,R)},R.rotations=function(z){return z==null?F:(F=z,R)},R.gamma=function(z){return z==null?G:(G=z,R)},R.hue=function(z){return z==null?B:(B=z,rt(B)==="array"?($=B[1]-B[0],$===0&&(B=B[1])):$=0,R)},R.lightness=function(z){return z==null?V:(rt(z)==="array"?(V=z,C=z[1]-z[0]):(V=[z,z],C=0),R)},R.scale=function(){return _.scale(R)},R.hue(B),R},_.random=function(){var P,F,B;for(F="0123456789abcdef",P="#",B=0;B<6;++B)P+=F.charAt(X(Math.random()*16));return new r(P)},d=[],L=function(P,F,B,G){var V,$,C,R;for(B==null&&(B=.5),G==null&&(G="rgb"),rt(P)!=="object"&&(P=_(P)),rt(F)!=="object"&&(F=_(F)),C=0,$=d.length;C<$;C++)if(V=d[C],G===V[0]){R=V[1](P,F,B,G);break}if(R==null)throw"color mode "+G+" is not supported";return R.alpha(P.alpha()+B*(F.alpha()-P.alpha()))},_.interpolate=L,r.prototype.interpolate=function(P,F,B){return L(this,P,F,B)},_.mix=L,r.prototype.mix=r.prototype.interpolate,h.rgb=function(){var P,F,B,G;F=Ke(arguments),B=[];for(P in F)G=F[P],B.push(G);return B},_.rgb=function(){return function(P,F,B){B.prototype=P.prototype;var G=new B,V=P.apply(G,F);return Object(V)===V?V:G}(r,Xt.call(arguments).concat(["rgb"]),function(){})},r.prototype.rgb=function(P){return P==null&&(P=!0),P?this._rgb.map(Math.round).slice(0,3):this._rgb.slice(0,3)},r.prototype.rgba=function(P){return P==null&&(P=!0),P?[Math.round(this._rgb[0]),Math.round(this._rgb[1]),Math.round(this._rgb[2]),this._rgb[3]]:this._rgb.slice(0)},f.push({p:3,test:function(P){var F;if(F=Ke(arguments),rt(F)==="array"&&F.length===3||F.length===4&&rt(F[3])==="number"&&F[3]>=0&&F[3]<=1)return"rgb"}}),h.lrgb=h.rgb,ee=function(P,F,B,G){var V,$;return V=P._rgb,$=F._rgb,new r(Mt(Pe(V[0],2)*(1-B)+Pe($[0],2)*B),Mt(Pe(V[1],2)*(1-B)+Pe($[1],2)*B),Mt(Pe(V[2],2)*(1-B)+Pe($[2],2)*B),G)},c=function(P){var F,B,G,V,$,C;for(B=1/P.length,C=[0,0,0,0],V=0,G=P.length;V<G;V++)F=P[V],$=F._rgb,C[0]+=Pe($[0],2)*B,C[1]+=Pe($[1],2)*B,C[2]+=Pe($[2],2)*B,C[3]+=$[3]*B;return C[0]=Mt(C[0]),C[1]=Mt(C[1]),C[2]=Mt(C[2]),new r(C)},d.push(["lrgb",ee]),_.average=function(P,F){var B,G,V,$,C,R,z,oe,ce,Te,de,ue,Me;if(F==null&&(F="rgb"),ce=P.length,P=P.map(function(Le){return _(Le)}),z=P.splice(0,1)[0],F==="lrgb")return c(P);ue=z.get(F),$=[],C=0,R=0;for(oe in ue)ue[oe]=ue[oe]||0,$.push(isNaN(ue[oe])?0:1),F.charAt(oe)==="h"&&!isNaN(ue[oe])&&(B=ue[oe]/180*a,C+=S(B),R+=Et(B));for(G=z.alpha(),de=0,Te=P.length;de<Te;de++){V=P[de],Me=V.get(F),G+=V.alpha();for(oe in ue)isNaN(Me[oe])||($[oe]+=1,F.charAt(oe)==="h"?(B=Me[oe]/180*a,C+=S(B),R+=Et(B)):ue[oe]+=Me[oe])}for(oe in ue)if(F.charAt(oe)==="h"){for(B=v(R/$[oe],C/$[oe])/a*180;B<0;)B+=360;for(;B>=360;)B-=360;ue[oe]=B}else ue[oe]=ue[oe]/$[oe];return _(ue,F).alpha(G/ce)},Z=function(P){var F,B,G,V,$,C;if(P.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return(P.length===4||P.length===7)&&(P=P.substr(1)),P.length===3&&(P=P.split(""),P=P[0]+P[0]+P[1]+P[1]+P[2]+P[2]),C=parseInt(P,16),V=C>>16,G=C>>8&255,B=C&255,[V,G,B,1];if(P.match(/^#?([A-Fa-f0-9]{8})$/))return P.length===9&&(P=P.substr(1)),C=parseInt(P,16),V=C>>24&255,G=C>>16&255,B=C>>8&255,F=Rt((C&255)/255*100)/100,[V,G,B,F];if(h.css!=null&&($=h.css(P)))return $;throw"unknown color: "+P},Be=function(P,F){var B,G,V,$,C,R,z;return F==null&&(F="rgb"),C=P[0],V=P[1],G=P[2],B=P[3],C=Math.round(C),V=Math.round(V),G=Math.round(G),z=C<<16|V<<8|G,R="000000"+z.toString(16),R=R.substr(R.length-6),$="0"+Rt(B*255).toString(16),$=$.substr($.length-2),"#"+function(){switch(F.toLowerCase()){case"rgba":return R+$;case"argb":return $+R;default:return R}}()},h.hex=function(P){return Z(P)},_.hex=function(){return function(P,F,B){B.prototype=P.prototype;var G=new B,V=P.apply(G,F);return Object(V)===V?V:G}(r,Xt.call(arguments).concat(["hex"]),function(){})},r.prototype.hex=function(P){return P==null&&(P="rgb"),Be(this._rgb,P)},f.push({p:4,test:function(P){if(arguments.length===1&&rt(P)==="string")return"hex"}}),D=function(){var P,F,B,G,V,$,C,R,z,oe,ce,Te,de,ue;if(P=Ke(arguments),V=P[0],ce=P[1],C=P[2],ce===0)z=G=F=C*255;else{for(ue=[0,0,0],B=[0,0,0],de=C<.5?C*(1+ce):C+ce-C*ce,Te=2*C-de,V/=360,ue[0]=V+1/3,ue[1]=V,ue[2]=V-1/3,$=R=0;R<=2;$=++R)ue[$]<0&&(ue[$]+=1),ue[$]>1&&(ue[$]-=1),6*ue[$]<1?B[$]=Te+(de-Te)*6*ue[$]:2*ue[$]<1?B[$]=de:3*ue[$]<2?B[$]=Te+(de-Te)*(2/3-ue[$])*6:B[$]=Te;oe=[Rt(B[0]*255),Rt(B[1]*255),Rt(B[2]*255)],z=oe[0],G=oe[1],F=oe[2]}return P.length>3?[z,G,F,P[3]]:[z,G,F]},we=function(P,F,B){var G,V,$,C,R;return P!==void 0&&P.length>=3&&(C=P,P=C[0],F=C[1],B=C[2]),P/=255,F/=255,B/=255,$=Math.min(P,F,B),se=Math.max(P,F,B),V=(se+$)/2,se===$?(R=0,G=Number.NaN):R=V<.5?(se-$)/(se+$):(se-$)/(2-se-$),P===se?G=(F-B)/(se-$):F===se?G=2+(B-P)/(se-$):B===se&&(G=4+(P-F)/(se-$)),G*=60,G<0&&(G+=360),[G,R,V]},_.hsl=function(){return function(P,F,B){B.prototype=P.prototype;var G=new B,V=P.apply(G,F);return Object(V)===V?V:G}(r,Xt.call(arguments).concat(["hsl"]),function(){})},h.hsl=D,r.prototype.hsl=function(){return we(this._rgb)},W=function(){var P,F,B,G,V,$,C,R,z,oe,ce,Te,de,ue,Me,Le,De,Fe;if(P=Ke(arguments),V=P[0],Le=P[1],Fe=P[2],Fe*=255,Le===0)z=G=F=Fe;else switch(V===360&&(V=0),V>360&&(V-=360),V<0&&(V+=360),V/=60,$=X(V),B=V-$,C=Fe*(1-Le),R=Fe*(1-Le*B),De=Fe*(1-Le*(1-B)),$){case 0:oe=[Fe,De,C],z=oe[0],G=oe[1],F=oe[2];break;case 1:ce=[R,Fe,C],z=ce[0],G=ce[1],F=ce[2];break;case 2:Te=[C,Fe,De],z=Te[0],G=Te[1],F=Te[2];break;case 3:de=[C,R,Fe],z=de[0],G=de[1],F=de[2];break;case 4:ue=[De,C,Fe],z=ue[0],G=ue[1],F=ue[2];break;case 5:Me=[Fe,C,R],z=Me[0],G=Me[1],F=Me[2]}return[z,G,F,P.length>3?P[3]:1]},Ie=function(){var P,F,B,G,V,$,C,R,z;return C=Ke(arguments),$=C[0],B=C[1],P=C[2],V=Math.min($,B,P),se=Math.max($,B,P),F=se-V,z=se/255,se===0?(G=Number.NaN,R=0):(R=F/se,$===se&&(G=(B-P)/F),B===se&&(G=2+(P-$)/F),P===se&&(G=4+($-B)/F),G*=60,G<0&&(G+=360)),[G,R,z]},_.hsv=function(){return function(P,F,B){B.prototype=P.prototype;var G=new B,V=P.apply(G,F);return Object(V)===V?V:G}(r,Xt.call(arguments).concat(["hsv"]),function(){})},h.hsv=W,r.prototype.hsv=function(){return Ie(this._rgb)},ye=function(P){var F,B,G;return rt(P)==="number"&&P>=0&&P<=16777215?(G=P>>16,B=P>>8&255,F=P&255,[G,B,F,1]):(console.warn("unknown num color: "+P),[0,0,0,1])},Ze=function(){var P,F,B,G;return G=Ke(arguments),B=G[0],F=G[1],P=G[2],(B<<16)+(F<<8)+P},_.num=function(P){return new r(P,"num")},r.prototype.num=function(P){return P==null&&(P="rgb"),Ze(this._rgb,P)},h.num=ye,f.push({p:1,test:function(P){if(arguments.length===1&&rt(P)==="number"&&P>=0&&P<=16777215)return"num"}}),q=function(){var P,F,B,G,V,$,C,R,z,oe,ce,Te,de,ue,Me,Le,De,Fe,wt,ke;if(B=Ke(arguments),R=B[0],V=B[1],F=B[2],V=V/100,C=C/100*255,P=V*255,V===0)Te=C=G=F;else switch(R===360&&(R=0),R>360&&(R-=360),R<0&&(R+=360),R/=60,z=X(R),$=R-z,oe=F*(1-V),ce=oe+P*(1-$),wt=oe+P*$,ke=oe+P,z){case 0:de=[ke,wt,oe],Te=de[0],C=de[1],G=de[2];break;case 1:ue=[ce,ke,oe],Te=ue[0],C=ue[1],G=ue[2];break;case 2:Me=[oe,ke,wt],Te=Me[0],C=Me[1],G=Me[2];break;case 3:Le=[oe,ce,ke],Te=Le[0],C=Le[1],G=Le[2];break;case 4:De=[wt,oe,ke],Te=De[0],C=De[1],G=De[2];break;case 5:Fe=[ke,oe,ce],Te=Fe[0],C=Fe[1],G=Fe[2]}return[Te,C,G,B.length>3?B[3]:1]},We=function(){var P,F,B,G,V,$,C,R,z;return z=Ke(arguments),R=z[0],V=z[1],F=z[2],C=Math.min(R,V,F),se=Math.max(R,V,F),G=se-C,B=G*100/255,P=C/(255-G)*100,G===0?$=Number.NaN:(R===se&&($=(V-F)/G),V===se&&($=2+(F-R)/G),F===se&&($=4+(R-V)/G),$*=60,$<0&&($+=360)),[$,B,P]},_.hcg=function(){return function(P,F,B){B.prototype=P.prototype;var G=new B,V=P.apply(G,F);return Object(V)===V?V:G}(r,Xt.call(arguments).concat(["hcg"]),function(){})},h.hcg=q,r.prototype.hcg=function(){return We(this._rgb)},M=function(P){var F,B,G,V,$,C,R,z;if(P=P.toLowerCase(),_.colors!=null&&_.colors[P])return Z(_.colors[P]);if($=P.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(R=$.slice(1,4),V=C=0;C<=2;V=++C)R[V]=+R[V];R[3]=1}else if($=P.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(R=$.slice(1,5),V=z=0;z<=3;V=++z)R[V]=+R[V];else if($=P.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(R=$.slice(1,4),V=F=0;F<=2;V=++F)R[V]=Rt(R[V]*2.55);R[3]=1}else if($=P.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(R=$.slice(1,5),V=B=0;B<=2;V=++B)R[V]=Rt(R[V]*2.55);R[3]=+R[3]}else($=P.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?(G=$.slice(1,4),G[1]*=.01,G[2]*=.01,R=D(G),R[3]=1):($=P.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&(G=$.slice(1,4),G[1]*=.01,G[2]*=.01,R=D(G),R[3]=+$[4]);return R},Je=function(P){var F;if(F=P[3]<1?"rgba":"rgb",F==="rgb")return F+"("+P.slice(0,3).map(Rt).join(",")+")";if(F==="rgba")return F+"("+P.slice(0,3).map(Rt).join(",")+","+P[3]+")"},vt=function(P){return Rt(P*100)/100},N=function(P,F){var B;return B=F<1?"hsla":"hsl",P[0]=vt(P[0]||0),P[1]=vt(P[1]*100)+"%",P[2]=vt(P[2]*100)+"%",B==="hsla"&&(P[3]=F),B+"("+P.join(",")+")"},h.css=function(P){return M(P)},_.css=function(){return function(P,F,B){B.prototype=P.prototype;var G=new B,V=P.apply(G,F);return Object(V)===V?V:G}(r,Xt.call(arguments).concat(["css"]),function(){})},r.prototype.css=function(P){if(P==null&&(P="rgb"),P.slice(0,3)==="rgb")return Je(this._rgb);if(P.slice(0,3)==="hsl")return N(this.hsl(),this.alpha())},h.named=function(P){return Z(Ft[P])},f.push({p:5,test:function(P){if(arguments.length===1&&Ft[P]!=null)return"named"}}),r.prototype.name=function(P){var F,B;arguments.length&&(Ft[P]&&(this._rgb=Z(Ft[P])),this._rgb[3]=1),F=this.hex();for(B in Ft)if(F===Ft[B])return B;return F},ae=function(){var P,F,B,G;return G=Ke(arguments),B=G[0],P=G[1],F=G[2],F=F*i,[B,S(F)*P,Et(F)*P]},re=function(){var P,F,B,G,V,$,C,R,z,oe,ce;return B=Ke(arguments),R=B[0],V=B[1],C=B[2],oe=ae(R,V,C),P=oe[0],F=oe[1],G=oe[2],ce=J(P,F,G),z=ce[0],$=ce[1],G=ce[2],[z,$,G,B.length>3?B[3]:1]},Y=function(){var P,F,B,G,V,$;return $=Ke(arguments),V=$[0],P=$[1],F=$[2],B=Mt(P*P+F*F),G=(v(F,P)*s+360)%360,Rt(B*1e4)===0&&(G=Number.NaN),[V,B,G]},Ce=function(){var P,F,B,G,V,$,C;return $=Ke(arguments),V=$[0],B=$[1],F=$[2],C=qe(V,B,F),G=C[0],P=C[1],F=C[2],Y(G,P,F)},_.lch=function(){var P;return P=Ke(arguments),new r(P,"lch")},_.hcl=function(){var P;return P=Ke(arguments),new r(P,"hcl")},h.lch=re,h.hcl=function(){var P,F,B,G;return G=Ke(arguments),F=G[0],P=G[1],B=G[2],re([B,P,F])},r.prototype.lch=function(){return Ce(this._rgb)},r.prototype.hcl=function(){return Ce(this._rgb).reverse()},He=function(P){var F,B,G,V,$,C,R,z,oe;return P==null&&(P="rgb"),z=Ke(arguments),R=z[0],V=z[1],F=z[2],R=R/255,V=V/255,F=F/255,$=1-Math.max(R,Math.max(V,F)),G=$<1?1/(1-$):0,B=(1-R-$)*G,C=(1-V-$)*G,oe=(1-F-$)*G,[B,C,oe,$]},A=function(){var P,F,B,G,V,$,C,R,z;return F=Ke(arguments),G=F[0],C=F[1],z=F[2],$=F[3],P=F.length>4?F[4]:1,$===1?[0,0,0,P]:(R=G>=1?0:255*(1-G)*(1-$),V=C>=1?0:255*(1-C)*(1-$),B=z>=1?0:255*(1-z)*(1-$),[R,V,B,P])},h.cmyk=function(){return A(Ke(arguments))},_.cmyk=function(){return function(P,F,B){B.prototype=P.prototype;var G=new B,V=P.apply(G,F);return Object(V)===V?V:G}(r,Xt.call(arguments).concat(["cmyk"]),function(){})},r.prototype.cmyk=function(){return He(this._rgb)},h.gl=function(){var P,F,B,G,V;for(G=function(){var $,C;$=Ke(arguments),C=[];for(F in $)V=$[F],C.push(V);return C}.apply(this,arguments),P=B=0;B<=2;P=++B)G[P]*=255;return G},_.gl=function(){return function(P,F,B){B.prototype=P.prototype;var G=new B,V=P.apply(G,F);return Object(V)===V?V:G}(r,Xt.call(arguments).concat(["gl"]),function(){})},r.prototype.gl=function(){var P;return P=this._rgb,[P[0]/255,P[1]/255,P[2]/255,P[3]]},Ne=function(P,F,B){var G;return G=Ke(arguments),P=G[0],F=G[1],B=G[2],P=ne(P),F=ne(F),B=ne(B),.2126*P+.7152*F+.0722*B},ne=function(P){return P/=255,P<=.03928?P/12.92:Pe((P+.055)/1.055,2.4)},te=function(P,F,B,G){var V,$;return V=P._rgb,$=F._rgb,new r(V[0]+B*($[0]-V[0]),V[1]+B*($[1]-V[1]),V[2]+B*($[2]-V[2]),G)},d.push(["rgb",te]),r.prototype.luminance=function(P,F){var B,G,V,$,C;return F==null&&(F="rgb"),arguments.length?($=this._rgb,P===0?$=[0,0,0,this._rgb[3]]:P===1?$=[255,255,255,this[3]]:(B=Ne(this._rgb),G=1e-7,V=20,C=function(R,z){var oe,ce;return ce=R.interpolate(z,.5,F),oe=ce.luminance(),Math.abs(P-oe)<G||!V--?ce:oe>P?C(R,ce):C(ce,z)},B>P?$=C(_("black"),this).rgba():$=C(this,_("white")).rgba()),_($).alpha(this.alpha())):Ne(this._rgb)},bt=function(P){var F,B,G,V;return V=P/100,V<66?(G=255,B=-155.25485562709179-.44596950469579133*(B=V-2)+104.49216199393888*_e(B),F=V<20?0:-254.76935184120902+.8274096064007395*(F=V-10)+115.67994401066147*_e(F)):(G=351.97690566805693+.114206453784165*(G=V-55)-40.25366309332127*_e(G),B=325.4494125711974+.07943456536662342*(B=V-50)-28.0852963507957*_e(B),F=255),[G,B,F]},Ve=function(){var P,F,B,G,V,$,C,R;for($=Ke(arguments),V=$[0],$[1],P=$[2],G=1e3,B=4e4,F=.4;B-G>F;)R=(B+G)*.5,C=bt(R),C[2]/C[0]>=P/V?B=R:G=R;return Rt(R)},_.temperature=_.kelvin=function(){return function(P,F,B){B.prototype=P.prototype;var G=new B,V=P.apply(G,F);return Object(V)===V?V:G}(r,Xt.call(arguments).concat(["temperature"]),function(){})},h.temperature=h.kelvin=h.K=bt,r.prototype.temperature=function(){return Ve(this._rgb)},r.prototype.kelvin=r.prototype.temperature,_.contrast=function(P,F){var B,G,V,$;return((V=rt(P))==="string"||V==="number")&&(P=new r(P)),(($=rt(F))==="string"||$==="number")&&(F=new r(F)),B=P.luminance(),G=F.luminance(),B>G?(B+.05)/(G+.05):(G+.05)/(B+.05)},_.distance=function(P,F,B){var G,V,$,C,R,z,oe;B==null&&(B="lab"),((R=rt(P))==="string"||R==="number")&&(P=new r(P)),((z=rt(F))==="string"||z==="number")&&(F=new r(F)),$=P.get(B),C=F.get(B),oe=0;for(V in $)G=($[V]||0)-(C[V]||0),oe+=G*G;return Math.sqrt(oe)},_.deltaE=function(P,F,B,G){var V,$,C,R,z,oe,ce,Te,de,ue,Me,Le,De,Fe,wt,ke,je,pt,Xe,be,Re,et,mt,it,xt,_t,qt;for(B==null&&(B=1),G==null&&(G=1),((je=rt(P))==="string"||je==="number")&&(P=new r(P)),((pt=rt(F))==="string"||pt==="number")&&(F=new r(F)),Xe=P.lab(),V=Xe[0],C=Xe[1],z=Xe[2],be=F.lab(),$=be[0],R=be[1],oe=be[2],ce=Mt(C*C+z*z),Te=Mt(R*R+oe*oe),mt=V<16?.511:.040975*V/(1+.01765*V),Re=.0638*ce/(1+.0131*ce)+.638,ke=ce<1e-6?0:v(z,C)*180/a;ke<0;)ke+=360;for(;ke>=360;)ke-=360;return it=ke>=164&&ke<=345?.56+p(.2*S(a*(ke+168)/180)):.36+p(.4*S(a*(ke+35)/180)),de=ce*ce*ce*ce,wt=Mt(de/(de+1900)),et=Re*(wt*it+1-wt),Fe=V-$,De=ce-Te,Me=C-R,Le=z-oe,ue=Me*Me+Le*Le-De*De,xt=Fe/(B*mt),_t=De/(G*Re),qt=et,Mt(xt*xt+_t*_t+ue/(qt*qt))},r.prototype.get=function(P){var F,B,G,V,$,C;return G=this,$=P.split("."),V=$[0],F=$[1],C=G[V](),F?(B=V.indexOf(F),B>-1?C[B]:console.warn("unknown channel "+F+" in mode "+V)):C},r.prototype.set=function(P,F){var B,G,V,$,C,R;if(V=this,C=P.split("."),$=C[0],B=C[1],B)if(R=V[$](),G=$.indexOf(B),G>-1)if(rt(F)==="string")switch(F.charAt(0)){case"+":R[G]+=+F;break;case"-":R[G]+=+F;break;case"*":R[G]*=+F.substr(1);break;case"/":R[G]/=+F.substr(1);break;default:R[G]=+F}else R[G]=F;else console.warn("unknown channel "+B+" in mode "+$);else R=F;return _(R,$).alpha(V.alpha())},r.prototype.clipped=function(){return this._rgb._clipped||!1},r.prototype.alpha=function(P){return arguments.length?_.rgb([this._rgb[0],this._rgb[1],this._rgb[2],P]):this._rgb[3]},r.prototype.darken=function(P){var F,B;return P==null&&(P=1),B=this,F=B.lab(),F[0]-=n.Kn*P,_.lab(F).alpha(B.alpha())},r.prototype.brighten=function(P){return P==null&&(P=1),this.darken(-P)},r.prototype.darker=r.prototype.darken,r.prototype.brighter=r.prototype.brighten,r.prototype.saturate=function(P){var F,B;return P==null&&(P=1),B=this,F=B.lch(),F[1]+=P*n.Kn,F[1]<0&&(F[1]=0),_.lch(F).alpha(B.alpha())},r.prototype.desaturate=function(P){return P==null&&(P=1),this.saturate(-P)},r.prototype.premultiply=function(){var P,F;return F=this.rgb(),P=this.alpha(),_(F[0]*P,F[1]*P,F[2]*P,P)},g=function(P,F,B){if(!g[B])throw"unknown blend mode "+B;return g[B](P,F)},x=function(P){return function(F,B){var G,V;return G=_(B).rgb(),V=_(F).rgb(),_(P(G,V),"rgb")}},H=function(P){return function(F,B){var G,V,$;for($=[],G=V=0;V<=3;G=++V)$[G]=P(F[G],B[G]);return $}},he=function(P,F){return P},xe=function(P,F){return P*F/255},E=function(P,F){return P>F?F:P},le=function(P,F){return P>F?P:F},Gt=function(P,F){return 255*(1-(1-P/255)*(1-F/255))},pe=function(P,F){return F<128?2*P*F/255:255*(1-2*(1-P/255)*(1-F/255))},b=function(P,F){return 255*(1-(1-F/255)/(P/255))},T=function(P,F){return P===255||(P=255*(F/255)/(1-P/255),P>255)?255:P},g.normal=x(H(he)),g.multiply=x(H(xe)),g.screen=x(H(Gt)),g.overlay=x(H(pe)),g.darken=x(H(E)),g.lighten=x(H(le)),g.dodge=x(H(T)),g.burn=x(H(b)),_.blend=g,_.analyze=function(P){var F,B,G,V;for(G={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},B=0,F=P.length;B<F;B++)V=P[B],V!=null&&!isNaN(V)&&(G.values.push(V),G.sum+=V,V<G.min&&(G.min=V),V>G.max&&(G.max=V),G.count+=1);return G.domain=[G.min,G.max],G.limits=function($,C){return _.limits(G,$,C)},G},_.scale=function(P,F){var B,G,V,$,C,R,z,oe,ce,Te,de,ue,Me,Le,De,Fe,wt,ke,je,pt,Xe;return ce="rgb",Te=_("#ccc"),Le=0,C=[0,1],Me=[],ue=[0,0],B=!1,V=[],de=!1,oe=0,z=1,$=!1,G={},De=!0,R=1,pt=function(be){var Re,et,mt,it,xt,_t;if(be==null&&(be=["#fff","#000"]),be!=null&&rt(be)==="string"&&_.brewer!=null&&(be=_.brewer[be]||_.brewer[be.toLowerCase()]||be),rt(be)==="array"){for(be=be.slice(0),Re=mt=0,it=be.length-1;0<=it?mt<=it:mt>=it;Re=0<=it?++mt:--mt)et=be[Re],rt(et)==="string"&&(be[Re]=_(et));for(Me.length=0,Re=_t=0,xt=be.length-1;0<=xt?_t<=xt:_t>=xt;Re=0<=xt?++_t:--_t)Me.push(Re/(be.length-1))}return je(),V=be},wt=function(be){var Re,et;if(B!=null){for(et=B.length-1,Re=0;Re<et&&be>=B[Re];)Re++;return Re-1}return 0},Xe=function(be){return be},ke=function(be,Re){var et,mt,it,xt,_t,qt,Ar,gt;if(Re==null&&(Re=!1),isNaN(be))return Te;if(Re?gt=be:B&&B.length>2?(et=wt(be),gt=et/(B.length-2)):z!==oe?gt=(be-oe)/(z-oe):gt=1,Re||(gt=Xe(gt)),R!==1&&(gt=Pe(gt,R)),gt=ue[0]+gt*(1-ue[0]-ue[1]),gt=Math.min(1,Math.max(0,gt)),xt=Math.floor(gt*1e4),De&&G[xt])mt=G[xt];else{if(rt(V)==="array")for(it=_t=0,Ar=Me.length-1;0<=Ar?_t<=Ar:_t>=Ar;it=0<=Ar?++_t:--_t){if(qt=Me[it],gt<=qt){mt=V[it];break}if(gt>=qt&&it===Me.length-1){mt=V[it];break}if(gt>qt&&gt<Me[it+1]){gt=(gt-qt)/(Me[it+1]-qt),mt=_.interpolate(V[it],V[it+1],gt,ce);break}}else rt(V)==="function"&&(mt=V(gt));De&&(G[xt]=mt)}return mt},je=function(){return G={}},pt(P),Fe=function(be){var Re;return Re=_(ke(be)),de&&Re[de]?Re[de]():Re},Fe.classes=function(be){var Re;return be!=null?(rt(be)==="array"?(B=be,C=[be[0],be[be.length-1]]):(Re=_.analyze(C),be===0?B=[Re.min,Re.max]:B=_.limits(Re,"e",be)),Fe):B},Fe.domain=function(be){var Re,et,mt,it,xt,_t,qt;if(!arguments.length)return C;if(oe=be[0],z=be[be.length-1],Me=[],mt=V.length,be.length===mt&&oe!==z)for(xt=0,it=be.length;xt<it;xt++)et=be[xt],Me.push((et-oe)/(z-oe));else for(Re=qt=0,_t=mt-1;0<=_t?qt<=_t:qt>=_t;Re=0<=_t?++qt:--qt)Me.push(Re/(mt-1));return C=[oe,z],Fe},Fe.mode=function(be){return arguments.length?(ce=be,je(),Fe):ce},Fe.range=function(be,Re){return pt(be,Re),Fe},Fe.out=function(be){return de=be,Fe},Fe.spread=function(be){return arguments.length?(Le=be,Fe):Le},Fe.correctLightness=function(be){return be==null&&(be=!0),$=be,je(),$?Xe=function(Re){var et,mt,it,xt,_t,qt,Ar,gt,rr;for(et=ke(0,!0).lab()[0],mt=ke(1,!0).lab()[0],Ar=et>mt,it=ke(Re,!0).lab()[0],_t=et+(mt-et)*Re,xt=it-_t,gt=0,rr=1,qt=20;Math.abs(xt)>.01&&qt-- >0;)(function(){return Ar&&(xt*=-1),xt<0?(gt=Re,Re+=(rr-Re)*.5):(rr=Re,Re+=(gt-Re)*.5),it=ke(Re,!0).lab()[0],xt=it-_t})();return Re}:Xe=function(Re){return Re},Fe},Fe.padding=function(be){return be!=null?(rt(be)==="number"&&(be=[be,be]),ue=be,Fe):ue},Fe.colors=function(be,Re){var et,mt,it,xt,_t,qt,Ar,gt;if(arguments.length<2&&(Re="hex"),_t=[],arguments.length===0)_t=V.slice(0);else if(be===1)_t=[Fe(.5)];else if(be>1)mt=C[0],et=C[1]-mt,_t=function(){qt=[];for(var rr=0;0<=be?rr<be:rr>be;0<=be?rr++:rr--)qt.push(rr);return qt}.apply(this).map(function(rr){return Fe(mt+rr/(be-1)*et)});else{if(P=[],Ar=[],B&&B.length>2)for(it=gt=1,xt=B.length;1<=xt?gt<xt:gt>xt;it=1<=xt?++gt:--gt)Ar.push((B[it-1]+B[it])*.5);else Ar=C;_t=Ar.map(function(rr){return Fe(rr)})}return _[Re]&&(_t=_t.map(function(rr){return rr[Re]()})),_t},Fe.cache=function(be){return be!=null?(De=be,Fe):De},Fe.gamma=function(be){return be!=null?(R=be,Fe):R},Fe},_.scales==null&&(_.scales={}),_.scales.cool=function(){return _.scale([_.hsl(180,1,.9),_.hsl(250,.7,.4)])},_.scales.hot=function(){return _.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},_.analyze=function(P,F,B){var G,V,$,C,R,z,oe;if(R={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},B==null&&(B=function(){return!0}),G=function(ce){ce!=null&&!isNaN(ce)&&(R.values.push(ce),R.sum+=ce,ce<R.min&&(R.min=ce),ce>R.max&&(R.max=ce),R.count+=1)},oe=function(ce,Te){if(B(ce,Te))return F!=null&&rt(F)==="function"?G(F(ce)):F!=null&&rt(F)==="string"||rt(F)==="number"?G(ce[F]):G(ce)},rt(P)==="array")for(C=0,$=P.length;C<$;C++)z=P[C],oe(z);else for(V in P)z=P[V],oe(z,V);return R.domain=[R.min,R.max],R.limits=function(ce,Te){return _.limits(R,ce,Te)},R},_.limits=function(P,F,B){var G,V,$,C,R,z,oe,ce,Te,de,ue,Me,Le,De,Fe,wt,ke,je,pt,Xe,be,Re,et,mt,it,xt,_t,qt,Ar,gt,rr,ji,Di,Xn,Xi,qi,Yi,Zi,Ki,qn,ds,Yn,ya,ba,xa,_a,Ji,ps,vs,ms,Zn,Zu,Op,Qi,gs;if(F==null&&(F="equal"),B==null&&(B=7),rt(P)==="array"&&(P=_.analyze(P)),it=P.min,se=P.max,P.sum,Qi=P.values.sort(function(yl,bl){return yl-bl}),B===1)return[it,se];if(et=[],F.substr(0,1)==="c"&&(et.push(it),et.push(se)),F.substr(0,1)==="e"){for(et.push(it),Xe=rr=1,Xi=B-1;1<=Xi?rr<=Xi:rr>=Xi;Xe=1<=Xi?++rr:--rr)et.push(it+Xe/B*(se-it));et.push(se)}else if(F.substr(0,1)==="l"){if(it<=0)throw"Logarithmic scales are only possible for values > 0";for(xt=Math.LOG10E*_e(it),mt=Math.LOG10E*_e(se),et.push(it),Xe=gs=1,qi=B-1;1<=qi?gs<=qi:gs>=qi;Xe=1<=qi?++gs:--gs)et.push(Pe(10,xt+Xe/B*(mt-xt)));et.push(se)}else if(F.substr(0,1)==="q"){for(et.push(it),Xe=G=1,Yn=B-1;1<=Yn?G<=Yn:G>=Yn;Xe=1<=Yn?++G:--G)ji=(Qi.length-1)*Xe/B,Di=X(ji),Di===ji?et.push(Qi[Di]):(Xn=ji-Di,et.push(Qi[Di]*(1-Xn)+Qi[Di+1]*Xn));et.push(se)}else if(F.substr(0,1)==="k"){for(qt=Qi.length,De=new Array(qt),je=new Array(B),ms=!0,Ar=0,wt=null,wt=[],wt.push(it),Xe=V=1,ya=B-1;1<=ya?V<=ya:V>=ya;Xe=1<=ya?++V:--V)wt.push(it+Xe/B*(se-it));for(wt.push(se);ms;){for(be=$=0,ba=B-1;0<=ba?$<=ba:$>=ba;be=0<=ba?++$:--$)je[be]=0;for(Xe=C=0,xa=qt-1;0<=xa?C<=xa:C>=xa;Xe=0<=xa?++C:--C){for(Op=Qi[Xe],_t=Number.MAX_VALUE,be=R=0,_a=B-1;0<=_a?R<=_a:R>=_a;be=0<=_a?++R:--R)pt=p(wt[be]-Op),pt<_t&&(_t=pt,Fe=be);je[Fe]++,De[Xe]=Fe}for(gt=new Array(B),be=z=0,Ji=B-1;0<=Ji?z<=Ji:z>=Ji;be=0<=Ji?++z:--z)gt[be]=null;for(Xe=oe=0,ps=qt-1;0<=ps?oe<=ps:oe>=ps;Xe=0<=ps?++oe:--oe)ke=De[Xe],gt[ke]===null?gt[ke]=Qi[Xe]:gt[ke]+=Qi[Xe];for(be=ce=0,vs=B-1;0<=vs?ce<=vs:ce>=vs;be=0<=vs?++ce:--ce)gt[be]*=1/je[be];for(ms=!1,be=Te=0,Yi=B-1;0<=Yi?Te<=Yi:Te>=Yi;be=0<=Yi?++Te:--Te)if(gt[be]!==wt[Xe]){ms=!0;break}wt=gt,Ar++,Ar>200&&(ms=!1)}for(Re={},be=de=0,Zi=B-1;0<=Zi?de<=Zi:de>=Zi;be=0<=Zi?++de:--de)Re[be]=[];for(Xe=ue=0,Ki=qt-1;0<=Ki?ue<=Ki:ue>=Ki;Xe=0<=Ki?++ue:--ue)ke=De[Xe],Re[ke].push(Qi[Xe]);for(Zn=[],be=Me=0,qn=B-1;0<=qn?Me<=qn:Me>=qn;be=0<=qn?++Me:--Me)Zn.push(Re[be][0]),Zn.push(Re[be][Re[be].length-1]);for(Zn=Zn.sort(function(yl,bl){return yl-bl}),et.push(Zn[0]),Xe=Le=1,ds=Zn.length-1;Le<=ds;Xe=Le+=2)Zu=Zn[Xe],!isNaN(Zu)&&et.indexOf(Zu)===-1&&et.push(Zu)}return et},Q=function(P,F,B){var G,V,$,C;return G=Ke(arguments),P=G[0],F=G[1],B=G[2],isNaN(P)&&(P=0),P/=360,P<1/3?(V=(1-F)/3,C=(1+F*S(u*P)/S(o-u*P))/3,$=1-(V+C)):P<2/3?(P-=1/3,C=(1-F)/3,$=(1+F*S(u*P)/S(o-u*P))/3,V=1-(C+$)):(P-=2/3,$=(1-F)/3,V=(1+F*S(u*P)/S(o-u*P))/3,C=1-($+V)),C=Se(B*C*3),$=Se(B*$*3),V=Se(B*V*3),[C*255,$*255,V*255,G.length>3?G[3]:1]},ie=function(){var P,F,B,G,V,$,C,R;return C=Ke(arguments),$=C[0],F=C[1],P=C[2],u=Math.PI*2,$/=255,F/=255,P/=255,V=Math.min($,F,P),G=($+F+P)/3,R=1-V/G,R===0?B=0:(B=($-F+($-P))/2,B/=Math.sqrt(($-F)*($-F)+($-P)*(F-P)),B=Math.acos(B),P>F&&(B=u-B),B/=u),[B*360,R,G]},_.hsi=function(){return function(P,F,B){B.prototype=P.prototype;var G=new B,V=P.apply(G,F);return Object(V)===V?V:G}(r,Xt.call(arguments).concat(["hsi"]),function(){})},h.hsi=Q,r.prototype.hsi=function(){return ie(this._rgb)},U=function(P,F,B,G){var V,$,C,R,z,oe,ce,Te,de,ue,Me,Le;return G==="hsl"?(Me=P.hsl(),Le=F.hsl()):G==="hsv"?(Me=P.hsv(),Le=F.hsv()):G==="hcg"?(Me=P.hcg(),Le=F.hcg()):G==="hsi"?(Me=P.hsi(),Le=F.hsi()):(G==="lch"||G==="hcl")&&(G="hcl",Me=P.hcl(),Le=F.hcl()),G.substr(0,1)==="h"&&(C=Me[0],de=Me[1],oe=Me[2],R=Le[0],ue=Le[1],ce=Le[2]),!isNaN(C)&&!isNaN(R)?(R>C&&R-C>180?V=R-(C+360):R<C&&C-R>180?V=R+360-C:V=R-C,$=C+B*V):isNaN(C)?isNaN(R)?$=Number.NaN:($=R,(oe===1||oe===0)&&G!=="hsv"&&(Te=ue)):($=C,(ce===1||ce===0)&&G!=="hsv"&&(Te=de)),Te==null&&(Te=de+B*(ue-de)),z=oe+B*(ce-oe),_[G]($,Te,z)},d=d.concat(function(){var P,F,B,G;for(B=["hsv","hsl","hsi","hcl","lch","hcg"],G=[],F=0,P=B.length;F<P;F++)ve=B[F],G.push([ve,U]);return G}()),K=function(P,F,B,G){var V,$;return V=P.num(),$=F.num(),_.num(V+($-V)*B,"num")},d.push(["num",K]),k=function(P,F,B,G){var V,$;return V=P.lab(),$=F.lab(),new r(V[0]+B*($[0]-V[0]),V[1]+B*($[1]-V[1]),V[2]+B*($[2]-V[2]),G)},d.push(["lab",k])}).call(g0)}),aA=nA.scale,oA={scale:"uniform",mode:"hcl",domain:[0,1],value:16777215,reverse:!1},sA=new Oe,Lt=function(t){t===void 0&&(t={}),this.parameters=vi(t,oA),typeof this.parameters.value=="string"&&(this.parameters.value=sA.set(this.parameters.value).getHex()),this.parameters.structure&&(this.atomProxy=this.parameters.structure.getAtomProxy())};Lt.prototype.getScale=function(t){t===void 0&&(t={});var r=vi(t,this.parameters);return r.scale==="rainbow"?r.scale=["red","orange","yellow","green","blue"]:r.scale==="rwb"&&(r.scale=["red","white","blue"]),r.reverse&&r.domain.reverse(),aA(r.scale).mode(r.mode).domain(r.domain).out("num")};Lt.prototype.colorToArray=function(t,r,i){return r===void 0&&(r=[]),i===void 0&&(i=0),r[i]=(t>>16&255)/255,r[i+1]=(t>>8&255)/255,r[i+2]=(t&255)/255,r};Lt.prototype.atomColorToArray=function(t,r,i){return this.colorToArray(this.atomColor?this.atomColor(t):0,r,i)};Lt.prototype.bondColor=function(t,r){return this.atomProxy&&this.atomColor?(this.atomProxy.index=r?t.atomIndex1:t.atomIndex2,this.atomColor(this.atomProxy)):0};Lt.prototype.bondColorToArray=function(t,r,i,n){return this.colorToArray(this.bondColor(t,r),i,n)};Lt.prototype.volumeColorToArray=function(t,r,i){return this.colorToArray(this.volumeColor?this.volumeColor(t):0,r,i)};Lt.prototype.positionColorToArray=function(t,r,i){return this.colorToArray(this.positionColor?this.positionColor(t):0,r,i)};var uA=zd(function(e){/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
 */(function(t){function r(o,s,u,c,f){this._listener=s,this._isOnce=u,this.context=c,this._signal=o,this._priority=f||0}r.prototype={active:!0,params:null,execute:function(o){var s,u;return this.active&&this._listener&&(u=this.params?this.params.concat(o):o,s=this._listener.apply(this.context,u),this._isOnce&&this.detach()),s},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};function i(o,s){if(typeof o!="function")throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",s))}function n(){this._bindings=[],this._prevParams=null;var o=this;this.dispatch=function(){n.prototype.dispatch.apply(o,arguments)}}n.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(o,s,u,c){var f=this._indexOfListener(o,u),l;if(f!==-1){if(l=this._bindings[f],l.isOnce()!==s)throw new Error("You cannot add"+(s?"":"Once")+"() then add"+(s?"Once":"")+"() the same listener without removing the relationship first.")}else l=new r(this,o,s,u,c),this._addBinding(l);return this.memorize&&this._prevParams&&l.execute(this._prevParams),l},_addBinding:function(o){var s=this._bindings.length;do--s;while(this._bindings[s]&&o._priority<=this._bindings[s]._priority);this._bindings.splice(s+1,0,o)},_indexOfListener:function(o,s){for(var u=this,c=this._bindings.length,f;c--;)if(f=u._bindings[c],f._listener===o&&f.context===s)return c;return-1},has:function(o,s){return this._indexOfListener(o,s)!==-1},add:function(o,s,u){return i(o,"add"),this._registerListener(o,!1,s,u)},addOnce:function(o,s,u){return i(o,"addOnce"),this._registerListener(o,!0,s,u)},remove:function(o,s){i(o,"remove");var u=this._indexOfListener(o,s);return u!==-1&&(this._bindings[u]._destroy(),this._bindings.splice(u,1)),o},removeAll:function(){for(var o=this,s=this._bindings.length;s--;)o._bindings[s]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(o){if(this.active){var s=Array.prototype.slice.call(arguments),u=this._bindings.length,c;if(this.memorize&&(this._prevParams=s),!!u){c=this._bindings.slice(),this._shouldPropagate=!0;do u--;while(c[u]&&this._shouldPropagate&&c[u].execute(s)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var a=n;a.Signal=n,e.exports?e.exports=a:t.signals=a})(g0)}),ht=uA.Signal,nt;(function(e){e[e.PROTEIN=1]="PROTEIN",e[e.NUCLEIC=2]="NUCLEIC",e[e.RNA=3]="RNA",e[e.DNA=4]="DNA",e[e.POLYMER=5]="POLYMER",e[e.WATER=6]="WATER",e[e.HELIX=7]="HELIX",e[e.SHEET=8]="SHEET",e[e.TURN=9]="TURN",e[e.BACKBONE=10]="BACKBONE",e[e.SIDECHAIN=11]="SIDECHAIN",e[e.ALL=12]="ALL",e[e.HETERO=13]="HETERO",e[e.ION=14]="ION",e[e.SACCHARIDE=15]="SACCHARIDE",e[e.SUGAR=15]="SUGAR",e[e.BONDED=16]="BONDED",e[e.RING=17]="RING",e[e.AROMATICRING=18]="AROMATICRING",e[e.METAL=19]="METAL",e[e.NONE=20]="NONE"})(nt||(nt={}));var y0=["*","","ALL"],cA=["NONE"],Ud=[nt.BACKBONE,nt.SIDECHAIN,nt.BONDED,nt.RING,nt.AROMATICRING,nt.METAL],b0=[nt.POLYMER,nt.WATER],fA=["ALA","GLY","SER"],lA=["CYS","SER","THR"],hA=["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL"],dA=["PHE","TRP","TYR","HIS"],pA=["ASN","GLN"],vA=["ASP","GLU"],mA=["ARG","HIS","LYS"],gA=["ARG","ASP","GLU","HIS","LYS"],yA=["ASN","ARG","ASP","CYS","GLY","GLN","GLU","HIS","LYS","SER","THR","TYR"],bA=["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL"],xA=["HIS","PHE","PRO","TRP","TYR"],_A=["ALA","GLY","ILE","LEU","VAL"];function wA(e){var t={operator:void 0,rules:[]};if(!e)return t;var r=t,i,n,a=[];e=e.replace(/\(/g," ( ").replace(/\)/g," ) ").trim(),e.charAt(0)==="("&&e.substr(-1)===")"&&(e=e.slice(1,-1).trim());for(var o=e.split(/\s+/),s=function(q){i={operator:q,rules:[]},r===void 0?(r=i,t=i):(r.rules.push(i),a.push(r),r=i)},u=function(q){n=r,r=a.pop(),r===void 0&&(s(q),c(n))},c=function(q){r.rules.push(q)},f=!1,l=0;l<o.length;++l){var h=o[l],d=h.toUpperCase();if(h==="("){f=!1,s();continue}else if(h===")"){u(),r.negate&&u();continue}if(f>0)if(d==="NOT")f=1;else if(f===1)f=2;else if(f===2)f=!1,u();else throw new Error("something went wrong with 'not'");if(d==="AND"){if(r.operator==="OR"){var p=r.rules.pop();s("AND"),c(p)}else r.operator="AND";continue}else if(d==="OR"){r.operator==="AND"?u("OR"):r.operator="OR";continue}else if(h.toUpperCase()==="NOT"){f=1,s(),r.negate=!0;continue}if(+d!=+d){var v=nt[d];if(v!==void 0){c({keyword:v});continue}}if(d==="HYDROGEN"){c({operator:"OR",rules:[{element:"H"},{element:"D"}]});continue}if(d==="SMALL"){c({resname:fA});continue}if(d==="NUCLEOPHILIC"){c({resname:lA});continue}if(d==="HYDROPHOBIC"){c({resname:hA});continue}if(d==="AROMATIC"){c({resname:dA});continue}if(d==="AMIDE"){c({resname:pA});continue}if(d==="ACIDIC"){c({resname:vA});continue}if(d==="BASIC"){c({resname:mA});continue}if(d==="CHARGED"){c({resname:gA});continue}if(d==="POLAR"){c({resname:yA});continue}if(d==="NONPOLAR"){c({resname:bA});continue}if(d==="CYCLIC"){c({resname:xA});continue}if(d==="ALIPHATIC"){c({resname:_A});continue}if(d==="SIDECHAINATTACHED"){c({operator:"OR",rules:[{keyword:nt.SIDECHAIN},{operator:"AND",negate:!1,rules:[{keyword:nt.PROTEIN},{operator:"OR",negate:!1,rules:[{atomname:"CA"},{atomname:"BB"}]}]},{operator:"AND",negate:!1,rules:[{resname:"PRO"},{atomname:"N"}]},{operator:"AND",negate:!1,rules:[{keyword:nt.NUCLEIC},{operator:"OR",negate:!0,rules:[{atomname:"P"},{atomname:"OP1"},{atomname:"OP2"},{atomname:"O3'"},{atomname:"O3*"},{atomname:"O5'"},{atomname:"O5*"},{atomname:"C5'"},{atomname:"C5*"}]}]}]});continue}if(d==="LIGAND"){c({operator:"AND",rules:[{operator:"OR",rules:[{operator:"AND",rules:[{keyword:nt.HETERO},{negate:!0,operator:void 0,rules:[{keyword:nt.POLYMER}]}]},{negate:!0,operator:void 0,rules:[{keyword:nt.POLYMER}]}]},{negate:!0,operator:void 0,rules:[{operator:"OR",rules:[{keyword:nt.WATER},{keyword:nt.ION}]}]}]});continue}if(y0.indexOf(d)!==-1){c({keyword:nt.ALL});continue}if(h.charAt(0)==="@"){var m=h.substr(1).split(",").map(function(q){return parseInt(q)});m.sort(function(q,Z){return q-Z}),c({atomindex:m});continue}if(h.charAt(0)==="#"){console.error("# for element selection deprecated, use _"),c({element:d.substr(1)});continue}if(h.charAt(0)==="_"){c({element:d.substr(1)});continue}if(h[0]==="["&&h[h.length-1]==="]"){var g=d.substr(1,h.length-2).split(","),x=g.length>1?g:g[0];c({resname:x});continue}else if(h.length>=1&&h.length<=4&&h[0]!=="^"&&h[0]!==":"&&h[0]!=="."&&h[0]!=="%"&&h[0]!=="/"&&isNaN(parseInt(h))){c({resname:d});continue}var y={operator:"AND",rules:[]},b=h.split("/");if(b.length>1&&b[1]){if(isNaN(parseInt(b[1])))throw new Error("model must be an integer");y.rules.push({model:parseInt(b[1])})}var _=b[0].split("%");_.length>1&&y.rules.push({altloc:_[1]});var w=_[0].split(".");if(w.length>1&&w[1]){if(w[1].length>4)throw new Error("atomname must be one to four characters");y.rules.push({atomname:w[1].substring(0,4).toUpperCase()})}var A=w[0].split(":");A.length>1&&A[1]&&y.rules.push({chainname:A[1]});var S=A[0].split("^");if(S.length>1&&y.rules.push({inscode:S[1]}),S[0]){var M=void 0,E=void 0;S[0][0]==="-"&&(S[0]=S[0].substr(1),M=!0),S[0].includes("--")&&(S[0]=S[0].replace("--","-"),E=!0);var T=S[0].split("-");if(T.length===1){var H=parseInt(T[0]);if(isNaN(H))throw new Error("resi must be an integer");M&&(H*=-1),y.rules.push({resno:H})}else if(T.length===2){var X=T.map(function(q){return parseInt(q)});M&&(X[0]*=-1),E&&(X[1]*=-1),y.rules.push({resno:[X[0],X[1]]})}else throw new Error("resi range must contain one '-'")}if(y.rules.length===1)c(y.rules[0]);else if(y.rules.length>1)c(y);else throw new Error("empty selection chunk")}return t.operator===void 0&&t.rules.length===1&&t.rules[0].hasOwnProperty("operator")&&(t=t.rules[0]),t}function AA(e,t){if(t.atomname===void 0&&t.element===void 0&&t.altloc===void 0&&t.atomindex===void 0&&t.keyword===void 0&&t.inscode===void 0&&t.resname===void 0&&t.sstruc===void 0&&t.resno===void 0&&t.chainname===void 0&&t.model===void 0)return-1;if(t.keyword!==void 0&&(t.keyword===nt.BACKBONE&&!e.isBackbone()||t.keyword===nt.SIDECHAIN&&!e.isSidechain()||t.keyword===nt.BONDED&&!e.isBonded()||t.keyword===nt.RING&&!e.isRing()||t.keyword===nt.AROMATICRING&&!e.isAromatic()||t.keyword===nt.HETERO&&!e.isHetero()||t.keyword===nt.PROTEIN&&!e.isProtein()||t.keyword===nt.NUCLEIC&&!e.isNucleic()||t.keyword===nt.RNA&&!e.isRna()||t.keyword===nt.DNA&&!e.isDna()||t.keyword===nt.POLYMER&&!e.isPolymer()||t.keyword===nt.WATER&&!e.isWater()||t.keyword===nt.HELIX&&!e.isHelix()||t.keyword===nt.SHEET&&!e.isSheet()||t.keyword===nt.TURN&&!e.isTurn()||t.keyword===nt.ION&&!e.isIon()||t.keyword===nt.SACCHARIDE&&!e.isSaccharide()||t.keyword===nt.METAL&&!e.isMetal())||t.atomname!==void 0&&t.atomname!==e.atomname||t.element!==void 0&&t.element!==e.element||t.altloc!==void 0&&t.altloc!==e.altloc||t.atomindex!==void 0&&Aa(t.atomindex,e.index)<0)return!1;if(t.resname!==void 0){if(Array.isArray(t.resname)){if(!t.resname.includes(e.resname))return!1}else if(t.resname!==e.resname)return!1}if(t.sstruc!==void 0&&t.sstruc!==e.sstruc)return!1;if(t.resno!==void 0){if(Array.isArray(t.resno)&&t.resno.length===2){if(t.resno[0]>e.resno||t.resno[1]<e.resno)return!1}else if(t.resno!==e.resno)return!1}return!(t.inscode!==void 0&&t.inscode!==e.inscode||t.chainname!==void 0&&t.chainname!==e.chainname||t.model!==void 0&&t.model!==e.modelIndex)}function SA(e,t){if(t.resname===void 0&&t.resno===void 0&&t.inscode===void 0&&t.sstruc===void 0&&t.model===void 0&&t.chainname===void 0&&t.atomindex===void 0&&(t.keyword===void 0||Ud.includes(t.keyword)))return-1;if(t.keyword!==void 0&&(t.keyword===nt.HETERO&&!e.isHetero()||t.keyword===nt.PROTEIN&&!e.isProtein()||t.keyword===nt.NUCLEIC&&!e.isNucleic()||t.keyword===nt.RNA&&!e.isRna()||t.keyword===nt.DNA&&!e.isDna()||t.keyword===nt.POLYMER&&!e.isPolymer()||t.keyword===nt.WATER&&!e.isWater()||t.keyword===nt.HELIX&&!e.isHelix()||t.keyword===nt.SHEET&&!e.isSheet()||t.keyword===nt.TURN&&!e.isTurn()||t.keyword===nt.ION&&!e.isIon()||t.keyword===nt.SACCHARIDE&&!e.isSaccharide())||t.atomindex!==void 0&&Fd(t.atomindex,e.atomOffset,e.atomEnd)===0)return!1;if(t.resname!==void 0){if(Array.isArray(t.resname)){if(!t.resname.includes(e.resname))return!1}else if(t.resname!==e.resname)return!1}if(t.sstruc!==void 0&&t.sstruc!==e.sstruc)return!1;if(t.resno!==void 0){if(Array.isArray(t.resno)&&t.resno.length===2){if(t.resno[0]>e.resno||t.resno[1]<e.resno)return!1}else if(t.resno!==e.resno)return!1}return!(t.inscode!==void 0&&t.inscode!==e.inscode||t.chainname!==void 0&&t.chainname!==e.chainname||t.model!==void 0&&t.model!==e.modelIndex)}function MA(e,t){return t.chainname===void 0&&t.model===void 0&&t.atomindex===void 0&&(t.keyword===void 0||!b0.includes(t.keyword)||!e.entity)?-1:!(t.keyword!==void 0&&(t.keyword===nt.POLYMER&&!e.entity.isPolymer()||t.keyword===nt.WATER&&!e.entity.isWater())||t.atomindex!==void 0&&Fd(t.atomindex,e.atomOffset,e.atomEnd)===0||t.chainname!==void 0&&t.chainname!==e.chainname||t.model!==void 0&&t.model!==e.modelIndex)}function CA(e,t){return t.model===void 0&&t.atomindex===void 0?-1:!(t.atomindex!==void 0&&Fd(t.atomindex,e.atomOffset,e.atomEnd)===0||t.model!==void 0&&t.model!==e.index)}function Tu(e,t){if(e===null||e.error||!e.rules||e.rules.length===0)return!1;for(var r=e.rules.length,i=!e.negate,n=!!e.negate,a=[],o=0;o<r;++o){var s=e.rules[o];s.hasOwnProperty("operator")&&(a[o]=Tu(s,t))}return function(c){for(var f=e.operator==="AND",l=!1,h=0;h<r;++h){var d=e.rules[h],p=void 0;if(d.hasOwnProperty("operator")){var v=a[h];if(v!==!1?p=v(c):p=-1,p===-1){l=!0;continue}else if(p===!0){if(f)continue;return i}else{if(f)return n;continue}}else{if(d.keyword===nt.ALL){if(f)continue;return i}else if(d.keyword===nt.NONE){if(f)continue;return n}if(p=t(c,d),p===-1){l=!0;continue}else if(p===!0){if(f)continue;return i}else{if(f)return n;continue}}}return l?-1:f?i:n}}function Eu(e,t){if(e.error||!e.rules||e.rules.length===0)return e;var r=e.rules.length,i={operator:e.operator,rules:[]};e.hasOwnProperty("negate")&&(i.negate=e.negate);for(var n=0;n<r;++n){var a=e.rules[n];if(a.hasOwnProperty("operator")){var o=Eu(a,t);o!==null&&i.rules.push(o)}else t(a)||i.rules.push(a)}return i.rules.length>0?e:null}function gv(e,t){t===void 0&&(t=!1);var r=e;return t&&(r=Eu(e,function(i){return i.keyword!==void 0&&!Ud.includes(i.keyword)||i.model!==void 0||i.chainname!==void 0||i.resname!==void 0||i.resno!==void 0||i.sstruc!==void 0})),Tu(r,AA)}function yv(e,t){t===void 0&&(t=!1);var r=e;return t&&(r=Eu(e,function(i){return!!(i.keyword!==void 0&&Ud.includes(i.keyword)||i.model!==void 0||i.chainname!==void 0||i.atomname!==void 0||i.element!==void 0||i.altloc!==void 0)})),Tu(r,SA)}function bv(e,t){t===void 0&&(t=!1);var r=e;return t&&(r=Eu(e,function(i){return i.keyword!==void 0&&!b0.includes(i.keyword)||i.resname!==void 0||i.resno!==void 0||i.atomname!==void 0||i.element!==void 0||i.altloc!==void 0||i.sstruc!==void 0||i.inscode!==void 0})),Tu(r,MA)}function xv(e,t){t===void 0&&(t=!1);var r=e;return t&&(r=Eu(e,function(i){return i.keyword!==void 0||i.chainname!==void 0||i.resname!==void 0||i.resno!==void 0||i.atomname!==void 0||i.element!==void 0||i.altloc!==void 0||i.sstruc!==void 0||i.inscode!==void 0})),Tu(r,CA)}var Kt=function(t){this.signals={stringChanged:new ht},this.setString(t)},x0={type:{configurable:!0}};x0.type.get=function(){return"selection"};Kt.prototype.setString=function(t,r){if(t===void 0&&(t=this.string||""),t!==this.string){try{this.selection=wA(t)}catch(n){this.selection={error:n.message}}var i=this.selection;this.string=t,this.test=gv(i),this.residueTest=yv(i),this.chainTest=bv(i),this.modelTest=xv(i),this.atomOnlyTest=gv(i,!0),this.residueOnlyTest=yv(i,!0),this.chainOnlyTest=bv(i,!0),this.modelOnlyTest=xv(i,!0),r||this.signals.stringChanged.dispatch(this.string)}};Kt.prototype.isAllSelection=function(){return y0.includes(this.string.toUpperCase())};Kt.prototype.isNoneSelection=function(){return cA.includes(this.string.toUpperCase())};Object.defineProperties(Kt.prototype,x0);var PA=function(e){function t(r){var i=this;e.call(this,r),this.colormakerList=[],this.selectionList=[];var n=r.dataList||[];n.forEach(function(a){var o=a[0],s=a[1],u=a[2];u===void 0&&(u={}),Tt.hasScheme(o)?Object.assign(u,{scheme:o,structure:i.parameters.structure}):Object.assign(u,{scheme:"uniform",value:new Oe(o).getHex()}),i.colormakerList.push(Tt.getScheme(u)),i.selectionList.push(new Kt(s))})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(i){for(var n=this,a=0,o=this.selectionList.length;a<o;++a){var s=n.selectionList[a].test;if(s&&s(i))return n.colormakerList[a].atomColor(i)}return 16777215},t}(Lt),TA={"":"",OrRd:"[S] Orange-Red",PuBu:"[S] Purple-Blue",BuPu:"[S] Blue-Purple",Oranges:"[S] Oranges",BuGn:"[S] Blue-Green",YlOrBr:"[S] Yellow-Orange-Brown",YlGn:"[S] Yellow-Green",Reds:"[S] Reds",RdPu:"[S] Red-Purple",Greens:"[S] Greens",YlGnBu:"[S] Yellow-Green-Blue",Purples:"[S] Purples",GnBu:"[S] Green-Blue",Greys:"[S] Greys",YlOrRd:"[S] Yellow-Orange-Red",PuRd:"[S] Purple-Red",Blues:"[S] Blues",PuBuGn:"[S] Purple-Blue-Green",Viridis:"[D] Viridis",Spectral:"[D] Spectral",RdYlGn:"[D] Red-Yellow-Green",RdBu:"[D] Red-Blue",PiYG:"[D] Pink-Yellowgreen",PRGn:"[D] Purplered-Green",RdYlBu:"[D] Red-Yellow-Blue",BrBG:"[D] Brown-Bluegreen",RdGy:"[D] Red-Grey",PuOr:"[D] Purple-Orange",Set1:"[Q] Set1",Set2:"[Q] Set2",Set3:"[Q] Set3",Dark2:"[Q] Dark2",Paired:"[Q] Paired",Pastel1:"[Q] Pastel1",Pastel2:"[Q] Pastel2",Accent:"[Q] Accent",rainbow:"[?] Rainbow",rwb:"[?] Red-White-Blue"},EA={"":"",rgb:"Red Green Blue",hsv:"Hue Saturation Value",hsl:"Hue Saturation Lightness",hsi:"Hue Saturation Intensity",lab:"CIE L*a*b*",hcl:"Hue Chroma Lightness"},Pi=function(){this.schemes={},this.userSchemes={}};Pi.prototype.getScheme=function(t){var r=t||{},i=(r.scheme||"").toLowerCase(),n;return i in this.schemes?n=this.schemes[i]:i in this.userSchemes?n=this.userSchemes[i]:n=Lt,new n(t)};Pi.prototype.getSchemes=function(){var t={};return Object.keys(this.schemes).forEach(function(r){t[r]=r}),Object.keys(this.userSchemes).forEach(function(r){t[r]=r.split("|")[1]}),t};Pi.prototype.getScales=function(){return TA};Pi.prototype.getModes=function(){return EA};Pi.prototype.add=function(t,r){t=t.toLowerCase(),this.schemes[t]=r};Pi.prototype.addScheme=function(t,r){return t instanceof Lt||(t=this._createScheme(t)),this._addUserScheme(t,r)};Pi.prototype._addUserScheme=function(t,r){r=r||"";var i=(Nd()+"|"+r).toLowerCase();return this.userSchemes[i]=t,i};Pi.prototype.removeScheme=function(t){t=t.toLowerCase(),delete this.userSchemes[t]};Pi.prototype._createScheme=function(t){var r=function(i){Lt.call(this,i),t.call(this,i)};return r.prototype=Lt.prototype,r.prototype.constructor=Lt,r};Pi.prototype.addSelectionScheme=function(t,r){var i=function(n){function a(o){n.call(this,Object.assign({dataList:t},o))}return n&&(a.__proto__=n),a.prototype=Object.create(n&&n.prototype),a.prototype.constructor=a,a}(PA);return this._addUserScheme(i,r)};Pi.prototype.hasScheme=function(t){return t=t.toLowerCase(),t in this.schemes||t in this.userSchemes};var IA=function(e){function t(){e.call(this,"parser")}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.__hasObjName=function(i,n){var a=this.get(i);return a&&a.prototype.__objName===n},t.prototype.isTrajectory=function(i){return this.__hasObjName(i,"frames")},t.prototype.isStructure=function(i){return this.__hasObjName(i,"structure")},t.prototype.isVolume=function(i){return this.__hasObjName(i,"volume")},t.prototype.isSurface=function(i){return this.__hasObjName(i,"surface")},t.prototype.isBinary=function(i){var n=this.get(i);return n&&n.prototype.isBinary},t.prototype.isXml=function(i){var n=this.get(i);return n&&n.prototype.isXml},t.prototype.isJson=function(i){var n=this.get(i);return n&&n.prototype.isJson},t.prototype.getTrajectoryExtensions=function(){var i=this;return this.names.filter(function(n){return i.isTrajectory(n)})},t.prototype.getStructureExtensions=function(){var i=this;return this.names.filter(function(n){return i.isStructure(n)})},t.prototype.getVolumeExtensions=function(){var i=this;return this.names.filter(function(n){return i.isVolume(n)})},t.prototype.getSurfaceExtensions=function(){var i=this;return this.names.filter(function(n){return i.isSurface(n)})},t}(Vi);function _0(e){var t=e;return e.forEach(function(r){r.__deps&&Array.prototype.push.apply(t,_0(r.__deps))}),t}function RA(e){var t=Bd(_0(e));return t.map(function(r){return r.toString()}).join(`


`)}function LA(e){var t=e.data.__name,r=e.data.__postId;if(t===void 0)console.error("message __name undefined");else if(self.func===void 0)console.error("worker func undefined",t);else{var i=function(n,a){n=n||{},r!==void 0&&(n.__postId=r);try{self.postMessage(n,a)}catch(o){console.error("self.postMessage:",o),self.postMessage(n)}};self.func(e,i)}}function OA(e,t){var r=`'use strict';

`+RA(t);return r+=`


self.func = `+e.toString()+";",r+=`


self.onmessage = `+LA.toString()+";",new Blob([r],{type:"application/javascript"})}var Gd=function(){this.activeWorkerCount=0,this._funcDict={},this._depsDict={},this._blobDict={}};Gd.prototype.add=function(t,r,i){this._funcDict[t]=r,this._depsDict[t]=i};Gd.prototype.get=function(t){return this._blobDict[t]||(this._blobDict[t]=OA(this._funcDict[t],this._depsDict[t])),this._blobDict[t]};var w0=d0(),A0=!1;try{var DA=Object.defineProperty({},"passive",{get:function(){A0=!0}});window.addEventListener("test",function(e){},DA)}catch{}var S0=typeof window<"u"?typeof window.orientation<"u":!1,aa=!1;function FA(e){aa=e}var an=!1;function BA(e){an=e}var fe={log:Function.prototype.bind.call(console.log,console),info:Function.prototype.bind.call(console.info,console),warn:Function.prototype.bind.call(console.warn,console),error:Function.prototype.bind.call(console.error,console),time:Function.prototype.bind.call(console.time,console),timeEnd:Function.prototype.bind.call(console.timeEnd,console)},ys={color:"green",labelColor:"grey",labelAttachment:"bottom-center",labelSize:.7,labelZOffset:.5,labelYOffset:.1,labelBorder:!0,labelBorderColor:"lightgrey",labelBorderWidth:.25,lineOpacity:.8,linewidth:5,opacity:.6,labelUnit:"angstrom",arcVisible:!0,planeVisible:!1},ge=U2(z2("debug")),NA='<div style="display:flex;align-items:center;justify-content:center;height:100%;"><p style="padding:15px;text-align:center;">Your browser/graphics card does not seem to support <a target="_blank" href="https://en.wikipedia.org/wiki/WebGL">WebGL</a>.<br/><br/>Find out how to get it <a target="_blank" href="http://get.webgl.org/">here</a>.</p></div>',kA=["ngl","js"],xu=new Gd,Tt=new Pi,Vo=new Vi("datasource"),or=new Vi("representatation"),ut=new IA,Ut=new Vi("shader"),Hd=new Vi("decompressor"),Wo=new Vi("component"),mi=new Vi("buffer"),Ti=new Vi("picker"),Ll,$r=function(t,r){r===void 0&&(r={}),this.chunkSize=1024*1024*10,this.newline=`
`,this.__pointer=0,this.__partialLine="",this.compressed=O(r.compressed,!1),this.binary=O(r.binary,!1),this.json=O(r.json,!1),this.xml=O(r.xml,!1),this.src=t};$r.prototype.isBinary=function(){return this.binary||this.compressed};$r.prototype.read=function(){var t=this;return this._read().then(function(r){var i=t.compressed?Hd.get(t.compressed):void 0;return t.compressed&&i?t.data=i(r):((t.binary||t.compressed)&&r instanceof ArrayBuffer&&(r=new Uint8Array(r)),t.data=r),t.data})};$r.prototype._chunk=function(t,r){return r=Math.min(this.data.length,r),t===0&&this.data.length===r?this.data:this.isBinary()?this.data.subarray(t,r):this.data.substring(t,r)};$r.prototype.chunk=function(t){var r=t+this.chunkSize;return this._chunk(t,r)};$r.prototype.peekLines=function(t){var r=this.data,i=r.length,n=this.isBinary()?this.newline.charCodeAt(0):this.newline,a,o=0;for(a=0;a<i&&(r[a]===n&&++o,o!==t);++a);var s=this._chunk(0,a+1),u=this.chunkToLines(s,"",a>i);return u.lines};$r.prototype.chunkCount=function(){return Math.floor(this.data.length/this.chunkSize)+1};$r.prototype.asText=function(){return this.isBinary()?Nf(this.data):this.data};$r.prototype.chunkToLines=function(t,r,i){var n=this.newline;if(!this.isBinary()&&t.length===this.data.length)return{lines:t.split(n),partialLine:""};var a=[],o=this.isBinary()?Nf(t):t,s=o.lastIndexOf(n);if(s===-1)r+=o;else{var u=r+o.substr(0,s);a=a.concat(u.split(n)),s===o.length-n.length?r="":r=o.substr(s+n.length)}return i&&r!==""&&a.push(r),{lines:a,partialLine:r}};$r.prototype.nextChunk=function(){var t=this.__pointer;if(!(t>this.data.length))return this.__pointer+=this.chunkSize,this.chunk(t)};$r.prototype.nextChunkOfLines=function(){var t=this.nextChunk();if(t!==void 0){var r=this.__pointer>this.data.length,i=this.chunkToLines(t,this.__partialLine,r);return this.__partialLine=i.partialLine,i.lines}};$r.prototype.eachChunk=function(t){for(var r=this,i=this.chunkSize,n=this.data.length,a=this.chunkCount(),o=0;o<n;o+=i){var s=r.chunk(o),u=Math.round(o/i);t(s,u,a)}};$r.prototype.eachChunkOfLines=function(t){var r=this;this.eachChunk(function(i,n,a){var o=n===a+1,s=r.chunkToLines(i,r.__partialLine,o);r.__partialLine=s.partialLine,t(s.lines,n,a)})};$r.prototype.dispose=function(){delete this.src};var zA=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._read=function(){var i=this;return new Promise(function(n,a){var o=i.src,s=new FileReader;s.onload=function(u){u.target&&n(u.target.result)},s.onerror=function(u){return a(u)},i.binary||i.compressed?s.readAsArrayBuffer(o):s.readAsText(o)})},t}($r),UA=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._read=function(){var i=this;return new Promise(function(n,a){var o=i.src,s=new XMLHttpRequest;s.open("GET",o,!0),s.addEventListener("load",function(){if(s.status===200||s.status===304||s.status===0)try{n(s.response)}catch(u){a(u)}else a(s.statusText)},!1),s.addEventListener("error",function(u){return a("network error")},!1),i.isBinary()?s.responseType="arraybuffer":i.json?s.responseType="json":i.xml?s.responseType="document":s.responseType="text",s.send()})},t}($r),M0=function(t,r){r===void 0&&(r={}),this.parameters=vi(r,{ext:"",compressed:!1,binary:ut.isBinary(r.ext||""),name:"",dir:"",path:"",protocol:""});var i={compressed:this.parameters.compressed,binary:this.parameters.binary,json:ut.isJson(this.parameters.ext),xml:ut.isXml(this.parameters.ext)};typeof File<"u"&&t instanceof File||typeof Blob<"u"&&t instanceof Blob?this.streamer=new zA(t,i):this.streamer=new UA(t,i)},GA=function(e){function t(r,i){i===void 0&&(i={}),e.call(this,r,i),this.parserParams={voxelSize:i.voxelSize,firstModelOnly:i.firstModelOnly,asTrajectory:i.asTrajectory,cAlphaOnly:i.cAlphaOnly,name:this.parameters.name,path:this.parameters.path}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.load=function(){var i=ut.get(this.parameters.ext),n=new i(this.streamer,this.parserParams);return n.parse()},t}(M0),C0=function(t,r,i){this.name=r,this.path=i,this.signals={elementAdded:new ht,elementRemoved:new ht,nameChanged:new ht},this.type="Script",this.dir=i.substring(0,i.lastIndexOf("/")+1);try{this.fn=new Function("stage","__name","__path","__dir",t)}catch(n){fe.error("Script compilation failed",n),this.fn=function(){}}};C0.prototype.run=function(t){var r=this;return new Promise(function(i,n){try{r.fn.apply(null,[t,r.name,r.path,r.dir]),i()}catch(a){fe.error("Script.fn",a),n(a)}})};var HA=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.load=function(){var i=this;return this.streamer.read().then(function(){return new C0(i.streamer.asText(),i.parameters.name,i.parameters.path)})},t}(M0);function Or(e){var t=Hd.names,r,i,n="";e instanceof File?r=e.name:e instanceof Blob?r="":r=e;var a=r.lastIndexOf("?"),o=a!==-1?r.substring(a):"";r=r.substring(0,a===-1?r.length:a);var s=r.replace(/^.*[\\/]/,""),u=s.substring(0,s.lastIndexOf(".")),c=s.split("."),f=c.length>1?(c.pop()||"").toLowerCase():"",l=r.match(/^(.+):\/\/(.+)$/);l&&(n=l[1].toLowerCase(),r=l[2]||"");var h=r.substring(0,r.lastIndexOf("/")+1);if(t.includes(f)){i=f;var d=r.length-f.length-1;f=(r.substr(0,d).split(".").pop()||"").toLowerCase();var p=u.length-f.length-1;u=u.substr(0,p)}else i=!1;return{path:r,name:s,ext:f,base:u,dir:h,compressed:i,protocol:n,query:o,src:e}}function VA(e){var t=Or(e),r=Vo.get(t.protocol);return r&&(t=Or(r.getUrl(t.src)),!t.ext&&r.getExt&&(t.ext=r.getExt(e))),t}function Vd(e,t){t===void 0&&(t={});var r=Object.assign(VA(e),t),i;return ut.names.includes(r.ext)?i=new GA(r.src,r):kA.includes(r.ext)&&(i=new HA(r.src,r)),i?i.load():Promise.reject(new Error("autoLoad: ext '"+r.ext+"' unknown"))}var WA=zd(function(e,t){(function(){var r={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[\+\-]/};function i(u){return a(s(u),arguments)}function n(u,c){return i.apply(null,[u].concat(c||[]))}function a(u,c){var f=1,l=u.length,h,d="",p,v,m,g,x,y,b,_;for(p=0;p<l;p++)if(typeof u[p]=="string")d+=u[p];else if(typeof u[p]=="object"){if(m=u[p],m.keys)for(h=c[f],v=0;v<m.keys.length;v++){if(h==null)throw new Error(i('[sprintf] Cannot access property "%s" of undefined value "%s"',m.keys[v],m.keys[v-1]));h=h[m.keys[v]]}else m.param_no?h=c[m.param_no]:h=c[f++];if(r.not_type.test(m.type)&&r.not_primitive.test(m.type)&&h instanceof Function&&(h=h()),r.numeric_arg.test(m.type)&&typeof h!="number"&&isNaN(h))throw new TypeError(i("[sprintf] expecting number but found %T",h));switch(r.number.test(m.type)&&(b=h>=0),m.type){case"b":h=parseInt(h,10).toString(2);break;case"c":h=String.fromCharCode(parseInt(h,10));break;case"d":case"i":h=parseInt(h,10);break;case"j":h=JSON.stringify(h,null,m.width?parseInt(m.width):0);break;case"e":h=m.precision?parseFloat(h).toExponential(m.precision):parseFloat(h).toExponential();break;case"f":h=m.precision?parseFloat(h).toFixed(m.precision):parseFloat(h);break;case"g":h=m.precision?String(Number(h.toPrecision(m.precision))):parseFloat(h);break;case"o":h=(parseInt(h,10)>>>0).toString(8);break;case"s":h=String(h),h=m.precision?h.substring(0,m.precision):h;break;case"t":h=String(!!h),h=m.precision?h.substring(0,m.precision):h;break;case"T":h=Object.prototype.toString.call(h).slice(8,-1).toLowerCase(),h=m.precision?h.substring(0,m.precision):h;break;case"u":h=parseInt(h,10)>>>0;break;case"v":h=h.valueOf(),h=m.precision?h.substring(0,m.precision):h;break;case"x":h=(parseInt(h,10)>>>0).toString(16);break;case"X":h=(parseInt(h,10)>>>0).toString(16).toUpperCase();break}r.json.test(m.type)?d+=h:(r.number.test(m.type)&&(!b||m.sign)?(_=b?"+":"-",h=h.toString().replace(r.sign,"")):_="",x=m.pad_char?m.pad_char==="0"?"0":m.pad_char.charAt(1):" ",y=m.width-(_+h).length,g=m.width&&y>0?x.repeat(y):"",d+=m.align?_+h+g:x==="0"?_+g+h:g+_+h)}return d}var o=Object.create(null);function s(u){if(o[u])return o[u];for(var c=u,f,l=[],h=0;c;){if((f=r.text.exec(c))!==null)l.push(f[0]);else if((f=r.modulo.exec(c))!==null)l.push("%");else if((f=r.placeholder.exec(c))!==null){if(f[2]){h|=1;var d=[],p=f[2],v=[];if((v=r.key.exec(p))!==null)for(d.push(v[1]);(p=p.substring(v[0].length))!=="";)if((v=r.key_access.exec(p))!==null)d.push(v[1]);else if((v=r.index_access.exec(p))!==null)d.push(v[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");f[2]=d}else h|=2;if(h===3)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");l.push({placeholder:f[0],param_no:f[1],keys:f[2],sign:f[3],pad_char:f[4],align:f[5],width:f[6],precision:f[7],type:f[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");c=c.substring(f[0].length)}return o[u]=l}t.sprintf=i,t.vsprintf=n,typeof window<"u"&&(window.sprintf=i,window.vsprintf=n)})()}),ii=WA.sprintf,Iu=function(){};Iu.prototype.getBlob=function(){return new Blob([this.getData()],{type:this.mimeType})};Iu.prototype.download=function(t,r){t=O(t,this.defaultName),r=O(r,this.defaultExt),H2(this.getBlob(),t+"."+r)};var jA="ATOM  %5d %-4s %3s %1s%4d    %8.3f%8.3f%8.3f%6.2f%6.2f      %4s%2s",XA="HETATM%5d %-4s %3s %1s%4d    %8.3f%8.3f%8.3f%6.2f%6.2f      %4s%2s";(function(e){function t(r,i){e.call(this),this.mimeType="text/plain",this.defaultName="structure",this.defaultExt="pdb";var n=Object.assign({},i);this.renumberSerial=O(n.renumberSerial,!0),this.remarks=q2(O(n.remarks,[])),this.structure=r,this._records=[]}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._writeRecords=function(){this._records.length=0,this._writeTitle(),this._writeRemarks(),this._writeAtoms()},t.prototype._writeTitle=function(){this._records.push(ii("TITLE %-74s",this.structure.name))},t.prototype._writeRemarks=function(){var i=this;this.remarks.forEach(function(n){i._records.push(ii("REMARK %-73s",n))}),this.structure.trajectory&&(this._records.push(ii("REMARK %-73s","Trajectory '"+this.structure.trajectory.name+"'")),this._records.push(ii("REMARK %-73s","Frame "+this.structure.trajectory.frame)))},t.prototype._writeAtoms=function(){var i=this,n=1,a=1;this.structure.eachModel(function(o){i._records.push(ii("MODEL %-74d",a++)),o.eachAtom(function(s){var u=s.hetero?XA:jA,c=i.renumberSerial?n:s.serial,f=s.atomname;f.length===1&&(f=" "+f),i._records.push(ii(u,c,f,s.resname,O(s.chainname," "),s.resno,s.x,s.y,s.z,O(s.occupancy,1),O(s.bfactor,0),"",O(s.element,""))),n+=1}),i._records.push(ii("%-80s","ENDMDL")),a+=1}),this._records.push(ii("%-80s","END"))},t.prototype.getString=function(){return console.warn("PdbWriter.getString() is deprecated, use .getData instead"),this.getData()},t.prototype.getData=function(){return this._writeRecords(),this._records.join(`
`)},t})(Iu);var qA="%3i%3i  0  0  0  0  0  0  0  0999 V2000",YA="%10.4f%10.4f%10.4f %-3s 0%3i  0  0  0",ZA="%3i%3i%3i  0  0  0";(function(e){function t(i){e.call(this),this.mimeType="text/plain",this.defaultName="structure",this.defaultExt="sdf",this.structure=i,this._records=[]}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={idString:{configurable:!0},titleString:{configurable:!0},countsString:{configurable:!0},chargeLines:{configurable:!0}};return r.idString.get=function(){return this.structure.id},r.titleString.get=function(){return"  "+this.structure.title},r.countsString.get=function(){return ii(qA,this.structure.atomCount,this.structure.bondCount)},r.chargeLines.get=function(){var i=[];this.structure.eachAtom(function(c){c.formalCharge!=null&&c.formalCharge!==0&&i.push([c.index,c.formalCharge])});for(var n=[],a=0;a<i.length;a+=8){for(var o=Math.min(8,i.length-a),s=ii("M  CHG%3i",o),u=a;u<a+o;u++)s+=ii(" %3i %3i",i[u][0]+1,i[u][1]);n.push(s)}return n},t.prototype.formatAtom=function(n){var a=0;n.formalCharge!=null&&n.formalCharge!==0&&(a=4-n.formalCharge);var o=ii(YA,n.x,n.y,n.z,n.element,a);if(o.length!==48)throw new Error("Incompatible atom for sdf format");return o},t.prototype.formatBond=function(n){return ii(ZA,n.atomIndex1+1,n.atomIndex2+1,n.bondOrder)},t.prototype._writeRecords=function(){this._records.length=0,this._writeHeader(),this._writeCTab(),this._writeFooter()},t.prototype._writeHeader=function(){this._records.push(this.idString,this.titleString,"")},t.prototype._writeCTab=function(){var n=this;this._records.push(this.countsString),this.structure.eachAtom(function(a){n._records.push(n.formatAtom(a))}),this.structure.eachBond(function(a){n._records.push(n.formatBond(a))}),this.chargeLines.forEach(function(a){n._records.push(a)}),this._records.push("M  END")},t.prototype._writeFooter=function(){this._records.push("$$$$")},t.prototype.getData=function(){return this._writeRecords(),this._records.join(`
`)},Object.defineProperties(t.prototype,r),t})(Iu);var KA=1024*8,Ol=[],yt=function(t,r){r===void 0&&(r={}),this._mark=0,this._marks=[],this.offset=0,this.littleEndian=!0;var i=!1;t===void 0&&(t=KA),typeof t=="number"?t=new ArrayBuffer(t):i=!0;var n=r.offset?r.offset>>>0:0,a=t.byteLength-n,o=n;t instanceof ArrayBuffer||(t.byteLength!==t.buffer.byteLength&&(o=t.byteOffset+n),t=t.buffer),i?this._lastWrittenByte=a:this._lastWrittenByte=0,this.buffer=t,this.length=a,this.byteLength=a,this.byteOffset=o,this._data=new DataView(this.buffer,o,a)};yt.prototype.available=function(t){return t===void 0&&(t=1),this.offset+t<=this.length};yt.prototype.isLittleEndian=function(){return this.littleEndian};yt.prototype.setLittleEndian=function(){return this.littleEndian=!0,this};yt.prototype.isBigEndian=function(){return!this.littleEndian};yt.prototype.setBigEndian=function(){return this.littleEndian=!1,this};yt.prototype.skip=function(t){return t===void 0&&(t=1),this.offset+=t,this};yt.prototype.seek=function(t){return this.offset=t,this};yt.prototype.mark=function(){return this._mark=this.offset,this};yt.prototype.reset=function(){return this.offset=this._mark,this};yt.prototype.pushMark=function(){return this._marks.push(this.offset),this};yt.prototype.popMark=function(){var t=this._marks.pop();if(t===void 0)throw new Error("Mark stack empty");return this.seek(t),this};yt.prototype.rewind=function(){return this.offset=0,this};yt.prototype.ensureAvailable=function(t){if(t===void 0&&(t=1),!this.available(t)){var r=this.offset+t,i=r*2,n=new Uint8Array(i);n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=this.byteLength=i,this._data=new DataView(this.buffer)}return this};yt.prototype.readBoolean=function(){return this.readUint8()!==0};yt.prototype.readInt8=function(){return this._data.getInt8(this.offset++)};yt.prototype.readUint8=function(){return this._data.getUint8(this.offset++)};yt.prototype.readByte=function(){return this.readUint8()};yt.prototype.readBytes=function(t){var r=this;t===void 0&&(t=1);for(var i=new Uint8Array(t),n=0;n<t;n++)i[n]=r.readByte();return i};yt.prototype.readInt16=function(){var t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t};yt.prototype.readUint16=function(){var t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t};yt.prototype.readInt32=function(){var t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t};yt.prototype.readUint32=function(){var t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t};yt.prototype.readFloat32=function(){var t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t};yt.prototype.readFloat64=function(){var t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t};yt.prototype.readChar=function(){return String.fromCharCode(this.readInt8())};yt.prototype.readChars=function(t){var r=this;t===void 0&&(t=1),Ol.length=t;for(var i=0;i<t;i++)Ol[i]=r.readChar();return Ol.join("")};yt.prototype.writeBoolean=function(t){return t===void 0&&(t=!1),this.writeUint8(t?255:0),this};yt.prototype.writeInt8=function(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this};yt.prototype.writeUint8=function(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this};yt.prototype.writeByte=function(t){return this.writeUint8(t)};yt.prototype.writeBytes=function(t){var r=this;this.ensureAvailable(t.length);for(var i=0;i<t.length;i++)r._data.setUint8(r.offset++,t[i]);return this._updateLastWrittenByte(),this};yt.prototype.writeInt16=function(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this};yt.prototype.writeUint16=function(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this};yt.prototype.writeInt32=function(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this};yt.prototype.writeUint32=function(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this};yt.prototype.writeFloat32=function(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this};yt.prototype.writeFloat64=function(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this};yt.prototype.writeChar=function(t){return this.writeUint8(t.charCodeAt(0))};yt.prototype.writeChars=function(t){for(var r=this,i=0;i<t.length;i++)r.writeUint8(t.charCodeAt(i));return this};yt.prototype.toArray=function(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)};yt.prototype._updateLastWrittenByte=function(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)};(function(e){function t(r){e.call(this),this.mimeType="application/vnd.ms-pki.stl",this.defaultName="surface",this.defaultExt="stl",this.surface=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getData=function(){var i=this,n=this.surface.index.length/3,a=n*2+n*3*4*4+80+4,o=new yt(a);o.skip(80),o.writeUint32(n);for(var s=new I,u=new I,c=new I,f=new I,l=0;l<n;l++){var h=[i.surface.index[l*3],i.surface.index[l*3+1],i.surface.index[l*3+2]];u.fromArray(i.surface.normal,h[0]*3),c.fromArray(i.surface.normal,h[1]*3),f.fromArray(i.surface.normal,h[2]*3),s.addVectors(u,c).add(f).normalize(),o.writeFloat32(s.x),o.writeFloat32(s.y),o.writeFloat32(s.z);for(var d=0;d<3;d++)s.fromArray(i.surface.position,h[d]*3),o.writeFloat32(s.x),o.writeFloat32(s.y),o.writeFloat32(s.z);o.writeUint16(0)}return new DataView(o.buffer)},t})(Iu);var yn=function(){this.count=0,this.signals={countChanged:new ht}};yn.prototype.clear=function(){this.change(-this.count)};yn.prototype.change=function(t){this.count+=t,this.signals.countChanged.dispatch(t,this.count),this.count<0&&fe.warn("Counter.count below zero",this.count)};yn.prototype.increment=function(){this.change(1)};yn.prototype.decrement=function(){this.change(-1)};yn.prototype.listen=function(t){this.change(t.count),t.signals.countChanged.add(this.change,this)};yn.prototype.unlisten=function(t){var r=t.signals.countChanged;r.has(this.change,this)&&r.remove(this.change,this)};yn.prototype.onZeroOnce=function(t,r){var i=this;if(this.count===0)t.call(r);else{var n=function(){i.count===0&&(i.signals.countChanged.remove(n,i),t.call(r))};this.signals.countChanged.add(n,this)}};yn.prototype.dispose=function(){this.clear(),this.signals.countChanged.dispose()};Ut.add("shader/BasicLine.vert",`void main(){
#include begin_vertex
#include project_vertex
}`);Ut.add("shader/BasicLine.frag",`uniform vec3 uColor;
#include common
#include fog_pars_fragment
void main(){
gl_FragColor = vec4( uColor, 1.0 );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include encodings_fragment
#include fog_fragment
}`);Ut.add("shader/Quad.vert",`varying vec2 vUv;
void main() {
vUv = uv;
gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`);Ut.add("shader/Quad.frag",`varying vec2 vUv;
uniform sampler2D tForeground;
uniform float scale;
void main() {
vec4 foreground = texture2D( tForeground, vUv );
gl_FragColor = foreground * scale;
}`);var zf=function(){this.signals={updated:new ht},this.maxDuration=-1/0,this.minDuration=1/0,this.avgDuration=14,this.lastDuration=1/0,this.prevFpsTime=0,this.lastFps=1/0,this.lastFrames=1,this.frames=0,this.count=0,this.begin()};zf.prototype.update=function(){this.startTime=this.end(),this.currentTime=this.startTime,this.signals.updated.dispatch()};zf.prototype.begin=function(){this.startTime=window.performance.now(),this.lastFrames=this.frames};zf.prototype.end=function(){var t=window.performance.now();return this.count+=1,this.frames+=1,this.lastDuration=t-this.startTime,this.minDuration=Math.min(this.minDuration,this.lastDuration),this.maxDuration=Math.max(this.maxDuration,this.lastDuration),this.avgDuration-=this.avgDuration/30,this.avgDuration+=this.lastDuration/30,t>this.prevFpsTime+1e3&&(this.lastFps=this.frames,this.prevFpsTime=t,this.frames=0),t};Ut.add("shader/chunk/fog_fragment.glsl",`#ifdef USE_FOG
float depth = length( vViewPosition );
#ifdef FOG_EXP2
float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );
#else
float fogFactor = smoothstep( fogNear, fogFar, depth );
#endif
gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`);Ut.add("shader/chunk/interior_fragment.glsl",`if( gl_FrontFacing == false ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}`);Ut.add("shader/chunk/matrix_scale.glsl",`float matrixScale( in mat4 m ){
vec4 r = m[ 0 ];
return sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );
}`);Ut.add("shader/chunk/nearclip_vertex.glsl",`#ifdef NEAR_CLIP
if( vViewPosition.z < clipNear - 5.0 )
gl_Position.z = 2.0 * gl_Position.w;
#endif`);Ut.add("shader/chunk/nearclip_fragment.glsl",`#ifdef NEAR_CLIP
if( vViewPosition.z < clipNear )
discard;
#endif`);Ut.add("shader/chunk/opaque_back_fragment.glsl",`#ifdef OPAQUE_BACK
#ifdef FLIP_SIDED
if( gl_FrontFacing == true ){
gl_FragColor.a = 1.0;
}
#else
if( gl_FrontFacing == false ){
gl_FragColor.a = 1.0;
}
#endif
#endif`);Ut.add("shader/chunk/radiusclip_vertex.glsl",`#ifdef RADIUS_CLIP
if( distance( vViewPosition, vClipCenter ) > clipRadius + 5.0 )
gl_Position.z = 2.0 * gl_Position.w;
#endif`);Ut.add("shader/chunk/radiusclip_fragment.glsl",`#ifdef RADIUS_CLIP
if( distance( vViewPosition, vClipCenter ) > clipRadius )
discard;
#endif`);Ut.add("shader/chunk/unpack_color.glsl",`vec3 unpackColor(float f) {
vec3 color;
color.r = floor(f / 256.0 / 256.0);
color.g = floor((f - color.r * 256.0 * 256.0) / 256.0);
color.b = floor(f - color.r * 256.0 * 256.0 - color.g * 256.0);
return color / 255.0;
}`);function JA(e){if(e===void 0)return"";var t=[];for(var r in e){var i=e[r];i&&t.push("#define "+r+" "+i)}return t.join(`
`)+`
`}var QA=/^(?!\/\/)\s*#include\s+(\S+)/gmi,Dl={};function _u(e,t){t===void 0&&(t={});var r=e+"|";for(var i in t)r+=i+":"+t[i];if(!Dl[r]){var n=JA(t),a=Ut.get("shader/"+e);if(!a)throw new Error("empty shader, '"+e+"'");a=a.replace(QA,function(o,s){var u="shader/chunk/"+s+".glsl",c=Ut.get(u)||Ht[s];if(!c)throw new Error("empty chunk, '"+s+"'");return c}),Dl[r]=n+a}return Dl[r]}if(typeof WebGLRenderingContext<"u"){var wn=WebGLRenderingContext.prototype,$A=wn.getShaderParameter;wn.getShaderParameter=function(){return ge?$A.apply(this,arguments):!0};var eS=wn.getShaderInfoLog;wn.getShaderInfoLog=function(){return ge?eS.apply(this,arguments):""};var tS=wn.getProgramParameter;wn.getProgramParameter=function(t,r){return ge||r!==wn.LINK_STATUS?tS.apply(this,arguments):!0};var rS=wn.getProgramInfoLog;wn.getProgramInfoLog=function(){return ge?rS.apply(this,arguments):""}}var P0=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];P0.forEach(function(e){e.forEach(function(t){t[0]*=.0625,t[1]*=.0625})});var Ru=function(t,r,i,n){this.canvas=document.createElement("canvas"),this._viewer=i,this._factor=O(n.factor,2),this._antialias=O(n.antialias,!1),this._onProgress=n.onProgress,this._onFinish=n.onFinish,this._antialias&&(this._factor*=2),this._n=this._factor*this._factor,this._width=this._viewer.width,this._height=this._viewer.height,this._antialias?(this.canvas.width=this._width*this._factor/2,this.canvas.height=this._height*this._factor/2):(this.canvas.width=this._width*this._factor,this.canvas.height=this._height*this._factor),this._ctx=this.canvas.getContext("2d"),this._viewerSampleLevel=i.sampleLevel,this._viewer.setSampling(-1)};Ru.prototype._renderTile=function(t){var r=this._viewer,i=this._width,n=this._height,a=this._factor,o=t%a,s=Math.floor(t/a),u=o*i,c=s*n;if(r.camera.setViewOffset(i*a,n*a,u,c,i,n),r.render(),this._antialias){var f=Math.round((u+i)/2)-Math.round(u/2),l=Math.round((c+n)/2)-Math.round(c/2);this._ctx.drawImage(r.renderer.domElement,Math.round(u/2),Math.round(c/2),f,l)}else this._ctx.drawImage(r.renderer.domElement,Math.floor(u),Math.floor(c),Math.ceil(i),Math.ceil(n));typeof this._onProgress=="function"&&this._onProgress(t+1,this._n,!1)};Ru.prototype._finalize=function(){this._viewer.setSampling(this._viewerSampleLevel),this._viewer.camera.view=null,typeof this._onFinish=="function"&&this._onFinish(this._n+1,this._n,!1)};Ru.prototype.render=function(){for(var t=this,r=0;r<=this._n;++r)r===t._n?t._finalize():t._renderTile(r)};Ru.prototype.renderAsync=function(){for(var t=this,r=0,i=this._n,n=function(){r===i?t._finalize():t._renderTile(r),r+=1},a=0;a<=i;++a)setTimeout(n,0)};var Fl=2*Math.PI,T0=180/Math.PI;function Bl(e,t,r,i,n){r===void 0&&(r=1),i===void 0&&(i=0);var a=n?n.length:e.length/r,o=0,s=0;if(n)for(var u=0;u<a;++u){var c=(e[n[u]*r+i]+t)%t,f=c/t*Fl-Math.PI;o+=Math.cos(f),s+=Math.sin(f)}else for(var l=i;l<a;l+=r){var h=(e[l]+t)%t,d=h/t*Fl-Math.PI;o+=Math.cos(d),s+=Math.sin(d)}o/=a,s/=a;var p=Math.atan2(s,o),v=(p+Math.PI)/Fl*t;return v}function on(e,t,r,i){i===void 0&&(i=0);for(var n=e.length,a=r||new Float32Array(n),o=0;o<n;o+=3)a[i+o+0]=(e[o+0]+t[o+0])/2,a[i+o+1]=(e[o+1]+t[o+1])/2,a[i+o+2]=(e[o+2]+t[o+2])/2;return a}function Uf(e,t){for(var r=e.length,i=new Float32Array(r),n=0;n<r;n+=3)i[n+0]=t[n+0]-e[n+0],i[n+1]=t[n+1]-e[n+1],i[n+2]=t[n+2]-e[n+2];return i}function pi(e,t,r){for(var i=r||new Float32Array(e),n=0;n<e;++n)i[n]=t;return i}function Qt(e,t,r,i,n){for(var a=n||new Float32Array(e*3),o=0;o<e;++o){var s=o*3;a[s+0]=t,a[s+1]=r,a[s+2]=i}return a}function iS(e,t){t===void 0&&(t=new I);for(var r=e.length,i=0;i<r;i+=3)t.x+=e[i],t.y+=e[i+1],t.z+=e[i+2];return t.divideScalar(r/3),t}function jo(e){for(var t=new Float32Array(e),r=0;r<e;++r)t[r]=r;return t}function sd(e,t,r,i){r===void 0&&(r=0);for(var n=i||new Float32Array(e*t),a=0;a<e;++a)for(var o=r+a*t,s=0;s<t;++s)n[o+s]=a;return n}function Nl(e,t){for(var r=e.length,i=new Float32Array(r*t),n=0;n<r;++n)for(var a=n*t,o=e[n],s=0;s<t;++s)i[a+s]=o;return i}function nS(e,t){for(var r=e.length/3,i=new Float32Array(r*t*3),n=0;n<r;++n)for(var a=n*3,o=n*t*3,s=e[a+0],u=e[a+1],c=e[a+2],f=0;f<t;++f){var l=o+f*3;i[l+0]=s,i[l+1]=u,i[l+2]=c}return i}function aS(e,t){for(var r=e.length,i=new Float32Array(r),n=0;n<r;n++)i[n]=Math.min(e[n],t[n]);return i}function si(e,t,r,i,n){for(var a=0;a<n;++a)t[i+a]=e[r+a]}function _v(e,t,r,i){si(e,e,t,r,i)}function oS(e,t,r,i){r===void 0&&(r=0),t=t||function(v,m){return v>m?1:v<m?-1:0},i=(i||e.length)-1;var n=[],a=-1,o=r,s=i,u;function c(p,v){var m=e[p];e[p]=e[v],e[v]=m}for(var f,l;;)if(s-o<=25){for(var h=o+1;h<=s;++h){for(u=e[h],f=h-1;f>=o&&t(e[f],u)>0;)e[f+1]=e[f],--f;e[f+1]=u}if(a===-1)break;s=n[a--],o=n[a--]}else{var d=o+s>>1;for(f=o+1,l=s,c(d,f),t(e[o],e[s])>0&&c(o,s),t(e[f],e[s])>0&&c(f,s),t(e[o],e[f])>0&&c(o,f),u=e[f];;){do f++;while(t(e[f],u)<0);do l--;while(t(e[l],u)>0);if(l<f)break;c(f,l)}e[o+1]=e[l],e[l]=u,s-f+1>=l-o?(n[++a]=f,n[++a]=s,s=l-1):(n[++a]=o,n[++a]=l-1,o=f)}return e}function wc(e){for(var t=-1/0,r=0,i=e.length;r<i;++r)e[r]>t&&(t=e[r]);return t}function Ac(e){for(var t=1/0,r=0,i=e.length;r<i;++r)e[r]<t&&(t=e[r]);return t}function E0(e,t,r){t===void 0&&(t=1),r===void 0&&(r=0);for(var i=e.length,n=0,a=r;a<i;a+=t)n+=e[a];return n}function Sc(e,t,r){return t===void 0&&(t=1),r===void 0&&(r=0),E0(e,t,r)/(e.length/t)}function sS(e){for(var t=e.length,r=0,i=0;i<t;++i){var n=e[i];r+=n*n}return Math.sqrt(r/t)}function uS(e,t,r,i,n){var a=e.height,o=e.width,s=e.getContext("2d"),u=s.getImageData(0,0,o,a).data,c,f,l,h;for(l=!1,f=0;f<a;f++){for(c=0;c<o;c++)if(h=(f*o+c)*4,u[h]!==t||u[h+1]!==r||u[h+2]!==i||u[h+3]!==n){l=!0;break}if(l)break}var d=f;for(l=!1,c=0;c<o;c++){for(f=0;f<a;f++)if(h=(f*o+c)*4,u[h]!==t||u[h+1]!==r||u[h+2]!==i||u[h+3]!==n){l=!0;break}if(l)break}var p=c;for(l=!1,f=a-1;f>=0;f--){for(c=o-1;c>=0;c--)if(h=(f*o+c)*4,u[h]!==t||u[h+1]!==r||u[h+2]!==i||u[h+3]!==n){l=!0;break}if(l)break}var v=f;for(l=!1,c=o-1;c>=0;c--){for(f=a-1;f>=0;f--)if(h=(f*o+c)*4,u[h]!==t||u[h+1]!==r||u[h+2]!==i||u[h+3]!==n){l=!0;break}if(l)break}var m=c,g=document.createElement("canvas");g.width=m-p,g.height=v-d;var x=g.getContext("2d");return x.drawImage(e,p,d,g.width,g.height,0,0,g.width,g.height),g}var cS={trim:!1,factor:1,antialias:!1,transparent:!1,onProgress:void 0};function fS(e,t){t===void 0&&(t={});var r=vi(t,cS),i=r.trim,n=r.factor,a=r.antialias,o=r.transparent,s=e.renderer,u=e.camera,c=s.getClearAlpha(),f=s.getClearColor();function l(p){p===void 0&&(p=!1);var v=n;a&&(v*=2),p&&(v=1/v),e.scene.traverse(function(m){var g=m.material;g&&g.linewidth&&(g.linewidth*=v),g&&g.uniforms&&g.uniforms.size&&g.uniforms.size.__seen===void 0&&(g.uniforms.size.value*=v,g.uniforms.size.__seen=!0),g&&g.uniforms&&g.uniforms.linewidth&&g.uniforms.linewidth.__seen===void 0&&(g.uniforms.linewidth.value*=v,g.uniforms.linewidth.__seen=!0)}),e.scene.traverse(function(m){var g=m.material;g&&g.uniforms&&g.uniforms.size&&delete g.uniforms.size.__seen,g&&g.uniforms&&g.uniforms.linewidth&&delete g.uniforms.linewidth.__seen})}function h(p){if(i){var v=f,m=o?0:v.r*255,g=o?0:v.g*255,x=o?0:v.b*255,y=o?0:255;return uS(p,m,g,x,y)}else return p}function d(p,v,m){typeof t.onProgress=="function"&&t.onProgress(p,v,m)}return new Promise(function(p,v){var m=new Ru(s,u,e,{factor:n,antialias:a,onProgress:d,onFinish:g});s.setClearAlpha(o?0:1),l(),m.renderAsync();function g(x,y){var b=h(m.canvas);b.toBlob(function(_){s.setClearAlpha(c),l(!0),e.requestRender(),d(y,y,!0),_?p(_):v("error creating image")},"image/png")}})}var kl=new I,wv=new Ae,Av=new Ae;function lS(e,t){e.traverseVisible(function(r){if(!(!(r instanceof Ws)||!r.userData.buffer.parameters.sortParticles)){var i=r.geometry.attributes,n=i.position.count;if(n!==0){wv.multiplyMatrices(t.matrixWorldInverse,r.matrixWorld),Av.multiplyMatrices(t.projectionMatrix,wv);var a,o,s,u;r.userData.sortData?(a=r.userData.sortData,s=a.__zArray,o=a.__sortArray,u=a.__cmpFn):(s=new Float32Array(n),o=new Uint32Array(n),u=function(b,_){var w=s[b],A=s[_];return w>A?1:w<A?-1:0},a={__zArray:s,__sortArray:o,__cmpFn:u},r.userData.sortData=a);for(var c=0;c<n;++c)kl.fromArray(i.position.array,c*3),kl.applyMatrix4(Av),s[c]=-kl.z,o[c]=c;oS(o,u);var f,l,h,d;for(var p in i){var v=i[p],m=v.array,g=v.itemSize;a[p]||(a[p]=new Float32Array(g*n)),d=a[p],a[p]=m;for(var x=0;x<n;++x){f=o[x];for(var y=0;y<g;++y)l=f*g+y,h=x*g+y,d[h]=m[l]}i[p].array=d,i[p].needsUpdate=!0}}}})}var Sv=new Ee,bf=new Ae,xf=new Ae;function hS(e,t,r,i,n){var a=r.getSize(),o=a.width,s=a.height,u=s,c=r.getPixelRatio(),f=t.type==="OrthographicCamera";Sv.set(o,s),bf.getInverse(t.projectionMatrix),xf.copy(t.projectionMatrix).transpose(),e.traverse(function(l){var h=l.material;if(h){var d=h.uniforms;if(d){if(h.clipNear){var p=(50-h.clipNear)/50,v=i-n*p;d.clipNear.value=v}d.canvasHeight&&(d.canvasHeight.value=u),d.resolution&&d.resolution.value.copy(Sv),d.pixelRatio&&(d.pixelRatio.value=c),d.projectionMatrixInverse&&d.projectionMatrixInverse.value.copy(bf),d.projectionMatrixTranspose&&d.projectionMatrixTranspose.value.copy(xf),d.ortho&&(d.ortho.value=f)}}})}function ud(e,t){bf.getInverse(t.projectionMatrix),xf.copy(t.projectionMatrix).transpose(),e.traverse(function(r){var i=r.material;if(i){var n=i.uniforms;n&&(n.projectionMatrixInverse&&n.projectionMatrixInverse.value.copy(bf),n.projectionMatrixTranspose&&n.projectionMatrixTranspose.value.copy(xf))}})}function dS(e,t,r,i){var n=e.createProgram();t.forEach(function(o){return e.attachShader(n,o)}),r&&r.forEach(function(o,s){e.bindAttribLocation(n,i?i[s]:s,o)}),e.linkProgram(n);var a=e.getProgramParameter(n,e.LINK_STATUS);return a?n:(console.log("error linking program: "+e.getProgramInfoLog(n)),e.deleteProgram(n),null)}function Mv(e,t,r){var i=e.createShader(r);e.shaderSource(i,t),e.compileShader(i);var n=e.getShaderParameter(i,e.COMPILE_STATUS);return n?i:(console.log("error compiling shader "+i+": "+e.getShaderInfoLog(i)),e.deleteShader(i),null)}function pS(e,t){switch(t){case e.NO_ERROR:return"no error";case e.INVALID_ENUM:return"invalid enum";case e.INVALID_VALUE:return"invalid value";case e.INVALID_OPERATION:return"invalid operation";case e.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case e.OUT_OF_MEMORY:return"out of memory";case e.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"}function zl(e,t){var r=e.getExtension(t);return r||console.log("extension '"+t+"' not available"),r}var vS=`
attribute vec4 a_position;

void main() {
  gl_Position = a_position;
}`,mS=`
precision mediump float;
uniform vec4 u_color;
uniform sampler2D u_texture;

void main() {
  gl_FragColor = texture2D(u_texture, vec2(0.5, 0.5)) * u_color;
}`,gS=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function ec(e){var t=document.createElement("canvas");t.width=16,t.height=16,t.style.width="16px",t.style.height="16px";var r=t.getContext("webgl")||t.getContext("experimental-webgl");if(!r)return console.log("error creating webgl context for "+e),!1;zl(r,"OES_texture_float"),zl(r,"OES_texture_half_float"),zl(r,"WEBGL_color_buffer_float");var i=Mv(r,vS,r.VERTEX_SHADER),n=Mv(r,mS,r.FRAGMENT_SHADER);if(!i||!n)return!1;var a=dS(r,[i,n]);r.useProgram(a);var o=r.getAttribLocation(a,"a_position"),s=r.getUniformLocation(a,"u_color");if(!s)return console.log("error getting 'u_color' uniform location"),!1;var u=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,u),r.bufferData(r.ARRAY_BUFFER,gS,r.STATIC_DRAW),r.enableVertexAttribArray(o),r.vertexAttribPointer(o,2,r.FLOAT,!1,0,0);var c=r.createTexture(),f=new Uint8Array([255,255,255,255]);r.bindTexture(r.TEXTURE_2D,c),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,f);var l=r.createTexture();r.bindTexture(r.TEXTURE_2D,l),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,1,1,0,r.RGBA,e,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST);var h=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,h),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,l,0);var d=r.checkFramebufferStatus(r.FRAMEBUFFER);if(d!==r.FRAMEBUFFER_COMPLETE)return console.log("error creating framebuffer for "+e),!1;r.bindTexture(r.TEXTURE_2D,c),r.uniform4fv(s,[0,10,20,1]),r.drawArrays(r.TRIANGLES,0,6),r.bindTexture(r.TEXTURE_2D,l),r.bindFramebuffer(r.FRAMEBUFFER,null),r.clearColor(1,0,0,1),r.clear(r.COLOR_BUFFER_BIT),r.uniform4fv(s,[0,1/10,1/20,1]),r.drawArrays(r.TRIANGLES,0,6);var p=new Uint8Array(4);if(r.readPixels(0,0,1,1,r.RGBA,r.UNSIGNED_BYTE,p),p[0]!==0||p[1]<248||p[2]<248||p[3]<254)return console.log("not able to actually render to "+e+" texture"),!1;if(e===r.FLOAT){r.bindFramebuffer(r.FRAMEBUFFER,h);var v=new Float32Array(4);r.readPixels(0,0,1,1,r.RGBA,r.FLOAT,v);var m=r.getError();if(m)return console.log("error reading pixels as float: '"+pS(r,m)+"'"),!1}return!0}var yS=new Float32Array(4*25),bS=new Uint8Array(4*25),Cv=[12,7,13,17,11,6,8,18,16,2,14,22,10,1,3,9,19,23,21,15,5,0,4,24,20],tc=new Ae;function xS(e,t,r,i,n){var a=n.uniforms,o=[];if(a.objectId&&(a.objectId.value=aa?this.id:this.id/255,o.push("objectId")),(a.modelViewMatrixInverse||a.modelViewMatrixInverseTranspose||a.modelViewProjectionMatrix||a.modelViewProjectionMatrixInverse)&&this.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,this.matrixWorld),a.modelViewMatrixInverse&&(a.modelViewMatrixInverse.value.getInverse(this.modelViewMatrix),o.push("modelViewMatrixInverse")),a.modelViewMatrixInverseTranspose&&(a.modelViewMatrixInverse?a.modelViewMatrixInverseTranspose.value.copy(a.modelViewMatrixInverse.value).transpose():a.modelViewMatrixInverseTranspose.value.getInverse(this.modelViewMatrix).transpose(),o.push("modelViewMatrixInverseTranspose")),a.modelViewProjectionMatrix&&(a.modelViewProjectionMatrix.value.multiplyMatrices(r.projectionMatrix,this.modelViewMatrix),o.push("modelViewProjectionMatrix")),a.modelViewProjectionMatrixInverse&&(a.modelViewProjectionMatrix?(tc.copy(a.modelViewProjectionMatrix.value),a.modelViewProjectionMatrixInverse.value.getInverse(tc)):(tc.multiplyMatrices(r.projectionMatrix,this.modelViewMatrix),a.modelViewProjectionMatrixInverse.value.getInverse(tc)),o.push("modelViewProjectionMatrixInverse")),o.length){var s=e.properties.get(n);if(s.program){var u=e.getContext(),c=s.program;u.useProgram(c.program);var f=c.getUniforms();o.forEach(function(l){f.setValue(u,l,a[l].value)})}}}var St=function(t){if(this.boundingBox=new ir,this.boundingBoxSize=new I,this.boundingBoxLength=0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}},this.distVector=new I,this.signals={ticked:new ht,rendered:new ht},typeof t=="string"){var r=document.getElementById(t);r===null?this.container=document.createElement("div"):this.container=r}else t instanceof HTMLElement?this.container=t:this.container=document.createElement("div");if(this.container===document.body)this.width=window.innerWidth||1,this.height=window.innerHeight||1;else{var i=this.container.getBoundingClientRect();this.width=i.width||1,this.height=i.height||1,this.container.style.overflow="hidden"}if(this.wrapper=document.createElement("div"),this.wrapper.style.position="relative",this.container.appendChild(this.wrapper),this._initParams(),this._initStats(),this._initCamera(),this._initScene(),this._initRenderer()===!1){fe.error("Viewer: could not initialize renderer");return}this._initHelper(),this.setBackground(),this.setFog(),this.animate=this.animate.bind(this)};St.prototype._initParams=function(){this.parameters={fogColor:new Oe(0),fogNear:50,fogFar:100,fogMode:"scene",fogScale:"relative",backgroundColor:new Oe(0),cameraType:"perspective",cameraFov:40,cameraEyeSep:.3,cameraZ:-80,clipNear:0,clipFar:100,clipDist:10,clipMode:"scene",clipScale:"relative",lightColor:new Oe(14540253),lightIntensity:1,ambientColor:new Oe(14540253),ambientIntensity:.2,sampleLevel:0}};St.prototype._initCamera=function(){var t=new I(0,0,0),r=this,i=r.width,n=r.height;this.perspectiveCamera=new xr(this.parameters.cameraFov,i/n),this.perspectiveCamera.position.z=this.parameters.cameraZ,this.perspectiveCamera.lookAt(t),this.orthographicCamera=new ia(i/-2,i/2,n/2,n/-2),this.orthographicCamera.position.z=this.parameters.cameraZ,this.orthographicCamera.lookAt(t),this.stereoCamera=new r0,this.stereoCamera.aspect=.5,this.stereoCamera.eyeSep=this.parameters.cameraEyeSep;var a=this.parameters.cameraType;if(a==="orthographic")this.camera=this.orthographicCamera;else if(a==="perspective"||a==="stereo")this.camera=this.perspectiveCamera;else throw new Error("Unknown cameraType '"+a+"'");this.camera.updateProjectionMatrix()};St.prototype._initStats=function(){this.stats=new zf};St.prototype._initScene=function(){this.scene||(this.scene=new Vs,this.scene.name="scene"),this.rotationGroup=new Jt,this.rotationGroup.name="rotationGroup",this.scene.add(this.rotationGroup),this.translationGroup=new Jt,this.translationGroup.name="translationGroup",this.rotationGroup.add(this.translationGroup),this.modelGroup=new Jt,this.modelGroup.name="modelGroup",this.translationGroup.add(this.modelGroup),this.pickingGroup=new Jt,this.pickingGroup.name="pickingGroup",this.translationGroup.add(this.pickingGroup),this.backgroundGroup=new Jt,this.backgroundGroup.name="backgroundGroup",this.translationGroup.add(this.backgroundGroup),this.helperGroup=new Jt,this.helperGroup.name="helperGroup",this.translationGroup.add(this.helperGroup),this.scene.fog=new xo(this.parameters.fogColor.getHex()),this.spotLight=new sf(this.parameters.lightColor.getHex(),this.parameters.lightIntensity),this.scene.add(this.spotLight),this.ambientLight=new uf(this.parameters.ambientColor.getHex(),this.parameters.ambientIntensity),this.scene.add(this.ambientLight)};St.prototype._initRenderer=function(){var t=window.devicePixelRatio,r=this,i=r.width,n=r.height;try{this.renderer=new Rd({preserveDrawingBuffer:!0,alpha:!0,antialias:!0})}catch{return this.wrapper.innerHTML=NA,!1}this.renderer.setPixelRatio(t),this.renderer.setSize(i,n),this.renderer.autoClear=!1,this.renderer.sortObjects=!0;var a=this.renderer.getContext();BA(this.renderer.extensions.get("EXT_frag_depth")),this.renderer.extensions.get("OES_element_index_uint"),FA(this.renderer.extensions.get("OES_texture_float")&&this.renderer.extensions.get("WEBGL_color_buffer_float")||this.renderer.extensions.get("OES_texture_float")&&ec(a.FLOAT)),this.wrapper.appendChild(this.renderer.domElement);var o=i*t,s=n*t;this.renderer.extensions.get("OES_texture_float"),this.supportsHalfFloat=this.renderer.extensions.get("OES_texture_half_float")&&ec(36193),this.renderer.extensions.get("WEBGL_color_buffer_float"),ge&&console.log(JSON.stringify({Browser:w0,OES_texture_float:!!this.renderer.extensions.get("OES_texture_float"),OES_texture_half_float:!!this.renderer.extensions.get("OES_texture_half_float"),WEBGL_color_buffer_float:!!this.renderer.extensions.get("WEBGL_color_buffer_float"),"testTextureSupport Float":ec(a.FLOAT),"testTextureSupport HalfFloat":ec(36193),"this.supportsHalfFloat":this.supportsHalfFloat,SupportsReadPixelsFloat:aa},null,2)),this.pickingTarget=new En(o,s,{minFilter:vr,magFilter:vr,stencilBuffer:!1,format:zi,type:aa?go:Fs}),this.pickingTarget.texture.generateMipmaps=!1,this.renderer.clearTarget(this.pickingTarget,!0,!0,!0),this.renderer.setRenderTarget(null),this.sampleTarget=new En(o,s,{minFilter:Dr,magFilter:Dr,format:zi}),this.holdTarget=new En(o,s,{minFilter:vr,magFilter:vr,format:zi,type:Fs}),this.compositeUniforms={tForeground:new hu(this.sampleTarget.texture),scale:new hu(1)},this.compositeMaterial=new Gr({uniforms:this.compositeUniforms,vertexShader:_u("Quad.vert"),fragmentShader:_u("Quad.frag"),premultipliedAlpha:!0,transparent:!0,blending:xd,depthTest:!1,depthWrite:!1}),this.compositeCamera=new ia(-1,1,1,-1,0,1),this.compositeScene=new Vs,this.compositeScene.name="compositeScene",this.compositeScene.add(new Jr(new Gs(2,2),this.compositeMaterial))};St.prototype._initHelper=function(){var t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(8*3),i=new Ue;i.setIndex(new ft(t,1)),i.addAttribute("position",new ft(r,3));var n=new Gr({uniforms:{uColor:{value:new Oe("skyblue")}},vertexShader:_u("BasicLine.vert"),fragmentShader:_u("BasicLine.frag")});this.boundingBoxMesh=new ar(i,n),this.helperGroup.add(this.boundingBoxMesh)};St.prototype.updateHelper=function(){var t=this.boundingBoxMesh.geometry.attributes.position,r=t.array,i=this.boundingBox,n=i.min,a=i.max;r[0]=a.x,r[1]=a.y,r[2]=a.z,r[3]=n.x,r[4]=a.y,r[5]=a.z,r[6]=n.x,r[7]=n.y,r[8]=a.z,r[9]=a.x,r[10]=n.y,r[11]=a.z,r[12]=a.x,r[13]=a.y,r[14]=n.z,r[15]=n.x,r[16]=a.y,r[17]=n.z,r[18]=n.x,r[19]=n.y,r[20]=n.z,r[21]=a.x,r[22]=n.y,r[23]=n.z,t.needsUpdate=!0,this.boundingBox.isEmpty()||this.boundingBoxMesh.geometry.computeBoundingSphere()};St.prototype.add=function(t,r){var i=this;r?r.forEach(function(n){return i.addBuffer(t,n)}):this.addBuffer(t),t.parameters.background?(this.backgroundGroup.add(t.group),this.backgroundGroup.add(t.wireframeGroup)):(this.modelGroup.add(t.group),this.modelGroup.add(t.wireframeGroup)),t.pickable&&this.pickingGroup.add(t.pickingGroup),ge&&this.updateHelper()};St.prototype.addBuffer=function(t,r){function i(s){s instanceof Jt?s.children.forEach(i):(s.userData.buffer=t,s.userData.instance=r,s.onBeforeRender=xS)}var n=t.getMesh();r&&n.applyMatrix(r.matrix),i(n),t.group.add(n);var a=t.getWireframeMesh();if(r&&(a.matrix.copy(n.matrix),a.position.copy(n.position),a.quaternion.copy(n.quaternion),a.scale.copy(n.scale)),i(a),t.wireframeGroup.add(a),t.pickable){var o=t.getPickingMesh();r&&(o.matrix.copy(n.matrix),o.position.copy(n.position),o.quaternion.copy(n.quaternion),o.scale.copy(n.scale)),i(o),t.pickingGroup.add(o)}r?this._updateBoundingBox(t.geometry,t.matrix,r.matrix):this._updateBoundingBox(t.geometry,t.matrix)};St.prototype.remove=function(t){this.translationGroup.children.forEach(function(r){r.remove(t.group),r.remove(t.wireframeGroup)}),t.pickable&&this.pickingGroup.remove(t.pickingGroup),this.updateBoundingBox(),ge&&this.updateHelper()};St.prototype._updateBoundingBox=function(t,r,i){var n=this.boundingBox;function a(s,u,c){s.boundingBox||s.computeBoundingBox();var f=s.boundingBox.clone();u&&f.applyMatrix4(u),c&&f.applyMatrix4(c),f.min.equals(f.max)&&f.expandByScalar(5),n.union(f)}function o(s){if(s.geometry!==void 0){var u,c;s.userData.buffer&&(u=s.userData.buffer.matrix),s.userData.instance&&(c=s.userData.instance.matrix),a(s.geometry,u,c)}}t?a(t,r,i):(n.makeEmpty(),this.modelGroup.traverse(o),this.backgroundGroup.traverse(o)),n.getSize(this.boundingBoxSize),this.boundingBoxLength=this.boundingBoxSize.length()};St.prototype.updateBoundingBox=function(){this._updateBoundingBox(),ge&&this.updateHelper()};St.prototype.getPickingPixels=function(){var t=this,r=t.width,i=t.height,n=r*i*4,a=aa?new Float32Array(n):new Uint8Array(n);return this.render(!0),this.renderer.readRenderTargetPixels(this.pickingTarget,0,0,r,i,a),a};St.prototype.getImage=function(t){var r=this;return new Promise(function(i){if(t){var n=r,a=n.width,o=n.height,s=a*o*4,u=r.getPickingPixels();if(aa){for(var c=new Uint8Array(s),f=0;f<s;++f)c[f]=Math.round(u[f]*255);u=c}var l=document.createElement("canvas");l.width=a,l.height=o;var h=l.getContext("2d"),d=h.getImageData(0,0,a,o);d.data.set(u),h.putImageData(d,0,0),l.toBlob(i,"image/png")}else r.renderer.domElement.toBlob(i,"image/png")})};St.prototype.makeImage=function(t){return t===void 0&&(t={}),fS(this,t)};St.prototype.setLight=function(t,r,i,n){var a=this.parameters;t!==void 0&&a.lightColor.set(t),r!==void 0&&(a.lightIntensity=r),i!==void 0&&a.ambientColor.set(i),n!==void 0&&(a.ambientIntensity=n),this.requestRender()};St.prototype.setFog=function(t,r,i,n,a){var o=this.parameters;t!==void 0&&o.fogColor.set(t),r!==void 0&&(o.fogNear=r),i!==void 0&&(o.fogFar=i),n!==void 0&&(o.fogMode=n),a!==void 0&&(o.fogScale=a),this.requestRender()};St.prototype.setBackground=function(t){var r=this.parameters;t&&r.backgroundColor.set(t),this.setFog(r.backgroundColor),this.renderer.setClearColor(r.backgroundColor,0),this.renderer.domElement.style.backgroundColor=r.backgroundColor.getStyle(),this.requestRender()};St.prototype.setSampling=function(t){t!==void 0&&(this.parameters.sampleLevel=t,this.sampleLevel=t),this.requestRender()};St.prototype.setCamera=function(t,r,i){var n=this.parameters;if(t&&(n.cameraType=t),r&&(n.cameraFov=r),i&&(n.cameraEyeSep=i),n.cameraType==="orthographic")this.camera!==this.orthographicCamera&&(this.camera=this.orthographicCamera,this.camera.position.copy(this.perspectiveCamera.position),this.camera.up.copy(this.perspectiveCamera.up),this.updateZoom());else if(n.cameraType==="perspective"||n.cameraType==="stereo")this.camera!==this.perspectiveCamera&&(this.camera=this.perspectiveCamera,this.camera.position.copy(this.orthographicCamera.position),this.camera.up.copy(this.orthographicCamera.up));else throw new Error("Unknown cameraType '"+n.cameraType+"'");this.perspectiveCamera.fov=n.cameraFov,this.stereoCamera.eyeSep=n.cameraEyeSep,this.camera.updateProjectionMatrix(),this.requestRender()};St.prototype.setClip=function(t,r,i,n,a){var o=this.parameters;t!==void 0&&(o.clipNear=t),r!==void 0&&(o.clipFar=r),i!==void 0&&(o.clipDist=i),n!==void 0&&(o.clipMode=n),a!==void 0&&(o.clipScale=a),this.requestRender()};St.prototype.setSize=function(t,r){this.width=t||1,this.height=r||1,this.perspectiveCamera.aspect=this.width/this.height,this.orthographicCamera.left=-this.width/2,this.orthographicCamera.right=this.width/2,this.orthographicCamera.top=this.height/2,this.orthographicCamera.bottom=-this.height/2,this.camera.updateProjectionMatrix();var i=window.devicePixelRatio;this.renderer.setPixelRatio(i),this.renderer.setSize(t,r);var n=this.width*i,a=this.height*i;this.pickingTarget.setSize(n,a),this.sampleTarget.setSize(n,a),this.holdTarget.setSize(n,a),this.requestRender()};St.prototype.handleResize=function(){if(this.container===document.body)this.setSize(window.innerWidth,window.innerHeight);else{var t=this.container.getBoundingClientRect();this.setSize(t.width,t.height)}};St.prototype.updateInfo=function(t){var r=this.info,i=r.memory,n=r.render;if(t)i.programs=0,i.geometries=0,i.textures=0,n.calls=0,n.vertices=0,n.points=0;else{var a=this.renderer.info,o=a.memory,s=a.render;i.geometries=o.geometries,i.textures=o.textures,n.calls+=s.calls,n.faces+=s.triangles,n.points+=s.points}};St.prototype.animate=function(){this.signals.ticked.dispatch(this.stats);var t=window.performance.now()-this.stats.startTime;if(t>500&&!this.isStill&&this.sampleLevel<3&&this.sampleLevel!==-1){var r=this.sampleLevel;this.sampleLevel=3,this.renderPending=!0,this.render(),this.isStill=!0,this.sampleLevel=r,ge&&fe.log("rendered still frame")}window.requestAnimationFrame(this.animate)};St.prototype.pick=function(t,r){var i=this;if(this.parameters.cameraType==="stereo")return{pid:0,instance:void 0,picker:void 0};t*=window.devicePixelRatio,r*=window.devicePixelRatio,t=Math.max(t-2,0),r=Math.max(r-2,0);var n=0,a,o,s=aa?yS:bS;this.render(!0),this.renderer.readRenderTargetPixels(this.pickingTarget,t,r,5,5,s);for(var u=0;u<Cv.length;u++){var c=Cv[u]*4,f=Math.round(s[c+3]),l=i.pickingGroup.getObjectById(f);if(l)a=l.userData.instance,o=l.userData.buffer.picking;else continue;aa?n=Math.round(s[c]*255)<<16&16711680|Math.round(s[c+1]*255)<<8&65280|Math.round(s[c+2]*255)&255:n=s[c]<<16|s[c+1]<<8|s[c+2]}return{pid:n,instance:a,picker:o}};St.prototype.requestRender=function(){var t=this;this.renderPending||(window.performance.now()-this.stats.startTime>22&&(this.stats.begin(),this.isStill=!1),this.renderPending=!0,window.requestAnimationFrame(function(){t.render(),t.stats.update()}))};St.prototype.updateZoom=function(){var t=lr(this.perspectiveCamera.fov),r=2*Math.tan(t/2)*-this.camera.position.z;this.orthographicCamera.zoom=this.height/r};St.prototype.__updateClipping=function(){var t=this.parameters;if(this.cDist=this.distVector.copy(this.camera.position).length(),this.cDist||(this.camera.position.set(0,0,t.cameraZ),this.cDist=Math.abs(t.cameraZ)),(t.clipScale!=="absolute"||t.fogScale!=="absolute")&&(this.bRadius=Math.max(10,this.boundingBoxLength*.5),this.bRadius+=this.boundingBox.getCenter(this.distVector).length(),(this.bRadius===1/0||this.bRadius===-1/0||isNaN(this.bRadius))&&(this.bRadius=50)),t.clipMode=="camera")this.camera.near=t.clipNear,this.camera.far=t.clipFar;else if(t.clipScale=="absolute")this.camera.near=this.cDist-t.clipNear,this.camera.far=this.cDist+t.clipFar;else{var r=(50-t.clipNear)/50,i=-(50-t.clipFar)/50;this.camera.near=this.cDist-this.bRadius*r,this.camera.far=this.cDist+this.bRadius*i}var n=this.scene.fog;if(n.color.set(t.fogColor),t.fogMode=="camera")n.near=t.fogNear,n.far=t.fogFar;else if(t.fogScale=="absolute")n.near=this.cDist+t.fogNear,n.far=this.cDist+t.fogFar;else{var a=(50-t.fogNear)/50,o=-(50-t.fogFar)/50;n.near=this.cDist-this.bRadius*a,n.far=this.cDist+this.bRadius*o}this.camera.type==="PerspectiveCamera"?(this.camera.near=Math.max(.1,t.clipDist,this.camera.near),this.camera.far=Math.max(1,this.camera.far),n.near=Math.max(.1,n.near),n.far=Math.max(1,n.far)):this.camera.type==="OrthographicCamera"&&t.clipDist>0&&(this.camera.near=Math.max(t.clipDist,this.camera.near))};St.prototype.__updateCamera=function(){var t=this.camera;t.updateMatrix(),t.updateMatrixWorld(!0),t.updateProjectionMatrix(),hS(this.scene,t,this.renderer,this.cDist,this.bRadius),lS(this.scene,t)};St.prototype.__setVisibility=function(t,r,i,n){this.modelGroup.visible=t,this.pickingGroup.visible=r,this.backgroundGroup.visible=i,this.helperGroup.visible=n};St.prototype.__updateLights=function(){this.spotLight.color.set(this.parameters.lightColor),this.spotLight.intensity=this.parameters.lightIntensity,this.distVector.copy(this.camera.position).setLength(this.boundingBoxLength*100),this.spotLight.position.copy(this.camera.position).add(this.distVector),this.ambientLight.color.set(this.parameters.ambientColor),this.ambientLight.intensity=this.parameters.ambientIntensity};St.prototype.__renderPickingGroup=function(t){this.renderer.clearTarget(this.pickingTarget,!0,!0,!0),this.__setVisibility(!1,!0,!1,!1),this.renderer.render(this.scene,t,this.pickingTarget),this.updateInfo(),this.renderer.setRenderTarget(null)};St.prototype.__renderModelGroup=function(t,r){r?this.renderer.clearTarget(r,!0,!0,!0):this.renderer.clear(),this.__setVisibility(!1,!1,!0,!1),this.renderer.render(this.scene,t,r),r?this.renderer.clearTarget(r,!1,!0,!1):this.renderer.clearDepth(),this.updateInfo(),this.__setVisibility(!0,!1,!1,ge),this.renderer.render(this.scene,t,r),this.updateInfo()};St.prototype.__renderSuperSample=function(t){var r=this,i=P0[Math.max(0,Math.min(this.sampleLevel,5))],n=1/i.length,a=1/32;this.compositeUniforms.tForeground.value=this.sampleTarget.texture;var o=this.sampleTarget.width,s=this.sampleTarget.height;this.parameters.cameraType==="stereo"&&(o/=2);for(var u=0;u<i.length;++u){var c=i[u];t.setViewOffset(o,s,c[0],c[1],o,s),t.updateProjectionMatrix(),ud(r.scene,t);var f=n,l=-.5+(u+.5)/i.length;f+=a*l,r.compositeUniforms.scale.value=f,r.__renderModelGroup(t,r.sampleTarget),r.renderer.render(r.compositeScene,r.compositeCamera,r.holdTarget,u===0)}this.compositeUniforms.scale.value=1,this.compositeUniforms.tForeground.value=this.holdTarget.texture,t.clearViewOffset(),this.renderer.render(this.compositeScene,this.compositeCamera,null,!0)};St.prototype.__renderStereo=function(t){t===void 0&&(t=!1);var r=this.stereoCamera;r.update(this.perspectiveCamera);var i=this.renderer,n=i.getSize();i.setScissorTest(!0),i.setScissor(0,0,n.width/2,n.height),i.setViewport(0,0,n.width/2,n.height),ud(this.scene,r.cameraL),this.__render(t,r.cameraL),i.setScissor(n.width/2,0,n.width/2,n.height),i.setViewport(n.width/2,0,n.width/2,n.height),ud(this.scene,r.cameraR),this.__render(t,r.cameraR),i.setScissorTest(!1),i.setViewport(0,0,n.width,n.height)};St.prototype.__render=function(t,r){t===void 0&&(t=!1),t?this.lastRenderedPicking||this.__renderPickingGroup(r):this.sampleLevel>0&&this.parameters.cameraType!=="stereo"?this.__renderSuperSample(r):this.__renderModelGroup(r)};St.prototype.render=function(t){if(t===void 0&&(t=!1),this.rendering){fe.warn("'tried to call 'render' from within 'render'");return}this.rendering=!0,this.__updateClipping(),this.__updateCamera(),this.__updateLights(),this.updateInfo(!0),this.parameters.cameraType==="stereo"?this.__renderStereo(t):this.__render(t,this.camera),this.lastRenderedPicking=t,this.rendering=!1,this.renderPending=!1,this.signals.rendered.dispatch()};St.prototype.clear=function(){fe.log("scene cleared"),this.scene.remove(this.rotationGroup),this._initScene(),this.renderer.clear()};St.prototype.dispose=function(){this.renderer.dispose()};var _S=1,wS=3;function I0(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY;return Math.sqrt(t*t+r*r)}function AS(e){if(typeof e=="object"){if("buttons"in e)return e.buttons;if("which"in e){var t=e.which;if(t===2)return 4;if(t===3)return 2;if(t>0)return 1<<t-1}else if("button"in e){var r=e.button;if(r===1)return 4;if(r===2)return 2;if(r>=0)return 1<<r}}return 0}var Vr=function(t,r){r===void 0&&(r={}),this.domElement=t,this.signals={moved:new ht,scrolled:new ht,dragged:new ht,dropped:new ht,clicked:new ht,hovered:new ht,doubleClicked:new ht},this.position=new Ee,this.prevPosition=new Ee,this.down=new Ee,this.canvasPosition=new Ee,this.prevClickCP=new Ee,this.moving=!1,this.hovering=!0,this.scrolled=!1,this.lastMoved=1/0,this.which=0,this.buttons=0,this.pressed=!1,this.altKey=!1,this.ctrlKey=!1,this.metaKey=!1,this.shiftKey=!1,this.domElement.style.touchAction="none",this.hoverTimeout=O(r.hoverTimeout,50),this.handleScroll=O(r.handleScroll,!0),this.doubleClickSpeed=O(r.doubleClickSpeed,500),this._listen=this._listen.bind(this),this._onMousewheel=this._onMousewheel.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMousedown=this._onMousedown.bind(this),this._onMouseup=this._onMouseup.bind(this),this._onContextmenu=this._onContextmenu.bind(this),this._onTouchstart=this._onTouchstart.bind(this),this._onTouchend=this._onTouchend.bind(this),this._onTouchmove=this._onTouchmove.bind(this),this._listen();var i={passive:!1};document.addEventListener("mousewheel",this._onMousewheel,i),document.addEventListener("wheel",this._onMousewheel,i),document.addEventListener("MozMousePixelScroll",this._onMousewheel,i),document.addEventListener("mousemove",this._onMousemove,i),document.addEventListener("mousedown",this._onMousedown,i),document.addEventListener("mouseup",this._onMouseup,i),document.addEventListener("contextmenu",this._onContextmenu,i),document.addEventListener("touchstart",this._onTouchstart,i),document.addEventListener("touchend",this._onTouchend,i),document.addEventListener("touchmove",this._onTouchmove,i)},R0={key:{configurable:!0}};R0.key.get=function(){var e=0;return this.altKey&&(e+=1),this.ctrlKey&&(e+=2),this.metaKey&&(e+=4),this.shiftKey&&(e+=8),e};Vr.prototype.setParameters=function(t){t===void 0&&(t={}),this.hoverTimeout=O(t.hoverTimeout,this.hoverTimeout)};Vr.prototype._listen=function(){var t=window.performance.now(),r=this.canvasPosition;this.doubleClickPending&&t-this.lastClicked>this.doubleClickSpeed&&(this.doubleClickPending=!1),t-this.lastMoved>this.hoverTimeout&&(this.moving=!1),(this.scrolled||!this.moving&&!this.hovering)&&(this.scrolled=!1,this.hoverTimeout!==-1&&this.overElement&&(this.hovering=!0,this.signals.hovered.dispatch(r.x,r.y))),window.requestAnimationFrame(this._listen)};Vr.prototype._onMousewheel=function(t){var r=this;if(!(t.target!==this.domElement||!this.handleScroll)){t.preventDefault(),this._setKeys(t);var i=0;t.wheelDelta?i=t.wheelDelta/40:t.detail?i=-t.detail/3:i=-t.deltaY/(t.deltaMode?.33:30),this.signals.scrolled.dispatch(i),setTimeout(function(){r.scrolled=!0},this.hoverTimeout)}};Vr.prototype._onMousemove=function(t){t.target===this.domElement?(t.preventDefault(),this.overElement=!0):this.overElement=!1,this._setKeys(t),this.moving=!0,this.hovering=!1,this.lastMoved=window.performance.now(),this.prevPosition.copy(this.position),this.position.set(t.clientX,t.clientY),this._setCanvasPosition(t);var r=this.prevPosition.x-this.position.x,i=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(r,i),this.pressed&&this.signals.dragged.dispatch(r,i)};Vr.prototype._onMousedown=function(t){t.target===this.domElement&&(t.preventDefault(),this._setKeys(t),this.moving=!1,this.hovering=!1,this.down.set(t.clientX,t.clientY),this.position.set(t.clientX,t.clientY),this.which=t.which,this.buttons=AS(t),this.pressed=!0,this._setCanvasPosition(t))};Vr.prototype._onMouseup=function(t){t.target===this.domElement&&t.preventDefault(),this._setKeys(t);var r=this.canvasPosition;this._distance()<4&&(this.lastClicked=window.performance.now(),this.doubleClickPending&&this.prevClickCP.distanceTo(r)<4&&(this.signals.doubleClicked.dispatch(r.x,r.y),this.doubleClickPending=!1),this.signals.clicked.dispatch(r.x,r.y),this.doubleClickPending=!0,this.prevClickCP.copy(r)),this.which=void 0,this.buttons=void 0,this.pressed=void 0};Vr.prototype._onContextmenu=function(t){t.target===this.domElement&&t.preventDefault()};Vr.prototype._onTouchstart=function(t){if(t.target===this.domElement)switch(t.preventDefault(),this.pressed=!0,t.touches.length){case 1:{this.moving=!1,this.hovering=!1,this.down.set(t.touches[0].pageX,t.touches[0].pageY),this.position.set(t.touches[0].pageX,t.touches[0].pageY),this._setCanvasPosition(t.touches[0]);break}case 2:this.down.set((t.touches[0].pageX+t.touches[1].pageX)/2,(t.touches[0].pageY+t.touches[1].pageY)/2),this.position.set((t.touches[0].pageX+t.touches[1].pageX)/2,(t.touches[0].pageY+t.touches[1].pageY)/2),this.lastTouchDistance=I0(t)}};Vr.prototype._onTouchend=function(t){t.target===this.domElement&&t.preventDefault(),this.which=void 0,this.buttons=void 0,this.pressed=void 0};Vr.prototype._onTouchmove=function(t){switch(t.target===this.domElement?(t.preventDefault(),this.overElement=!0):this.overElement=!1,t.touches.length){case 1:{this._setKeys(t),this.which=_S,this.buttons=1,this.moving=!0,this.hovering=!1,this.lastMoved=window.performance.now(),this.prevPosition.copy(this.position),this.position.set(t.touches[0].pageX,t.touches[0].pageY),this._setCanvasPosition(t.touches[0]);var r=this.prevPosition.x-this.position.x,i=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(r,i),this.pressed&&this.signals.dragged.dispatch(r,i);break}case 2:{var n=I0(t),a=n-this.lastTouchDistance;if(this.lastTouchDistance=n,this.prevPosition.copy(this.position),this.position.set((t.touches[0].pageX+t.touches[1].pageX)/2,(t.touches[0].pageY+t.touches[1].pageY)/2),Math.abs(a)>2&&this.handleScroll&&this.position.distanceTo(this.prevPosition)<2)this.which=0,this.buttons=0,this.signals.scrolled.dispatch(a/2);else{this.which=wS,this.buttons=2;var o=this.prevPosition.x-this.position.x,s=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(o,s),this.pressed&&this.signals.dragged.dispatch(o,s)}}}};Vr.prototype._distance=function(){return this.position.distanceTo(this.down)};Vr.prototype._setCanvasPosition=function(t){var r=this.domElement.getBoundingClientRect(),i,n;"offsetX"in t&&"offsetY"in t?(i=t.offsetX,n=t.offsetY):(i=t.clientX-r.left,n=t.clientY-r.top),this.canvasPosition.set(i,r.height-n)};Vr.prototype._setKeys=function(t){this.altKey=t.altKey,this.ctrlKey=t.ctrlKey,this.metaKey=t.metaKey,this.shiftKey=t.shiftKey};Vr.prototype.dispose=function(){document.removeEventListener("mousewheel",this._onMousewheel),document.removeEventListener("wheel",this._onMousewheel),document.removeEventListener("MozMousePixelScroll",this._onMousewheel),document.removeEventListener("mousemove",this._onMousemove),document.removeEventListener("mousedown",this._onMousedown),document.removeEventListener("mouseup",this._onMouseup),document.removeEventListener("contextmenu",this._onContextmenu),document.removeEventListener("touchstart",this._onTouchstart),document.removeEventListener("touchend",this._onTouchend),document.removeEventListener("touchmove",this._onTouchmove)};Object.defineProperties(Vr.prototype,R0);var po=new Ae,_f=new Ae,Pv=new Ae,$a=new Ae,eo=new I,Tv=new er,Ma=new Ae,Ga=new I,rc=new I,Ei=function(t,r){r===void 0&&(r={}),this.stage=t,this.rotateSpeed=O(r.rotateSpeed,2),this.zoomSpeed=O(r.zoomSpeed,1.2),this.panSpeed=O(r.panSpeed,1),this.viewer=t.viewer,this.mouse=t.mouseObserver,this.controls=t.viewerControls},Wd={component:{configurable:!0},atom:{configurable:!0}};Wd.component.get=function(){return this.stage.transformComponent};Wd.atom.get=function(){return this.stage.transformAtom};Ei.prototype._setPanVector=function(t,r,i){i===void 0&&(i=0);var n=this.controls.getCanvasScaleFactor(i);Ga.set(t,r,0),Ga.multiplyScalar(this.panSpeed*n)};Ei.prototype._getRotateXY=function(t,r){return[this.rotateSpeed*-t*.01,this.rotateSpeed*r*.01]};Ei.prototype._transformPanVector=function(){this.component&&(Ma.extractRotation(this.component.transform),Ma.premultiply(this.viewer.rotationGroup.matrix),Ma.getInverse(Ma),Ga.applyMatrix4(Ma))};Ei.prototype.zoom=function(t){this.controls.zoom(this.zoomSpeed*t*.02)};Ei.prototype.pan=function(t,r){this._setPanVector(t,r),Ma.getInverse(this.viewer.rotationGroup.matrix),Ga.applyMatrix4(Ma),this.controls.translate(Ga)};Ei.prototype.panComponent=function(t,r){this.component&&(this._setPanVector(t,r),this._transformPanVector(),this.component.position.add(Ga),this.component.updateMatrix())};Ei.prototype.panAtom=function(t,r){!this.atom||!this.component||(this.atom.positionToVector3(rc),rc.add(this.viewer.translationGroup.position),rc.applyMatrix4(this.viewer.rotationGroup.matrix),this._setPanVector(t,r,rc.z),this._transformPanVector(),this.atom.positionAdd(Ga),this.component.updateRepresentations({position:!0}))};Ei.prototype.rotate=function(t,r){var i=this._getRotateXY(t,r),n=i[0],a=i[1];po.makeRotationX(a),_f.makeRotationY(n),po.multiply(_f),this.controls.applyMatrix(po)};Ei.prototype.zRotate=function(t,r){var i=this.rotateSpeed*((-t+r)/-2)*.01;Pv.makeRotationZ(i),this.controls.applyMatrix(Pv)};Ei.prototype.rotateComponent=function(t,r){if(this.component){var i=this._getRotateXY(t,r),n=i[0],a=i[1];$a.extractRotation(this.component.transform),$a.premultiply(this.viewer.rotationGroup.matrix),$a.getInverse($a),eo.set(1,0,0),eo.applyMatrix4($a),po.makeRotationAxis(eo,a),eo.set(0,1,0),eo.applyMatrix4($a),_f.makeRotationAxis(eo,n),po.multiply(_f),Tv.setFromRotationMatrix(po),this.component.quaternion.premultiply(Tv),this.component.updateMatrix()}};Object.defineProperties(Ei.prototype,Wd);var to=new I;function SS(e,t,r){return e.distanceTo(t)<e.distanceTo(r)}var Gf=function(t,r){this.stage=r,this.pid=t.pid,this.picker=t.picker,this.instance=t.instance,this.stage=r,this.controls=r.viewerControls,this.mouse=r.mouseObserver},zt={type:{configurable:!0},altKey:{configurable:!0},ctrlKey:{configurable:!0},metaKey:{configurable:!0},shiftKey:{configurable:!0},canvasPosition:{configurable:!0},component:{configurable:!0},object:{configurable:!0},position:{configurable:!0},closestBondAtom:{configurable:!0},closeAtom:{configurable:!0},arrow:{configurable:!0},atom:{configurable:!0},axes:{configurable:!0},bond:{configurable:!0},box:{configurable:!0},cone:{configurable:!0},clash:{configurable:!0},contact:{configurable:!0},cylinder:{configurable:!0},distance:{configurable:!0},ellipsoid:{configurable:!0},octahedron:{configurable:!0},point:{configurable:!0},mesh:{configurable:!0},slice:{configurable:!0},sphere:{configurable:!0},tetrahedron:{configurable:!0},torus:{configurable:!0},surface:{configurable:!0},unitcell:{configurable:!0},unknown:{configurable:!0},volume:{configurable:!0},wideline:{configurable:!0}};zt.type.get=function(){return this.picker.type};zt.altKey.get=function(){return this.mouse.altKey};zt.ctrlKey.get=function(){return this.mouse.ctrlKey};zt.metaKey.get=function(){return this.mouse.metaKey};zt.shiftKey.get=function(){return this.mouse.shiftKey};zt.canvasPosition.get=function(){return this.mouse.canvasPosition};zt.component.get=function(){return this.stage.getComponentsByObject(this.picker.data).list[0]};zt.object.get=function(){return this.picker.getObject(this.pid)};zt.position.get=function(){return this.picker.getPosition(this.pid,this.instance,this.component)};zt.closestBondAtom.get=function(){if(!(this.type!=="bond"||!this.bond)){var e=this.bond,t=this.controls,r=this.canvasPosition,i=t.getPositionOnCanvas(e.atom1),n=t.getPositionOnCanvas(e.atom2);return SS(r,i,n)?e.atom1:e.atom2}};zt.closeAtom.get=function(){var e=this.canvasPosition,t=this.closestBondAtom;if(t){var r=this.controls.getPositionOnCanvas(t);t.positionToVector3(to),this.instance&&to.applyMatrix4(this.instance.matrix),to.applyMatrix4(this.component.matrix);var i=this.controls.viewer;to.add(i.translationGroup.position),to.applyMatrix4(i.rotationGroup.matrix);var n=this.controls.getCanvasScaleFactor(to.z),a=this.component,o=a.getMaxRepresentationRadius(t.index);if(e.distanceTo(r)<=o/n)return t}};zt.arrow.get=function(){return this._objectIfType("arrow")};zt.atom.get=function(){return this._objectIfType("atom")};zt.axes.get=function(){return this._objectIfType("axes")};zt.bond.get=function(){return this._objectIfType("bond")};zt.box.get=function(){return this._objectIfType("box")};zt.cone.get=function(){return this._objectIfType("cone")};zt.clash.get=function(){return this._objectIfType("clash")};zt.contact.get=function(){return this._objectIfType("contact")};zt.cylinder.get=function(){return this._objectIfType("cylinder")};zt.distance.get=function(){return this._objectIfType("distance")};zt.ellipsoid.get=function(){return this._objectIfType("ellipsoid")};zt.octahedron.get=function(){return this._objectIfType("octahedron")};zt.point.get=function(){return this._objectIfType("point")};zt.mesh.get=function(){return this._objectIfType("mesh")};zt.slice.get=function(){return this._objectIfType("slice")};zt.sphere.get=function(){return this._objectIfType("sphere")};zt.tetrahedron.get=function(){return this._objectIfType("tetrahedron")};zt.torus.get=function(){return this._objectIfType("torus")};zt.surface.get=function(){return this._objectIfType("surface")};zt.unitcell.get=function(){return this._objectIfType("unitcell")};zt.unknown.get=function(){return this._objectIfType("unknown")};zt.volume.get=function(){return this._objectIfType("volume")};zt.wideline.get=function(){return this._objectIfType("wideline")};Gf.prototype._objectIfType=function(t){return this.type===t?this.object:void 0};Gf.prototype.getLabel=function(){var t=this.atom||this.closeAtom,r="nothing";return this.arrow?r=this.arrow.name:t?r="atom: "+t.qualifiedName()+" ("+t.structure.name+")":this.axes?r="axes":this.bond?r="bond: "+this.bond.atom1.qualifiedName()+" - "+this.bond.atom2.qualifiedName()+" ("+this.bond.structure.name+")":this.box?r=this.box.name:this.cone?r=this.cone.name:this.clash?r="clash: "+this.clash.clash.sele1+" - "+this.clash.clash.sele2:this.contact?r=this.contact.type+": "+this.contact.atom1.qualifiedName()+" - "+this.contact.atom2.qualifiedName()+" ("+this.contact.atom1.structure.name+")":this.cylinder?r=this.cylinder.name:this.distance?r="distance: "+this.distance.atom1.qualifiedName()+" - "+this.distance.atom2.qualifiedName()+" ("+this.distance.structure.name+")":this.ellipsoid?r=this.ellipsoid.name:this.octahedron?r=this.octahedron.name:this.point?r=this.point.name:this.mesh?r="mesh: "+(this.mesh.name||this.mesh.serial)+" ("+this.mesh.shape.name+")":this.slice?r="slice: "+this.slice.value.toPrecision(3)+" ("+this.slice.volume.name+")":this.sphere?r=this.sphere.name:this.surface?r="surface: "+this.surface.surface.name:this.tetrahedron?r=this.tetrahedron.name:this.torus?r=this.torus.name:this.unitcell?r="unitcell: "+this.unitcell.unitcell.spacegroup+" ("+this.unitcell.structure.name+")":this.unknown?r="unknown":this.volume?r="volume: "+this.volume.value.toPrecision(3)+" ("+this.volume.volume.name+")":this.wideline&&(r=this.wideline.name),r};Object.defineProperties(Gf.prototype,zt);var L0=function(t){this.stage=t,this.viewer=t.viewer};L0.prototype.pick=function(t,r){var i=this.viewer.pick(t,r);if(i.picker&&i.picker.type!=="ignore"&&i.pid!==void 0){var n=i.picker.array;if(n&&i.pid>=n.length)console.error("pid >= picker.array.length");else return new Gf(i,this.stage)}};var Ev=new er,Iv=new I,Rv=new I,Ul=new I,MS=new I,Lv=new Ae,Ov=new I,Dv=new Ae,ei=function(t){this.stage=t,this.signals={changed:new ht},this.viewer=t.viewer},jd={position:{configurable:!0},rotation:{configurable:!0}};jd.position.get=function(){return this.viewer.translationGroup.position};jd.rotation.get=function(){return this.viewer.rotationGroup.quaternion};ei.prototype.changed=function(){this.viewer.requestRender(),this.signals.changed.dispatch()};ei.prototype.getPositionOnCanvas=function(t,r){var i=Z2(r),n=this.viewer;return Ul.copy(t).add(n.translationGroup.position).applyMatrix4(n.rotationGroup.matrix).project(n.camera),i.set((Ul.x+1)*n.width/2,(Ul.y+1)*n.height/2)};ei.prototype.getCanvasScaleFactor=function(t){t===void 0&&(t=0);var r=this.viewer.camera;if(r instanceof ia)return 1/r.zoom;t=-t,t+=r.position.z;var i=lr(r.fov),n=-2*t*Math.tan(i/2);return n/this.viewer.height};ei.prototype.getOrientation=function(t){var r=Cu(t);r.copy(this.viewer.rotationGroup.matrix);var i=-this.viewer.camera.position.z;return r.scale(MS.set(i,i,i)),r.setPosition(this.viewer.translationGroup.position),r};ei.prototype.orient=function(t){Cu(t).decompose(Iv,Ev,Rv);var r=this.viewer;r.rotationGroup.setRotationFromQuaternion(Ev),r.translationGroup.position.copy(Iv),r.camera.position.z=-Rv.z,r.updateZoom(),this.changed()};ei.prototype.translate=function(t){this.viewer.translationGroup.position.add(Ua(t)),this.changed()};ei.prototype.center=function(t){this.viewer.translationGroup.position.copy(Ua(t)).negate(),this.changed()};ei.prototype.zoom=function(t){this.distance(this.viewer.camera.position.z*(1-t))};ei.prototype.distance=function(t){this.viewer.camera.position.z=Math.min(-1,t),this.viewer.updateZoom(),this.changed()};ei.prototype.spin=function(t,r){Lv.getInverse(this.viewer.rotationGroup.matrix),Ov.copy(Ua(t)).applyMatrix4(Lv),this.viewer.rotationGroup.rotateOnAxis(Ov,r),this.changed()};ei.prototype.rotate=function(t){this.viewer.rotationGroup.setRotationFromQuaternion(od(t)),this.changed()};ei.prototype.align=function(t){Dv.getInverse(Cu(t)),this.viewer.rotationGroup.setRotationFromMatrix(Dv),this.changed()};ei.prototype.applyMatrix=function(t){this.viewer.rotationGroup.applyMatrix(Cu(t)),this.changed()};Object.defineProperties(ei.prototype,jd);var gi=function(t,r){for(var i,n=[],a=arguments.length-2;a-- >0;)n[a]=arguments[a+2];this.pausedTime=-1,this.elapsedDuration=0,this.pausedDuration=0,this.ignoreGlobalToggle=!1,this._paused=!1,this._resolveList=[],this.duration=O(t,1e3),this.controls=r,this.startTime=window.performance.now(),(i=this)._init.apply(i,n)},Xd={done:{configurable:!0},paused:{configurable:!0}};Xd.done.get=function(){return this.alpha===1};Xd.paused.get=function(){return this._paused};gi.prototype.tick=function(t){if(!this._paused)return this.elapsedDuration=t.currentTime-this.startTime-this.pausedDuration,this.duration===0?this.alpha=1:this.alpha=Pu(0,1,this.elapsedDuration/this.duration),this._tick(t),this.done&&this._resolveList.forEach(function(r){return r()}),this.done};gi.prototype.pause=function(t){t&&(this._hold=!0),this.pausedTime===-1&&(this.pausedTime=window.performance.now()),this._paused=!0};gi.prototype.resume=function(t){!t&&this._hold||(this.pausedDuration+=window.performance.now()-this.pausedTime,this._paused=!1,this._hold=!1,this.pausedTime=-1)};gi.prototype.toggle=function(){this._paused?this.resume():this.pause()};gi.prototype.then=function(t){var r=this,i;return this.done?i=Promise.resolve():i=new Promise(function(n){return r._resolveList.push(n)}),i.then(t)};Object.defineProperties(gi.prototype,Xd);var O0=function(e){function t(r,i){for(var n=[],a=arguments.length-2;a-- >0;)n[a]=arguments[a+2];e.apply(this,[O(r,1/0),i].concat(n))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._init=function(i,n){Array.isArray(i)?this.axis=new I().fromArray(i):this.axis=O(i,new I(0,1,0)),this.angle=O(n,.01)},t.prototype._tick=function(i){!this.axis||!this.angle||this.controls.spin(this.axis,this.angle*i.lastDuration/16)},t}(gi),D0=function(e){function t(r,i){for(var n=[],a=arguments.length-2;a-- >0;)n[a]=arguments[a+2];e.apply(this,[O(r,1/0),i].concat(n)),this.angleSum=0,this.direction=1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._init=function(i,n,a){Array.isArray(i)?this.axis=new I().fromArray(i):this.axis=O(i,new I(0,1,0)),this.angleStep=O(n,.01),this.angleEnd=O(a,.2)},t.prototype._tick=function(i){if(!(!this.axis||!this.angleStep||!this.angleEnd)){var n=Pu(0,1,Math.abs(this.angleSum)/this.angleEnd),a=this.angleStep*this.direction*(1.1-n);this.controls.spin(this.axis,a*i.lastDuration/16),this.angleSum+=this.angleStep,this.angleSum>=this.angleEnd&&(this.direction*=-1,this.angleSum=-this.angleEnd)}},t}(gi),F0=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._init=function(i,n){this.moveFrom=Ua(O(i,new I)),this.moveTo=Ua(O(n,new I))},t.prototype._tick=function(){this.controls.position.lerpVectors(this.moveFrom,this.moveTo,this.alpha).negate(),this.controls.changed()},t}(gi),CS=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._init=function(i,n){this.zoomFrom=i,this.zoomTo=n},t.prototype._tick=function(){this.controls.distance(yi(this.zoomFrom,this.zoomTo,this.alpha))},t}(gi),PS=function(e){function t(){e.apply(this,arguments),this._currentRotation=new er}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._init=function(i,n){this.rotateFrom=od(i),this.rotateTo=od(n),this._currentRotation=new er},t.prototype._tick=function(){this._currentRotation.copy(this.rotateFrom).slerp(this.rotateTo,this.alpha),this.controls.rotate(this._currentRotation)},t}(gi),TS=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._init=function(i,n,a){this.valueFrom=i,this.valueTo=n,this.callback=a},t.prototype._tick=function(){this.callback(yi(this.valueFrom,this.valueTo,this.alpha))},t}(gi),ES=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._init=function(i){this.callback=i},t.prototype._tick=function(){this.alpha===1&&this.callback()},t}(gi),Hf=function(t){t===void 0&&(t=[]),this._resolveList=[],this._list=t},B0={done:{configurable:!0}};B0.done.get=function(){return this._list.every(function(e){return e.done})};Hf.prototype.then=function(t){var r=this,i;return this.done?i=Promise.resolve():i=new Promise(function(n){r._resolveList.push(n),r._list.forEach(function(a){a.then(function(){r._resolveList.forEach(function(o){o()}),r._resolveList.length=0})})}),i.then(t)};Object.defineProperties(Hf.prototype,B0);var br=function(t){this.stage=t,this.animationList=[],this.finishedList=[],this.viewer=t.viewer,this.controls=t.viewerControls},N0={paused:{configurable:!0}};N0.paused.get=function(){return this.animationList.every(function(e){return e.paused})};br.prototype.add=function(t){return t.duration===0?t.tick(this.viewer.stats):this.animationList.push(t),t};br.prototype.remove=function(t){var r=this.animationList,i=r.indexOf(t);i>-1&&r.splice(i,1)};br.prototype.run=function(t){for(var r=this,i=this.finishedList,n=this.animationList,a=n.length,o=0;o<a;++o){var s=n[o];s.tick(t)&&i.push(s)}var u=i.length;if(u){for(var c=0;c<u;++c)r.remove(i[c]);i.length=0}};br.prototype.spin=function(t,r,i){return this.add(new O0(i,this.controls,t,r))};br.prototype.rock=function(t,r,i,n){return this.add(new D0(n,this.controls,t,r,i))};br.prototype.rotate=function(t,r){var i=this.viewer.rotationGroup.quaternion.clone();return this.add(new PS(r,this.controls,i,t))};br.prototype.move=function(t,r){var i=this.controls.position.clone().negate();return this.add(new F0(r,this.controls,i,t))};br.prototype.zoom=function(t,r){var i=this.viewer.camera.position.z;return this.add(new CS(r,this.controls,i,t))};br.prototype.zoomMove=function(t,r,i){return new Hf([this.move(t,i),this.zoom(r,i)])};br.prototype.orient=function(t,r){var i=new I,n=new er,a=new I;return Cu(t).decompose(i,n,a),new Hf([this.move(i.negate(),r),this.rotate(n,r),this.zoom(-a.x,r)])};br.prototype.value=function(t,r,i,n){return this.add(new TS(n,this.controls,t,r,i))};br.prototype.timeout=function(t,r){return this.add(new ES(r,this.controls,t))};br.prototype.spinComponent=function(t,r,i,n){return this.add(new O0(n,t.controls,r,i))};br.prototype.rockComponent=function(t,r,i,n,a){return this.add(new D0(a,t.controls,r,i,n))};br.prototype.moveComponent=function(t,r,i){var n=t.controls.position.clone().negate();return this.add(new F0(i,t.controls,n,r))};br.prototype.pause=function(){this.animationList.forEach(function(t){return t.pause()})};br.prototype.resume=function(){this.animationList.forEach(function(t){return t.resume()})};br.prototype.toggle=function(){this.paused?this.resume():this.pause()};br.prototype.clear=function(){this.animationList.length=0};br.prototype.dispose=function(){this.clear()};Object.defineProperties(br.prototype,N0);var Xo=function(t,r){var i=this;if(this.fn=t,this.queue=[],this.pending=!1,this.next=this.next.bind(this),r){for(var n=0,a=r.length;n<a;++n)i.queue.push(r[n]);this.next()}};Xo.prototype.run=function(t){this.fn(t,this.next)};Xo.prototype.next=function(){var t=this,r=this.queue.shift();r!==void 0?(this.pending=!0,setTimeout(function(){return t.run(r)})):this.pending=!1};Xo.prototype.push=function(t){this.queue.push(t),this.pending||this.next()};Xo.prototype.kill=function(){this.queue.length=0};Xo.prototype.length=function(){return this.queue.length};var wr=function(t,r,i){this.type="",this.parameters={lazy:{type:"boolean"},clipNear:{type:"range",step:1,max:100,min:0,buffer:!0},clipRadius:{type:"number",precision:1,max:1e3,min:0,buffer:!0},clipCenter:{type:"vector3",precision:1,buffer:!0},flatShaded:{type:"boolean",buffer:!0},opacity:{type:"range",step:.01,max:1,min:0,buffer:!0},depthWrite:{type:"boolean",buffer:!0},side:{type:"select",buffer:!0,options:{front:"front",back:"back",double:"double"}},wireframe:{type:"boolean",buffer:!0},colorScheme:{type:"select",update:"color",options:{}},colorScale:{type:"select",update:"color",options:Tt.getScales()},colorReverse:{type:"boolean",update:"color"},colorValue:{type:"color",update:"color"},colorDomain:{type:"hidden",update:"color"},colorMode:{type:"select",update:"color",options:Tt.getModes()},roughness:{type:"range",step:.01,max:1,min:0,buffer:!0},metalness:{type:"range",step:.01,max:1,min:0,buffer:!0},diffuse:{type:"color",buffer:!0},diffuseInterior:{type:"boolean",buffer:!0},useInteriorColor:{type:"boolean",buffer:!0},interiorColor:{type:"color",buffer:!0},interiorDarkening:{type:"range",step:.01,max:1,min:0,buffer:!0},matrix:{type:"hidden",buffer:!0},disablePicking:{type:"boolean",rebuild:!0}},this.viewer=r,this.tasks=new yn,this.queue=new Xo(this.make.bind(this)),this.bufferList=[],this.parameters.colorScheme&&(this.parameters.colorScheme.options=Tt.getSchemes()),this.toBePrepared=!1};wr.prototype.init=function(t){var r=t||{};this.clipNear=O(r.clipNear,0),this.clipRadius=O(r.clipRadius,0),this.clipCenter=O(r.clipCenter,new I),this.flatShaded=O(r.flatShaded,!1),this.side=O(r.side,"double"),this.opacity=O(r.opacity,1),this.depthWrite=O(r.depthWrite,!0),this.wireframe=O(r.wireframe,!1),this.setColor(r.color,r),this.colorScheme=O(r.colorScheme,"uniform"),this.colorScale=O(r.colorScale,""),this.colorReverse=O(r.colorReverse,!1),this.colorValue=O(r.colorValue,9474192),this.colorDomain=O(r.colorDomain,void 0),this.colorMode=O(r.colorMode,"hcl"),this.visible=O(r.visible,!0),this.quality=O(r.quality,void 0),this.roughness=O(r.roughness,.4),this.metalness=O(r.metalness,0),this.diffuse=O(r.diffuse,16777215),this.diffuseInterior=O(r.diffuseInterior,!1),this.useInteriorColor=O(r.useInteriorColor,!1),this.interiorColor=O(r.interiorColor,2236962),this.interiorDarkening=O(r.interiorDarkening,0),this.lazy=O(r.lazy,!1),this.lazyProps={build:!1,bufferParams:{},what:{}},this.matrix=O(r.matrix,new Ae),this.disablePicking=O(r.disablePicking,!1);var i=this.parameters;i.sphereDetail===!0&&(i.sphereDetail={type:"integer",max:3,min:0,rebuild:"impostor"}),i.radialSegments===!0&&(i.radialSegments={type:"integer",max:25,min:5,rebuild:"impostor"}),i.openEnded===!0&&(i.openEnded={type:"boolean",rebuild:"impostor",buffer:!0}),i.disableImpostor===!0&&(i.disableImpostor={type:"boolean",rebuild:!0}),r.quality==="low"?(i.sphereDetail&&(this.sphereDetail=0),i.radialSegments&&(this.radialSegments=5)):r.quality==="medium"?(i.sphereDetail&&(this.sphereDetail=1),i.radialSegments&&(this.radialSegments=10)):r.quality==="high"?(i.sphereDetail&&(this.sphereDetail=2),i.radialSegments&&(this.radialSegments=20)):(i.sphereDetail&&(this.sphereDetail=O(r.sphereDetail,1)),i.radialSegments&&(this.radialSegments=O(r.radialSegments,10))),i.openEnded&&(this.openEnded=O(r.openEnded,!0)),i.disableImpostor&&(this.disableImpostor=O(r.disableImpostor,!1))};wr.prototype.getColorParams=function(t){return Object.assign({scheme:this.colorScheme,scale:this.colorScale,reverse:this.colorReverse,value:this.colorValue,domain:this.colorDomain,mode:this.colorMode},t)};wr.prototype.getBufferParams=function(t){return t===void 0&&(t={}),Object.assign({clipNear:this.clipNear,clipRadius:this.clipRadius,clipCenter:this.clipCenter,flatShaded:this.flatShaded,opacity:this.opacity,depthWrite:this.depthWrite,side:this.side,wireframe:this.wireframe,roughness:this.roughness,metalness:this.metalness,diffuse:this.diffuse,diffuseInterior:this.diffuseInterior,useInteriorColor:this.useInteriorColor,interiorColor:this.interiorColor,interiorDarkening:this.interiorDarkening,matrix:this.matrix,disablePicking:this.disablePicking},t)};wr.prototype.setColor=function(t,r){var i=Object.keys(Tt.getSchemes());if(typeof t=="string"&&i.includes(t.toLowerCase()))r?r.colorScheme=t:this.setParameters({colorScheme:t});else if(t!==void 0){var n=new Oe(t).getHex();r?(r.colorScheme="uniform",r.colorValue=n):this.setParameters({colorScheme:"uniform",colorValue:n})}return this};wr.prototype.prepare=function(t){};wr.prototype.create=function(){};wr.prototype.update=function(t){this.build()};wr.prototype.build=function(t){if(this.lazy&&(!this.visible||!this.opacity)){this.lazyProps.build=!0;return}if(!this.toBePrepared){this.tasks.increment(),this.make();return}this.queue.length()>0?(this.tasks.change(1-this.queue.length()),this.queue.kill()):this.tasks.increment(),this.queue.push(t||!1)};wr.prototype.make=function(t,r){var i=this;ge&&fe.time("Representation.make "+this.type);var n=function(){t?(i.update(t),i.viewer.requestRender(),i.tasks.decrement(),r&&r()):(i.clear(),i.create(),!i.manualAttach&&!i.disposed&&(ge&&fe.time("Representation.attach "+i.type),i.attach(function(){ge&&fe.timeEnd("Representation.attach "+i.type),i.tasks.decrement(),r&&r()}))),ge&&fe.timeEnd("Representation.make "+i.type)};this.toBePrepared?this.prepare(n):n()};wr.prototype.attach=function(t){this.setVisibility(this.visible),t()};wr.prototype.setVisibility=function(t,r){if(this.visible=t,this.visible&&this.opacity){var i=this.lazyProps,n=i.bufferParams,a=i.what;if(i.build)return i.build=!1,this.build(),this;(Object.keys(n).length||Object.keys(a).length)&&(i.bufferParams={},i.what={},this.updateParameters(n,a))}return this.bufferList.forEach(function(o){o.setVisibility(t)}),r||this.viewer.requestRender(),this};wr.prototype.setParameters=function(t,r,i){var n=this;r===void 0&&(r={}),i===void 0&&(i=!1);var a=t||{},o=this.parameters,s={};!this.opacity&&a.opacity!==void 0&&(this.lazyProps.build?(this.lazyProps.build=!1,i=!0):(Object.assign(s,this.lazyProps.bufferParams),Object.assign(r,this.lazyProps.what),this.lazyProps.bufferParams={},this.lazyProps.what={})),this.setColor(a.color,a);for(var u in a)if(a[u]!==void 0&&o[u]!==void 0&&(o[u].int&&(a[u]=parseInt(a[u])),o[u].float&&(a[u]=parseFloat(a[u])),!(a[u]===n[u]&&(!a[u].equals||a[u].equals(n[u]))))){if(n[u]&&n[u].copy&&a[u].copy?n[u].copy(a[u]):n[u]&&n[u].set?n[u].set(a[u]):n[u]=a[u],o[u].buffer)if(o[u].buffer===!0)s[u]=a[u];else{var c=o[u].buffer;s[c]=a[u]}o[u].update&&(r[o[u].update]=!0),o[u].rebuild&&!(o[u].rebuild==="impostor"&&an&&!n.disableImpostor)&&(i=!0)}return i?this.build():this.updateParameters(s,r),this};wr.prototype.updateParameters=function(t,r){if(t===void 0&&(t={}),this.lazy&&(!this.visible||!this.opacity)&&t.hasOwnProperty("opacity")===!1){Object.assign(this.lazyProps.bufferParams,t),Object.assign(this.lazyProps.what,r);return}this.bufferList.forEach(function(i){i.setParameters(t)}),Object.keys(r).length&&this.update(r),this.viewer.requestRender()};wr.prototype.getParameters=function(){var t=this,r={lazy:this.lazy,visible:this.visible,quality:this.quality};return Object.keys(this.parameters).forEach(function(i){t.parameters[i]!==null&&(r[i]=t[i])}),r};wr.prototype.clear=function(){var t=this;this.bufferList.forEach(function(r){t.viewer.remove(r),r.dispose()}),this.bufferList.length=0,this.viewer.requestRender()};wr.prototype.dispose=function(){this.disposed=!0,this.queue.kill(),this.tasks.dispose(),this.clear()};var Vf=function(t){var r=this;this.pending=0,this.postCount=0,this.onmessageDict={},this.onerrorDict={},this.name=t,this.blobUrl=window.URL.createObjectURL(xu.get(t)),this.worker=new Worker(this.blobUrl),xu.activeWorkerCount+=1,this.worker.onmessage=function(i){r.pending-=1;var n=i.data.__postId;ge&&fe.timeEnd("Worker.postMessage "+t+" #"+n);var a=r.onmessageDict[n];a&&a.call(r.worker,i),delete r.onmessageDict[n],delete r.onerrorDict[n]},this.worker.onerror=function(i){if(r.pending-=1,i.data){var n=i.data.__postId,a=r.onerrorDict[n];a?a.call(r.worker,i):fe.error("Worker.onerror",n,t,i),delete r.onmessageDict[n],delete r.onerrorDict[n]}else fe.error("Worker.onerror",t,i)}};Vf.prototype.post=function(t,r,i,n){t===void 0&&(t={}),this.onmessageDict[this.postCount]=i,this.onerrorDict[this.postCount]=n,t.__name=this.name,t.__postId=this.postCount,t.__debug=ge,ge&&fe.time("Worker.postMessage "+this.name+" #"+this.postCount);try{this.worker.postMessage(t,r)}catch(a){fe.error("worker.post:",a),this.worker.postMessage(t)}return this.pending+=1,this.postCount+=1,this};Vf.prototype.terminate=function(){this.worker?(this.worker.terminate(),window.URL.revokeObjectURL(this.blobUrl),xu.activeWorkerCount-=1):fe.log("no worker to terminate")};var Bo=function(t,r){r===void 0&&(r=2),this.pool=[],this.count=0,this.maxCount=Math.min(8,r),this.name=t};Bo.prototype.post=function(t,r,i,n){t===void 0&&(t={});var a=this.getNextWorker();return a?a.post(t,r,i,n):console.error("unable to get worker from pool"),this};Bo.prototype.terminate=function(){this.pool.forEach(function(t){t.terminate()})};Bo.prototype.getNextWorker=function(){for(var t=this,r,i=1/0,n=0;n<this.maxCount;++n){if(n>=t.count){r=new Vf(t.name),t.pool.push(r),t.count+=1;break}var a=t.pool[n];if(a.pending===0){r=a;break}else a.pending<i&&(i=a.pending,r=a)}return r};Bo.prototype.constructor=Bo;function cd(e){for(var t=e.length,r=t/3,i=0,n=0,a=0,o=0;o<t;o+=3)i+=e[o+0],n+=e[o+1],a+=e[o+2];return new I(i/r,n/r,a/r)}function Ea(e,t,r){return r?e.sub(r).projectOnVector(t).add(r):e.projectOnVector(t),e}function Lu(e){for(var t=1/0,r=1/0,i=1/0,n=-1/0,a=-1/0,o=-1/0,s=0,u=e.length;s<u;s+=3){var c=e[s],f=e[s+1],l=e[s+2];c<t&&(t=c),f<r&&(r=f),l<i&&(i=l),c>n&&(n=c),f>a&&(a=f),l>o&&(o=l)}return[Vt([t,r,i]),Vt([n,a,o])]}Lu.__deps=[Vt];function Wf(e,t){for(var r=0,i=t.length;r<i;r+=3){var n=t[r],a=t[r+1],o=t[r+2];t[r]=e[0]*n+e[4]*a+e[8]*o+e[12],t[r+1]=e[1]*n+e[5]*a+e[9]*o+e[13],t[r+2]=e[2]*n+e[6]*a+e[10]*o+e[14]}}function qd(e,t){for(var r=0,i=t.length;r<i;r+=3){var n=t[r],a=t[r+1],o=t[r+2];t[r]=e[0]*n+e[3]*a+e[6]*o,t[r+1]=e[1]*n+e[4]*a+e[7]*o,t[r+2]=e[2]*n+e[5]*a+e[8]*o}}function k0(e){for(var t=0,r=e.length;t<r;t+=3){var i=e[t],n=e[t+1],a=e[t+2],o=1/Math.sqrt(i*i+n*n+a*a);e[t]=i*o,e[t+1]=n*o,e[t+2]=a*o}}function Vt(e){return new Float32Array(e||3)}function wi(e,t,r){var i=t[0],n=t[1],a=t[2],o=r[0],s=r[1],u=r[2];e[0]=n*u-a*s,e[1]=a*o-i*u,e[2]=i*s-n*o}function Bi(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Cr(e,t,r){e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2]}function Sa(e,t,r){e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2]}function ai(e,t,r){r===void 0&&(r=0),e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2]}function Ct(e,t,r){r===void 0&&(r=0),t[r]=e[0],t[r+1]=e[1],t[r+2]=e[2]}function Ia(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}function co(e,t,r){pr(e,t,1/r)}co.__deps=[pr];function pr(e,t,r){e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}function zr(e,t){pr(e,t,1/Ia(t))}zr.__deps=[pr,Ia];function z0(e,t,r){e[0]=t[0]-r,e[1]=t[1]-r,e[2]=t[2]-r}function Mc(e,t,r){e[0]=t[0]+r,e[1]=t[1]+r,e[2]=t[2]+r}function fd(e,t){e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2])}function Cs(e,t){e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2])}function Yd(e,t){e[0]=-t[0],e[1]=-t[1],e[2]=-t[2]}function IS(e,t){t===void 0&&(t=9);for(var r=Math.floor(t/2),i=e.position1.length/3,n=r*i,a=n*3,o=1/t,s=Uf(e.position1,e.position2),u=new Float32Array(a),c=new Float32Array(a),f=new I,l=0;l<i;++l){var h=l*3;f.set(s[h],s[h+1],s[h+2]);for(var d=e.position1[h],p=e.position1[h+1],v=e.position1[h+2],m=0;m<r;++m){var g=r*h+m*3,x=o*(m*2+1),y=o*(m*2+2);u[g]=d+f.x*x,u[g+1]=p+f.y*x,u[g+2]=v+f.z*x,c[g]=d+f.x*y,c[g+1]=p+f.y*y,c[g+2]=v+f.z*y}}var b=on(u,c),_=nS(e.color,r),w=_,A={position:b,position1:u,position2:c,color:_,color2:w};return e.radius&&(A.radius=Nl(e.radius,r)),e.picking&&e.picking.array&&(e.picking.array=Nl(e.picking.array,r),A.picking=e.picking),e.primitiveId&&(A.primitiveId=Nl(e.primitiveId,r)),A}function U0(e,t){t===void 0&&(t=.1);for(var r=Uf(e.position1,e.position2),i=[],n=[],a=[],o=e.radius?[]:void 0,s=e.picking?[]:void 0,u=e.primitiveId?[]:void 0,c=new I,f=e.position1.length/3,l=0,h=0;h<f;++h){var d=h*3;c.set(r[d],r[d+1],r[d+2]);for(var p=c.length(),v=p/t,m=Math.floor(v/2),g=1/v,x=e.position1[d],y=e.position1[d+1],b=e.position1[d+2],_=0;_<m;++_){var w=l*3+_*3,A=g*(_*2+1),S=g*(_*2+2);i[w]=x+c.x*A,i[w+1]=y+c.y*A,i[w+2]=b+c.z*A,n[w]=x+c.x*S,n[w+1]=y+c.y*S,n[w+2]=b+c.z*S,e.color&&(a[w]=e.color[d],a[w+1]=e.color[d+1],a[w+2]=e.color[d+2]),o&&(o[l+_]=e.radius[h]),s&&(e.picking.array?s[l+_]=e.picking.array[h]:s[l+_]=h),u&&(u[l+_]=e.primitiveId[h])}l+=m}var M=new Float32Array(i),E=new Float32Array(n),T=on(M,E),H=new Float32Array(a),X=H,q={position:T,position1:M,position2:E,color:H,color2:X};return o&&(q.radius=new Float32Array(o)),s&&e.picking&&(e.picking.array=new Float32Array(s),q.picking=e.picking),u&&(q.primitiveId=new Float32Array(u)),q}function ld(e,t){t===void 0&&(t=.1);for(var r=Uf(e.position1,e.position2),i=[],n=[],a=[],o=e.radius?[]:void 0,s=e.picking?[]:void 0,u=e.primitiveId?[]:void 0,c=new I,f=e.position1.length/3,l=t,h=!0,d=0,p=0,v=0,m=0;m<f;++m){var g=m*3,x=e.position1[g],y=e.position1[g+1],b=e.position1[g+2];c.set(r[g],r[g+1],r[g+2]);var _=c.length();h&&(i[p]=x,i[p+1]=y,i[p+2]=b);for(var w=l,A=1/_;w<_;){var S=h?n:i;S[p]=x+c.x*w*A,S[p+1]=y+c.y*w*A,S[p+2]=b+c.z*w*A,h&&(d++,p=d*3),h=!h,l=t,w+=t}h&&(n[p]=e.position2[g],n[p+1]=e.position2[g+1],n[p+2]=e.position2[g+2],d++,p=d*3),l=w-_;for(var M=v;M<d;M++){if(e.color){var E=M*3;a[E]=e.color[g],a[E+1]=e.color[g+1],a[E+2]=e.color[g+2]}o&&(o[M]=e.radius[m]),s&&(e.picking.array?s[M]=e.picking.array[m]:s[M]=m),u&&(u[M]=e.primitiveId[m])}v=d}if(!h&&f>0){var T=d*3;n[T]=e.position2[3*f-3],n[T+1]=e.position2[3*f-2],n[T+1]=e.position2[3*f-1]}var H=new Float32Array(i),X=new Float32Array(n),q=on(H,X),Z=new Float32Array(a),Q=Z,N={position:q,position1:H,position2:X,color:Z,color2:Q};return o&&(N.radius=new Float32Array(o)),s&&e.picking&&(e.picking.array=new Float32Array(s),N.picking=e.picking),u&&(N.primitiveId=new Float32Array(u)),N}function RS(e,t){e.toArray!==void 0?e=e.toArray():e.x!==void 0?e=[e.x,e.y,e.z]:e.r!==void 0&&(e=[e.r,e.g,e.b]),t.push.apply(t,e)}var oa=new I,Ir=function(){},Zd={Picker:{configurable:!0},Buffer:{configurable:!0}};Zd.Picker.get=function(){return Ti.get(this.type)};Zd.Buffer.get=function(){return mi.get(this.type)};Ir.getShapeKey=function(t){return this.type+t[0].toUpperCase()+t.substr(1)};Ir.expandBoundingBox=function(t,r){};Ir.valueToShape=function(t,r,i){var n=t._primitiveData[this.getShapeKey(r)],a=this.fields[r];switch(a){case"v3":case"c":RS(i,n);break;default:n.push(i)}};Ir.objectToShape=function(t,r){var i=this;Object.keys(this.fields).forEach(function(n){i.valueToShape(t,n,r[n])}),this.valueToShape(t,"name",r.name),this.expandBoundingBox(t.boundingBox,r)};Ir.valueFromShape=function(t,r,i){var n=t._primitiveData[this.getShapeKey(i)],a=this.fields[i];switch(a){case"v3":return new I().fromArray(n,3*r);case"c":return new Oe().fromArray(n,3*r);default:return n[r]}};Ir.objectFromShape=function(t,r){var i=this,n=this.valueFromShape(t,r,"name");n===void 0&&(n=this.type+": "+r+" ("+t.name+")");var a={shape:t,name:n};return Object.keys(this.fields).forEach(function(o){a[o]=i.valueFromShape(t,r,o)}),a};Ir.arrayFromShape=function(t,r){var i=t._primitiveData[this.getShapeKey(r)],n=this.fields[r];switch(n){case"s":return i;default:return new Float32Array(i)}};Ir.dataFromShape=function(t){var r=this,i={};return this.Picker&&(i.picking=new this.Picker(t)),Object.keys(this.fields).forEach(function(n){i[n]=r.arrayFromShape(t,n)}),i};Ir.bufferFromShape=function(t,r){return new this.Buffer(this.dataFromShape(t),r)};Object.defineProperties(Ir,Zd);Ir.type="";Ir.fields={};var qo=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.positionFromShape=function(i,n){return this.valueFromShape(i,n,"position")},t.expandBoundingBox=function(i,n){i.expandByPoint(oa.fromArray(n.position))},t}(Ir);qo.type="sphere";qo.fields={position:"v3",color:"c",radius:"f"};var Xa=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.positionFromShape=function(i,n){return this.valueFromShape(i,n,"position")},t.expandBoundingBox=function(i,n){i.expandByPoint(oa.fromArray(n.position))},t}(Ir);Xa.type="box";Xa.fields={position:"v3",color:"c",size:"f",heightAxis:"v3",depthAxis:"v3"};var jf=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Xa);jf.type="octahedron";var Xf=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Xa);Xf.type="tetrahedron";var qa=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.positionFromShape=function(i,n){var a=this.valueFromShape(i,n,"position1"),o=this.valueFromShape(i,n,"position2");return a.add(o).multiplyScalar(.5)},t.expandBoundingBox=function(i,n){i.expandByPoint(oa.fromArray(n.position1)),i.expandByPoint(oa.fromArray(n.position2))},t.bufferFromShape=function(i,n){n===void 0&&(n={});var a=this.dataFromShape(i);return this.type==="cylinder"&&n.dashedCylinder&&(a=U0(a)),new this.Buffer(a,n)},t}(Ir);qa.type="cylinder";qa.fields={position1:"v3",position2:"v3",color:"c",radius:"f"};var qf=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(qa);qf.type="arrow";var Yf=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(qa);Yf.type="cone";var Yo=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(qo);Yo.type="ellipsoid";Yo.fields={position:"v3",color:"c",radius:"f",majorAxis:"v3",minorAxis:"v3"};var Zf=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Yo);Zf.type="torus";var Kf=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.positionFromShape=function(i,n){return this.valueFromShape(i,n,"position")},t.expandBoundingBox=function(i,n){i.expandByPoint(oa.fromArray(n.position))},t}(Ir);Kf.type="text";Kf.fields={position:"v3",color:"c",size:"f",text:"s"};var Ou=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.positionFromShape=function(i,n){return this.valueFromShape(i,n,"position")},t.expandBoundingBox=function(i,n){i.expandByPoint(oa.fromArray(n.position))},t}(Ir);Ou.type="point";Ou.fields={position:"v3",color:"c"};var Du=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.positionFromShape=function(i,n){var a=this.valueFromShape(i,n,"position1"),o=this.valueFromShape(i,n,"position2");return a.add(o).multiplyScalar(.5)},t.expandBoundingBox=function(i,n){i.expandByPoint(oa.fromArray(n.position1)),i.expandByPoint(oa.fromArray(n.position2))},t}(Ir);Du.type="wideline";Du.fields={position1:"v3",position2:"v3",color:"c"};function LS(e){for(var t=e.x,r=e.y,i=e.z,n=new ir,a=t.length,o=n.min,s=n.max,u=0;u<a;u++)o.x=Math.min(t[u],o.x),o.y=Math.min(r[u],o.y),o.z=Math.min(i[u],o.z),s.x=Math.max(t[u],s.x),s.y=Math.max(r[u],s.y),s.z=Math.max(i[u],s.z);return n}var Ha=function(t,r){var i=this;this.exp=3;var n=r||LS(t);this.minX=n.min.x,this.minY=n.min.y,this.minZ=n.min.z,this.boundX=(n.max.x-this.minX>>this.exp)+1,this.boundY=(n.max.y-this.minY>>this.exp)+1,this.boundZ=(n.max.z-this.minZ>>this.exp)+1;for(var a=this.boundX*this.boundY*this.boundZ,o=t.count!==void 0?t.count:t.x.length,s=t.x,u=t.y,c=t.z,f=0,l=new Uint32Array(a),h=new Int32Array(o),d=0;d<o;++d){var p=s[d]-i.minX>>i.exp,v=u[d]-i.minY>>i.exp,m=c[d]-i.minZ>>i.exp,g=(p*i.boundY+v)*i.boundZ+m;(l[g]+=1)===1&&(f+=1),h[d]=g}for(var x=new Uint16Array(f),y=0,b=0;y<a;++y){var _=l[y];_>0&&(l[y]=b+1,x[b]=_,b+=1)}for(var w=new Uint32Array(f),A=1;A<f;++A)w[A]+=w[A-1]+x[A-1];for(var S=new Uint16Array(f),M=new Int32Array(o),E=0;E<o;++E){var T=l[h[E]];if(T>0){var H=T-1;M[w[H]+S[H]]=E,S[H]+=1}}this.grid=l,this.bucketCount=x,this.bucketOffset=w,this.bucketArray=M,this.xArray=s,this.yArray=u,this.zArray=c};Ha.prototype.within=function(t,r,i,n){var a=[];return this.eachWithin(t,r,i,n,function(o){return a.push(o)}),a};Ha.prototype.eachWithin=function(t,r,i,n,a){for(var o=this,s=n*n,u=Math.max(0,t-n-this.minX>>this.exp),c=Math.max(0,r-n-this.minY>>this.exp),f=Math.max(0,i-n-this.minZ>>this.exp),l=Math.min(this.boundX,(t+n-this.minX>>this.exp)+1),h=Math.min(this.boundY,(r+n-this.minY>>this.exp)+1),d=Math.min(this.boundZ,(i+n-this.minZ>>this.exp)+1),p=u;p<l;++p)for(var v=c;v<h;++v)for(var m=f;m<d;++m){var g=(p*o.boundY+v)*o.boundZ+m,x=o.grid[g];if(x>0)for(var y=x-1,b=o.bucketOffset[y],_=o.bucketCount[y],w=b+_,A=b;A<w;++A){var S=o.bucketArray[A],M=o.xArray[S]-t,E=o.yArray[S]-r,T=o.zArray[S]-i,H=M*M+E*E+T*T;H<=s&&a(S,H)}}};var Wr=function(t){this._fields=this._defaultFields,this._init(0)};Wr.prototype._init=function(t){var r=this;this.length=t,this.count=0;for(var i=0,n=this._fields.length;i<n;++i){var a=r._fields[i],o=a[0],s=a[1],u=a[2];r._initField(o,s,u)}};Wr.prototype._initField=function(t,r,i){this[t]=p0(i,this.length*r)};Wr.prototype.addField=function(t,r,i){this._fields.push([t,r,i]),this._initField(t,r,i)};Wr.prototype.resize=function(t){var r=this;this.length=Math.round(t||0),this.count=Math.min(this.count,this.length);for(var i=0,n=this._fields.length;i<n;++i){var a=r._fields[i][0],o=r._fields[i][1],s=r.length*o,u=new r[a].constructor(s);r[a].length>s?u.set(r[a].subarray(0,s)):u.set(r[a]),r[a]=u}};Wr.prototype.growIfFull=function(){if(this.count>=this.length){var t=Math.round(this.length*1.5);this.resize(Math.max(256,t))}};Wr.prototype.copyFrom=function(t,r,i,n){for(var a=this,o=0,s=this._fields.length;o<s;++o)for(var u=a._fields[o][0],c=a._fields[o][1],f=a[u],l=t[u],h=0;h<n;++h)for(var d=c*(r+h),p=c*(i+h),v=0;v<c;++v)f[d+v]=l[p+v]};Wr.prototype.copyWithin=function(t,r,i){for(var n=this,a=0,o=this._fields.length;a<o;++a)for(var s=n._fields[a][0],u=n._fields[a][1],c=n[s],f=0;f<i;++f)for(var l=u*(t+f),h=u*(r+f),d=0;d<u;++d)c[l+d]=c[h+d]};Wr.prototype.sort=function(t){fe.time("Store.sort");var r=this,i=new this.constructor(1);function n(o,s){o!==s&&(i.copyFrom(r,0,o,1),r.copyWithin(o,s,1),r.copyFrom(i,s,0,1))}function a(o,s){if(o<s){var u=Math.floor((o+s)/2),c=o,f=s;do{for(;t(c,u)<0;)c+=1;for(;t(f,u)>0;)f-=1;c<=f&&(c===u?u=f:f===u&&(u=c),n(c,f),c+=1,f-=1)}while(c<=f);a(o,f),a(c,s)}}a(0,this.count-1),fe.timeEnd("Store.sort")};Wr.prototype.clear=function(){this.count=0};Wr.prototype.dispose=function(){var t=this;delete this.length,delete this.count;for(var r=0,i=this._fields.length;r<i;++r){var n=t._fields[r][0];delete t[n]}};var OS=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={_defaultFields:{configurable:!0}};return r._defaultFields.get=function(){return[["index1",1,"int32"],["index2",1,"int32"],["type",1,"int8"]]},t.prototype.addContact=function(n,a,o){this.growIfFull();var s=this.count;n<a?(this.index1[s]=n,this.index2[s]=a):(this.index2[s]=n,this.index1[s]=a),o&&(this.type[s]=o),this.count+=1},Object.defineProperties(t.prototype,r),t}(Wr);function Jf(e){return e-=e>>>1&1431655765,e=(e&858993459)+(e>>>2&858993459),(e+(e>>>4)&252645135)*16843009>>>24}var lt=function(t,r){this.length=t,this._words=new Uint32Array(t+32>>>5),r===!0&&this.setAll()};lt.prototype.get=function(t){return(this._words[t>>>5]&1<<t)!==0};lt.prototype.set=function(t){this._words[t>>>5]|=1<<t};lt.prototype.clear=function(t){this._words[t>>>5]&=~(1<<t)};lt.prototype.flip=function(t){this._words[t>>>5]^=1<<t};lt.prototype._assignRange=function(t,r,i){if(!(r<t)){for(var n=this._words,a=i===!0?4294967295:0,o=t>>>5,s=r>>>5,u=o;u<s;++u)n[u]=a;var c=o<<5,f=s<<5;if(i===!0)if(r-t<32)for(var l=t,h=r+1;l<h;++l)n[l>>>5]|=1<<l;else{for(var d=t,p=c;d<p;++d)n[d>>>5]|=1<<d;for(var v=f,m=r+1;v<m;++v)n[v>>>5]|=1<<v}else if(r-t<32)for(var g=t,x=r+1;g<x;++g)n[g>>>5]&=~(1<<g);else{for(var y=t,b=c;y<b;++y)n[y>>>5]&=~(1<<y);for(var _=f,w=r+1;_<w;++_)n[_>>>5]&=~(1<<_)}return this}};lt.prototype.setRange=function(t,r){return this._assignRange(t,r,!0)};lt.prototype.clearRange=function(t,r){return this._assignRange(t,r,!1)};lt.prototype.setBits=function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];for(var i=this._words,n=t.length,a=0;a<n;++a){var o=t[a];i[o>>>5]|=1<<o}return this};lt.prototype.clearBits=function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];for(var i=this._words,n=t.length,a=0;a<n;++a){var o=t[a];i[o>>>5]&=~(1<<o)}return this};lt.prototype.setAll=function(){return this._assignRange(0,this.length-1,!0)};lt.prototype.clearAll=function(){return this._assignRange(0,this.length-1,!1)};lt.prototype.flipAll=function(){for(var t=this._words.length,r=this._words,i=32-this.length%32,n=0;n<t-1;++n)r[n]=~r[n];return r[t-1]=~(r[t-1]<<i)>>>i,this};lt.prototype._isRangeValue=function(t,r,i){if(!(r<t)){for(var n=this._words,a=i===!0?4294967295:0,o=t>>>5,s=r>>>5,u=o;u<s;++u)if(n[u]!==a)return!1;if(r-t<32){for(var c=t,f=r+1;c<f;++c)if(!!(n[c>>>5]&1<<c)!==i)return!1}else{for(var l=o<<5,h=s<<5,d=t,p=l<<5;d<p;++d)if(!!(n[d>>>5]&1<<d)!==i)return!1;for(var v=h,m=r+1;v<m;++v)if(!!(n[v>>>5]&1<<v)!==i)return!1}return!0}};lt.prototype.isRangeSet=function(t,r){return this._isRangeValue(t,r,!0)};lt.prototype.isRangeClear=function(t,r){return this._isRangeValue(t,r,!1)};lt.prototype.isAllSet=function(){return this._isRangeValue(0,this.length-1,!0)};lt.prototype.isAllClear=function(){return this._isRangeValue(0,this.length-1,!1)};lt.prototype.isSet=function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];for(var i=this._words,n=t.length,a=0;a<n;++a){var o=t[a];if(!(i[o>>>5]&1<<o))return!1}return!0};lt.prototype.isClear=function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];for(var i=this._words,n=t.length,a=0;a<n;++a){var o=t[a];if(i[o>>>5]&1<<o)return!1}return!0};lt.prototype.isEqualTo=function(t){for(var r=this._words,i=t._words,n=Math.min(r.length,i.length),a=0;a<n;++a)if(r[a]!==i[a])return!1;return!0};lt.prototype.getSize=function(){for(var t=this._words.length,r=this._words,i=0,n=0;n<t;++n)i+=Jf(r[n]);return i};lt.prototype.difference=function(t){for(var r=this._words,i=t._words,n=Math.min(r.length,i.length),a=0;a<n;++a)r[a]=r[a]&~i[a];for(var o=r.length;o<n;++o)r[o]=0;return this};lt.prototype.union=function(t){for(var r=this._words,i=t._words,n=Math.min(r.length,i.length),a=0;a<n;++a)r[a]|=i[a];for(var o=r.length;o<n;++o)r[o]=0;return this};lt.prototype.intersection=function(t){for(var r=this._words,i=t._words,n=Math.min(r.length,i.length),a=0;a<n;++a)r[a]&=i[a];for(var o=r.length;o<n;++o)r[o]=0;return this};lt.prototype.intersects=function(t){for(var r=this._words,i=t._words,n=Math.min(r.length,i.length),a=0;a<n;++a)if(r[a]&i[a])return!0;return!1};lt.prototype.getIntersectionSize=function(t){for(var r=this._words,i=t._words,n=Math.min(r.length,i.length),a=0,o=0;o<n;++o)a+=Jf(r[o]&i[o]);return a};lt.prototype.makeIntersection=function(t){var r=this._words,i=t._words,n=Math.min(r.length,i.length),a=new Uint32Array(n),o=Object.create(lt.prototype);o._words=a,o.length=Math.min(this.length,t.length);for(var s=0;s<n;++s)a[s]=r[s]&i[s];return o};lt.prototype.forEach=function(t){for(var r=this._words.length,i=this._words,n=0,a=0;a<r;++a)for(var o=i[a];o!==0;){var s=o&-o,u=(a<<5)+Jf(s-1);t(u,n),o^=s,++n}};lt.prototype.toArray=function(){for(var t=this._words,r=new Array(this.getSize()),i=this._words.length,n=0,a=0;a<i;++a)for(var o=t[a];o!==0;){var s=o&-o;r[n++]=(a<<5)+Jf(s-1),o^=s}return r};lt.prototype.toString=function(){return"{"+this.toArray().join(",")+"}"};lt.prototype.toSeleString=function(){var t=this.toArray().join(",");return t?"@"+t:"NONE"};lt.prototype.clone=function(){var t=Object.create(lt.prototype);return t.length=this.length,t._words=new Uint32Array(this._words),t};function G0(e){for(var t=e.edgeCount,r=e.nodeCount,i=e.nodeArray1,n=e.nodeArray2,a=new Uint8Array(r),o=new Int32Array(r),s=0;s<t;++s)a[i[s]]+=1,a[n[s]]+=1;for(var u=1;u<r;++u)o[u]+=o[u-1]+a[u-1];for(var c=t*2,f=new Int32Array(c),l=0;l<c;++l)f[l]=-1;for(var h=0;h<t;++h){for(var d=i[h],p=n[h],v=o[d];f[v]!==-1&&v<c;)v+=1;f[v]=h;for(var m=o[p];f[m]!==-1&&m<c;)m+=1;f[m]=h}return{countArray:a,offsetArray:o,indexArray:f}}function DS(){return{types:[],groups:[],centers:{x:[],y:[],z:[]},atomSets:[]}}function Er(e,t){return e===void 0&&(e=0),t===void 0&&(t=0),{type:e,group:t,x:0,y:0,z:0,atomSet:[]}}function mr(e,t){e.x+=t.x,e.y+=t.y,e.z+=t.z,e.atomSet.push(t.index)}function gr(e,t){var r=t.atomSet.length;if(r>0){var i=e.types,n=e.groups,a=e.centers,o=e.atomSets;i.push(t.type),n.push(t.group),a.x.push(t.x/r),a.y.push(t.y/r),a.z.push(t.z/r),o.push(t.atomSet)}}var FS=0,Qf=1,$f=2,el=3,tl=4,BS=0,rl=1,il=2,Ya=3,Un=4,Gn=5,nl=6,Va=0,Kd=1,Jd=2,Qd=3,Zo=4,Ko=5,Jo=6,NS=["D-BETA-PEPTIDE, C-GAMMA LINKING","D-GAMMA-PEPTIDE, C-DELTA LINKING","D-PEPTIDE COOH CARBOXY TERMINUS","D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING","L-GAMMA-PEPTIDE, C-DELTA LINKING","L-PEPTIDE COOH CARBOXY TERMINUS","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE LINKING","PEPTIDE LINKING","PEPTIDE-LIKE"],kS=["RNA OH 3 PRIME TERMINUS","RNA OH 5 PRIME TERMINUS","RNA LINKING"],zS=["DNA OH 3 PRIME TERMINUS","DNA OH 5 PRIME TERMINUS","DNA LINKING","L-DNA LINKING","L-RNA LINKING"],H0=["D-SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE","L-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING","SACCHARIDE"],US=["OTHER"],GS=["NON-POLYMER"],HS=GS.concat(US,H0),V0=["h","g","i"],W0=["e","b"],j0=["s","t","l",""],VS={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109,DS:110,RG:111,CN:112,NH:113,FL:114,MC:115,LV:116,TS:117,OG:118},WS=0,jS={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2,110:2,111:2,112:2,113:2,114:2,115:2,116:2,117:2,118:2},XS=2,qS={1:.31,2:.28,3:1.28,4:.96,5:.84,6:.76,7:.71,8:.66,9:.57,10:.58,11:1.66,12:1.41,13:1.21,14:1.11,15:1.07,16:1.05,17:1.02,18:1.06,19:2.03,20:1.76,21:1.7,22:1.6,23:1.53,24:1.39,25:1.39,26:1.32,27:1.26,28:1.24,29:1.32,30:1.22,31:1.22,32:1.2,33:1.19,34:1.2,35:1.2,36:1.16,37:2.2,38:1.95,39:1.9,40:1.75,41:1.64,42:1.54,43:1.47,44:1.46,45:1.42,46:1.39,47:1.45,48:1.44,49:1.42,50:1.39,51:1.39,52:1.38,53:1.39,54:1.4,55:2.44,56:2.15,57:2.07,58:2.04,59:2.03,60:2.01,61:1.99,62:1.98,63:1.98,64:1.96,65:1.94,66:1.92,67:1.92,68:1.89,69:1.9,70:1.87,71:1.87,72:1.75,73:1.7,74:1.62,75:1.51,76:1.44,77:1.41,78:1.36,79:1.36,80:1.32,81:1.45,82:1.46,83:1.48,84:1.4,85:1.5,86:1.5,87:2.6,88:2.21,89:2.15,90:2.06,91:2,92:1.96,93:1.9,94:1.87,95:1.8,96:1.69,97:1.6,98:1.6,99:1.6,100:1.6,101:1.6,102:1.6,103:1.6,104:1.6,105:1.6,106:1.6,107:1.6,108:1.6,109:1.6,110:1.6,111:1.6,112:1.6,113:1.6,114:1.6,115:1.6,116:1.6,117:1.6,118:1.6},YS=1.6,X0={1:[1],2:[0],3:[1],4:[2],5:[3],6:[4],7:[3],8:[2],9:[1],10:[0],11:[1],12:[2],13:[6],14:[6],15:[3,5,7],16:[2,4,6],17:[1],18:[0],19:[1],20:[2],31:[3],32:[4],33:[3,5],34:[2,4,6],35:[1],36:[0],37:[1],38:[2],49:[3],50:[4],51:[3,5],52:[2],53:[1,2,5],54:[0,2],55:[1],56:[2],81:[3],82:[4],83:[3],84:[2],85:[1],86:[0],87:[1],88:[2]},ZS=-1,KS={1:1,2:2,3:1,4:2,5:3,6:4,7:5,8:6,9:7,10:8,11:1,12:2,13:3,14:4,15:5,16:6,17:7,18:8,19:1,20:2,21:3,22:4,23:5,24:6,25:7,26:8,27:9,28:10,29:11,30:2,31:3,32:4,33:5,34:6,35:7,36:8,37:1,38:2,39:3,40:4,41:5,42:6,43:7,44:8,45:9,46:10,47:11,48:2,49:3,50:4,51:5,52:6,53:7,54:8,55:1,56:2,57:3,58:4,59:3,60:4,61:5,62:6,63:7,64:8,65:9,66:10,67:11,68:12,69:13,70:14,71:15,72:4,73:5,74:6,75:7,76:8,77:9,78:10,79:11,80:2,81:3,82:4,83:5,84:6,85:7,86:8,87:1,88:2,89:3,90:4,91:3,92:4,93:5,94:6,95:7,96:8,97:9,98:10,99:11,100:12,101:13,102:14,103:15,104:2,105:2,106:2,107:2,108:2,109:2,110:2,111:2,112:2,113:3,114:4,115:5,116:6,117:7,118:8},JS=2,Fv={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53]},QS=[0,0,0],wf={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O"},Qo=Object.keys(wf),q0=["A","C","T","G","U","I"],Y0=["DA","DC","DT","DG","DU","DI"],$S=["A","G","I","DA","DG","DI"],wu=q0.concat(Y0),Af=["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP3","TIP4","SPC"],e3=["118","119","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","543","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MLT","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","NCO","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","OHX"],t3=["045","0AT","0BD","0MK","0NZ","0TS","0V4","0XY","0YT","10M","147","149","14T","15L","16G","18T","18Y","1AR","1BW","1GL","1GN","1JB","1LL","1NA","1S3","26M","26Q","26R","26V","26W","26Y","27C","289","291","293","2DG","2F8","2FG","2FL","2FP","2GL","2M4","2M5","32O","34V","3CM","3DO","3DY","3FM","3LR","3MF","3MG","3SA","3ZW","46D","46M","46Z","48Z","4CQ","4GC","4NN","50A","5DI","5GF","5MM","5RP","5SA","5SP","64K","6PG","6SA","7JZ","7SA","A1Q","A2G","AAB","AAL","AAO","ABC","ABD","ABE","ABF","ABL","ACG","ACI","ACR","ACX","ADA","ADG","ADR","AF1","AFD","AFL","AFO","AFP","AFR","AGC","AGH","AGL","AHR","AIG","ALL","ALX","AMU","AOG","AOS","ARA","ARB","ARE","ARI","ASG","ASO","AXP","AXR","B0D","B16","B2G","B4G","B6D","B8D","B9D","BBK","BCD","BDG","BDP","BDR","BEM","BFP","BGC","BGL","BGP","BGS","BHG","BMA","BMX","BNG","BNX","BOG","BRI","BXF","BXP","BXX","BXY","C3X","C4X","C5X","CAP","CBI","CBK","CBS","CDR","CEG","CGF","CHO","CR1","CR6","CRA","CT3","CTO","CTR","CTT","D6G","DAF","DAG","DDA","DDB","DDL","DEL","DFR","DFX","DG0","DGC","DGD","DGM","DGS","DIG","DLF","DLG","DMU","DNO","DOM","DP5","DQQ","DQR","DR2","DR3","DR4","DRI","DSR","DT6","DVC","E4P","E5G","EAG","EBG","EBQ","EGA","EJT","EPG","ERE","ERI","F1P","F1X","F6P","FBP","FCA","FCB","FCT","FDP","FDQ","FFC","FIX","FMO","FRU","FSI","FU4","FUB","FUC","FUD","FUL","FXP","G16","G1P","G2F","G3I","G4D","G4S","G6D","G6P","G6S","GAC","GAD","GAL","GC1","GC4","GCD","GCN","GCO","GCS","GCT","GCU","GCV","GCW","GCX","GE1","GFG","GFP","GIV","GL0","GL2","GL5","GL6","GL7","GL9","GLA","GLB","GLC","GLD","GLF","GLG","GLO","GLP","GLS","GLT","GLW","GMH","GN1","GNX","GP1","GP4","GPH","GPM","GQ1","GQ2","GQ4","GS1","GS4","GSA","GSD","GTE","GTH","GTK","GTR","GTZ","GU0","GU1","GU2","GU3","GU4","GU5","GU6","GU8","GU9","GUF","GUP","GUZ","GYP","GYV","H2P","HDL","HMS","HS2","HSD","HSG","HSH","HSJ","HSQ","HSR","HSU","HSX","HSY","HSZ","IAB","IDG","IDR","IDS","IDT","IDU","IDX","IDY","IMK","IN1","IPT","ISL","KBG","KD2","KDA","KDM","KDO","KFN","KO1","KO2","KTU","L6S","LAG","LAI","LAK","LAO","LAT","LB2","LBT","LCN","LDY","LGC","LGU","LM2","LMT","LMU","LOG","LOX","LPK","LSM","LTM","LVZ","LXB","LXZ","M1F","M3M","M6P","M8C","MA1","MA2","MA3","MAB","MAG","MAL","MAN","MAT","MAV","MAW","MBG","MCU","MDA","MDM","MDP","MFA","MFB","MFU","MG5","MGA","MGL","MLB","MMA","MMN","MN0","MRP","MTT","MUG","MVP","MXY","N1L","N9S","NAA","NAG","NBG","NDG","NED","NG1","NG6","NGA","NGB","NGC","NGE","NGF","NGL","NGS","NGY","NHF","NM6","NM9","NTF","NTO","NTP","NXD","NYT","OPG","OPM","ORP","OX2","P3M","P53","P6P","PA5","PNA","PNG","PNW","PRP","PSJ","PSV","PTQ","QDK","QPS","QV4","R1P","R1X","R2B","R5P","RAA","RAE","RAF","RAM","RAO","RAT","RB5","RBL","RCD","RDP","REL","RER","RF5","RG1","RGG","RHA","RIB","RIP","RNS","RNT","ROB","ROR","RPA","RST","RUB","RUU","RZM","S6P","S7P","SA0","SCR","SDD","SF6","SF9","SG4","SG5","SG6","SG7","SGA","SGC","SGD","SGN","SGS","SHB","SHG","SI3","SIO","SOE","SOL","SSG","SUC","SUP","SUS","T6P","T6T","TAG","TCB","TDG","TGK","TGY","TH1","TIA","TM5","TM6","TM9","TMR","TMX","TOA","TOC","TRE","TYV","UCD","UDC","VG1","X0X","X1X","X2F","X4S","X5S","X6X","XBP","XDN","XDP","XIF","XIM","XLF","XLS","XMM","XUL","XXR","XYP","XYS","YO5","Z3Q","Z6J","Z9M","ZDC","ZDM"],r3=["CA","C","N","O","O1","O2","OC1","OC2","OX1","OXT","H","H1","H2","H3","HA","HN","BB"],Z0=["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"],Ui={};Ui[Kd]={trace:"CA",direction1:"C",direction2:["O","OC1","O1","OX1","OXT"],backboneStart:"N",backboneEnd:"C"};Ui[Jd]={trace:["C4'","C4*"],direction1:["C1'","C1*"],direction2:["C3'","C3*"],backboneStart:"P",backboneEnd:["O3'","O3*"]};Ui[Qd]={trace:["C3'","C3*"],direction1:["C2'","C2*"],direction2:["O4'","O4*"],backboneStart:"P",backboneEnd:["O3'","O3*"]};Ui[Zo]={trace:["CA","BB"],backboneStart:["CA","BB"],backboneEnd:["CA","BB"]};Ui[Ko]={trace:["C4'","C4*","P"],backboneStart:["C4'","C4*","P"],backboneEnd:["C4'","C4*","P"]};Ui[Jo]={trace:["C3'","C3*","C2'","P"],backboneStart:["C3'","C3*","C2'","P"],backboneEnd:["C3'","C3*","C2'","P"]};Ui[Va]={};function ro(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;default:return 8}}var Bv=new Map([[2,lr(180)],[3,lr(120)],[4,lr(109.4721)],[6,lr(90)]]);function Sf(e,t){var r=[],i=new I,n=new I;return i.subVectors(t,e),e.eachBondedAtom(function(a){a.number!==1&&(n.subVectors(a,e),r.push(i.angleTo(n)))}),r}function Nv(e,t){var r=e.clone(),i=new I;i.subVectors(t,e);var n=[new I,new I],a=0;if(e.eachBondedAtom(function(s){a>1||s.number!==1&&(r.index=s.index,n[a++].subVectors(s,e))}),a===1&&r.eachBondedAtom(function(s){a>1||s.number!==1&&s.index!==e.index&&n[a++].subVectors(s,e)}),a===2){var o=n[0].cross(n[1]);return Math.abs(Math.PI/2-o.angleTo(i))}}function i3(e){var t=e.structure.getBondProxy(),r=e.number,i=r===8||r===7;if(i&&e.bondCount===4)return!1;var n=!1;return e.eachBond(function(a){if(a.bondOrder>1){n=!0;return}if(i){var o=a.getOtherAtom(e);o.eachBond(function(s){if(s.bondOrder>1){var u=o.number;if((u===15||u===16)&&s.getOtherAtom(o).number===8)return;n=!0}},t)}}),n}function n3(e){var t=0;return e.eachBond(function(r){return t+=r.bondOrder}),t}function a3(e,t){var r=e.bondToElementCount(1),i=e.formalCharge||0,n=t.assignCharge==="always"||t.assignCharge==="auto"&&i===0,a=t.assignH==="always"||t.assignH==="auto"&&r===0,o=e.bondCount,s=n3(e),u=i3(e),c=s-o>0,f=0,l=8;switch(e.number){case 1:n&&(o===0?(i=1,l=0):o===1&&(i=0,l=1));break;case 6:n&&(i=0),a&&(f=Math.max(0,4-s-Math.abs(i))),l=ro(o+f+Math.max(0,-i));break;case 7:if(n)if(!a)i=s-3;else if(u&&s<4)o-r===1&&s-r===2?i=1:i=0;else{var h=!1;e.eachBondedAtom(function(d){(d.number===16||d.isMetal())&&(h=!0)}),h?i=0:i=1}a&&(f=Math.max(0,3-s+i)),u&&!c?l=ro(o+f-i):l=ro(o+f+1-i);break;case 8:n&&(a||(i=s-2),s===1&&e.eachBondedAtom(function(d){d.eachBond(function(p){var v=p.getOtherAtom(d);v.index!==e.index&&v.number===8&&p.bondOrder===2&&(i=-1)})})),a&&(f=Math.max(0,2-s+i)),u&&!c?l=ro(o+f-i+1):l=ro(o+f-i+2);break;case 16:n&&(a||(s<=3&&!e.bondToElementCount(8)?i=s-2:i=0)),a&&s<2&&(f=Math.max(0,2-s+i)),s<=3&&(l=ro(o+f-i+2));break;case 9:case 17:case 35:case 53:case 85:n&&(i=s-1);break;case 3:case 11:case 19:case 37:case 55:case 87:n&&(i=1-s);break;case 4:case 12:case 20:case 38:case 56:case 88:n&&(i=2-s);break;default:console.warn("Requested charge, protonation for an unhandled element",e.element)}return[i,f,f+r,l]}function o3(e,t){var r=e.structure,i=r.atomCount,n=new Int8Array(i),a=new Int8Array(i),o=new Int8Array(i),s=new Int8Array(i);return r.eachAtom(function(u){var c=u.index,f=a3(u,t),l=f[0],h=f[1],d=f[2],p=f[3];n[c]=l,a[c]=h,o[c]=d,s[c]=p}),{charge:n,implicitH:a,totalH:o,idealGeometry:s}}function s3(e){return{structure:e,"@spatialLookup":void 0,"@valenceModel":void 0}}function $o(e){if(e["@valenceModel"])return e["@valenceModel"];var t=o3(e,{assignCharge:"auto",assignH:"auto"});return e["@valenceModel"]=t,t}function u3(e){return e.number===16&&e.bondToElementCount(8)===3}function c3(e){return e.number===16&&e.bondToElementCount(8)===4}function kv(e){return e.number===15&&e.bondToElementCount(8)===e.bondCount}function f3(e){var t=0;return e.number===6&&e.bondToElementCount(8)===2&&e.bondToElementCount(6)===1&&e.eachBondedAtom(function(r){r.number===8&&r.bondCount-r.bondToElementCount(1)===1&&++t}),t===2}function l3(e){var t=0;return e.number===6&&e.bondCount===3&&e.bondToElementCount(7)===3&&e.eachBondedAtom(function(r){r.bondCount-r.bondToElementCount(1)===1&&++t}),t===2}function h3(e){var t=0;return e.number===6&&e.bondCount===3&&e.bondToElementCount(7)===2&&e.bondToElementCount(6)===1&&e.eachBondedAtom(function(r){r.bondCount-r.bondToElementCount(1)===1&&++t}),t===2}var d3=["ARG","HIS","LYS"],p3=["GLU","ASP"];function v3(e,t){var r=$o(e.data),i=r.charge,n={};e.eachResidue(function(a){if(d3.includes(a.resname)){var o=Er(1);a.eachAtom(function(s){s.number===7&&s.isSidechain()&&mr(o,s)}),gr(t,o)}else!Qo.includes(a.resname)&&!a.isNucleic()&&(a.eachAtom(function(s){var u=!1,c=Er(1);l3(s)?(c.group=8,u=!0):h3(s)&&(c.group=9,u=!0),u&&(s.eachBondedAtom(function(f){f.number===7&&(n[f.index]=!0,mr(c,f))}),gr(t,c))}),a.eachAtom(function(s){var u=Er(1);i[s.index]>0&&(n[s.index]||(mr(u,s),gr(t,u)))}))})}function m3(e,t){var r=$o(e.data),i=r.charge,n={};e.eachResidue(function(a){if(p3.includes(a.resname)){var o=Er(2);a.eachAtom(function(u){u.number===8&&u.isSidechain()&&mr(o,u)}),gr(t,o)}else if(wu.includes(a.resname)){var s=Er(2);a.eachAtom(function(u){kv(u)&&(s.group=6,u.eachBondedAtom(function(c){c.number===8&&mr(s,c)}),gr(t,s))})}else!Qo.includes(a.resname)&&!wu.includes(a.resname)&&(a.eachAtom(function(u){var c=!1,f=Er(2);u3(u)?(f.group=4,c=!0):kv(u)?(f.group=6,c=!0):c3(u)?(f.group=5,c=!0):f3(u)&&(f.group=10,c=!0),c&&(u.eachBondedAtom(function(l){l.number===8&&(n[l.index]=!0,mr(f,l))}),gr(t,f))}),a.eachAtom(function(u){var c=Er(2);i[u.index]<0&&(n[u.index]||(mr(c,u),gr(t,c)))}))})}function g3(e,t){var r=e.getAtomProxy();e.eachResidue(function(i){var n=i.getAromaticRings();if(n){var a=i.atomOffset;n.forEach(function(o){var s=Er(3);o.forEach(function(u){r.index=u+a,mr(s,r)}),gr(t,s)})}})}function y3(e,t){return e===2&&t===1||e===1&&t===2}function b3(e,t){return e===3&&t===3}function x3(e,t){return e===3&&t===1||e===1&&t===3}function _3(e,t,r){r===void 0&&(r={});for(var i=O(r.maxIonicDist,ur.maxIonicDist),n=O(r.maxPiStackingDist,ur.maxPiStackingDist),a=O(r.maxPiStackingOffset,ur.maxPiStackingOffset),o=O(r.maxPiStackingAngle,ur.maxPiStackingAngle),s=O(r.maxCationPiDist,ur.maxCationPiDist),u=O(r.maxCationPiOffset,ur.maxCationPiOffset),c=O(r.masterModelIndex,ur.masterModelIndex),f=Math.max(i+2,n,s),l=n*n,h=s*s,d=t.features,p=t.spatialHash,v=t.contactStore,m=t.featureSet,g=d.types,x=d.centers,y=d.atomSets,b=x.x,_=x.y,w=x.z,A=g.length,S=e.atomStore.x,M=e.atomStore.y,E=e.atomStore.z,T=e.getAtomProxy(),H=e.getAtomProxy(),X=function(Y,J,j){for(var ae=Y.length,re=J.length,le=0;le<ae;++le){T.index=Y[le];for(var Se=0;Se<re;++Se)if(H.index=J[Se],T.distanceTo(H)<=j)return!0}return!1},q=new I,Z=new I,Q=new I,N=new I,D=new I,W=new I,L=new I,U=function(Y,J){q.set(S[Y[0]],M[Y[0]],E[Y[0]]),Z.set(S[Y[1]],M[Y[1]],E[Y[1]]),Q.set(S[Y[2]],M[Y[2]],E[Y[2]]),N.subVectors(q,Z),D.subVectors(q,Q),J.crossVectors(N,D)},k=function(Y,J,j){return q.set(b[Y],_[Y],w[Y]),Z.set(b[J],_[J],w[J]),q.sub(Z).projectOnPlane(j).add(Z).distanceTo(Z)},ee=function(Y,J,j){m.setBits(Y,J),v.addContact(Y,J,j)},K=function(Y){p.eachWithin(b[Y],_[Y],w[Y],f,function(J,j){if(!(J<=Y)&&(T.index=y[Y][0],H.index=y[J][0],!Fu(T,H,c))){var ae=g[Y],re=g[J];if(y3(ae,re))X(y[Y],y[J],i)&&ee(Y,J,1);else if(b3(ae,re)){if(j<=l){U(y[Y],W),U(y[J],L);var le=Q2(W.angleTo(L)),Se=Math.min(k(Y,J,L),k(J,Y,W));Se<=a&&(le<=o||le>=180-o||le<=o+90&&le>=90-o)&&ee(Y,J,3)}}else if(x3(ae,re)&&j<=h){var _e=ae===3?[Y,J]:[J,Y],ne=_e[0],ve=_e[1];U(y[ne],W);var se=k(ve,ne,W);se<=u&&ee(ne,ve,2)}}})},te=0;te<A;++te)K(te)}function w3(e,t){var r=$o(e.data),i=r.totalH;e.eachAtom(function(n){var a=Er(4),o=n.number;(K0(n)||i[n.index]>0&&(o===7||o===8||o===16))&&(mr(a,n),gr(t,a))})}function A3(e,t){var r=$o(e.data),i=r.totalH;e.eachAtom(function(n){if(n.number===6&&i[n.index]>0&&(n.bondToElementCount(7)>0||n.bondToElementCount(8)>0||S3(n))){var a=Er(9);mr(a,n),gr(t,a)}})}function S3(e){if(!e.isAromatic())return!1;var t=e.residueType.getRings();if(!t)return!1;var r=!1,i=t.rings;return i.forEach(function(n){r||n.some(function(a){return e.index-e.residueAtomOffset===a})&&(r=n.some(function(a){var o=e.residueType.atomTypeIdList[a],s=e.atomMap.get(o).number;return s===7||s===8}))}),r}function M3(e,t){var r=$o(e.data),i=r.charge,n=r.implicitH,a=r.idealGeometry;e.eachAtom(function(o){var s=Er(5),u=o.number;if(u===8)mr(s,o),gr(t,s);else if(u===7){if(K0(o))mr(s,o),gr(t,s);else if(i[o.index]<1){var c=o.bondCount+n[o.index],f=a[o.index];(f===4&&c<4||f===3&&c<3||f===2&&c<2)&&(mr(s,o),gr(t,s))}}else u===16&&(o.resname==="CYS"||o.resname==="MET"||o.formalCharge===-1)&&(mr(s,o),gr(t,s))})}function K0(e){return e.resname==="HIS"&&e.number==7&&e.isRing()}function C3(e,t){return e.isBackbone()&&t.isBackbone()}function P3(e,t){return e.isWater()&&t.isWater()}function T3(e,t){return e===5&&t===4||e===4&&t===5}function E3(e,t){return e===9&&t===5||e===5&&t===9}function I3(e,t){return P3(e,t)?9:C3(e,t)?10:4}function R3(e,t,r){r===void 0&&(r={});for(var i=O(r.maxHbondDist,ur.maxHbondDist),n=O(r.maxHbondSulfurDist,ur.maxHbondSulfurDist),a=lr(O(r.maxHbondAccAngle,ur.maxHbondAccAngle)),o=lr(O(r.maxHbondDonAngle,ur.maxHbondDonAngle)),s=lr(O(r.maxHbondAccPlaneAngle,ur.maxHbondAccPlaneAngle)),u=lr(O(r.maxHbondDonPlaneAngle,ur.maxHbondDonPlaneAngle)),c=O(r.masterModelIndex,ur.masterModelIndex),f=Math.max(i,n),l=i*i,h=t.features,d=t.spatialHash,p=t.contactStore,v=t.featureSet,m=h.types,g=h.centers,x=h.atomSets,y=g.x,b=g.y,_=g.z,w=m.length,A=$o(e.data),S=A.idealGeometry,M=e.getAtomProxy(),E=e.getAtomProxy(),T=function(X){d.eachWithin(y[X],b[X],_[X],f,function(q,Z){if(!(q<=X)){var Q=m[X],N=m[q],D=E3(Q,N);if(!(!D&&!T3(Q,N))){var W=N===5?[X,q]:[q,X],L=W[0],U=W[1];if(M.index=x[L][0],E.index=x[U][0],E.index!==M.index&&!Fu(M,E,c)&&!(M.number!==16&&E.number!==16&&Z>l)&&!M.connectedTo(E)){var k=Sf(M,E),ee=Bv.get(S[M.index])||lr(120);if(!k.some(function(ae){return Math.abs(ee-ae)>o})){if(S[M.index]===3){var K=Nv(M,E);if(K!==void 0&&K>u)return}var te=Sf(E,M),Y=Bv.get(S[E.index])||lr(120);if(!te.some(function(ae){return Y-ae>a})){if(S[E.index]===3){var J=Nv(E,M);if(J!==void 0&&J>s)return}v.setBits(L,U);var j=D?8:I3(M,E);p.addContact(L,U,j)}}}}}})},H=0;H<w;++H)T(H)}var L3=[3,11,19,37,55,12,20,38,56,13,31,49,81,21,50,82,83,51,80];function O3(e,t){e.eachAtom(function(r){var i=!1,n=!1,a=Qo.includes(r.resname),o=wu.includes(r.resname);if(!a&&!o?r.isHalogen()||r.number===8||r.number===16?(i=!0,n=!0):r.number===7&&(i=!0):a?r.number===8?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(r.resname)&&r.isSidechain()||r.isBackbone())&&(i=!0,n=!0):r.number===16&&r.resname==="CYS"?(i=!0,n=!0):r.number===7&&r.resname==="HIS"&&r.isSidechain()&&(i=!0):o&&(r.number===8&&r.isBackbone()?(i=!0,n=!0):["N3","N4","N7"].includes(r.atomname)?i=!0:["O2","O4","O6"].includes(r.atomname)&&(i=!0,n=!0)),i){var s=Er(11);mr(s,r),gr(t,s)}if(n){var u=Er(10);mr(u,r),gr(t,u)}})}function D3(e,t){e.eachAtom(function(r){if(r.isTransitionMetal()||r.number===30||r.number===48){var i=Er(12);mr(i,r),gr(t,i)}else if(L3.includes(r.number)){var n=Er(13);mr(n,r),gr(t,n)}})}function F3(e,t){if(e===12)return t===11||t===12;if(e===13)return t===10}function B3(e,t,r){r===void 0&&(r={});for(var i=O(r.maxMetalDist,ur.maxMetalDist),n=O(r.masterModelIndex,ur.masterModelIndex),a=t.features,o=t.spatialHash,s=t.contactStore,u=t.featureSet,c=a.types,f=a.centers,l=a.atomSets,h=f.x,d=f.y,p=f.z,v=c.length,m=e.getAtomProxy(),g=e.getAtomProxy(),x=function(b){o.eachWithin(h[b],d[b],p[b],i,function(_,w){if(!(_<=b)&&(m.index=l[b][0],g.index=l[_][0],!Fu(m,g,n))){var A=m.isMetal(),S=g.isMetal();if(!(!A&&!S)){var M=A?[c[b],c[_]]:[c[_],c[b]],E=M[0],T=M[1];F3(E,T)&&(u.setBits(b,_),s.addContact(b,_,7))}}})},y=0;y<v;++y)x(y)}function N3(e,t){e.eachAtom(function(r){var i=Er(8),n=!1;r.number===6?(n=!0,r.eachBondedAtom(function(a){var o=a.number;o!==6&&o!==1&&(n=!1)})):r.number===9&&(n=!0),n&&(mr(i,r),gr(t,i))})}function k3(e,t){return e===8&&t===8}function z3(e,t,r){r===void 0&&(r={});for(var i=O(r.maxHydrophobicDist,ur.maxHydrophobicDist),n=O(r.masterModelIndex,ur.masterModelIndex),a=t.features,o=t.spatialHash,s=t.contactStore,u=t.featureSet,c=a.types,f=a.centers,l=a.atomSets,h=f.x,d=f.y,p=f.z,v=c.length,m=e.getAtomProxy(),g=e.getAtomProxy(),x=function(b){o.eachWithin(h[b],d[b],p[b],i,function(_,w){_<=b||(m.index=l[b][0],g.index=l[_][0],!Fu(m,g,n)&&(m.number===9&&g.number===9||m.connectedTo(g)||k3(c[b],c[_])&&(u.setBits(b,_),s.addContact(b,_,6))))})},y=0;y<v;++y)x(y)}var U3=[17,35,53,85];function G3(e,t){e.eachAtom(function(r){if(U3.includes(r.number)&&r.bondToElementCount(6)===1){var i=Er(6);mr(i,r),gr(t,i)}})}var H3=[7,8,16],V3=[6,7,15,16];function W3(e,t){e.eachAtom(function(r){if(H3.includes(r.number)){var i=!1;if(r.eachBondedAtom(function(a){V3.includes(a.number)&&(i=!0)}),i){var n=Er(7);mr(n,r),gr(t,n)}}})}function j3(e,t){return e===7&&t===6||e===6&&t===7}var X3=lr(180),q3=lr(120);function Y3(e,t,r){r===void 0&&(r={});for(var i=O(r.maxHalogenBondDist,ur.maxHalogenBondDist),n=lr(O(r.maxHalogenBondAngle,ur.maxHalogenBondAngle)),a=O(r.masterModelIndex,ur.masterModelIndex),o=t.features,s=t.spatialHash,u=t.contactStore,c=t.featureSet,f=o.types,l=o.centers,h=o.atomSets,d=l.x,p=l.y,v=l.z,m=f.length,g=e.getAtomProxy(),x=e.getAtomProxy(),y=function(_){s.eachWithin(d[_],p[_],v[_],i,function(w,A){if(!(w<=_)&&(g.index=h[_][0],x.index=h[w][0],!Fu(g,x,a)&&j3(f[_],f[w]))){var S=f[_]===6?[g,x]:[x,g],M=S[0],E=S[1],T=Sf(M,E);if(T.length===1&&!(X3-T[0]>n)){var H=Sf(E,M);H.length!==0&&(H.some(function(X){return q3-X>n})||(c.setBits(_,w),u.addContact(_,w,5)))}}})},b=0;b<m;++b)y(b)}function zv(e,t,r){return!J0(e,t,r)&&(e.modelIndex!==t.modelIndex||e.altloc&&t.altloc&&e.altloc!==t.altloc)}function Z3(e,t,r){r===void 0&&(r={}),ge&&fe.time("refineLineOfSight");var i=O(r.lineOfSightDistFactor,ur.lineOfSightDistFactor),n=O(r.masterModelIndex,ur.masterModelIndex),a=e.spatialHash,o=t.contactSet,s=t.contactStore,u=t.features,c=s.index1,f=s.index2,l=u.centers,h=u.atomSets,d=l.x,p=l.y,v=l.z,m=e.getAtomProxy(),g=e.getAtomProxy(),x=e.getAtomProxy(),y=new I,b=new I,_=3*i,w=i*i;o.forEach(function(A){y.set(d[c[A]],p[c[A]],v[c[A]]),b.set(d[f[A]],p[f[A]],v[f[A]]);var S=(y.x+b.x)/2,M=(y.y+b.y)/2,E=(y.z+b.z)/2,T=h[c[A]],H=h[f[A]];m.index=T[0],g.index=H[0],a.eachWithin(S,M,E,_,function(X,q){x.index=X,x.number!==1&&x.vdw*x.vdw*w>q&&!zv(m,x,n)&&!zv(g,x,n)&&!T.includes(X)&&!H.includes(X)&&y.distanceToSquared(x)>1&&b.distanceToSquared(x)>1&&(o.clear(A),ge&&fe.log("removing",m.qualifiedName(),g.qualifiedName(),"because",x.qualifiedName()))})}),ge&&fe.timeEnd("refineLineOfSight")}function K3(e,t){var r=t.contactSet,i=t.contactStore,n=t.features,a=i.type,o=i.index1,s=i.index2,u=n.atomSets,c=e.getAtomProxy(),f=e.getAtomProxy(),l={},h=function(d,p,v){var m=l[v]||[1/0,-1],g=m[0],x=m[1];d<g?(x!==-1&&r.clear(x),l[v]=[d,p]):r.clear(p)};r.forEach(function(d){if(a[d]===6){c.index=u[o[d]][0],f.index=u[s[d]][0];var p=c.distanceTo(f);h(p,d,c.index+"|"+f.residueIndex),h(p,d,f.index+"|"+c.residueIndex)}})}function J3(e){return e===4||e===9||e===10}function Q3(e,t){var r=t.contactSet,i=t.contactStore,n=t.features,a=i.type,o=i.index1,s=i.index2,u=n.atomSets,c={},f=function(l,h){c[l]||(c[l]=[]),c[l].push(h)};r.forEach(function(l){a[l]===1&&(u[o[l]].forEach(function(h){return f(h,l)}),u[s[l]].forEach(function(h){return f(h,l)}))}),r.forEach(function(l){if(J3(a[l])){var h=c[u[o[l]][0]],d=c[u[s[l]][0]];if(!(!h||!d)){for(var p=h.length,v=0;v<p;++v)if(d.includes(h[v])){r.clear(l);return}}}})}function $3(e,t){var r=t.contactSet,i=t.contactStore,n=t.features,a=i.type,o=i.index1,s=i.index2,u=n.atomSets,c={},f=function(l,h){c[l]||(c[l]=[]),c[l].push(h)};r.forEach(function(l){a[l]===3&&(u[o[l]].forEach(function(h){return f(h,l)}),u[s[l]].forEach(function(h){return f(h,l)}))}),r.forEach(function(l){if(!(a[l]!==6&&a[l]!==2)){var h=c[u[o[l]][0]],d=c[u[s[l]][0]];if(!(!h||!d)){for(var p=h.length,v=0;v<p;++v)if(d.includes(h[v])){r.clear(l);return}}}})}function eM(e,t){var r=t.contactSet,i=t.contactStore,n=t.features,a=i.type,o=i.index1,s=i.index2,u=n.atomSets,c={},f=function(l,h){c[l]||(c[l]=[]),c[l].push(h)};r.forEach(function(l){a[l]===1&&(u[o[l]].forEach(function(h){return f(h,l)}),u[s[l]].forEach(function(h){return f(h,l)}))}),r.forEach(function(l){if(a[l]===7){var h=c[u[o[l]][0]],d=c[u[s[l]][0]];if(!(!h||!d)){for(var p=h.length,v=0;v<p;++v)if(d.includes(h[v])){r.clear(h[v]);return}}}})}var ur={maxHydrophobicDist:4,maxHbondDist:3.5,maxHbondSulfurDist:4.1,maxHbondAccAngle:45,maxHbondDonAngle:45,maxHbondAccPlaneAngle:90,maxHbondDonPlaneAngle:30,maxPiStackingDist:5.5,maxPiStackingOffset:2,maxPiStackingAngle:30,maxCationPiDist:6,maxCationPiOffset:2,maxIonicDist:5,maxHalogenBondDist:4,maxHalogenBondAngle:30,maxMetalDist:3,refineSaltBridges:!0,masterModelIndex:-1,lineOfSightDistFactor:1};function J0(e,t,r){return e.modelIndex===r&&t.modelIndex!==r||t.modelIndex===r&&e.modelIndex!==r}function Fu(e,t,r){return!J0(e,t,r)&&(e.modelIndex!==t.modelIndex||e.residueIndex===t.residueIndex||e.altloc&&t.altloc&&e.altloc!==t.altloc)}function tM(e){var t=e.types,r=e.centers,i=new Ha(r),n=new OS,a=new lt(t.length,!1);return{features:e,spatialHash:i,contactStore:n,featureSet:a}}function rM(e){var t=e.contactStore,r=t.index1,i=t.index2,n=t.count,a=G0({nodeArray1:r,nodeArray2:i,edgeCount:n,nodeCount:e.featureSet.length}),o=new lt(e.contactStore.count,!0);return Object.assign({adjacencyList:a,contactSet:o},e)}function iM(e){var t=DS();return ge&&fe.time("calculateFeatures"),v3(e,t),m3(e,t),g3(e,t),M3(e,t),w3(e,t),A3(e,t),O3(e,t),D3(e,t),N3(e,t),W3(e,t),G3(e,t),ge&&fe.timeEnd("calculateFeatures"),t}function nM(e,t){t===void 0&&(t=ur);var r=iM(e),i=tM(r);ge&&fe.time("calculateContacts"),_3(e,i,t),R3(e,i,t),B3(e,i,t),z3(e,i,t),Y3(e,i,t);var n=rM(i);return Z3(e,n,t),K3(e,n),t.refineSaltBridges&&Q3(e,n),$3(e,n),eM(e,n),ge&&fe.timeEnd("calculateContacts"),n}function aM(e){switch(e){case 4:case 9:case 10:return"hydrogen bond";case 6:return"hydrophobic contact";case 5:return"halogen bond";case 1:return"ionic interaction";case 7:return"metal coordination";case 2:return"cation-pi interaction";case 3:return"pi-pi stacking";case 8:return"weak hydrogen bond";default:return"unknown contact"}}var oM={hydrogenBond:!0,hydrophobic:!0,halogenBond:!0,ionicInteraction:!0,metalCoordination:!0,cationPi:!0,piStacking:!0,weakHydrogenBond:!0,waterHydrogenBond:!0,backboneHydrogenBond:!0,radius:1,filterSele:""},An=new Oe;function sM(e){switch(e){case 4:case 9:case 10:return An.setHex(2851770).toArray();case 6:return An.setHex(8421504).toArray();case 5:return An.setHex(4259775).toArray();case 1:return An.setHex(15779860).toArray();case 7:return An.setHex(9191577).toArray();case 2:return An.setHex(16744448).toArray();case 3:return An.setHex(9220966).toArray();case 8:return An.setHex(12967404).toArray();default:return An.setHex(13421772).toArray()}}function uM(e,t,r){var i=vi(r,oM),n=[];i.hydrogenBond&&n.push(4),i.hydrophobic&&n.push(6),i.halogenBond&&n.push(5),i.ionicInteraction&&n.push(1),i.metalCoordination&&n.push(7),i.cationPi&&n.push(2),i.piStacking&&n.push(3),i.weakHydrogenBond&&n.push(8),i.waterHydrogenBond&&n.push(9),i.backboneHydrogenBond&&n.push(10);var a=e.features,o=e.contactSet,s=e.contactStore,u=a.centers,c=a.atomSets,f=u.x,l=u.y,h=u.z,d=s.index1,p=s.index2,v=s.type,m=[],g=[],x=[],y=[],b=[],_;return i.filterSele&&(Array.isArray(i.filterSele)?_=i.filterSele.map(function(w){return t.getAtomSet(new Kt(w))}):_=t.getAtomSet(new Kt(i.filterSele))),o.forEach(function(w){var A=v[w];if(n.includes(A)){if(_){var S=c[d[w]][0],M=c[p[w]][0];if(Array.isArray(_)){if(!(_[0].isSet(S)&&_[1].isSet(M)||_[1].isSet(S)&&_[0].isSet(M)))return}else if(!_.isSet(S)&&!_.isSet(M))return}var E=d[w],T=p[w];m.push(f[E],l[E],h[E]),g.push(f[T],l[T],h[T]),x.push.apply(x,sM(A)),y.push(i.radius),b.push(w)}}),{position1:new Float32Array(m),position2:new Float32Array(g),color:new Float32Array(x),color2:new Float32Array(x),radius:new Float32Array(y),picking:new dM(b,e,t)}}function cM(e,t){for(var r=on(e.position1,e.position2),i=[],n=Uf(e.position1,e.position2),a=n.length/3,o=0;o<a;o++){var s=3*o,u=Math.sqrt(Math.pow(n[s],2)+Math.pow(n[s+1],2)+Math.pow(n[s+2],2));switch(t.unit){case"angstrom":i[o]=u.toFixed(2)+" ";break;case"nm":i[o]=(u/10).toFixed(2)+" nm";break;default:i[o]=u.toFixed(2);break}}return{position:r,size:pi(r.length/3,t.size),color:e.color,text:i}}var Nr=function(t){this.array=t},$d={type:{configurable:!0},data:{configurable:!0}};$d.type.get=function(){return""};$d.data.get=function(){return{}};Nr.prototype.getIndex=function(t){return this.array?this.array[t]:t};Nr.prototype.getObject=function(t){return{}};Nr.prototype._applyTransformations=function(t,r,i){return r&&t.applyMatrix4(r.matrix),i&&t.applyMatrix4(i.matrix),t};Nr.prototype._getPosition=function(t){return new I};Nr.prototype.getPosition=function(t,r,i){return this._applyTransformations(this._getPosition(t),r,i)};Object.defineProperties(Nr.prototype,$d);var Ii=function(e){function t(i){e.call(this),this.shape=i}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={primitive:{configurable:!0},data:{configurable:!0},type:{configurable:!0}};return r.primitive.get=function(){},r.data.get=function(){return this.shape},r.type.get=function(){return this.primitive.type},t.prototype.getObject=function(n){return this.primitive.objectFromShape(this.shape,this.getIndex(n))},t.prototype._getPosition=function(n){return this.primitive.positionFromShape(this.shape,this.getIndex(n))},Object.defineProperties(t.prototype,r),t}(Nr),fM=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={primitive:{configurable:!0}};return r.primitive.get=function(){return qa},Object.defineProperties(t.prototype,r),t}(Ii),lM=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={primitive:{configurable:!0}};return r.primitive.get=function(){return qf},Object.defineProperties(t.prototype,r),t}(Ii),Za=function(e){function t(i,n){e.call(this,i),this.structure=n}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},data:{configurable:!0}};return r.type.get=function(){return"atom"},r.data.get=function(){return this.structure},t.prototype.getObject=function(n){return this.structure.getAtomProxy(this.getIndex(n))},t.prototype._getPosition=function(n){return new I().copy(this.getObject(n))},Object.defineProperties(t.prototype,r),t}(Nr),hM=function(e){function t(i){e.call(this),this.axes=i}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},data:{configurable:!0}};return r.type.get=function(){return"axes"},r.data.get=function(){return this.axes},t.prototype.getObject=function(){return{axes:this.axes}},t.prototype._getPosition=function(){return this.axes.center.clone()},Object.defineProperties(t.prototype,r),t}(Nr),Q0=function(e){function t(i,n,a){e.call(this,i),this.structure=n,this.bondStore=a||n.bondStore}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},data:{configurable:!0}};return r.type.get=function(){return"bond"},r.data.get=function(){return this.structure},t.prototype.getObject=function(n){var a=this.structure.getBondProxy(this.getIndex(n));return a.bondStore=this.bondStore,a},t.prototype._getPosition=function(n){var a=this.getObject(n);return new I().copy(a.atom1).add(a.atom2).multiplyScalar(.5)},Object.defineProperties(t.prototype,r),t}(Nr),dM=function(e){function t(i,n,a){e.call(this,i),this.contacts=n,this.structure=a}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},data:{configurable:!0}};return r.type.get=function(){return"contact"},r.data.get=function(){return this.contacts},t.prototype.getObject=function(n){var a=this.getIndex(n),o=this.contacts,s=o.features,u=o.contactStore,c=s.centers,f=s.atomSets,l=c.x,h=c.y,d=c.z,p=u.index1,v=u.index2,m=u.type,g=p[a],x=v[a];return{center1:new I(l[g],h[g],d[g]),center2:new I(l[x],h[x],d[x]),atom1:this.structure.getAtomProxy(f[g][0]),atom2:this.structure.getAtomProxy(f[x][0]),type:aM(m[a])}},t.prototype._getPosition=function(n){var a=this.getObject(n),o=a.center1,s=a.center2;return new I().addVectors(o,s).multiplyScalar(.5)},Object.defineProperties(t.prototype,r),t}(Nr),pM=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={primitive:{configurable:!0}};return r.primitive.get=function(){return Yf},Object.defineProperties(t.prototype,r),t}(Ii),vM=function(e){function t(i,n,a){e.call(this,i),this.validation=n,this.structure=a}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},data:{configurable:!0}};return r.type.get=function(){return"clash"},r.data.get=function(){return this.validation},t.prototype.getObject=function(n){var a=this.validation,o=this.getIndex(n);return{validation:a,index:o,clash:a.clashArray[o]}},t.prototype._getAtomProxyFromSele=function(n){var a=new Kt(n),o=this.structure.getAtomIndices(a)[0];return this.structure.getAtomProxy(o)},t.prototype._getPosition=function(n){var a=this.getObject(n).clash,o=this._getAtomProxyFromSele(a.sele1),s=this._getAtomProxyFromSele(a.sele2);return new I().copy(o).add(s).multiplyScalar(.5)},Object.defineProperties(t.prototype,r),t}(Nr),mM=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"distance"},Object.defineProperties(t.prototype,r),t}(Q0),gM=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={primitive:{configurable:!0}};return r.primitive.get=function(){return Yo},Object.defineProperties(t.prototype,r),t}(Ii),yM=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={primitive:{configurable:!0}};return r.primitive.get=function(){return jf},Object.defineProperties(t.prototype,r),t}(Ii),bM=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={primitive:{configurable:!0}};return r.primitive.get=function(){return Xa},Object.defineProperties(t.prototype,r),t}(Ii),xM=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"ignore"},Object.defineProperties(t.prototype,r),t}(Nr),_M=function(e){function t(i,n){e.call(this,i),this.mesh=n}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"mesh"},t.prototype.getObject=function(){var n=this.mesh;return{shape:this.shape,name:n.name,serial:n.serial}},t.prototype._getPosition=function(){return this.__position||(this.__position=cd(this.mesh.position)),this.__position},Object.defineProperties(t.prototype,r),t}(Ii),wM=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={primitive:{configurable:!0}};return r.primitive.get=function(){return qo},Object.defineProperties(t.prototype,r),t}(Ii),AM=function(e){function t(i,n){e.call(this,i),this.surface=n}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},data:{configurable:!0}};return r.type.get=function(){return"surface"},r.data.get=function(){return this.surface},t.prototype.getObject=function(n){return{surface:this.surface,index:this.getIndex(n)}},t.prototype._getPosition=function(){return this.surface.center.clone()},Object.defineProperties(t.prototype,r),t}(Nr),SM=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={primitive:{configurable:!0}};return r.primitive.get=function(){return Xf},Object.defineProperties(t.prototype,r),t}(Ii),MM=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={primitive:{configurable:!0}};return r.primitive.get=function(){return Zf},Object.defineProperties(t.prototype,r),t}(Ii),CM=function(e){function t(i,n){e.call(this),this.unitcell=i,this.structure=n}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},data:{configurable:!0}};return r.type.get=function(){return"unitcell"},r.data.get=function(){return this.unitcell},t.prototype.getObject=function(){return{unitcell:this.unitcell,structure:this.structure}},t.prototype._getPosition=function(){return this.unitcell.getCenter(this.structure)},Object.defineProperties(t.prototype,r),t}(Nr);(function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"unknown"},Object.defineProperties(t.prototype,r),t})(Nr);var $0=function(e){function t(i,n){e.call(this,i),this.volume=n}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},data:{configurable:!0}};return r.type.get=function(){return"volume"},r.data.get=function(){return this.volume},t.prototype.getObject=function(n){var a=this.volume,o=this.getIndex(n);return{volume:a,index:o,value:a.data[o]}},t.prototype._getPosition=function(n){var a=this.volume.position,o=this.getIndex(n);return new I(a[o*3],a[o*3+1],a[o*3+2])},Object.defineProperties(t.prototype,r),t}(Nr),PM=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"slice"},Object.defineProperties(t.prototype,r),t}($0),TM=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={primitive:{configurable:!0}};return r.primitive.get=function(){return Ou},Object.defineProperties(t.prototype,r),t}(Ii),EM=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={primitive:{configurable:!0}};return r.primitive.get=function(){return Du},Object.defineProperties(t.prototype,r),t}(Ii);Ti.add("arrow",lM);Ti.add("box",bM);Ti.add("cone",pM);Ti.add("cylinder",fM);Ti.add("ellipsoid",gM);Ti.add("octahedron",yM);Ti.add("sphere",wM);Ti.add("tetrahedron",SM);Ti.add("torus",MM);Ti.add("point",TM);Ti.add("wideline",EM);function ey(){return new Uint32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0])}function ty(){return new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1])}function ry(){return[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]]}function ep(e,t,r,i,n){var a=0,o=!1,s=!1,u=!1,c=t*r*i,f=t,l=t*r,h,d,p,v,m=new Int32Array(12),g=[],x=[],y=[],b=[],_=ey(),w=ty(),A=ry(),S,M,E;this.triangulate=function(W,L,U,k,ee){a=W,s=k,u=ee,o=L||s,!o&&!h&&(h=new Float32Array(c*3));var K=c*3;if((!d||d.length!==K)&&(d=new Int32Array(K)),p=0,v=0,U!==void 0){var te=U[0].map(Math.round),Y=U[1].map(Math.round);S=t*Math.ceil(Math.abs(te[0])/t),M=r*Math.ceil(Math.abs(te[1])/r),E=i*Math.ceil(Math.abs(te[2])/i),D(te[0],te[1],te[2],Y[0],Y[1],Y[2])}else S=M=E=0,D();return g.length=p*3,o||(x.length=p*3),y.length=v,n&&(b.length=p),{position:new Float32Array(g),normal:o?void 0:new Float32Array(x),index:dn(y,g.length/3),atomindex:n?new Int32Array(b):void 0,contour:s}};function T(W,L,U){return W+(L-W)*U}function H(W,L,U){return W=(W+S)%t,L=(L+M)%r,U=(U+E)%i,l*U+f*L+W}function X(W,L,U,k,ee,K,te){var Y=3*W;if(d[Y]<0){var J=(a-K)/(te-K),j=h,ae=p*3;if(g[ae+0]=U+J,g[ae+1]=k,g[ae+2]=ee,!o){var re=W*3;x[ae]=-T(j[re],j[re+3],J),x[ae+1]=-T(j[re+1],j[re+4],J),x[ae+2]=-T(j[re+2],j[re+5],J)}n&&(b[p]=n[W+Math.round(J)]),d[Y]=p,m[L]=p,p+=1}else m[L]=d[Y]}function q(W,L,U,k,ee,K,te){var Y=3*W+1;if(d[Y]<0){var J=(a-K)/(te-K),j=h,ae=p*3;if(g[ae]=U,g[ae+1]=k+J,g[ae+2]=ee,!o){var re=W*3,le=re+f*3;x[ae]=-T(j[re],j[le],J),x[ae+1]=-T(j[re+1],j[le+1],J),x[ae+2]=-T(j[re+2],j[le+2],J)}n&&(b[p]=n[W+Math.round(J)*f]),d[Y]=p,m[L]=p,p+=1}else m[L]=d[Y]}function Z(W,L,U,k,ee,K,te){var Y=3*W+2;if(d[Y]<0){var J=(a-K)/(te-K),j=h,ae=p*3;if(g[ae]=U,g[ae+1]=k,g[ae+2]=ee+J,!o){var re=W*3,le=re+l*3;x[ae]=-T(j[re],j[le],J),x[ae+1]=-T(j[re+1],j[le+1],J),x[ae+2]=-T(j[re+2],j[le+2],J)}n&&(b[p]=n[W+Math.round(J)*l]),d[Y]=p,m[L]=p,p+=1}else m[L]=d[Y]}function Q(W){var L=W*3;h[L]===0&&(h[L]=e[(W-1+c)%c]-e[(W+1)%c],h[L+1]=e[(W-f+c)%c]-e[(W+f)%c],h[L+2]=e[(W-l+c)%c]-e[(W+l)%c])}function N(W,L,U,k,ee){var K,te,Y,J,j,ae,re;u?(k=H(W,L,U),K=H(W+1,L,U),te=H(W,L+1,U),Y=H(W,L,U+1),J=H(W+1,L+1,U),j=H(W+1,L,U+1),ae=H(W,L+1,U+1),re=H(W+1,L+1,U+1)):(K=k+1,te=k+f,Y=k+l,J=te+1,j=Y+1,ae=te+l,re=ae+1);var le=0,Se=e[k],_e=e[K],ne=e[te],ve=e[J],se=e[Y],xe=e[j],he=e[ae],ye=e[re];Se<a&&(le|=1),_e<a&&(le|=2),ne<a&&(le|=8),ve<a&&(le|=4),se<a&&(le|=16),xe<a&&(le|=32),he<a&&(le|=128),ye<a&&(le|=64);var pe=_[le];if(pe===0)return 0;var Pe=W+1,He=L+1,Je=U+1;pe&1&&(o||(Q(k),Q(K)),X(k,0,W,L,U,Se,_e)),pe&2&&(o||(Q(K),Q(J)),q(K,1,Pe,L,U,_e,ve)),pe&4&&(o||(Q(te),Q(J)),X(te,2,W,He,U,ne,ve)),pe&8&&(o||(Q(k),Q(te)),q(k,3,W,L,U,Se,ne)),pe&16&&(o||(Q(Y),Q(j)),X(Y,4,W,L,Je,se,xe)),pe&32&&(o||(Q(j),Q(re)),q(j,5,Pe,L,Je,xe,ye)),pe&64&&(o||(Q(ae),Q(re)),X(ae,6,W,He,Je,he,ye)),pe&128&&(o||(Q(Y),Q(ae)),q(Y,7,W,L,Je,se,he)),pe&256&&(o||(Q(k),Q(Y)),Z(k,8,W,L,U,Se,se)),pe&512&&(o||(Q(K),Q(j)),Z(K,9,Pe,L,U,_e,xe)),pe&1024&&(o||(Q(J),Q(re)),Z(J,10,Pe,He,U,ve,ye)),pe&2048&&(o||(Q(te),Q(ae)),Z(te,11,W,He,U,ne,he));for(var We=le<<4,Be,ie,we,Ie=0;w[We+Ie]!==-1;)Be=w[We+Ie],ie=w[We+Ie+1],we=w[We+Ie+2],s?(A[Be][ie]&ee&&(y[v++]=m[Be],y[v++]=m[ie]),A[ie][we]&ee&&(y[v++]=m[ie],y[v++]=m[we]),A[Be][we]&ee&&(y[v++]=m[Be],y[v++]=m[we])):(y[v++]=m[ie],y[v++]=m[Be],y[v++]=m[we]),Ie+=3}function D(W,L,U,k,ee,K){var te,Y,J,j,ae,re,le;W=W!==void 0?W:0,L=L!==void 0?L:0,U=U!==void 0?U:0,k=k!==void 0?k:t-1,ee=ee!==void 0?ee:r-1,K=K!==void 0?K:i-1,u||(o?(W=Math.max(0,W),L=Math.max(0,L),U=Math.max(0,U),k=Math.min(t-1,k),ee=Math.min(r-1,ee),K=Math.min(i-1,K)):(W=Math.max(1,W),L=Math.max(1,L),U=Math.max(1,U),k=Math.min(t-2,k),ee=Math.min(r-2,ee),K=Math.min(i-2,K)));var Se,_e,ne,ve,se,xe;if(u)for(Se=W-2,_e=L-2,ne=U-2,ve=k+2,se=ee+2,xe=K+2,ae=ne;ae<xe;++ae)for(j=_e;j<se;++j)for(J=Se;J<ve;++J)Y=H(J,j,ae)*3,d[Y]=-1,d[Y+1]=-1,d[Y+2]=-1;else for(Se=Math.max(0,W-2),_e=Math.max(0,L-2),ne=Math.max(0,U-2),ve=Math.min(t,k+2),se=Math.min(r,ee+2),xe=Math.min(i,K+2),ae=ne;ae<xe;++ae)for(le=l*ae,j=_e;j<se;++j)for(re=le+f*j,J=Se;J<ve;++J)te=3*(re+J),d[te]=-1,d[te+1]=-1,d[te+2]=-1;if(!u){var he,ye=W,pe=L,Pe=U,He=k,Je=ee,We=K;for(he=!1,ae=U;ae<K;++ae){for(j=L;j<ee;++j){for(J=W;J<k;++J)if(te=t*r*ae+t*j+J,e[te]>=a){Pe=ae,he=!0;break}if(he)break}if(he)break}for(he=!1,j=L;j<ee;++j){for(ae=Pe;ae<K;++ae){for(J=W;J<k;++J)if(te=t*r*ae+t*j+J,e[te]>=a){pe=j,he=!0;break}if(he)break}if(he)break}for(he=!1,J=W;J<k;++J){for(j=pe;j<ee;++j){for(ae=Pe;ae<K;++ae)if(te=t*r*ae+t*j+J,e[te]>=a){ye=J,he=!0;break}if(he)break}if(he)break}for(he=!1,ae=K;ae>=U;--ae){for(j=ee;j>=L;--j){for(J=k;J>=W;--J)if(te=t*r*ae+t*j+J,e[te]>=a){We=ae,he=!0;break}if(he)break}if(he)break}for(he=!1,j=ee;j>=L;--j){for(ae=We;ae>=U;--ae){for(J=k;J>=W;--J)if(te=t*r*ae+t*j+J,e[te]>=a){Je=j,he=!0;break}if(he)break}if(he)break}for(he=!1,J=k;J>=W;--J){for(j=Je;j>=L;--j){for(ae=We;ae>=U;--ae)if(te=t*r*ae+t*j+J,e[te]>=a){He=J,he=!0;break}if(he)break}if(he)break}o?(W=Math.max(0,ye-1),L=Math.max(0,pe-1),U=Math.max(0,Pe-1),k=Math.min(t-1,He+1),ee=Math.min(r-1,Je+1),K=Math.min(i-1,We+1)):(W=Math.max(1,ye-1),L=Math.max(1,pe-1),U=Math.max(1,Pe-1),k=Math.min(t-2,He+1),ee=Math.min(r-2,Je+1),K=Math.min(i-2,We+1))}var Be=15;for(ae=U;ae<K;++ae,Be&=-5)for(le=l*ae,Be|=2,j=L;j<ee;++j,Be&=-3)for(re=le+f*j,Be|=1,J=W;J<k;++J,Be&=-2)te=re+J,N(J,j,ae,te,Be)}}Object.assign(ep,{__deps:[ey,ty,ry,dn]});var Wt=function(t,r){this.cols=t,this.rows=r,this.size=this.cols*this.rows,this.data=new Float32Array(this.size)};Wt.prototype.copyTo=function(t){t.data.set(this.data)};function ki(e,t){for(var r=0,i=0,n=t.rows,a=t.cols,o=0,s=0,u=0,c=t.data,f=e.data;r<n;s+=1,o+=a,r++)for(u=s,i=0;i<a;u+=n,i++)f[u]=c[o+i]}function IM(e,t,r){for(var i=0,n=0,a=0,o=0,s=0,u=0,c=0,f=0,l=t.cols,h=t.rows,d=r.cols,p=t.data,v=r.data,m=e.data,g=0;i<h;o+=l,i++)for(c=0,n=0;n<d;f++,c++,n++){for(u=c,s=o,g=0,a=0;a<l;s++,u+=d,a++)g+=p[s]*v[u];m[f]=g}}function Cc(e,t,r){for(var i=0,n=0,a=0,o=0,s=0,u=0,c=0,f=t.cols,l=t.rows,h=r.rows,d=t.data,p=r.data,v=e.data,m=0;i<l;o+=f,i++)for(u=0,n=0;n<h;c++,n++){for(s=o,m=0,a=0;a<f;s++,u++,a++)m+=d[s]*p[u];v[c]=m}}function RM(e,t){var r=e.data,i=t.data,n=r[4],a=r[8],o=r[5],s=r[7],u=r[0],c=u*n,f=u*o,l=r[3],h=r[1],d=l*h,p=r[2],v=l*p,m=r[6],g=m*h,x=m*p,y=1/(c*a-f*s-d*a+v*s+g*o-x*n);i[0]=(n*a-o*s)*y,i[1]=-(h*a-p*s)*y,i[2]=-(-h*o+p*n)*y,i[3]=-(l*a-o*m)*y,i[4]=(u*a-x)*y,i[5]=-(f-v)*y,i[6]=-(-l*s+n*m)*y,i[7]=-(u*s-g)*y,i[8]=(c-d)*y}function LM(e){var t=e.data;return t[0]*t[4]*t[8]-t[0]*t[5]*t[7]-t[3]*t[1]*t[8]+t[3]*t[2]*t[7]+t[6]*t[1]*t[5]-t[6]*t[2]*t[4]}function Gl(e,t,r){var i=e.data,n=t.data,a=r.data,o=n[0],s=n[1],u=n[2],c=n[3],f=n[4],l=n[5],h=n[6],d=n[7],p=n[8],v=a[0],m=a[1],g=a[2],x=a[3],y=a[4],b=a[5],_=a[6],w=a[7],A=a[8];i[0]=o*v+s*x+u*_,i[1]=o*m+s*y+u*w,i[2]=o*g+s*b+u*A,i[3]=c*v+f*x+l*_,i[4]=c*m+f*y+l*w,i[5]=c*g+f*b+l*A,i[6]=h*v+d*x+p*_,i[7]=h*m+d*y+p*w,i[8]=h*g+d*b+p*A}function hd(e){for(var t=e.rows,r=e.cols,i=e.data,n=new Array(r),a=0;a<r;++a)n[a]=0;for(var o=0,s=0;o<t;++o)for(var u=0;u<r;++u,++s)n[u]+=i[s];for(var c=0;c<r;++c)n[c]/=t;return n}function dd(e,t){for(var r=e.rows,i=e.cols,n=e.data,a=0,o=0;a<r;++a)for(var s=0;s<i;++s,++o)n[o]-=t[s]}function Hl(e,t,r,i){i=e[t],e[t]=e[r],e[r]=i}function OM(e,t){return e=Math.abs(e),t=Math.abs(t),e>t?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0}var DM=1192092896e-16,FM=1e-37;function BM(e,t,r,i,n,a,o,s){for(var u=DM*2,c=FM,f=0,l=0,h=0,d=0,p=Math.max(a,30),v=0,m=0,g=0,x=0,y=0,b=0,_=0,w=0,A=0,S=0,M=0,E=0,T=0,H=0,X=0,q=0,Z=0,Q=4660,N=0,D=0,W=0,L=new Float64Array(o<<3);f<o;f++){for(h=0,M=0;h<a;h++)w=e[f*t+h],M+=w*w;if(L[f]=M,i){for(h=0;h<o;h++)i[f*n+h]=0;i[f*n+f]=1}}for(;d<p;d++){for(y=0,f=0;f<o-1;f++)for(l=f+1;l<o;l++){for(v=f*t|0,m=l*t|0,X=L[f],q=0,Z=L[l],h=2,q+=e[v]*e[m],q+=e[v+1]*e[m+1];h<a;h++)q+=e[v+h]*e[m+h];if(!(Math.abs(q)<=u*Math.sqrt(X*Z))){for(q*=2,E=X-Z,T=OM(q,E),E<0?(H=(T-E)*.5,_=Math.sqrt(H/T),b=q/(T*_*2)):(b=Math.sqrt((T+E)/(T*2)),_=q/(T*b*2)),X=0,Z=0,h=2,A=b*e[v]+_*e[m],S=-_*e[v]+b*e[m],e[v]=A,e[m]=S,X+=A*A,Z+=S*S,A=b*e[v+1]+_*e[m+1],S=-_*e[v+1]+b*e[m+1],e[v+1]=A,e[m+1]=S,X+=A*A,Z+=S*S;h<a;h++)A=b*e[v+h]+_*e[m+h],S=-_*e[v+h]+b*e[m+h],e[v+h]=A,e[m+h]=S,X+=A*A,Z+=S*S;if(L[f]=X,L[l]=Z,y=1,i)for(g=f*n|0,x=l*n|0,h=2,A=b*i[g]+_*i[x],S=-_*i[g]+b*i[x],i[g]=A,i[x]=S,A=b*i[g+1]+_*i[x+1],S=-_*i[g+1]+b*i[x+1],i[g+1]=A,i[x+1]=S;h<o;h++)A=b*i[g+h]+_*i[x+h],S=-_*i[g+h]+b*i[x+h],i[g+h]=A,i[x+h]=S}}if(y===0)break}for(f=0;f<o;f++){for(h=0,M=0;h<a;h++)w=e[f*t+h],M+=w*w;L[f]=Math.sqrt(M)}for(f=0;f<o-1;f++){for(l=f,h=f+1;h<o;h++)L[l]<L[h]&&(l=h);if(f!==l&&(Hl(L,f,l,M),i)){for(h=0;h<a;h++)Hl(e,f*t+h,l*t+h,w);for(h=0;h<o;h++)Hl(i,f*n+h,l*n+h,w)}}for(f=0;f<o;f++)r[f]=L[f];if(i)for(f=0;f<s;f++){for(M=f<o?L[f]:0;M<=c;){for(D=1/a,h=0;h<a;h++)Q=Q*214013+2531011,N=Q>>16&32767&256?D:-D,e[f*t+h]=N;for(d=0;d<2;d++)for(l=0;l<f;l++){for(M=0,h=0;h<a;h++)M+=e[f*t+h]*e[l*t+h];for(W=0,h=0;h<a;h++)w=e[f*t+h]-M*e[l*t+h],e[f*t+h]=w,W+=Math.abs(w);for(W=W?1/W:0,h=0;h<a;h++)e[f*t+h]*=W}for(M=0,h=0;h<a;h++)w=e[f*t+h],M+=w*w;M=Math.sqrt(M)}for(_=1/M,h=0;h<a;h++)e[f*t+h]*=_}}function iy(e,t,r,i){var n=0,a=0,o=e.rows,s=e.cols,u=o,c=s;u<c&&(n=1,a=u,u=c,c=a);var f=new Wt(u,u),l=new Wt(1,c),h=new Wt(c,c);if(n===0)ki(f,e);else{for(a=0;a<s*o;a++)f.data[a]=e.data[a];for(;a<c*u;a++)f.data[a]=0}if(BM(f.data,u,l.data,h.data,c,u,c,u),t){for(a=0;a<c;a++)t.data[a]=l.data[a];for(;a<s;a++)t.data[a]=0}n===0?(r&&ki(r,f),i&&ki(i,h)):(r&&ki(r,h),i&&ki(i,f))}function Ps(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function es(e,t,r,i,n,a,o,s,u,c,f,l,h,d,p,v,m){e[0]=t,e[4]=r,e[8]=i,e[12]=n,e[1]=a,e[5]=o,e[9]=s,e[13]=u,e[2]=c,e[6]=f,e[10]=l,e[14]=h,e[3]=d,e[7]=p,e[11]=v,e[15]=m}function Pc(e,t,r){var i=t[0],n=t[4],a=t[8],o=t[12],s=t[1],u=t[5],c=t[9],f=t[13],l=t[2],h=t[6],d=t[10],p=t[14],v=t[3],m=t[7],g=t[11],x=t[15],y=r[0],b=r[4],_=r[8],w=r[12],A=r[1],S=r[5],M=r[9],E=r[13],T=r[2],H=r[6],X=r[10],q=r[14],Z=r[3],Q=r[7],N=r[11],D=r[15];e[0]=i*y+n*A+a*T+o*Z,e[4]=i*b+n*S+a*H+o*Q,e[8]=i*_+n*M+a*X+o*N,e[12]=i*w+n*E+a*q+o*D,e[1]=s*y+u*A+c*T+f*Z,e[5]=s*b+u*S+c*H+f*Q,e[9]=s*_+u*M+c*X+f*N,e[13]=s*w+u*E+c*q+f*D,e[2]=l*y+h*A+d*T+p*Z,e[6]=l*b+h*S+d*H+p*Q,e[10]=l*_+h*M+d*X+p*N,e[14]=l*w+h*E+d*q+p*D,e[3]=v*y+m*A+g*T+x*Z,e[7]=v*b+m*S+g*H+x*Q,e[11]=v*_+m*M+g*X+x*N,e[15]=v*w+m*E+g*q+x*D}function tp(e,t,r,i){es(e,t,0,0,0,0,r,0,0,0,0,i,0,0,0,0,1)}tp.__deps=[es];function rp(e,t,r,i){es(e,1,0,0,t,0,1,0,r,0,0,1,i,0,0,0,1)}rp.__deps=[es];function ip(e,t){var r=Math.cos(t),i=Math.sin(t);es(e,r,0,i,0,0,1,0,0,-i,0,r,0,0,0,0,1)}ip.__deps=[es];function ny(){return new Float32Array([1,0,0,0,1,0,0,0,1])}function np(e,t){var r=Vt([t[0],t[1],t[2]]),i=Vt([t[4],t[5],t[6]]),n=Vt([t[8],t[9],t[10]]),a=Vt();wi(a,i,n),e[0]=a[0],e[1]=a[1],e[2]=a[2],wi(a,n,r),e[3]=a[0],e[4]=a[1],e[5]=a[2],wi(a,r,i),e[6]=a[0],e[7]=a[1],e[8]=a[2]}np.__deps=[Vt,wi];function ap(e,t,r,i){r=r||1,i=i||!0;var n=e.length/3,a=t.length/3,o;i&&(o=new Float32Array(n*3));var s=new Float32Array(n*3),u,c=20,f=new Array(c);for(u=0;u<c;++u)f[u]=new Uint32Array(n);for(u=0;u<n;++u)f[0][u]=0;var l,h,d;for(u=0;u<a;++u){var p=u*3,v=u*3+1,m=u*3+2;for(d=!0,l=0,h=f[0][t[p]];l<h;++l)if(t[v]===f[l+1][t[p]]){d=!1;break}for(d&&(f[0][t[p]]++,f[f[0][t[p]]][t[p]]=t[v]),d=!0,l=0,h=f[0][t[p]];l<h;++l)if(t[m]===f[l+1][t[p]]){d=!1;break}for(d&&(f[0][t[p]]++,f[f[0][t[p]]][t[p]]=t[m]),d=!0,l=0,h=f[0][t[v]];l<h;++l)if(t[p]===f[l+1][t[v]]){d=!1;break}for(d&&(f[0][t[v]]++,f[f[0][t[v]]][t[v]]=t[p]),d=!0,l=0,h=f[0][t[v]];l<h;++l)if(t[m]===f[l+1][t[v]]){d=!1;break}for(d&&(f[0][t[v]]++,f[f[0][t[v]]][t[v]]=t[m]),d=!0,l=0;l<f[0][t[m]];++l)if(t[p]===f[l+1][t[m]]){d=!1;break}for(d&&(f[0][t[m]]++,f[f[0][t[m]]][t[m]]=t[p]),d=!0,l=0,h=f[0][t[m]];l<h;++l)if(t[v]===f[l+1][t[m]]){d=!1;break}d&&(f[0][t[m]]++,f[f[0][t[m]]][t[m]]=t[v])}for(var g=1,x=.5,y,b,_,w,A,S=-1,M=1,E=.75/(M+3.5),T=0;T<r;++T){for(u=0;u<n;++u)if(y=u*3,_=f[0][u],_<3)s[y]=e[y],s[y+1]=e[y+1],s[y+2]=e[y+2];else if(_===3||_===4){for(s[y]=0,s[y+1]=0,s[y+2]=0,l=0;l<_;++l)b=f[l+1][u]*3,s[y]+=e[b],s[y+1]+=e[b+1],s[y+2]+=e[b+2];s[y]+=x*e[y],s[y+1]+=x*e[y+1],s[y+2]+=x*e[y+2],A=x+_,s[y]/=A,s[y+1]/=A,s[y+2]/=A}else{for(s[y]=0,s[y+1]=0,s[y+2]=0,l=0;l<_;++l)b=f[l+1][u]*3,s[y]+=e[b],s[y+1]+=e[b+1],s[y+2]+=e[b+2];s[y]+=g*e[y],s[y+1]+=g*e[y+1],s[y+2]+=g*e[y+2],w=g+_,s[y]/=w,s[y+1]/=w,s[y+2]/=w}if(e.set(s),i){Bu(e,t,o);var H=n*3;for(y=0;y<H;y+=3)e[y]+=S*E*o[y],e[y+1]+=S*E*o[y+1],e[y+2]+=S*E*o[y+2]}}}Object.assign(ap,{__deps:[Bu]});function Bu(e,t,r){var i,n;if(r===void 0)r=new Float32Array(e.length);else for(i=0,n=r.length;i<n;i++)r[i]=0;var a=new Float32Array(3),o=new Float32Array(3),s=new Float32Array(3),u=new Float32Array(3),c=new Float32Array(3);if(t)for(i=0,n=t.length;i<n;i+=3){var f=t[i]*3,l=t[i+1]*3,h=t[i+2]*3;ai(a,e,f),ai(o,e,l),ai(s,e,h),Cr(u,s,o),Cr(c,a,o),wi(u,u,c),r[f]+=u[0],r[f+1]+=u[1],r[f+2]+=u[2],r[l]+=u[0],r[l+1]+=u[1],r[l+2]+=u[2],r[h]+=u[0],r[h+1]+=u[1],r[h+2]+=u[2]}else for(i=0,n=e.length;i<n;i+=9)ai(a,e,i),ai(o,e,i+3),ai(s,e,i+6),Cr(u,s,o),Cr(c,a,o),wi(u,u,c),r[i]=u[0],r[i+1]=u[1],r[i+2]=u[2],r[i+3]=u[0],r[i+4]=u[1],r[i+5]=u[2],r[i+6]=u[0],r[i+7]=u[1],r[i+8]=u[2];return k0(r),r}Object.assign(Bu,{__deps:[Cr,wi,ai,k0]});function ay(e){for(var t={},r=0,i=e.length;r<i;++r)t[e[r]]=!0;return t}function Nu(e,t,r,i,n){var a=1/i*3;a+=r,z0(e,e,n+a),Mc(t,t,n+a),pr(e,e,i),fd(e,e),co(e,e,i),pr(t,t,i),Cs(t,t),co(t,t,i);var o=new Float32Array(3);Cr(o,t,e),pr(o,o,i),Cs(o,o),Mc(o,o,1);var s=Math.pow(10,6)*256,u=o[0]*o[1]*o[2]*3;s<=u&&(i*=Math.pow(s/u,1/3),pr(e,e,i),fd(e,e),co(e,e,i),pr(t,t,i),Cs(t,t),co(t,t,i),Cr(o,t,e),pr(o,o,i),Cs(o,o),Mc(o,o,1));var c=new Float32Array(e);Yd(c,c);var f=Ps(),l=Ps();ip(l,lr(90)),Pc(f,f,l);var h=Ps();tp(h,-1/i,1/i,1/i),Pc(f,f,h);var d=Ps();return rp(d,-i*c[2],-i*c[1],-i*c[0]),Pc(f,f,d),{dim:o,tran:c,matrix:f,scaleFactor:i}}Object.assign(Nu,{__deps:[lr,z0,Mc,co,pr,fd,Cs,Cr,Yd,Ps,Pc,rp,tp,ip]});var jr=function(t,r,i){this.name=t||"",this.path=r||"",this.info={},this.center=new I,this.boundingBox=new ir,i instanceof st||i instanceof Ue||i instanceof Jt?this.fromGeometry(i):i&&(this.set(i.position,i.index,i.normal,i.color,i.atomindex,i.contour),this.boundingBox.setFromArray(i.position),this.boundingBox.getCenter(this.center))},oy={type:{configurable:!0}};oy.type.get=function(){return"Surface"};jr.prototype.set=function(t,r,i,n,a,o){o===void 0&&(o=!1),this.position=t,this.index=r,this.normal=i,this.color=n,this.atomindex=a,this.size=t.length/3,this.contour=o};jr.prototype.fromGeometry=function(t){ge&&fe.time("GeometrySurface.fromGeometry");var r;t instanceof st?(t.computeVertexNormals(!0),r=new Ue().fromGeometry(t)):t instanceof Ue?r=t:r=t[0],r.boundingBox||r.computeBoundingBox(),this.boundingBox.copy(r.boundingBox),this.boundingBox.getCenter(this.center);var i,n,a,o;if(r instanceof Ue){var s=r.attributes,u=s.normal?s.normal.array:!1;(!u||u[0]===0&&u[1]===0&&u[2]===0)&&r.computeVertexNormals(),i=s.position.array,a=s.index?s.index.array:null,o=s.normal.array}this.set(i,a,o,n,void 0),ge&&fe.timeEnd("GeometrySurface.setGeometry")};jr.prototype.getPosition=function(){return this.position};jr.prototype.getColor=function(t){var r=t||{};r.surface=this;var i=this.size,n=new Float32Array(i*3),a=Tt.getScheme(r);if(a.volumeColor||r.scheme==="random")for(var o=0;o<i;++o)a.volumeColorToArray(o,n,o*3);else if(a.positionColor)for(var s=new I,u=this.position,c=0;c<i;++c){var f=c*3;s.set(u[f],u[f+1],u[f+2]),a.positionColorToArray(s,n,f)}else if(a.atomColor&&this.atomindex)for(var l=r.structure.getAtomProxy(),h=this.atomindex,d=0;d<i;++d)l.index=h[d],a.atomColorToArray(l,n,d*3);else{var p=new Oe(r.value);Qt(i,p.r,p.g,p.b,n)}return n};jr.prototype.getPicking=function(t){return this.atomindex&&t?new Za(this.atomindex,t):new AM(jo(this.size),this)};jr.prototype.getNormal=function(){return this.normal};jr.prototype.getSize=function(t,r){return pi(this.size,t*r)};jr.prototype.getIndex=function(){return this.index};jr.prototype.getFilteredIndex=function(t,r){if(t&&this.atomindex){for(var i=new Kt(t),n=r.getAtomSet(i),a=[],o=this.atomindex,s=this.index,u=s.length,c=this.contour?2:3,f=0,l=0;l<u;l+=c){for(var h=!0,d=0;d<c;d++){var p=s[l+d],v=o[p];if(!n.get(v)){h=!1;break}}if(h)for(var m=0;m<c;m++,f++)a[f]=s[l+m]}return dn(a,this.position.length/3)}else return this.index};jr.prototype.getAtomindex=function(){return this.atomindex};jr.prototype.dispose=function(){};Object.defineProperties(jr.prototype,oy);function sa(e,t,r,i,n){var a=new ep(e,t,r,i,n);function o(s,u,c,f,l,h){h===void 0&&(h=!1);var d=a.triangulate(s,u,c,l,h);if(u&&!l&&(ap(d.position,d.index,u,!0),d.normal=Bu(d.position,d.index)),f&&(Wf(f,d.position),d.normal)){var p=ny();np(p,f),qd(p,d.normal)}return d}this.getSurface=o}Object.assign(sa,{__deps:[ap,Bu,ep,Wf,qd,ny,np]});xu.add("surf",function(t,r){var i=t.data.args,n=t.data.params;if(i&&(self.volsurf=new sa(i[0],i[1],i[2],i[3],i[4])),n){var a=self.volsurf.getSurface(n.isolevel,n.smooth,n.box,n.matrix,n.contour,n.wrap),o=[a.position.buffer,a.index.buffer];a.normal&&o.push(a.normal.buffer),a.atomindex&&o.push(a.atomindex.buffer);var s={sd:a,p:n};r(s,o)}},[sa]);var jt=function(t,r,i,n,a,o,s){this.name=t,this.path=r,this.matrix=new Ae,this.normalMatrix=new Ur,this.inverseMatrix=new Ae,this.center=new I,this.boundingBox=new ir,this.setData(i,n,a,o,s)},la={type:{configurable:!0},position:{configurable:!0},min:{configurable:!0},max:{configurable:!0},sum:{configurable:!0},mean:{configurable:!0},rms:{configurable:!0}};la.type.get=function(){return"Volume"};jt.prototype.setData=function(t,r,i,n,a){this.nx=r||1,this.ny=i||1,this.nz=n||1,this.data=t||new Float32Array(1),this.setAtomindex(a),delete this._position,delete this._min,delete this._max,delete this._mean,delete this._rms,this.worker&&this.worker.terminate()};jt.prototype.setStats=function(t,r,i,n){this._min=t,this._max=r,this._mean=i,this._rms=n};jt.prototype.setMatrix=function(t){this.matrix.copy(t);var r=this.boundingBox,i=this.center,n=this.nx-1,a=this.ny-1,o=this.nz-1;r.makeEmpty(),r.expandByPoint(i.set(n,a,o)),r.expandByPoint(i.set(n,a,0)),r.expandByPoint(i.set(n,0,o)),r.expandByPoint(i.set(n,0,0)),r.expandByPoint(i.set(0,a,o)),r.expandByPoint(i.set(0,0,o)),r.expandByPoint(i.set(0,a,0)),r.expandByPoint(i.set(0,0,0)),r.applyMatrix4(this.matrix),r.getCenter(this.center);var s=this.matrix.elements,u=new I(s[0],s[1],s[2]),c=new I(s[4],s[5],s[6]),f=new I(s[8],s[9],s[10]),l=new I,h=this.normalMatrix.elements;l.crossVectors(c,f),h[0]=l.x,h[1]=l.y,h[2]=l.z,l.crossVectors(f,u),h[3]=l.x,h[4]=l.y,h[5]=l.z,l.crossVectors(u,c),h[6]=l.x,h[7]=l.y,h[8]=l.z,this.inverseMatrix.getInverse(this.matrix)};jt.prototype.setAtomindex=function(t){this.atomindex=t};jt.prototype.getBox=function(t,r,i){return i||(i=new ir),i.set(t,t),i.expandByScalar(r),i.applyMatrix4(this.inverseMatrix),i.min.round(),i.max.round(),i};jt.prototype._getBox=function(t,r){if(!(!t||!r)){this.__box||(this.__box=new ir);var i=this.getBox(t,r,this.__box);return[i.min.toArray(),i.max.toArray()]}};jt.prototype._makeSurface=function(t,r,i){var n=this.name+"@"+r.toPrecision(2),a=new jr(n,"",t);return a.info.isolevel=r,a.info.smooth=i,a.info.volume=this,a};jt.prototype.getSurface=function(t,r,i,n,a,o){o===void 0&&(o=!1),t=isNaN(t)?this.getValueForSigma(2):t,r=O(r,0),this.volsurf===void 0&&(this.volsurf=new sa(this.data,this.nx,this.ny,this.nz,this.atomindex));var s=this._getBox(i,n),u=this.volsurf.getSurface(t,r,s,this.matrix.elements,a,o);return this._makeSurface(u,t,r)};jt.prototype.getSurfaceWorker=function(t,r,i,n,a,o,s){var u=this;if(t=isNaN(t)?this.getValueForSigma(2):t,r=r||0,window.hasOwnProperty("Worker")){this.workerPool===void 0&&(this.workerPool=new Bo("surf",2));var c={},f=this.workerPool.getNextWorker();f.postCount===0&&Object.assign(c,{args:[this.data,this.nx,this.ny,this.nz,this.atomindex]}),Object.assign(c,{params:{isolevel:t,smooth:r,box:this._getBox(i,n),matrix:this.matrix.elements,contour:a,wrap:o}}),f.post(c,void 0,function(h){var d=h.data.sd,p=h.data.p;s(u._makeSurface(d,p.isolevel,p.smooth))},function(h){console.warn("Volume.getSurfaceWorker error - trying without worker",h);var d=u.getSurface(t,r,i,n,a,o);s(d)})}else{var l=this.getSurface(t,r,i,n,a,o);s(l)}};jt.prototype.getValueForSigma=function(t){return this.mean+O(t,2)*this.rms};jt.prototype.getSigmaForValue=function(t){return(O(t,0)-this.mean)/this.rms};la.position.get=function(){if(!this._position){for(var e=this.nz,t=this.ny,r=this.nx,i=new Float32Array(r*t*e*3),n=0,a=0;a<e;++a)for(var o=0;o<t;++o)for(var s=0;s<r;++s)i[n+0]=s,i[n+1]=o,i[n+2]=a,n+=3;Wf(this.matrix.elements,i),this._position=i}return this._position};jt.prototype.getDataAtomindex=function(){return this.atomindex};jt.prototype.getDataPosition=function(){return this.position};jt.prototype.getDataColor=function(t){var r=t||{};r.volume=this,r.scale=r.scale||"Spectral",r.domain=r.domain||[this.min,this.max];for(var i=Tt.getScheme(r),n=this.position.length/3,a=new Float32Array(n*3),o=0;o<n;++o)i.volumeColorToArray(o,a,o*3);return a};jt.prototype.getDataPicking=function(){var t=jo(this.position.length/3);return new $0(t,this)};jt.prototype.getDataSize=function(t,r){var i=this.data,n=this.position.length/3,a;switch(t){case"value":a=new Float32Array(i);break;case"abs-value":a=new Float32Array(i);for(var o=0;o<n;++o)a[o]=Math.abs(a[o]);break;case"value-min":{a=new Float32Array(i);for(var s=this.min,u=0;u<n;++u)a[u]-=s;break}case"deviation":a=new Float32Array(i);break;default:a=pi(n,t);break}if(r!==1)for(var c=0;c<n;++c)a[c]*=r;return a};la.min.get=function(){return this._min===void 0&&(this._min=Ac(this.data)),this._min};la.max.get=function(){return this._max===void 0&&(this._max=wc(this.data)),this._max};la.sum.get=function(){return this._sum===void 0&&(this._sum=E0(this.data)),this._sum};la.mean.get=function(){return this._mean===void 0&&(this._mean=Sc(this.data)),this._mean};la.rms.get=function(){return this._rms===void 0&&(this._rms=sS(this.data)),this._rms};jt.prototype.clone=function(){var t=new jt(this.name,this.path,this.data,this.nx,this.ny,this.nz,this.atomindex);return t.matrix.copy(this.matrix),t.header=Object.assign({},this.header),t};jt.prototype.dispose=function(){this.workerPool&&this.workerPool.terminate()};Object.defineProperties(jt.prototype,la);Ut.add("shader/Mesh.vert",`#define STANDARD
uniform float clipNear;
uniform vec3 clipCenter;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#elif defined( NOLIGHT )
varying vec3 vColor;
#else
#include color_pars_vertex
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#endif
#include common
void main(){
#if defined( PICKING )
vPickingColor = unpackColor( primitiveId );
#elif defined( NOLIGHT )
vColor = color;
#else
#include color_vertex
#include beginnormal_vertex
#include defaultnormal_vertex
#ifndef FLAT_SHADED
vNormal = normalize( transformedNormal );
#endif
#endif
#include begin_vertex
#include project_vertex
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`);Ut.add("shader/Mesh.frag",`#define STANDARD
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
uniform float objectId;
varying vec3 vPickingColor;
#elif defined( NOLIGHT )
varying vec3 vColor;
#else
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#include common
#include color_pars_fragment
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
void main(){
#include nearclip_fragment
#include radiusclip_fragment
#if defined( PICKING )
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#elif defined( NOLIGHT )
gl_FragColor = vec4( vColor, opacity );
#else
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
#include normal_fragment_begin
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
#include interior_fragment
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include encodings_fragment
#include fog_fragment
#include opaque_back_fragment
#endif
}`);function sy(e){return e==="front"?Mu:e==="back"?ni:Ra}var Uv={f:1,v2:2,v3:3,c:3};function Vl(e,t){e.matrix.copy(t),e.matrix.decompose(e.position,e.quaternion,e.scale),e.matrixWorldNeedsUpdate=!0}var ti={opaqueBack:!1,side:"double",opacity:1,depthWrite:!0,clipNear:0,clipRadius:0,clipCenter:new I,flatShaded:!1,wireframe:!1,roughness:.4,metalness:0,diffuse:16777215,diffuseInterior:!1,useInteriorColor:!1,interiorColor:14540253,interiorDarkening:0,forceTransparent:!1,matrix:new Ae,disablePicking:!1,sortParticles:!1,background:!1},Ka={opaqueBack:{updateShader:!0},side:{updateShader:!0,property:!0},opacity:{uniform:!0},depthWrite:{property:!0},clipNear:{updateShader:!0,property:!0},clipRadius:{updateShader:!0,uniform:!0},clipCenter:{uniform:!0},flatShaded:{updateShader:!0},background:{updateShader:!0},wireframe:{updateVisibility:!0},roughness:{uniform:!0},metalness:{uniform:!0},diffuse:{uniform:!0},diffuseInterior:{updateShader:!0},useInteriorColor:{updateShader:!0},interiorColor:{uniform:!0},interiorDarkening:{uniform:!0},matrix:{}},It=function(t,r){r===void 0&&(r={}),this.parameterTypes=Ka,this.geometry=new Ue,this.indexVersion=0,this.wireframeIndexVersion=-1,this.group=new Jt,this.wireframeGroup=new Jt,this.pickingGroup=new Jt,this.vertexShader="",this.fragmentShader="",this.isImpostor=!1,this.isText=!1,this.isSurface=!1,this.isPoint=!1,this.isLine=!1,this.dynamic=!0,this.visible=!0,this.wireframeIndexCount=0,this.parameters=vi(r,this.defaultParameters),this.uniforms=Lr.merge([$e.common,{fogColor:{value:null},fogNear:{value:0},fogFar:{value:0},opacity:{value:this.parameters.opacity},clipNear:{value:0},clipRadius:{value:this.parameters.clipRadius},clipCenter:{value:this.parameters.clipCenter}},{emissive:{value:new Oe(0)},roughness:{value:this.parameters.roughness},metalness:{value:this.parameters.metalness},interiorColor:{value:new Oe(this.parameters.interiorColor)},interiorDarkening:{value:this.parameters.interiorDarkening}},$e.lights]),this.uniforms.diffuse.value.set(this.parameters.diffuse),this.pickingUniforms={clipNear:{value:0},objectId:{value:0},opacity:{value:this.parameters.opacity}};var i=t.position||t.position1;this._positionDataSize=i?i.length/3:0,t.primitiveId||(t.primitiveId=jo(this._positionDataSize)),this.addAttributes({position:{type:"v3",value:t.position},color:{type:"c",value:t.color},primitiveId:{type:"f",value:t.primitiveId}}),r.matrix&&(this.matrix=r.matrix),t.index&&this.initIndex(t.index),this.picking=t.picking,this.makeWireframeGeometry()},ha={defaultParameters:{configurable:!0},matrix:{configurable:!0},transparent:{configurable:!0},size:{configurable:!0},attributeSize:{configurable:!0},pickable:{configurable:!0}};ha.defaultParameters.get=function(){return ti};ha.matrix.set=function(e){this.setMatrix(e)};ha.matrix.get=function(){return this.group.matrix.clone()};ha.transparent.get=function(){return this.parameters.opacity<1||this.parameters.forceTransparent};ha.size.get=function(){return this._positionDataSize};ha.attributeSize.get=function(){return this.size};ha.pickable.get=function(){return!!this.picking&&!this.parameters.disablePicking};It.prototype.setMatrix=function(t){Vl(this.group,t),Vl(this.wireframeGroup,t),Vl(this.pickingGroup,t)};It.prototype.initIndex=function(t){this.geometry.setIndex(new ft(t,1)),this.geometry.getIndex().setDynamic(this.dynamic)};It.prototype.makeMaterial=function(){var t=sy(this.parameters.side),r=new Gr({uniforms:this.uniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:this.transparent,depthWrite:this.parameters.depthWrite,lights:!0,fog:!0,side:t});r.vertexColors=Tn,r.extensions.derivatives=this.parameters.flatShaded,r.extensions.fragDepth=this.isImpostor;var i=new Gr({uniforms:this.uniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:this.transparent,depthWrite:this.parameters.depthWrite,lights:!1,fog:!0,side:t});i.vertexColors=Tn;var n=new Gr({uniforms:this.pickingUniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:!1,depthWrite:this.parameters.depthWrite,lights:!1,fog:!1,side:t,blending:Ec});n.vertexColors=Tn,n.extensions.fragDepth=this.isImpostor,r.clipNear=this.parameters.clipNear,i.clipNear=this.parameters.clipNear,n.clipNear=this.parameters.clipNear,this.material=r,this.wireframeMaterial=i,this.pickingMaterial=n,this.updateShader()};It.prototype.makeWireframeGeometry=function(){this.makeWireframeIndex();var t=this.geometry,r=this.wireframeIndex,i=new Ue;i.attributes=t.attributes,r&&(i.setIndex(new ft(r,1).setDynamic(this.dynamic)),i.setDrawRange(0,this.wireframeIndexCount)),this.wireframeGeometry=i};It.prototype.makeWireframeIndex=function(){var t=[];function r(x,y){if(x>y){var b=x;x=y,y=b}var _=t[x];return _===void 0?(t[x]=[y],!0):_.includes(y)?!1:(_.push(y),!0)}var i=this.geometry,n=i.index;if(!this.parameters.wireframe)this.wireframeIndex=new Uint16Array(0),this.wireframeIndexCount=0;else if(n){var a=n.array,o=a.length;i.drawRange.count!==1/0&&(o=i.drawRange.count);var s;if(this.wireframeIndex&&this.wireframeIndex.length>o*2)s=this.wireframeIndex;else{var u=i.attributes.position.count;s=dn(o*2,u)}var c=0;t.length=0;for(var f=0;f<o;f+=3){var l=a[f+0],h=a[f+1],d=a[f+2];r(l,h)&&(s[c+0]=l,s[c+1]=h,c+=2),r(h,d)&&(s[c+0]=h,s[c+1]=d,c+=2),r(d,l)&&(s[c+0]=d,s[c+1]=l,c+=2)}this.wireframeIndex=s,this.wireframeIndexCount=c,this.wireframeIndexVersion=this.indexVersion}else{var p=i.attributes.position.count,v;this.wireframeIndex&&this.wireframeIndex.length>p*2?v=this.wireframeIndex:v=dn(p*2,p);for(var m=0,g=0;m<p;m+=3)v[g+0]=m,v[g+1]=m+1,v[g+2]=m+1,v[g+3]=m+2,v[g+4]=m+2,v[g+5]=m,g+=6;this.wireframeIndex=v,this.wireframeIndexCount=p*2,this.wireframeIndexVersion=this.indexVersion}};It.prototype.updateWireframeIndex=function(){if(!(!this.wireframeGeometry||!this.wireframeIndex)){if(this.wireframeGeometry.setDrawRange(0,1/0),this.wireframeIndexVersion<this.indexVersion&&this.makeWireframeIndex(),this.wireframeIndex.length>this.wireframeGeometry.index.array.length)this.wireframeGeometry.setIndex(new ft(this.wireframeIndex,1).setDynamic(this.dynamic));else{var t=this.wireframeGeometry.getIndex();t.set(this.wireframeIndex),t.needsUpdate=this.wireframeIndexCount>0,t.updateRange.count=this.wireframeIndexCount}this.wireframeGeometry.setDrawRange(0,this.wireframeIndexCount)}};It.prototype.getRenderOrder=function(){var t=0;return this.isText?t=1:this.transparent&&(this.isSurface?t=3:t=2),t};It.prototype._getMesh=function(t){this.material||this.makeMaterial();var r=this.geometry,i=this[t],n;return this.isLine?n=new ar(r,i):this.isPoint?n=new Ws(r,i):n=new Jr(r,i),n.frustumCulled=!1,n.renderOrder=this.getRenderOrder(),n};It.prototype.getMesh=function(){return this._getMesh("material")};It.prototype.getWireframeMesh=function(){var t;return this.material||this.makeMaterial(),this.wireframeGeometry||this.makeWireframeGeometry(),t=new ar(this.wireframeGeometry,this.wireframeMaterial),t.frustumCulled=!1,t.renderOrder=this.getRenderOrder(),t};It.prototype.getPickingMesh=function(){return this._getMesh("pickingMaterial")};It.prototype.getShader=function(t,r){return _u(t,this.getDefines(r))};It.prototype.getVertexShader=function(t){return this.getShader(this.vertexShader,t)};It.prototype.getFragmentShader=function(t){return this.getShader(this.fragmentShader,t)};It.prototype.getDefines=function(t){var r={};return this.parameters.clipNear&&(r.NEAR_CLIP=1),this.parameters.clipRadius&&(r.RADIUS_CLIP=1),t==="picking"?r.PICKING=1:((t==="background"||this.parameters.background)&&(r.NOLIGHT=1),this.parameters.flatShaded&&(r.FLAT_SHADED=1),this.parameters.opaqueBack&&(r.OPAQUE_BACK=1),this.parameters.diffuseInterior&&(r.DIFFUSE_INTERIOR=1),this.parameters.useInteriorColor&&(r.USE_INTERIOR_COLOR=1)),r};It.prototype.getParameters=function(){return this.parameters};It.prototype.addUniforms=function(t){this.uniforms=Lr.merge([this.uniforms,t]),this.pickingUniforms=Lr.merge([this.pickingUniforms,t])};It.prototype.addAttributes=function(t){var r=this;for(var i in t){var n=void 0,a=t[i],o=r.attributeSize*Uv[a.type];a.value?(o!==a.value.length&&fe.error("attribute value has wrong length",i),n=a.value):n=p0("float32",o),r.geometry.addAttribute(i,new ft(n,Uv[a.type]).setDynamic(r.dynamic))}};It.prototype.updateRenderOrder=function(){var t=this.getRenderOrder();function r(i){i.renderOrder=t}this.group.children.forEach(r),this.pickingGroup&&this.pickingGroup.children.forEach(r)};It.prototype.updateShader=function(){var t=this.material,r=this.wireframeMaterial,i=this.pickingMaterial;t.vertexShader=this.getVertexShader(),t.fragmentShader=this.getFragmentShader(),t.needsUpdate=!0,r.vertexShader=this.getShader("Line.vert"),r.fragmentShader=this.getShader("Line.frag"),r.needsUpdate=!0,i.vertexShader=this.getVertexShader("picking"),i.fragmentShader=this.getFragmentShader("picking"),i.needsUpdate=!0};It.prototype.setParameters=function(t){var r=this,i=t,n=this.parameterTypes,a=this.parameters,o={},s={},u=!1,c=!1;for(var f in i){var l=i[f];l!==void 0&&(a[f]=l,n[f]!==void 0&&(n[f].property&&(n[f].property!==!0?o[n[f].property]=l:o[f]=l),n[f].uniform&&(n[f].uniform!==!0?s[n[f].uniform]=l:s[f]=l),n[f].updateShader&&(u=!0),n[f].updateVisibility&&(c=!0),r.dynamic&&f==="wireframe"&&l===!0&&r.updateWireframeIndex(),f==="flatShaded"&&(r.material.extensions.derivatives=r.parameters.flatShaded||r.isText),f==="forceTransparent"&&(o.transparent=r.transparent),f==="matrix"&&(r.matrix=l)))}this.setProperties(o),this.setUniforms(s),u&&this.updateShader(),c&&this.setVisibility(this.visible)};It.prototype.setAttributes=function(t){var r=this,i=this.geometry,n=i.attributes;for(var a in t)if(a!=="picking"){var o=t[a],s=o.length;if(a==="index"){var u=i.getIndex();i.setDrawRange(0,1/0),s>u.array.length?i.setIndex(new ft(o,1).setDynamic(r.dynamic)):(u.set(o),u.needsUpdate=s>0,u.updateRange.count=s,i.setDrawRange(0,s)),r.indexVersion++,r.parameters.wireframe&&r.updateWireframeIndex()}else{var c=n[a];s>c.array.length?i.addAttribute(a,new ft(o,c.itemSize).setDynamic(r.dynamic)):(n[a].set(o),n[a].needsUpdate=s>0,n[a].updateRange.count=s)}}};It.prototype.setUniforms=function(t){var r=this;if(t){var i=this.material.uniforms,n=this.wireframeMaterial.uniforms,a=this.pickingMaterial.uniforms;for(var o in t)o==="opacity"&&r.setProperties({transparent:r.transparent}),i[o]!==void 0&&(i[o].value.isVector3?i[o].value.copy(t[o]):i[o].value.set?i[o].value.set(t[o]):i[o].value=t[o]),n[o]!==void 0&&(n[o].value.isVector3?n[o].value.copy(t[o]):n[o].value.set?n[o].value.set(t[o]):n[o].value=t[o]),a[o]!==void 0&&(a[o].value.isVector3?a[o].value.copy(t[o]):a[o].value.set?a[o].value.set(t[o]):a[o].value=t[o])}};It.prototype.setProperties=function(t){var r=this;if(t){var i=this.material,n=this.wireframeMaterial,a=this.pickingMaterial;for(var o in t){var s=o,u=t[s];s==="transparent"?r.updateRenderOrder():s==="side"&&(u=sy(u)),i[s]=u,n[s]=u,a[s]=u}i.needsUpdate=!0,n.needsUpdate=!0,a.needsUpdate=!0}};It.prototype.setVisibility=function(t){this.visible=t,this.parameters.wireframe?(this.group.visible=!1,this.wireframeGroup.visible=t,this.pickable&&(this.pickingGroup.visible=!1)):(this.group.visible=t,this.wireframeGroup.visible=!1,this.pickable&&(this.pickingGroup.visible=t))};It.prototype.dispose=function(){this.material&&this.material.dispose(),this.wireframeMaterial&&this.wireframeMaterial.dispose(),this.pickingMaterial&&this.pickingMaterial.dispose(),this.geometry.dispose(),this.wireframeGeometry&&this.wireframeGeometry.dispose()};It.prototype.toJSON=function(){var t=this,r={};for(var i in t)i!=="group"&&i!=="wireframeGroup"&&i!="pickingGroup"&&i!=="picking"&&(r[i]=t[i]);return r};Object.defineProperties(It.prototype,ha);var ua=function(e){function t(r,i){i===void 0&&(i={}),e.call(this,r,i),this.vertexShader="Mesh.vert",this.fragmentShader="Mesh.frag",this.addAttributes({normal:{type:"v3",value:r.normal}}),r.normal===void 0&&this.geometry.computeVertexNormals()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),uy=function(e){function t(){e.apply(this,arguments),this.isSurface=!0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(ua);function ic(e){e.visible=!0}function Gv(e){e.visible=!1}var Ri=function(t){this.group=new Jt,this.wireframeGroup=new Jt,this.pickingGroup=new Jt,this.frontMeshes=[],this.backMeshes=[],this.size=t.size,this.side=t.parameters.side,this.visible=t.visible,this.geometry=t.geometry,this.picking=t.picking,this.group=new Jt,this.wireframeGroup=new Jt,this.pickingGroup=new Jt,this.matrix=t.matrix;var r=t,i=new t.constructor({position:new Float32Array(0)});r.makeMaterial(),i.makeMaterial(),i.picking=t.picking,i.geometry=t.geometry,i.wireframeGeometry=t.wireframeGeometry,i.setParameters(t.getParameters()),i.updateShader(),r.setParameters({side:"front"}),i.setParameters({side:"back",opacity:i.parameters.opacity}),this.buffer=t,this.frontBuffer=r,this.backBuffer=i},ku={matrix:{configurable:!0},pickable:{configurable:!0},parameters:{configurable:!0}};ku.matrix.set=function(e){It.prototype.setMatrix.call(this,e)};ku.matrix.get=function(){return this.group.matrix.clone()};ku.pickable.get=function(){return!!this.picking&&!this.parameters.disablePicking};ku.parameters.get=function(){return this.buffer.parameters};Ri.prototype.getParameters=function(){var t=Object.assign({},this.buffer.parameters);return t.side=this.side,t};Ri.prototype.getMesh=function(t){var r,i;return t?(i=this.backBuffer.getPickingMesh(),r=this.frontBuffer.getPickingMesh()):(i=this.backBuffer.getMesh(),r=this.frontBuffer.getMesh()),this.frontMeshes.push(r),this.backMeshes.push(i),this.setParameters({side:this.side}),new Jt().add(i,r)};Ri.prototype.getWireframeMesh=function(){return this.buffer.getWireframeMesh()};Ri.prototype.getPickingMesh=function(){return this.getMesh(!0)};Ri.prototype.setAttributes=function(t){this.buffer.setAttributes(t)};Ri.prototype.setParameters=function(t){t=Object.assign({},t),t.side==="front"?(this.frontMeshes.forEach(ic),this.backMeshes.forEach(Gv)):t.side==="back"?(this.frontMeshes.forEach(Gv),this.backMeshes.forEach(ic)):t.side==="double"&&(this.frontMeshes.forEach(ic),this.backMeshes.forEach(ic)),t.side!==void 0&&(this.side=t.side),delete t.side,t.matrix!==void 0&&(this.matrix=t.matrix),delete t.matrix,this.frontBuffer.setParameters(t),t.wireframe!==void 0&&(this.wireframe=t.wireframe,this.setVisibility(this.visible)),delete t.wireframe,this.backBuffer.setParameters(t)};Ri.prototype.setVisibility=function(t){this.visible=t,this.parameters.wireframe?(this.group.visible=!1,this.wireframeGroup.visible=t,this.pickable&&(this.pickingGroup.visible=!1)):(this.group.visible=t,this.wireframeGroup.visible=!1,this.pickable&&(this.pickingGroup.visible=t))};Ri.prototype.dispose=function(){this.frontBuffer.dispose(),this.backBuffer.dispose()};Ri.prototype.toJSON=function(){var t=this,r={};for(var i in t)["side","size","visible","matrix","parameters"].includes(i)&&(r[i]=t[i]);return r};Object.defineProperties(Ri.prototype,ku);Ut.add("shader/Line.vert",`uniform float clipNear;
uniform vec3 clipCenter;
varying vec3 vViewPosition;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#include color_pars_vertex
void main(){
#include color_vertex
#include begin_vertex
#include project_vertex
vViewPosition = -mvPosition.xyz;
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`);Ut.add("shader/Line.frag",`uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
varying vec3 vViewPosition;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#include common
#include color_pars_fragment
#include fog_pars_fragment
void main(){
#include nearclip_fragment
#include radiusclip_fragment
gl_FragColor = vec4( vColor, opacity );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include encodings_fragment
#include fog_fragment
}`);var cy=function(e){function t(){e.apply(this,arguments),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(It),pd=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="surface",this.parameters=Object.assign({isolevelType:{type:"select",options:{value:"value",sigma:"sigma"}},isolevel:{type:"number",precision:2,max:1e3,min:-1e3},negateIsolevel:{type:"boolean"},isolevelScroll:{type:"boolean"},smooth:{type:"integer",precision:1,max:10,min:0},background:{type:"boolean",rebuild:!0},opaqueBack:{type:"boolean",buffer:!0},boxSize:{type:"integer",precision:1,max:100,min:0},colorVolume:{type:"hidden"},contour:{type:"boolean",rebuild:!0},useWorker:{type:"boolean",rebuild:!0},wrap:{type:"boolean",rebuild:!0}},this.parameters),r instanceof jt?(this.surface=void 0,this.volume=r):(this.surface=r,this.volume=void 0),this.boxCenter=new I,this.__boxCenter=new I,this.box=new ir,this.__box=new ir,this._position=new I,this.setBox=function(){this._position.copy(i.translationGroup.position).negate(),this._position.equals(this.boxCenter)||this.setParameters({boxCenter:this._position})},this.toBePrepared=!0,this.viewer.signals.ticked.add(this.setBox,this),this.init(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};n.colorScheme=O(n.colorScheme,"uniform"),n.colorValue=O(n.colorValue,14540253),this.isolevelType=O(n.isolevelType,"sigma"),this.isolevel=O(n.isolevel,2),this.negateIsolevel=O(n.negateIsolevel,!1),this.isolevelScroll=O(n.isolevelScroll,!1),this.smooth=O(n.smooth,0),this.background=O(n.background,!1),this.opaqueBack=O(n.opaqueBack,!0),this.boxSize=O(n.boxSize,0),this.colorVolume=O(n.colorVolume,void 0),this.contour=O(n.contour,!1),this.useWorker=O(n.useWorker,!0),this.wrap=O(n.wrap,!1),e.prototype.init.call(this,n),this.build()},t.prototype.attach=function(i){var n=this;this.bufferList.forEach(function(a){n.viewer.add(a)}),this.setVisibility(this.visible),i()},t.prototype.prepare=function(i){var n=this;if(this.volume){var a;if(this.isolevelType==="sigma"?a=this.volume.getValueForSigma(this.isolevel):a=this.isolevel,this.negateIsolevel&&(a*=-1),!this.surface||this.__isolevel!==a||this.__smooth!==this.smooth||this.__contour!==this.contour||this.__wrap!==this.wrap||this.__boxSize!==this.boxSize||this.boxSize>0&&!this.__boxCenter.equals(this.boxCenter)){this.__isolevel=a,this.__smooth=this.smooth,this.__contour=this.contour,this.__wrap=this.wrap,this.__boxSize=this.boxSize,this.__boxCenter.copy(this.boxCenter),this.__box.copy(this.box);var o=function(s){n.surface=s,i()};this.useWorker?this.volume.getSurfaceWorker(a,this.smooth,this.boxCenter,this.boxSize,this.contour,this.wrap,o):o(this.volume.getSurface(a,this.smooth,this.boxCenter,this.boxSize,this.contour,this.wrap))}else i()}else i()},t.prototype.create=function(){var i={position:this.surface.getPosition(),color:this.surface.getColor(this.getColorParams()),index:this.surface.getIndex()},n;if(this.contour)n=new cy(i,this.getBufferParams({wireframe:!1}));else{Object.assign(i,{normal:this.surface.getNormal(),picking:this.surface.getPicking()});var a=new uy(i,this.getBufferParams({background:this.background,opaqueBack:this.opaqueBack,dullInterior:!1}));n=new Ri(a)}this.bufferList.push(n)},t.prototype.update=function(i){if(this.bufferList.length!==0){i=i||{};var n={};i.position&&(n.position=this.surface.getPosition()),i.color&&(n.color=this.surface.getColor(this.getColorParams())),i.index&&(n.index=this.surface.getIndex()),i.normal&&(n.normal=this.surface.getNormal()),this.bufferList.forEach(function(a){a.setAttributes(n)})}},t.prototype.setParameters=function(i,n,a){return i&&i.isolevelType!==void 0&&this.volume&&(this.isolevelType==="value"&&i.isolevelType==="sigma"?this.isolevel=this.volume.getSigmaForValue(this.isolevel):this.isolevelType==="sigma"&&i.isolevelType==="value"&&(this.isolevel=this.volume.getValueForSigma(this.isolevel)),this.isolevelType=i.isolevelType),i&&i.boxCenter&&(this.boxCenter.copy(i.boxCenter),delete i.boxCenter),i&&i.wireframe&&(i.contour||i.contour===void 0&&this.contour)&&(i.wireframe=!1),e.prototype.setParameters.call(this,i,n,a),this.volume&&this.volume.getBox(this.boxCenter,this.boxSize,this.box),i&&i.colorVolume!==void 0&&n&&(n.color=!0),this.surface&&(i.isolevel!==void 0||i.negateIsolevel!==void 0||i.smooth!==void 0||i.wrap!==void 0||i.boxSize!==void 0||this.boxSize>0&&!this.__box.equals(this.box))&&this.build({position:!0,color:!0,index:!0,normal:!this.contour}),this},t.prototype.getColorParams=function(){var i=e.prototype.getColorParams.call(this);return i.volume=this.colorVolume,i},t.prototype.dispose=function(){this.viewer.signals.ticked.remove(this.setBox,this),e.prototype.dispose.call(this)},t}(wr),ot=function(){};ot.zoomScroll=function(t,r){t.trackballControls.zoom(r)};ot.clipNearScroll=function(t,r){var i=t.getParameters();t.setParameters({clipNear:i.clipNear+r/10})};ot.focusScroll=function(t,r){var i=t.getParameters(),n=i.clipNear*2,a=Math.sign(r),o=a*iA((100-n)/10,5,.2);t.setFocus(n+o)};ot.zoomFocusScroll=function(t,r){t.trackballControls.zoom(r);var i=t.viewer.camera.position.z;t.setFocus(100-Math.abs(i/8))};ot.isolevelScroll=function(t,r){var i=Math.sign(r)/10;t.eachRepresentation(function(n,a){if(n.repr instanceof pd){var o=n.getParameters();o.isolevelScroll&&n.setParameters({isolevel:o.isolevel+i})}})};ot.panDrag=function(t,r,i){t.trackballControls.pan(r,i)};ot.rotateDrag=function(t,r,i){t.trackballControls.rotate(r,i)};ot.zRotateDrag=function(t,r,i){t.trackballControls.zRotate(r,i)};ot.zoomDrag=function(t,r,i){t.trackballControls.zoom((r+i)/-2)};ot.zoomFocusDrag=function(t,r,i){t.trackballControls.zoom((r+i)/-2);var n=t.viewer.camera.position.z;t.setFocus(100-Math.abs(n/8))};ot.panComponentDrag=function(t,r,i){t.trackballControls.panComponent(r,i)};ot.panAtomDrag=function(t,r,i){t.trackballControls.panAtom(r,i)};ot.rotateComponentDrag=function(t,r,i){t.trackballControls.rotateComponent(r,i)};ot.movePick=function(t,r){r&&t.animationControls.move(r.position.clone())};ot.tooltipPick=function(t,r){var i=t.tooltip,n=t.getParameters();if(n.tooltip&&r){var a=r.mouse.position;i.innerText=r.getLabel(),i.style.bottom=window.innerHeight-a.y+3+"px",i.style.left=a.x+3+"px",i.style.display="block"}else i.style.display="none"};ot.measurePick=function(t,r){if(r&&(r.atom||r.bond)){var i=r.atom||r.closestBondAtom,n=r.component;n.measurePick(i)}else t.measureClear()};var fy={default:[["scroll",ot.zoomScroll],["scroll-shift",ot.focusScroll],["scroll-ctrl",ot.isolevelScroll],["scroll-shift-ctrl",ot.zoomFocusScroll],["drag-left",ot.rotateDrag],["drag-right",ot.panDrag],["drag-ctrl-left",ot.panDrag],["drag-ctrl-right",ot.zRotateDrag],["drag-shift-left",ot.zoomDrag],["drag-middle",ot.zoomFocusDrag],["drag-ctrl-shift-right",ot.panComponentDrag],["drag-ctrl-shift-left",ot.rotateComponentDrag],["clickPick-right",ot.measurePick],["clickPick-ctrl-left",ot.measurePick],["clickPick-middle",ot.movePick],["clickPick-left",ot.movePick],["hoverPick",ot.tooltipPick]],pymol:[["drag-left",ot.rotateDrag],["drag-middle",ot.panDrag],["drag-right",ot.zoomDrag],["drag-shift-right",ot.focusScroll],["clickPick-ctrl+shift-middle",ot.movePick],["hoverPick",ot.tooltipPick]],coot:[["scroll",ot.isolevelScroll],["drag-left",ot.rotateDrag],["drag-middle",ot.panDrag],["drag-ctrl-left",ot.panDrag],["drag-right",ot.zoomFocusDrag],["drag-ctrl-right",ot.focusScroll],["clickPick-middle",ot.movePick],["hoverPick",ot.tooltipPick]],astexviewer:[["drag-left",ot.rotateDrag],["drag-ctrl-left",ot.panDrag],["drag-shift-left",ot.zoomDrag],["scroll",ot.focusScroll],["clickPick-middle",ot.movePick],["hoverPick",ot.tooltipPick]]};function ly(e){var t=e.split(/[-+]/),r="";t.includes("scroll")&&(r="scroll"),t.includes("drag")&&(r="drag"),t.includes("click")&&(r="click"),t.includes("doubleClick")&&(r="doubleClick"),t.includes("hover")&&(r="hover"),t.includes("clickPick")&&(r="clickPick"),t.includes("hoverPick")&&(r="hoverPick");var i=0;t.includes("alt")&&(i+=1),t.includes("ctrl")&&(i+=2),t.includes("meta")&&(i+=4),t.includes("shift")&&(i+=8);var n=0;return t.includes("left")&&(n+=1),t.includes("right")&&(n+=2),t.includes("middle")&&(n+=4),[r,i,n]}var ts=function(t,r){r===void 0&&(r={}),this.stage=t,this.actionList=[],this.mouse=t.mouseObserver,this.disabled=r.disabled||!1,this.preset(r.preset||"default")};ts.prototype.run=function(t){for(var r=this,i=[],n=arguments.length-1;n-- >0;)i[n]=arguments[n+1];if(!this.disabled){var a=this.mouse.key||0,o=this.mouse.buttons||0;this.actionList.forEach(function(s){s.type===t&&s.key===a&&s.button===o&&s.callback.apply(s,[r.stage].concat(i))})}};ts.prototype.add=function(t,r){var i=ly(t),n=i[0],a=i[1],o=i[2];this.actionList.push({type:n,key:a,button:o,callback:r})};ts.prototype.remove=function(t,r){var i=t.includes("*"),n=ly(t),a=n[0],o=n[1],s=n[2],u=this.actionList.filter(function(c){return!((c.type===a||i&&a==="")&&(c.key===o||i&&o===0)&&(c.button===s||i&&s===0)&&(c.callback===r||r===void 0))});this.actionList=u};ts.prototype.preset=function(t){var r=this;this.clear();var i=fy[t]||[];i.forEach(function(n){return r.add(n[0],n[1])})};ts.prototype.clear=function(){this.actionList.length=0};var rn=function(){};rn.autoView=function(t){t.autoView(1e3)};rn.toggleAnimations=function(t){t.animationControls.toggle()};rn.toggleRock=function(t){t.toggleRock()};rn.toggleSpin=function(t){t.toggleSpin()};rn.toggleAntialiasing=function(t){var r=t.getParameters();t.setParameters({sampleLevel:r.sampleLevel===-1?0:-1})};var NM={default:[["i",rn.toggleSpin],["k",rn.toggleRock],["p",rn.toggleAnimations],["a",rn.toggleAntialiasing],["r",rn.autoView]]},rs=function(t,r){r===void 0&&(r={}),this.stage=t,this.actionList=[],this.disabled=r.disabled||!1,this.preset(r.preset||"default")};rs.prototype.run=function(t){var r=this;this.disabled||this.actionList.forEach(function(i){i.key===t&&i.callback(r.stage)})};rs.prototype.add=function(t,r){this.actionList.push({key:t,callback:r})};rs.prototype.remove=function(t,r){var i=this.actionList.filter(function(n){return!(n.key===t&&(n.callback===r||r===void 0))});this.actionList=i};rs.prototype.preset=function(t){var r=this;this.clear();var i=NM[t]||[];i.forEach(function(n){return r.add(n[0],n[1])})};rs.prototype.clear=function(){this.actionList.length=0};var al=function(t){this.stage=t,this.stage=t,this.mouse=t.mouseObserver,this.controls=t.mouseControls,this.mouse.signals.clicked.add(this._onClick,this),this.mouse.signals.hovered.add(this._onHover,this)};al.prototype._onClick=function(t,r){var i=this.stage.pickingControls.pick(t,r);this.stage.signals.clicked.dispatch(i),this.controls.run("clickPick",i)};al.prototype._onHover=function(t,r){var i=this.stage.pickingControls.pick(t,r);i&&this.mouse.down.equals(this.mouse.position)&&(this.stage.transformComponent=i.component,this.stage.transformAtom=i.atom),this.stage.signals.hovered.dispatch(i),this.controls.run("hoverPick",i)};al.prototype.dispose=function(){this.mouse.signals.clicked.remove(this._onClick,this),this.mouse.signals.hovered.remove(this._onHover,this)};var da=function(t){this.stage=t,this.stage=t,this.mouse=t.mouseObserver,this.controls=t.mouseControls,this.mouse.signals.moved.add(this._onMove,this),this.mouse.signals.scrolled.add(this._onScroll,this),this.mouse.signals.dragged.add(this._onDrag,this),this.mouse.signals.clicked.add(this._onClick,this),this.mouse.signals.hovered.add(this._onHover,this),this.mouse.signals.doubleClicked.add(this._onDblclick,this)};da.prototype._onMove=function(){this.stage.tooltip.style.display="none"};da.prototype._onScroll=function(t){this.controls.run("scroll",t)};da.prototype._onDrag=function(t,r){this.controls.run("drag",t,r)};da.prototype._onClick=function(t,r){this.controls.run("click",t,r)};da.prototype._onDblclick=function(t,r){this.controls.run("doubleClick",t,r)};da.prototype._onHover=function(t,r){this.controls.run("hover",t,r)};da.prototype.dispose=function(){this.mouse.signals.moved.remove(this._onMove,this),this.mouse.signals.scrolled.remove(this._onScroll,this),this.mouse.signals.dragged.remove(this._onDrag,this),this.mouse.signals.clicked.remove(this._onClick,this),this.mouse.signals.hovered.remove(this._onHover,this)};var op=function(t){this.stage=t,this.viewer=t.viewer,this.animationControls=t.animationControls,this.viewer.signals.ticked.add(this._onTick,this)};op.prototype._onTick=function(t){this.animationControls.run(t)};op.prototype.dispose=function(){this.viewer.signals.ticked.remove(this._onTick,this)};var hy=A0?{passive:!0}:!1,is=function(t){this.stage=t,this.stage=t,this.controls=t.keyControls,this.domElement=t.viewer.renderer.domElement,this.domElement.setAttribute("tabIndex","-1"),this.domElement.style.outline="none",this._focusDomElement=this._focusDomElement.bind(this),this._onKeydown=this._onKeydown.bind(this),this._onKeyup=this._onKeyup.bind(this),this._onKeypress=this._onKeypress.bind(this),this.domElement.addEventListener("mousedown",this._focusDomElement),this.domElement.addEventListener("touchstart",this._focusDomElement,hy),this.domElement.addEventListener("keydown",this._onKeydown),this.domElement.addEventListener("keyup",this._onKeyup),this.domElement.addEventListener("keypress",this._onKeypress)};is.prototype._onKeydown=function(){};is.prototype._onKeyup=function(){};is.prototype._onKeypress=function(t){var r;"key"in KeyboardEvent.prototype?r=t.key:r=String.fromCharCode(t.which||t.keyCode),this.controls.run(r)};is.prototype._focusDomElement=function(){this.domElement.focus()};is.prototype.dispose=function(){this.domElement.removeEventListener("mousedown",this._focusDomElement),this.domElement.removeEventListener("touchstart",this._focusDomElement,hy),this.domElement.removeEventListener("keydown",this._onKeypress),this.domElement.removeEventListener("keyup",this._onKeypress),this.domElement.removeEventListener("keypress",this._onKeypress)};var pa=function(t,r,i,n){n===void 0&&(n={}),this.component=t,this.position=r,this.offsetX=O(n.offsetX,0),this.offsetY=O(n.offsetY,0),this.visible=O(n.visible,!0),this.stage=t.stage,this.viewer=t.stage.viewer,this._viewerPosition=new I,this._updateViewerPosition(),this._canvasPosition=new Ee,this._cameraPosition=new I,this.element=document.createElement("div"),Object.assign(this.element.style,{display:"block",position:"absolute",pointerEvents:"none",whiteSpace:"nowrap",left:"-10000px"}),this.viewer.wrapper.appendChild(this.element),this.setContent(i),this.updateVisibility(),this.viewer.signals.rendered.add(this._update,this),this.component.signals.matrixChanged.add(this._updateViewerPosition,this)};pa.prototype.setContent=function(t){var r=this.element.style.display;if(r==="none"&&(this.element.style.left="-10000px",this.element.style.display="block"),t instanceof HTMLElement)this.element.appendChild(t);else{var i=document.createElement("div");i.innerText=t,Object.assign(i.style,{backgroundColor:"rgba( 0, 0, 0, 0.6 )",color:"lightgrey",padding:"8px",fontFamily:"sans-serif"}),this.element.appendChild(i)}this._clientRect=this.element.getBoundingClientRect(),r==="none"&&(this.element.style.display=r)};pa.prototype.setVisibility=function(t){this.visible=t,this.updateVisibility()};pa.prototype.getVisibility=function(){return this.visible&&this.component.parameters.visible};pa.prototype.updateVisibility=function(){this.element.style.display=this.getVisibility()?"block":"none"};pa.prototype._updateViewerPosition=function(){this._viewerPosition.copy(this.position).applyMatrix4(this.component.matrix)};pa.prototype._update=function(){if(this.getVisibility()){var t=this.element.style,r=this._canvasPosition,i=this._viewerPosition,n=this._clientRect;if(this._cameraPosition.copy(i).add(this.viewer.translationGroup.position).applyMatrix4(this.viewer.rotationGroup.matrix).sub(this.viewer.camera.position),this._cameraPosition.z<0){t.display="none";return}else t.display="block";var a=this._cameraPosition.length(),o=this.viewer.scene.fog;t.opacity=(1-Pu(o.near,o.far,a)).toString(),t.zIndex=Math.round((o.far-a)*100).toString(),this.stage.viewerControls.getPositionOnCanvas(i,r),t.bottom=this.offsetX+r.y+n.height/2+"px",t.left=this.offsetY+r.x-n.width/2+"px"}};pa.prototype.dispose=function(){this.viewer.wrapper.removeChild(this.element),this.viewer.signals.ticked.remove(this._update,this),this.component.signals.matrixChanged.remove(this._updateViewerPosition,this)};var Sn=new Ae,nc=new I,Hv=new er,ol=function(t){this.component=t,this.signals={changed:new ht},this.stage=t.stage,this.viewer=t.stage.viewer},sp={position:{configurable:!0},rotation:{configurable:!0}};sp.position.get=function(){return this.component.position};sp.rotation.get=function(){return this.component.quaternion};ol.prototype.changed=function(){this.component.updateMatrix(),this.viewer.requestRender(),this.signals.changed.dispatch()};ol.prototype.spin=function(t,r){Sn.getInverse(this.viewer.rotationGroup.matrix),nc.copy(Ua(t)).applyMatrix4(Sn),Sn.extractRotation(this.component.transform),Sn.premultiply(this.viewer.rotationGroup.matrix),Sn.getInverse(Sn),nc.copy(Ua(t)),nc.applyMatrix4(Sn),Sn.makeRotationAxis(nc,r),Hv.setFromRotationMatrix(Sn),this.component.quaternion.premultiply(Hv),this.changed()};Object.defineProperties(ol.prototype,sp);var dy={"":"",vdw:"by vdW radius",covalent:"by covalent radius",sstruc:"by secondary structure",bfactor:"by bfactor",size:"size",data:"data",explicit:"explicit"},pn=function(t){t===void 0&&(t={}),this.max=10,this.type=O(t.type,"size"),this.scale=O(t.scale,1),this.size=O(t.size,1),this.data=O(t.data,{})};pn.prototype.atomRadius=function(t){var r;switch(this.type){case"vdw":r=t.vdw;break;case"covalent":r=t.covalent;break;case"bfactor":r=t.bfactor||1;break;case"sstruc":var i=t.sstruc;i==="h"||i==="g"||i==="i"||i==="e"||i==="b"?r=.25:Z0.includes(t.atomname)?r=.4:r=.1;break;case"data":r=O(this.data[t.index],1);break;case"explicit":r=t.radius,r===null&&(r=this.size);break;default:r=this.size;break}return Math.min(r*this.scale,this.max)};pn.types=dy;var kM=new I(-1,-1,-1),zM=new Ae,zu=function(t){var r=t.rows,i=r/3,n=new Wt(r,3),a=new Wt(3,3),o=new Wt(1,3),s=new Wt(3,3),u=new Wt(3,3),c=hd(t);dd(t,c),ki(n,t),Cc(a,n,n),iy(a,o,s,u);var f=new I(c[0],c[1],c[2]),l=new I(s.data[0],s.data[3],s.data[6]),h=new I(s.data[1],s.data[4],s.data[7]),d=new I(s.data[2],s.data[5],s.data[8]),p=l.clone().multiplyScalar(Math.sqrt(o.data[0]/i)),v=h.clone().multiplyScalar(Math.sqrt(o.data[1]/i)),m=d.clone().multiplyScalar(Math.sqrt(o.data[2]/i));this.begA=f.clone().sub(p),this.endA=f.clone().add(p),this.begB=f.clone().sub(v),this.endB=f.clone().add(v),this.begC=f.clone().sub(m),this.endC=f.clone().add(m),this.center=f,this.vecA=p,this.vecB=v,this.vecC=m,this.normVecA=l,this.normVecB=h,this.normVecC=d};zu.prototype.getBasisMatrix=function(t){t===void 0&&(t=new Ae);var r=t;return r.makeBasis(this.normVecB,this.normVecA,this.normVecC),r.determinant()<0&&r.scale(kM),r};zu.prototype.getRotationQuaternion=function(t){t===void 0&&(t=new er);var r=t;return r.setFromRotationMatrix(this.getBasisMatrix(zM)),r.inverse()};zu.prototype.getProjectedScaleForAtoms=function(t){var r=-1/0,i=-1/0,n=-1/0,a=-1/0,o=-1/0,s=-1/0,u=new I,c=new I,f=this.center,l=this.normVecA,h=this.normVecB,d=this.normVecC;return t.eachAtom(function(p){Ea(u.copy(p),l,f);var v=c.subVectors(u,f).normalize().dot(l),m=u.distanceTo(f);v>0?m>r&&(r=m):m>i&&(i=m),Ea(u.copy(p),h,f);var g=c.subVectors(u,f).normalize().dot(h),x=u.distanceTo(f);g>0?x>n&&(n=x):x>a&&(a=x),Ea(u.copy(p),d,f);var y=c.subVectors(u,f).normalize().dot(d),b=u.distanceTo(f);y>0?b>o&&(o=b):b>s&&(s=b)}),{d1a:r,d2a:n,d3a:o,d1b:-i,d2b:-a,d3b:-s}};var Li=function(t,r,i,n){this.volume=t,this.setFilter(r,i,n)},Wi={header:{configurable:!0},matrix:{configurable:!0},normalMatrix:{configurable:!0},inverseMatrix:{configurable:!0},center:{configurable:!0},boundingBox:{configurable:!0},min:{configurable:!0},max:{configurable:!0},mean:{configurable:!0},rms:{configurable:!0}};Wi.header.get=function(){return this.volume.header};Wi.matrix.get=function(){return this.volume.matrix};Wi.normalMatrix.get=function(){return this.volume.normalMatrix};Wi.inverseMatrix.get=function(){return this.volume.inverseMatrix};Wi.center.get=function(){return this.volume.center};Wi.boundingBox.get=function(){return this.volume.boundingBox};Wi.min.get=function(){return this.volume.min};Wi.max.get=function(){return this.volume.max};Wi.mean.get=function(){return this.volume.mean};Wi.rms.get=function(){return this.volume.rms};Li.prototype._getFilterHash=function(t,r,i){return JSON.stringify([t,r,i])};Li.prototype.setFilter=function(t,r,i){isNaN(t)&&this.header&&(t=this.header.DMEAN+2*this.header.ARMS),t=t!==void 0&&!isNaN(t)?t:-1/0,r=O(r,1/0),i=O(i,!1);var n=this.volume.data,a=this.volume.position,o=this.volume.atomindex,s=this._getFilterHash(t,r,i);if(s!==this._filterHash){if(t===-1/0&&r===1/0)this.data=n,this.position=a,this.atomindex=o;else{var u=n.length;this._dataBuffer||(this._dataBuffer=new ArrayBuffer(u*4),this._positionBuffer=new ArrayBuffer(u*3*4),o&&(this._atomindexBuffer=new ArrayBuffer(u*4)));var c=new Float32Array(this._dataBuffer),f=new Float32Array(this._positionBuffer),l;o&&(l=new Uint32Array(this._atomindexBuffer));for(var h=0,d=0;d<u;++d){var p=d*3,v=n[d];if(!i&&v>=t&&v<=r||i&&(v<t||v>r)){var m=h*3;c[h]=v,f[m+0]=a[p+0],f[m+1]=a[p+1],f[m+2]=a[p+2],o&&l&&(l[h]=o[d]),h+=1}}this.data=new Float32Array(this._dataBuffer,0,h),this.position=new Float32Array(this._positionBuffer,0,h*3),o&&(this.atomindex=new Int32Array(this._atomindexBuffer,0,h))}this._filterHash=s}};Object.defineProperties(Li.prototype,Wi);Li.prototype.getValueForSigma=jt.prototype.getValueForSigma;Li.prototype.getSigmaForValue=jt.prototype.getSigmaForValue;Li.prototype.getDataAtomindex=jt.prototype.getDataAtomindex;Li.prototype.getDataPosition=jt.prototype.getDataPosition;Li.prototype.getDataColor=jt.prototype.getDataColor;Li.prototype.getDataPicking=jt.prototype.getDataPicking;Li.prototype.getDataSize=jt.prototype.getDataSize;var UM=function(t,r){var i=G0({nodeArray1:t.atomIndex1,nodeArray2:t.atomIndex2,edgeCount:t.count,nodeCount:r});this.countArray=i.countArray,this.offsetArray=i.offsetArray,this.indexArray=i.indexArray},Tc=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={_defaultFields:{configurable:!0}};return r._defaultFields.get=function(){return[["atomIndex1",1,"int32"],["atomIndex2",1,"int32"],["bondOrder",1,"int8"]]},t.prototype.addBond=function(n,a,o){this.growIfFull();var s=this.count,u=n.index,c=a.index;u<c?(this.atomIndex1[s]=u,this.atomIndex2[s]=c):(this.atomIndex2[s]=u,this.atomIndex1[s]=c),o&&(this.bondOrder[s]=o),this.count+=1},t.prototype.addBondIfConnected=function(n,a,o){return n.connectedTo(a)?(this.addBond(n,a,o),!0):!1},Object.defineProperties(t.prototype,r),t}(Wr),GM=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={_defaultFields:{configurable:!0}};return r._defaultFields.get=function(){return[["residueIndex",1,"uint32"],["atomTypeId",1,"uint16"],["x",1,"float32"],["y",1,"float32"],["z",1,"float32"],["serial",1,"int32"],["bfactor",1,"float32"],["altloc",1,"uint8"],["occupancy",1,"float32"]]},t.prototype.setAltloc=function(n,a){this.altloc[n]=a.charCodeAt(0)},t.prototype.getAltloc=function(n){var a=this.altloc[n];return a?String.fromCharCode(a):""},Object.defineProperties(t.prototype,r),t}(Wr),HM=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={_defaultFields:{configurable:!0}};return r._defaultFields.get=function(){return[["chainIndex",1,"uint32"],["atomOffset",1,"uint32"],["atomCount",1,"uint16"],["residueTypeId",1,"uint16"],["resno",1,"int32"],["sstruc",1,"uint8"],["inscode",1,"uint8"]]},t.prototype.setSstruc=function(n,a){this.sstruc[n]=a.charCodeAt(0)},t.prototype.getSstruc=function(n){var a=this.sstruc[n];return a?String.fromCharCode(a):""},t.prototype.setInscode=function(n,a){this.inscode[n]=a.charCodeAt(0)},t.prototype.getInscode=function(n){var a=this.inscode[n];return a?String.fromCharCode(a):""},Object.defineProperties(t.prototype,r),t}(Wr),VM=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={_defaultFields:{configurable:!0}};return r._defaultFields.get=function(){return[["entityIndex",1,"uint16"],["modelIndex",1,"uint16"],["residueOffset",1,"uint32"],["residueCount",1,"uint32"],["chainname",4,"uint8"],["chainid",4,"uint8"]]},t.prototype.setChainname=function(n,a){var o=4*n;this.chainname[o]=a.charCodeAt(0),this.chainname[o+1]=a.charCodeAt(1),this.chainname[o+2]=a.charCodeAt(2),this.chainname[o+3]=a.charCodeAt(3)},t.prototype.getChainname=function(n){for(var a=this,o="",s=0;s<4;++s){var u=a.chainname[4*n+s];if(u)o+=String.fromCharCode(u);else break}return o},t.prototype.setChainid=function(n,a){var o=4*n;this.chainid[o]=a.charCodeAt(0),this.chainid[o+1]=a.charCodeAt(1),this.chainid[o+2]=a.charCodeAt(2),this.chainid[o+3]=a.charCodeAt(3)},t.prototype.getChainid=function(n){for(var a=this,o="",s=0;s<4;++s){var u=a.chainid[4*n+s];if(u)o+=String.fromCharCode(u);else break}return o},Object.defineProperties(t.prototype,r),t}(Wr),WM=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={_defaultFields:{configurable:!0}};return r._defaultFields.get=function(){return[["chainOffset",1,"uint32"],["chainCount",1,"uint32"]]},Object.defineProperties(t.prototype,r),t}(Wr),kn=function(t){this.polymer=t,this.size=t.residueCount};kn.prototype.getCenterIterator=function(t){t===void 0&&(t=0);var r=this.getPosition().center,i=r.length/3,n=0,a=-1,o=[new I,new I,new I,new I];function s(){var f=this.get(a);return a+=1,f}function u(f){f=Math.min(i-1,Math.max(0,f));var l=o[n%4],h=3*f;if(l.fromArray(r,h),t){for(var d=Math.min(t,f,i-f-1),p=1;p<=d;++p){var v=p*3,m=(d+1-p)/(d+1);l.x+=m*r[h-v+0]+m*r[h+v+0],l.y+=m*r[h-v+1]+m*r[h+v+1],l.z+=m*r[h-v+2]+m*r[h+v+2]}l.x/=d+1,l.y/=d+1,l.z/=d+1}return n+=1,l}function c(){n=0,a=-1}return{size:i,next:s,get:u,reset:c}};kn.prototype.getColor=function(t){var r=this.polymer,i=r.structure,n=r.residueCount,a=r.residueIndexStart,o=new Float32Array(n*3),s=t||{};s.structure=i;for(var u=Tt.getScheme(s),c=i.getResidueProxy(),f=i.getAtomProxy(),l=0;l<n;++l)c.index=a+l,f.index=c.traceAtomIndex,u.atomColorToArray(f,o,l*3);return{color:o}};kn.prototype.getPicking=function(){for(var t=this.polymer,r=t.structure,i=t.residueCount,n=t.residueIndexStart,a=new Float32Array(i),o=r.getResidueProxy(),s=0;s<i;++s)o.index=n+s,a[s]=o.traceAtomIndex;return{picking:new Za(a,r)}};kn.prototype.getSize=function(t){for(var r=this.polymer,i=r.structure,n=r.residueCount,a=r.residueIndexStart,o=new Float32Array(n),s=new pn(t),u=i.getResidueProxy(),c=i.getAtomProxy(),f=0;f<n;++f)u.index=a+f,c.index=u.traceAtomIndex,o[f]=s.atomRadius(c);return{size:o}};kn.prototype.getPosition=function(){for(var t=this.polymer,r=t.structure,i=t.residueCount,n=i-3,a=new Float32Array(3*i),o=new Float32Array(3*i),s=new Float32Array(i),u=new Float32Array(i),c=new Float32Array(i),f=new Float32Array(i),l=new Float32Array(3*i),h=new I,d=new I,p=new I,v=new I,m=new I,g=new I,x=new I,y=new I,b=new I,_=new I,w=new I,A=new I(0,0,0),S="trace",M=r.getAtomProxy(),E=r.getAtomProxy(t.getAtomIndexByType(0,S)),T=r.getAtomProxy(t.getAtomIndexByType(1,S)),H=r.getAtomProxy(t.getAtomIndexByType(2,S)),X=0;X<n;++X){M.index=E.index,E.index=T.index,T.index=H.index,H.index=t.getAtomIndexByType(X+3,S);var q=3*X;h.subVectors(E,M),d.subVectors(T,E),p.subVectors(H,T),v.subVectors(h,d),m.subVectors(d,p),b.crossVectors(v,m).normalize(),b.toArray(o,q),X>0&&(s[X]=b.angleTo(_));var Z=Math.cos(v.angleTo(m));f[X]=180/Math.PI*Math.acos(Z);var Q=v.length(),N=m.length();u[X]=Math.sqrt(N*Q)/Math.max(2,2*(1-Z)),c[X]=Math.abs(d.dot(b)),g.copy(v).multiplyScalar(u[X]/Q),x.copy(m).multiplyScalar(u[X]/N),g.subVectors(E,g),x.subVectors(T,x),g.toArray(a,q+3),x.toArray(a,q+6),w.subVectors(M,A),w.toArray(l,q),_.copy(b),A.copy(g)}g.fromArray(a,3),x.fromArray(a,6),b.subVectors(g,x).normalize(),M.index=t.getAtomIndexByType(0,S),A.copy(M),y.copy(M),Ea(y,b,g),y.toArray(a,0),w.subVectors(A,g),w.toArray(l,0),g.fromArray(a,3*i-6),x.fromArray(a,3*i-9),b.subVectors(g,x).normalize(),M.index=t.getAtomIndexByType(i-1,S),A.copy(M),y.copy(M),Ea(y,b,g),y.toArray(a,3*i-3);for(var D=i-3;D<i;++D)g.fromArray(a,3*D),M.index=t.getAtomIndexByType(D,S),A.copy(M),w.subVectors(A,g),w.toArray(l,3*D);var W=new Float32Array(i),L=new Float32Array(i),U=new Float32Array(i),k=new Float32Array(i);W[1]=u[0],L[1]=f[0],U[1]=u[0];for(var ee=2;ee<i-2;++ee)W[ee]=.5*(u[ee-2]+u[ee-1]),L[ee]=.5*(f[ee-2]+f[ee-1]),U[ee]=.5*(c[ee-2]+c[ee-1]),g.fromArray(o,3*(ee-2)),x.fromArray(o,3*(ee-1)),k[ee]=180/Math.PI*Math.acos(Math.cos(g.angleTo(x)));W[i-2]=u[i-4],L[i-2]=f[i-4],U[i-2]=c[i-4];var K=new Float32Array(3*i);si(o,K,0,0,3),si(o,K,0,3,3);for(var te=2;te<i-2;++te)g.fromArray(o,3*(te-2)),x.fromArray(o,3*(te-1)),b.addVectors(x,g).multiplyScalar(.5).normalize(),b.toArray(K,3*te);return si(o,K,3*i-12,3*i-6,3),si(o,K,3*i-12,3*i-3,3),{center:a,axis:K,bending:k,radius:W,rise:U,twist:L,resdir:l}};var up=function(t){this.polymer=t,this.helixorient=new kn(t),this.position=this.helixorient.getPosition()};up.prototype.getAxis=function(t,r,i,n,a){t=t||30,r=r||2.5,i=i===void 0?!1:i;var o=this.polymer,s=o.structure,u=o.residueCount,c=o.residueIndexStart,f=this.position,l=n||{};l.structure=s;for(var h=Tt.getScheme(l),d=new pn(a),p=0,v=0,m=[],g=[],x=[],y=[],b=[],_=[],w=[],A=[],S=[],M=new Float32Array(u*3),E=new Float32Array(u*3),T,H,X=new I,q=new I,Z=s.getResidueProxy(),Q=s.getResidueProxy(),N=s.getAtomProxy(),D=new I,W=new I,L=!1,U=0;U<u;++U)if(Z.index=c+U,D.fromArray(f.center,U*3),U===u-1?L=!0:(Q.index=c+U+1,W.fromArray(f.center,U*3+3),(i&&Z.sstruc!==Q.sstruc||D.distanceTo(W)>r||f.bending[U]>t)&&(L=!0)),L){if(U-p<4){p=U,L=!1;continue}N.index=Z.traceAtomIndex,M=f.axis.subarray(p*3+3,U*3),E=f.center.subarray(p*3,U*3+3),T=cd(M).normalize(),H=cd(E),X.fromArray(E),Ea(X,T,H),q.fromArray(E,E.length-3),Ea(q,T,H),T.subVectors(q,X),T.toArray(m,v),H.toArray(g,v),X.toArray(x,v),q.toArray(y,v),h.atomColorToArray(N,b,v),_.push(N.index),w.push(d.atomRadius(N)),A.push(c+p),S.push(c+U+1-p),v+=3,p=U,L=!1}var k=new Float32Array(_);return{axis:new Float32Array(m),center:new Float32Array(g),begin:new Float32Array(x),end:new Float32Array(y),color:new Float32Array(b),picking:new Za(k,s),size:new Float32Array(w),residueOffset:A,residueCount:S}};var va=function(t){this.scoreFunction=t,this.content=[],this.scoreFunction=t};va.prototype.push=function(t){this.content.push(t),this.bubbleUp(this.content.length-1)};va.prototype.pop=function(){var t=this.content[0],r=this.content.pop();return r&&this.content.length>0&&(this.content[0]=r,this.sinkDown(0)),t};va.prototype.peek=function(){return this.content[0]};va.prototype.remove=function(t){for(var r=this,i=this.content.length,n=0;n<i;n++)if(r.content[n]===t){var a=r.content.pop();a&&n!==i-1&&(r.content[n]=a,r.scoreFunction(a)<r.scoreFunction(t)?r.bubbleUp(n):r.sinkDown(n));return}throw new Error("Node not found.")};va.prototype.size=function(){return this.content.length};va.prototype.bubbleUp=function(t){for(var r=this,i=this.content[t];t>0;){var n=Math.floor((t+1)/2)-1,a=r.content[n];if(r.scoreFunction(i)<r.scoreFunction(a))r.content[n]=i,r.content[t]=a,t=n;else break}};va.prototype.sinkDown=function(t){for(var r=this,i=this.content.length,n=this.content[t],a=this.scoreFunction(n),o=0,s=0;;){var u=(t+1)*2,c=u-1,f=null;if(c<i){var l=r.content[c];o=r.scoreFunction(l),o<a&&(f=c)}if(u<i){var h=r.content[u];s=r.scoreFunction(h),s<(f===null?a:o)&&(f=u)}if(f!==null)r.content[t]=r.content[f],r.content[f]=n,t=f;else break}};/**
 * Kdtree
 * @class
 * @author Alexander Rose <alexander.rose@weirdbyte.de>, 2016
 * @author Roman Bolzern <roman.bolzern@fhnw.ch>, 2013
 * @author I4DS http://www.fhnw.ch/i4ds, 2013
 * @license MIT License <http://www.opensource.org/licenses/mit-license.php>
 * @description
 * k-d Tree for typed arrays of 3d points (e.g. for Float32Array), in-place
 * provides fast nearest neighbour search
 *
 * Based on https://github.com/ubilabs/kd-tree-javascript by Ubilabs
 *
 * Further information (including mathematical properties)
 * http://en.wikipedia.org/wiki/Binary_tree
 * http://en.wikipedia.org/wiki/K-d_tree
 *
 * @example
 * points: [x, y, z, x, y, z, x, y, z, ...]
 * metric: function(a, b){
 *    return Math.pow(a[0]-b[0], 2) + Math.pow(a[1]-b[1], 2) + Math.pow(a[2]-b[2], 2);
 * }
 *
 * @param {Float32Array} points - points
 * @param {Function} metric - metric
 */var Uu=function(t,r){this.points=t,this.metric=r,this.maxDepth=0,this.currentNode=0;for(var i=t.length/3,n=new Uint32Array(i),a=0;a<i;++a)n[a]=a;this.indices=n,this.nodes=new Int32Array(i*4),this.rootIndex=this.buildTree(0,-1,0,i)};Uu.prototype.buildTree=function(t,r,i,n){t>this.maxDepth&&(this.maxDepth=t);var a=n-i;if(a===0)return-1;var o=this.currentNode*4,s=this.nodes;if(this.currentNode+=1,a===1)return s[o]=i,s[o+1]=-1,s[o+2]=-1,s[o+3]=r,o;for(var u=this.indices,c=this.points,f=i+Math.floor(a/2),l=t%3,h,d,p,v,m,g=i,x=n-1;x>g;){for(p=g+x>>1,v=c[u[p]*3+l],d=u[p],u[p]=u[x],u[x]=d,m=g,h=g;h<x;++h)c[u[h]*3+l]<v&&(d=u[m],u[m]=u[h],u[h]=d,++m);if(d=u[x],u[x]=u[m],u[m]=d,p=m,f===p)break;f<p?x=p-1:g=p+1}return s[o]=f,s[o+1]=this.buildTree(t+1,o,i,f),s[o+2]=this.buildTree(t+1,o,f+1,n),s[o+3]=r,o};Uu.prototype.getNodeDepth=function(t){var r=this.nodes[t+3];return r===-1?0:this.getNodeDepth(r)+1};Uu.prototype.nearest=function(t,r,i){var n=this,a=new va(function(d){return-d[1]}),o=this.nodes,s=this.points,u=this.indices,c=function(d){var p,v,m=n.getNodeDepth(d)%3,g=u[o[d]]*3,x=[s[g+0],s[g+1],s[g+2]],y=n.metric(t,x);function b(E,T){a.push([E,T]),a.size()>r&&a.pop()}var _=o[d+1],w=o[d+2];if(w===-1&&_===-1){(a.size()<r||y<a.peek()[1])&&y<=i&&b(d,y);return}w===-1?p=_:_===-1?p=w:t[m]<=s[g+m]?p=_:p=w,c(p),(a.size()<r||y<a.peek()[1])&&y<=i&&b(d,y);for(var A=[],S=0;S<3;S+=1)S===m?A[S]=t[S]:A[S]=s[g+S];var M=n.metric(A,x);(a.size()<r||Math.abs(M)<a.peek()[1])&&Math.abs(M)<=i&&(p===_?v=w:v=_,v!==-1&&c(v))};c(this.rootIndex);for(var f=[],l=0,h=Math.min(a.size(),r);l<h;l+=1)f.push(a.content[l]);return f};Uu.prototype.verify=function(t,r){r===void 0&&(r=0);var i=1;if(t===void 0&&(t=this.rootIndex),t===-1)throw new Error("node is null");var n=r%3,a=this.nodes,o=this.points,s=this.indices,u=a[t+1],c=a[t+2];if(u!==-1){if(o[s[a[u]]*3+n]>o[s[a[t]]*3+n])throw new Error("left child is > parent!");i+=this.verify(u,r+1)}if(c!==-1){if(o[s[a[c]]*3+n]<o[s[a[t]]*3+n])throw new Error("right child is < parent!");i+=this.verify(c,r+1)}return i};var tt=function(t,r){r===void 0&&(r=0),this.structure=t,this.index=r,this.chainStore=t.chainStore,this.residueStore=t.residueStore,this.atomStore=t.atomStore,this.residueMap=t.residueMap,this.atomMap=t.atomMap},dt={bondHash:{configurable:!0},entity:{configurable:!0},entityIndex:{configurable:!0},modelIndex:{configurable:!0},chainIndex:{configurable:!0},residue:{configurable:!0},residueIndex:{configurable:!0},sstruc:{configurable:!0},inscode:{configurable:!0},resno:{configurable:!0},chainname:{configurable:!0},chainid:{configurable:!0},residueType:{configurable:!0},atomType:{configurable:!0},residueAtomOffset:{configurable:!0},resname:{configurable:!0},hetero:{configurable:!0},atomname:{configurable:!0},number:{configurable:!0},element:{configurable:!0},vdw:{configurable:!0},covalent:{configurable:!0},x:{configurable:!0},y:{configurable:!0},z:{configurable:!0},serial:{configurable:!0},bfactor:{configurable:!0},occupancy:{configurable:!0},altloc:{configurable:!0},partialCharge:{configurable:!0},radius:{configurable:!0},formalCharge:{configurable:!0},aromatic:{configurable:!0},bondCount:{configurable:!0}};dt.bondHash.get=function(){return this.structure.bondHash};dt.entity.get=function(){return this.structure.entityList[this.entityIndex]};dt.entityIndex.get=function(){return this.chainStore.entityIndex[this.chainIndex]};dt.modelIndex.get=function(){return this.chainStore.modelIndex[this.chainIndex]};dt.chainIndex.get=function(){return this.residueStore.chainIndex[this.residueIndex]};dt.residue.get=function(){return console.warn("residue - might be expensive"),this.structure.getResidueProxy(this.residueIndex)};dt.residueIndex.get=function(){return this.atomStore.residueIndex[this.index]};dt.residueIndex.set=function(e){this.atomStore.residueIndex[this.index]=e};dt.sstruc.get=function(){return this.residueStore.getSstruc(this.residueIndex)};dt.inscode.get=function(){return this.residueStore.getInscode(this.residueIndex)};dt.resno.get=function(){return this.residueStore.resno[this.residueIndex]};dt.chainname.get=function(){return this.chainStore.getChainname(this.chainIndex)};dt.chainid.get=function(){return this.chainStore.getChainid(this.chainIndex)};dt.residueType.get=function(){return this.residueMap.get(this.residueStore.residueTypeId[this.residueIndex])};dt.atomType.get=function(){return this.atomMap.get(this.atomStore.atomTypeId[this.index])};dt.residueAtomOffset.get=function(){return this.residueStore.atomOffset[this.residueIndex]};dt.resname.get=function(){return this.residueType.resname};dt.hetero.get=function(){return this.residueType.hetero};dt.atomname.get=function(){return this.atomType.atomname};dt.number.get=function(){return this.atomType.number};dt.element.get=function(){return this.atomType.element};dt.vdw.get=function(){return this.atomType.vdw};dt.covalent.get=function(){return this.atomType.covalent};dt.x.get=function(){return this.atomStore.x[this.index]};dt.x.set=function(e){this.atomStore.x[this.index]=e};dt.y.get=function(){return this.atomStore.y[this.index]};dt.y.set=function(e){this.atomStore.y[this.index]=e};dt.z.get=function(){return this.atomStore.z[this.index]};dt.z.set=function(e){this.atomStore.z[this.index]=e};dt.serial.get=function(){return this.atomStore.serial[this.index]};dt.serial.set=function(e){this.atomStore.serial[this.index]=e};dt.bfactor.get=function(){return this.atomStore.bfactor[this.index]};dt.bfactor.set=function(e){this.atomStore.bfactor[this.index]=e};dt.occupancy.get=function(){return this.atomStore.occupancy[this.index]};dt.occupancy.set=function(e){this.atomStore.occupancy[this.index]=e};dt.altloc.get=function(){return this.atomStore.getAltloc(this.index)};dt.altloc.set=function(e){this.atomStore.setAltloc(this.index,e)};dt.partialCharge.get=function(){return this.atomStore.partialCharge?this.atomStore.partialCharge[this.index]:null};dt.partialCharge.set=function(e){this.atomStore.partialCharge&&(this.atomStore.partialCharge[this.index]=e)};dt.radius.get=function(){return this.atomStore.radius?this.atomStore.radius[this.index]:null};dt.radius.set=function(e){this.atomStore.radius&&(this.atomStore.radius[this.index]=e)};dt.formalCharge.get=function(){return this.atomStore.formalCharge?this.atomStore.formalCharge[this.index]:null};dt.formalCharge.set=function(e){this.atomStore.formalCharge&&(this.atomStore.formalCharge[this.index]=e)};dt.aromatic.get=function(){return this.atomStore.aromatic?this.atomStore.aromatic[this.index]:this.residueType.isAromatic(this)?1:0};dt.aromatic.set=function(e){this.atomStore.aromatic&&(this.atomStore.aromatic[this.index]=e)};dt.bondCount.get=function(){return this.bondHash.countArray[this.index]};tt.prototype.eachBond=function(t,r){r=r||this.structure._bp;for(var i=this.index,n=this.bondHash,a=n.indexArray,o=n.countArray[i],s=n.offsetArray[i],u=0;u<o;++u)r.index=a[s+u],t(r)};tt.prototype.eachBondedAtom=function(t,r){var i=r||this.structure._ap,n=this.index;this.eachBond(function(a){i.index=n!==a.atomIndex1?a.atomIndex1:a.atomIndex2,t(i)}),this.index=n};tt.prototype.hasBondTo=function(t){var r=!1;return this.eachBondedAtom(function(i){t.index===i.index&&(r=!0)}),r};tt.prototype.bondToElementCount=function(t){var r=0,i=this.index;return this.eachBondedAtom(function(n){n.number===t&&(r+=1)}),this.index=i,r};tt.prototype.hasBondToElement=function(t){return this.bondToElementCount(t)>0};tt.prototype.isBackbone=function(){var t=this.residueType.backboneIndexList;return t.length>0?t.includes(this.index-this.residueAtomOffset):!1};tt.prototype.isPolymer=function(){if(this.structure.entityList.length>0)return this.entity.isPolymer();var t=this.residueType.moleculeType;return t===Ya||t===Un||t===Gn};tt.prototype.isSidechain=function(){return this.isPolymer()&&!this.isBackbone()};tt.prototype.isCg=function(){var t=this.residueType.backboneType;return t===Zo||t===Ko||t===Jo};tt.prototype.isTrace=function(){return this.index===this.residueType.traceAtomIndex+this.residueAtomOffset};tt.prototype.isHetero=function(){return this.residueType.hetero===1};tt.prototype.isProtein=function(){return this.residueType.moleculeType===Ya};tt.prototype.isNucleic=function(){var t=this.residueType.moleculeType;return t===Un||t===Gn};tt.prototype.isRna=function(){return this.residueType.moleculeType===Un};tt.prototype.isDna=function(){return this.residueType.moleculeType===Gn};tt.prototype.isWater=function(){return this.residueType.moleculeType===rl};tt.prototype.isIon=function(){return this.residueType.moleculeType===il};tt.prototype.isSaccharide=function(){return this.residueType.moleculeType===nl};tt.prototype.isHelix=function(){return V0.includes(this.sstruc)};tt.prototype.isSheet=function(){return W0.includes(this.sstruc)};tt.prototype.isTurn=function(){return j0.includes(this.sstruc)&&this.isProtein()};tt.prototype.isBonded=function(){return this.bondHash.countArray[this.index]!==0};tt.prototype.isRing=function(){var t=this.residueType.getRings().atomRings;return t[this.index-this.residueAtomOffset]!==void 0};tt.prototype.isAromatic=function(){return this.aromatic===1};tt.prototype.isMetal=function(){return this.atomType.isMetal()};tt.prototype.isNonmetal=function(){return this.atomType.isNonmetal()};tt.prototype.isMetalloid=function(){return this.atomType.isMetalloid()};tt.prototype.isHalogen=function(){return this.atomType.isHalogen()};tt.prototype.isDiatomicNonmetal=function(){return this.atomType.isDiatomicNonmetal()};tt.prototype.isPolyatomicNonmetal=function(){return this.atomType.isPolyatomicNonmetal()};tt.prototype.isAlkaliMetal=function(){return this.atomType.isAlkaliMetal()};tt.prototype.isAlkalineEarthMetal=function(){return this.atomType.isAlkalineEarthMetal()};tt.prototype.isNobleGas=function(){return this.atomType.isNobleGas()};tt.prototype.isTransitionMetal=function(){return this.atomType.isTransitionMetal()};tt.prototype.isPostTransitionMetal=function(){return this.atomType.isPostTransitionMetal()};tt.prototype.isLanthanide=function(){return this.atomType.isLanthanide()};tt.prototype.isActinide=function(){return this.atomType.isActinide()};tt.prototype.getDefaultValence=function(){return this.atomType.getDefaultValence()};tt.prototype.getValenceList=function(){return this.atomType.getValenceList()};tt.prototype.getOuterShellElectronCount=function(){return this.atomType.getOuterShellElectronCount()};tt.prototype.distanceTo=function(t){var r=this.atomStore,i=t.atomStore,n=this.index,a=t.index,o=r.x[n]-i.x[a],s=r.y[n]-i.y[a],u=r.z[n]-i.z[a],c=o*o+s*s+u*u;return Math.sqrt(c)};tt.prototype.connectedTo=function(t){var r=this.atomStore,i=t.atomStore,n=this.index,a=t.index;if(r.altloc&&i.altloc){var o=r.altloc[n],s=i.altloc[a];if(!(o===0||s===0||o===32||s===32||o===s))return!1}var u=r.x[n]-i.x[a],c=r.y[n]-i.y[a],f=r.z[n]-i.z[a],l=u*u+c*c+f*f;if(l<48&&this.isCg())return!0;if(isNaN(l))return!1;var h=this.covalent+t.covalent,d=h+.3,p=h-.5;return l<d*d&&l>p*p};tt.prototype.positionFromArray=function(t,r){return r===void 0&&(r=0),this.x=t[r+0],this.y=t[r+1],this.z=t[r+2],this};tt.prototype.positionToArray=function(t,r){t===void 0&&(t=[]),r===void 0&&(r=0);var i=this.index,n=this.atomStore;return t[r+0]=n.x[i],t[r+1]=n.y[i],t[r+2]=n.z[i],t};tt.prototype.positionToVector3=function(t){return t===void 0&&(t=new I),t.x=this.x,t.y=this.y,t.z=this.z,t};tt.prototype.positionFromVector3=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this};tt.prototype.positionAdd=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this};tt.prototype.positionSub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this};tt.prototype.getResidueBonds=function(t){t===void 0&&(t=!1);var r=this.residueAtomOffset,i=this.index-this.residueAtomOffset,n=this.residueType.getBonds(),a=n.atomIndices1,o=n.atomIndices2,s,u,c,f;for(t||(f=[]),s=a.indexOf(i);s!==-1;)if(c=o[s]+r,f)f.push(c),s=a.indexOf(i,s+1);else return c;for(u=o.indexOf(i);u!==-1;)if(c=a[u]+r,f)f.push(c),u=o.indexOf(i,u+1);else return c;return f};tt.prototype.qualifiedName=function(t){t===void 0&&(t=!1);var r="";return this.resname&&!t&&(r+="["+this.resname+"]"),this.resno!==void 0&&(r+=this.resno),this.inscode&&(r+="^"+this.inscode),this.chainname&&(r+=":"+this.chainname),this.atomname&&(r+="."+this.atomname),this.altloc&&(r+="%"+this.altloc),this.structure.modelStore.count>1&&(r+="/"+this.modelIndex),r};tt.prototype.clone=function(){return new tt(this.structure,this.index)};tt.prototype.toObject=function(){return{index:this.index,residueIndex:this.residueIndex,resname:this.resname,x:this.x,y:this.y,z:this.z,element:this.element,chainname:this.chainname,resno:this.resno,serial:this.serial,vdw:this.vdw,covalent:this.covalent,hetero:this.hetero,bfactor:this.bfactor,altloc:this.altloc,atomname:this.atomname,modelIndex:this.modelIndex}};Object.defineProperties(tt.prototype,dt);function py(e,t){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function jM(e,t){return Math.sqrt(py(e,t))}var Wl=new Float32Array(3),vy=function(t,r){r===void 0&&(r=!1),ge&&fe.time("Kdtree build");var i=r?py:jM,n=new Float32Array(t.atomCount*3),a=new Uint32Array(t.atomCount),o=0;t.eachAtom(function(s){n[o+0]=s.x,n[o+1]=s.y,n[o+2]=s.z,a[o/3]=s.index,o+=3}),this.atomIndices=a,this.points=n,this.kdtree=new Uu(n,i),ge&&fe.timeEnd("Kdtree build")};vy.prototype.nearest=function(t,r,i){t instanceof I?t.toArray(Wl):t instanceof tt&&t.positionToArray(Wl);for(var n=this.kdtree.nearest(Wl,r,i),a=this.kdtree.indices,o=this.kdtree.nodes,s=this.atomIndices,u=[],c=0,f=n.length;c<f;++c){var l=n[c],h=l[0],d=l[1];u.push({index:s[a[o[h]]],distance:d})}return u};var XM={" ":"X","!":"Y","#":"Z",$:"-X","%":"-Y","&":"-Z","'":"Y+1/2","(":"1/2+X",")":"1/2+Y","*":"1/2-X","+":"1/2+Z",",":"1/2-Y","-":"1/2-Z",".":"X+1/2","/":"Z+1/2",0:"-X+1/2",1:"-Y+1/2",2:"-Z+1/2",3:"1/4+X",4:"1/4-Y",5:"1/4+Z",6:"1/4-X",7:"1/4+Y",8:"3/4-Y",9:"3/4+Z",":":"3/4+Y",";":"3/4+X","<":"3/4-X","=":"1/4-Z",">":"3/4-Z","?":"X-Y","@":"Y-X",A:"Z+1/3",B:"Z+2/3",C:"X+2/3",D:"Y+1/3",E:"-Y+2/3",F:"X-Y+1/3",G:"Y-X+2/3",H:"-X+1/3",I:"X+1/3",J:"Y+2/3",K:"-Y+1/3",L:"X-Y+2/3",M:"Y-X+1/3",N:"-X+2/3",O:"2/3+X",P:"1/3+Y",Q:"1/3+Z",R:"2/3-Y",S:"1/3+X-Y",T:"2/3+Y-X",U:"1/3-X",V:"2/3-X",W:"1/3-Y",X:"1/3-Z",Y:"2/3+Y",Z:"1/3+Y-X","[":"2/3+X-Y","]":"1/3+X","^":"2/3+Z",_:"2/3-Z","`":"5/6+Z",a:"1/6+Z",b:"5/6-Z",c:"1/6-Z",d:"Z+5/6",e:"Z+1/6",f:"Z+1/4",g:"+Y"},qM={"P 1":" !#","P -1":" !#$%&","P 1 2 1":" !#$!&","P 1 21 1":" !#$'&","C 1 2 1":" !#$!&()#*)&","P 1 m 1":" !# %#","P 1 c 1":" !# %+","C 1 m 1":" !# %#()#(,#","C 1 c 1":" !# %+()#(,+","P 1 2/m 1":" !# %#$!&$%&","P 1 21/m 1":" !#$)&$%& ,#","C 1 2/m 1":" !# %#$!&$%&()#(,#*)&*,&","P 1 2/c 1":" !#$!-$%& %+","P 1 21/c 1":" !#$%&$)- ,+","C 1 2/c 1":" !#$!-$%& %+()#*)-*,&(,+","P 2 2 2":" !#$%#$!& %&","P 2 2 21":" !#$%+$!- %&","P 21 21 2":" !#$%#*)&(,&","P 21 21 21":" !#*%+$)-(,&","C 2 2 21":" !#$%+$!- %&()#*,+*)-(,&","C 2 2 2":" !#$%#$!& %&()#*,#*)&(,&","F 2 2 2":" !#$%#$!& %& )+$,+$)- ,-(!+*%+*!-(%-()#*,#*)&(,&","I 2 2 2":" !#$%# %&$!&.'/01/.120'2","I 21 21 21":" !#*%+$)-(,&()+$,#*!& %-","P m m 2":" !#$%# %#$!#","P m c 21":" !#$%+ %+$!#","P c c 2":" !#$%# %+$!+","P m a 2":" !#$%#(%#*!#","P c a 21":" !#$%+(%#*!+","P n c 2":" !#$%# ,+$)+","P m n 21":" !#*%+(%+$!#","P b a 2":" !#$%#(,#*)#","P n a 21":" !#$%+(,#*)+","P n n 2":" !#$%#(,+*)+","C m m 2":" !#$%# %#$!#()#*,#(,#*)#","C m c 21":" !#$%+ %+$!#()#*,+(,+*)#","C c c 2":" !#$%# %+$!+()#*,#(,+*)+","A m m 2":" !#$%# %#$!# )+$,+ ,+$)+","A b m 2":" !#$%# ,#$)# )+$,+ %+$!+","A m a 2":" !#$%#(%#*!# )+$,+(,+*)+","A b a 2":" !#$%#(,#*)# )+$,+(%+*!+","F m m 2":" !#$%# %#$!# )+$,+ ,+$)+(!+*%+(%+*!+()#*,#(,#*)#","F d d 2":" !#$%#345675 )+$,+3896:9(!+*%+;49<79()#*,#;85<:5","I m m 2":" !#$%# %#$!#()+*,+(,+*)+","I b a 2":" !#$%#(,#*)#()+*,+ %+$!+","I m a 2":" !#$%#(%#*!#()+*,+ ,+$)+","P 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#","P 2/n 2/n 2/n":" !#$%#$!& %&*,-()-(,+*)+","P 2/c 2/c 2/m":" !#$%#$!- %-$%& !& %+$!+","P 2/b 2/a 2/n":" !#$%#$!& %&*,&()&(,#*)#","P 21/m 2/m 2/a":" !#*%#$!&(%&$%&(!& %#*!#","P 2/n 21/n 2/a":" !#*%#*)- ,-$%&(!&(,+$)+","P 2/m 2/n 21/a":" !#*%+*!- %&$%&(!-(%+$!#","P 21/c 2/c 2/a":" !#*%#$!-(%-$%&(!& %+*!+","P 21/b 21/a 2/m":" !#$%#*)&(,&$%& !&(,#*)#","P 21/c 21/c 2/n":" !#*,#$)-(%-$%&()& ,+*!+","P 2/b 21/c 21/m":" !#$%+$)- ,&$%& !- ,+$)#","P 21/n 21/n 2/m":" !#$%#*)-(,-$%& !&(,+*)+","P 21/m 21/m 2/n":" !#$%#*'&.,&*,&.'& %#$!#","P 21/b 2/c 21/n":" !#*,+$!-(,&$%&()- %+*)#","P 21/b 21/c 21/a":" !#*%+$)-(,&$%&(!- ,+*)#","P 21/n 21/m 21/a":" !#0%/$'&.12$%&.!2 1#0'/","C 2/m 2/c 21/m":" !#$%+$!- %&$%& !- %+$!#()#*,+*)-(,&*,&()-(,+*)#","C 2/m 2/c 21/a":" !#$,+$)- %&$%& )- ,+$!#()#*%+*!-(,&*,&(!-(%+*)#","C 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#()#*,#*)&(,&*,&()&(,#*)#","C 2/c 2/c 2/m":" !#$%#$!- %-$%& !& %+$!+()#*,#*)-(,-*,&()&(,+*)+","C 2/m 2/m 2/a":" !#$,#$)& %&$%& )& ,#$!#()#*%#*!&(,&*,&(!&(%#*)#","C 2/c 2/c 2/a":" !#*,#$!&(,&$,-(!- ,+*!+()#$%#*)& %&*%- )-(%+$)+","F 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!# )+$,+$)- ,-$,- )- ,+$)+(!+*%+*!-(%-*%-(!-(%+*!+()#*,#*)&(,&*,&()&(,#*)#","F 2/d 2/d 2/d":" !#$%#$!& %&64=37=345675 )+$,+$)- ,-68>3:>3896:9(!+*%+*!-(%-<4>;7>;49<79()#*,#*)&(,&<8=;:=;85<:5","I 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#()+*,+*)-(,-*,-()-(,+*)+","I 2/b 2/a 2/m":" !#$%#*)&(,&$%& !&(,#*)#()+*,+$!- %-*,-()- %+$!+","I 21/b 21/c 21/a":" !#*%+$)-(,&$%&(!- ,+*)#()+$,#*!& %-*,- )&(%#$!+","I 21/m 21/m 21/a":" !#$,#$)& %&$%& )& ,#$!#()+*%+*!-(,-*,-(!-(%+*)+","P 4":" !#$%#% #!$#","P 41":" !#$%+% 5!$9","P 42":" !#$%#% +!$+","P 43":" !#$%+% 9!$5","I 4":" !#$%#% #!$#()+*,+,(+)*+","I 41":" !#*,+%(5)$9()+$%#, 9!*5","P -4":" !#$%#!$&% &","I -4":" !#$%#!$&% &()+*,+)*-,(-","P 4/m":" !#$%#% #!$#$%& !&!$&% &","P 42/m":" !#$%#% +!$+$%& !&!$-% -","P 4/n":" !#$%#,(#)*#*,&()&!$&% &","P 42/n":" !#$%#,(+)*+*,-()-!$&% &","I 4/m":" !#$%#% #!$#$%& !&!$&% &()+*,+,(+)*+*,-()-)*-,(-","I 41/a":" !#*,+%(5)$9$,=(!>!$&,(-()+$%#, 9!*5*%> )=)*-% &","P 4 2 2":" !#$%#% #!$#$!& %&! &%$&","P 4 21 2":" !#$%#,(#)*#*)&(,&! &%$&","P 41 2 2":" !#$%+% 5!$9$!& %-! >%$=","P 41 21 2":" !#$%+,(5)*9*)=(,>! &%$-","P 42 2 2":" !#$%#% +!$+$!& %&! -%$-","P 42 21 2":" !#$%#,(+)*+*)-(,-! &%$&","P 43 2 2":" !#$%+% 9!$5$!& %-! =%$>","P 43 21 2":" !#$%+,(9)*5*)>(,=! &%$-","I 4 2 2":" !#$%#% #!$#$!& %&! &%$&()+*,+,(+)*+*)-(,-)(-,*-","I 41 2 2":" !#*,+%(5)$9*!> ,=)(-%$&()+$%#, 9!*5$)=(%>! &,*-","P 4 m m":" !#$%#% #!$# %#$!#%$#! #","P 4 b m":" !#$%#% #!$#(,#*)#,*#)(#","P 42 c m":" !#$%#% +!$+ %+$!+%$#! #","P 42 n m":" !#$%#,(+)*+(,+*)+%$#! #","P 4 c c":" !#$%#% #!$# %+$!+%$+! +","P 4 n c":" !#$%#% #!$#(,+*)+,*+)(+","P 42 m c":" !#$%#% +!$+ %#$!#%$+! +","P 42 b c":" !#$%#% +!$+(,#*)#,*+)(+","I 4 m m":" !#$%#% #!$# %#$!#%$#! #()+*,+,(+)*+(,+*)+,*+)(+","I 4 c m":" !#$%#% #!$# %+$!+%$+! +()+*,+,(+)*+(,#*)#,*#)(#","I 41 m d":" !#*,+%(5)$9 %#*)+%*5) 9()+$%#, 9!*5(,+$!#,$9!(5","I 41 c d":" !#*,+%(5)$9 %+*)#%*9) 5()+$%#, 9!*5(,#$!+,$5!(9","P -4 2 m":" !#$%#% &!$&$!& %&%$#! #","P -4 2 c":" !#$%#% &!$&$!- %-%$+! +","P -4 21 m":" !#$%#% &!$&*)&(,&,*#)(#","P -4 21 c":" !#$%#% &!$&*)-(,-,*+)(+","P -4 m 2":" !#$%#!$&% & %#$!#! &%$&","P -4 c 2":" !#$%#% &!$& %+$!+! -%$-","P -4 b 2":" !#$%#% &!$&(,#*)#)(&,*&","P -4 n 2":" !#$%#% &!$&(,+*)+)(-,*-","I -4 m 2":" !#$%#% &!$& %#$!#! &%$&()+*,+,(-)*-(,+*)+)(-,*-","I -4 c 2":" !#$%#% &!$& %+$!+! -%$-()+*,+,(-)*-(,#*)#)(&,*&","I -4 2 m":" !#$%#% &!$&$!& %&%$#! #()+*,+,(-)*-*)-(,-,*+)(+","I -4 2 d":" !#$%#% &!$&*!>(%>,$9) 9()+*,+,(-)*-$)= ,=%*5!(5","P 4/m 2/m 2/m":" !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #","P 4/m 2/c 2/c":" !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +","P 4/n 2/b 2/m":" !#$%#% #!$#$!& %&! &%$&*,&()&)*&,(&(,#*)#,*#)(#","P 4/n 2/n 2/c":" !#$%#% #!$#$!& %&! &%$&*,-()-)*-,(-(,+*)+,*+)(+","P 4/m 21/b 2/m":" !#$%#% #!$#*)&(,&)(&,*&$%& !&!$&% &(,#*)#,*#)(#","P 4/m 21/n 2/c":" !#$%#% #!$#*)-(,-)(-,*-$%& !&!$&% &(,+*)+,*+)(+","P 4/n 21/m 2/m":" !#$%#,(#)*#*)&(,&! &%$&*,&()&!$&% & %#$!#,*#)(#","P 4/n 2/c 2/c":" !#$%#,(#)*#*)-(,-! -%$-*,&()&!$&% & %+$!+,*+)(+","P 42/m 2/m 2/c":" !#$%#% +!$+$!& %&! -%$-$%& !&!$-% - %#$!#%$+! +","P 42/m 2/c 2/m":" !#$%#% +!$+$!- %-! &%$&$%& !&!$-% - %+$!+%$#! #","P 42/n 2/b 2/c":" !#$%#,(+)*+$!- %-)(&,*&*,-()-!$&% &(,#*)#%$+! +","P 42/n 2/n 2/m":" !#$%#,(+)*+$!& %&)(-,*-*,-()-!$&% &(,+*)+%$#! #","P 42/m 21/b 2/c":" !#$%#% +!$+*)&(,&)(-,*-$%& !&!$-% -(,#*)#,*+)(+","P 42/m 21/n 2/m":" !#$%#,./'*/*'-.,-! &%$&$%& !&'*-,.-.,/*'/%$#! #","P 42/n 21/m 2/c":" !#$%#,(+)*+*)-(,-! &%$&*,-()-!$&% & %#$!#,*+)(+","P 42/n 21/c 2/m":" !#$%#,(+)*+*)&(,&! -%$-*,-()-!$&% & %+$!+,*#)(#","I 4/m 2/m 2/m":" !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #()+*,+,(+)*+*)-(,-)(-,*-*,-()-)*-,(-(,+*)+,*+)(+","I 4/m 2/c 2/m":" !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +()+*,+,(+)*+*)&(,&)(&,*&*,-()-)*-,(-(,#*)#,*#)(#","I 41/a 2/m 2/d":" !#*,+%(5)$9*!> ,=)(-%$&$,=(!>!$&,(-(,+$!#,$9!(5()+$%#, 9!*5$)=(%>! &,*-*%> )=)*-% & %#*)+%*5) 9","I 41/a 2/c 2/d":" !#*,+%(5)$9*!= ,>)(&%$-$,=(!>!$&,(-(,#$!+,$5!(9()+$%#, 9!*5$)>(%=! -,*&*%> )=)*-% & %+*)#%*9) 5","P 3":" !#%?#@$#","P 31":" !#%?A@$B","P 32":" !#%?B@$A","H 3":" !#%?#@$#CDAEFAGHAIJBKLBMNB","R 3":" !## !!# ","P -3":" !#%?#@$#$%&!@&? &","H -3":" !#%?#@$#$%&!@&? &OPQRSQTUQVWXYZX[]X]Y^W[^ZV^UR_PT_SO_","R -3":" !## !!# $%&&$%%&$","P 3 1 2":" !#%?#@$#%$&@!& ?&","P 3 2 1":" !#%?#@$#! &?%&$@&","P 31 1 2":" !#%?Q@$^%$_@!X ?&","P 31 2 1":" !#%?A@$B! &?%_$@X","P 32 1 2":" !#%?^@$Q%$X@!_ ?&","P 32 2 1":" !#%?B@$A! &?%X$@_","H 3 2":" !#%?#@$#! &?%&$@&OPQRSQTUQY]X[WXVZX]Y^W[^ZV^PO_SR_UT_","R 3 2":" !## !!# %$&$&%&%$","P 3 m 1":" !#%?#@$#%$#@!# ?#","P 3 1 m":" !#%?#@$#! #?%#$@#","P 3 c 1":" !#%?#@$#%$+@!+ ?+","P 3 1 c":" !#%?#@$#! +?%+$@+","H 3 m":" !#%?#@$#%$#@!# ?#OPQRSQTUQRUQTPQOSQ]Y^W[^ZV^WV^ZY^][^","R 3 m":" !## !!# ! # #!#! ","H 3 c":" !#%?#@$#%$+@!+ ?+OPQRSQTUQRU`TP`OS`]Y^W[^ZV^WVaZYa][a","R 3 c":" !## !!# '././'/'.","P -3 1 2/m":" !#%?#@$#%$&@!& ?&$%&!@&? &! #?%#$@#","P -3 1 2/c":" !#%?#@$#%$-@!- ?-$%&!@&? &! +?%+$@+","P -3 2/m 1":" !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#","P -3 2/c 1":" !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+","H -3 2/m":" !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#OPQRSQTUQY]X[WXVZXVWXYZX[]XRUQTPQOSQ]Y^W[^ZV^PO_SR_UT_UR_PT_SO_WV^ZY^][^","R -3 2/m":" !## !!# %$&$&%&%$$%&&$%%&$! # #!#! ","H -3 2/c":" !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+OPQRSQTUQY]b[WbVZbVWXYZX[]XRU`TP`OS`]Y^W[^ZV^POcSRcUTcUR_PT_SO_WVaZYa][a","R -3 2/c":" !## !!# 102021210$%&&$%%&$'././'/'.","P 6":" !#%?#@$#$%#!@#? #","P 61":" !#%?A@$B$%/!@d? e","P 65":" !#%?B@$A$%/!@e? d","P 62":" !#%?^@$Q$%#!@^? Q","P 64":" !#%?Q@$^$%#!@Q? ^","P 63":" !#%?#@$#$%+!@+? +","P -6":" !#%?#@$# !&%?&@$&","P 6/m":" !#%?#@$#$%#!@#? #$%&!@&? & !&%?&@$&","P 63/m":" !#%?#@$#$%+!@+? +$%&!@&? & !-%?-@$-","P 6 2 2":" !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&","P 61 2 2":" !#%?Q@$^$%+!@`? a! X?%&$@_%$b@!- ?c","P 65 2 2":" !#%?^@$Q$%+!@a? `! _?%&$@X%$c@!- ?b","P 62 2 2":" !#%?^@$Q$%#!@^? Q! _?%&$@X%$_@!& ?X","P 64 2 2":" !#%?Q@$^$%#!@Q? ^! X?%&$@_%$X@!& ?_","P 63 2 2":" !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-","P 6 m m":" !#%?#@$#$%#!@#? #%$#@!# ?#! #?%#$@#","P 6 c c":" !#%?#@$#$%#!@#? #%$+@!+ ?+! +?%+$@+","P 63 c m":" !#%?#@$#$%+!@+? +%$+@!+ ?+! #?%#$@#","P 63 m c":" !#%?#@$#$%+!@+? +%$#@!# ?#! +?%+$@+","P -6 m 2":" !#%?#@$# !&%?&@$&%$#@!# ?#%$&@!& ?&","P -6 c 2":" !#%?#@$# !-%?-@$-%$+@!+ ?+%$&@!& ?&","P -6 2 m":" !#%?#@$# !&%?&@$&! &?%&$@&! #?%#$@#","P -6 2 c":" !#%?#@$# !-%?-@$-! &?%&$@&! +?%+$@+","P 6/m 2/m 2/m":" !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&$%&!@&? & !&@$&%?&%$#@!# ?#! #?%#$@#","P 6/m 2/c 2/c":" !#%?#@$#$%#!@#? #! -?%-$@-%$-@!- ?-$%&!@&? & !&@$&%?&%$+@!+ ?+! +?%+$@+","P 63/m 2/c 2/m":" !#%?#@$#$%+!@+? +! -?%-$@-%$&@!& ?&$%&!@&? & !-@$-%?-%$+@!+ ?+! #?%#$@#","P 63/m 2/m 2/c":" !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-$%&!@&? & !-@$-%?-%$#@!# ?#! +?%+$@+","P 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ","F 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%&  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ","I 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(","P 21 3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(","I 21 3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- ","P 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$","P 2/n -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& *,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*","F 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-($,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- *,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$","F 2/d -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& 64=37=345675=64=375345674=67=3453756 )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(68>3:>3896:9=<8=;:5;85<:4><7>;49;79<(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(<4>;7>;49<79>68>3:93896:8=<:=;85;:5<()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- <8=;:=;8f<:f><4>;79;49<78>6:>3893:96","I 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*","P 21/a -3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*","I 21/a -3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*()+$,#*g& %-+()#$,&*!- %)+(,#$!&*%- *,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$","P 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$","P 42 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*","F 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$","F 41 3 2":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46 )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<(!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86","I 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*","P 43 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7;>46=:<5839398<5:6=4;>75:<983>7;=46","P 41 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<","I 41 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46","P -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ","F -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&%  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(+%*+!*-%(- +)$+,$-) -,#)(#,*&)*&,((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() +,$+)$-, -(#)*#,*&)(&,+!(+%*-!*-%(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(#,*#)*&,(&(+!*+%*-!(-%+) +,$-)$-, ","I -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(","P -4 3 n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(","F -4 3 c":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() #,$#)$&, &(#!*#%*&!(&%+! +%$-!$-% (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(#%*#!*&%(& +!$+%$-! -%#) #,$&)$&, ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! +%$+!$-% - #)$#,$&) &,#!(#%*&!*&%(","I -4 3 d":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7354<9:6>8;=357<946>:;=857394<>:6=8;()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- :;98657<=43>;9:658<=73>49:;586=7<>43","P 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ","P 4/n -3 2/n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","P 42/m -3 2/n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","P 42/n -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ","F 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#!  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*%*+!(+%(-!*-$-) -, +)$+,&,(&)*#,*#)((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%**%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*,$+) +, -)$-*&)(&,(#)*#,-%(-!*+%*+!(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$*,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$,*#)(#,(&)*&*-!(-%(+!*+%-, -)$+,$+) ","F 4/m -3 2/c":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() &,$&)$#, #(#%*#!*&%(&!+!$+% -! -%$$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*,$#) #, &)$&*&!(&%(#!*#%-% -!$+%$+! (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(&%*&!*#%(# +%$+!$-% -!#)$#, &) &,$*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*%*#!(#%(&!*&$-! -% +!$+%&, &)$#,$#) ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! -%$-!$+% + #,$#)$&, &)#!*#%(&!(&%**,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$%$+! +% -!$-$&) &, #)$#,&%(&!*#%*#!(","F 41/d -3 2/m":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=4664=3:>;85<79=64>3:5;89<74=6:>385;79<,$+! #%(-)*&*&)(-% #!$+,-%(&)*+,$#!  )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<68>37=;49<:5=<8>;753496:4><:=;893756,*#!(+% &)$-*-!(&, +)$#%-, &!$+%*#)((!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<<4>;:=389675>68=379;45<:8=<7>;453:96%$#) +,(&!*-$&! -,(#)*+%&% -)$#,*+!(()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86<8=;7>3456:9><4=;:9385678>67=349;:5<%*+)(#, -!$&$-) &%(+!*#,&,(-!*#%$+) ","F 41/d -3 2/c":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46<8>;7=3496:5><8=;793456:8><7=;493:56%*#)(+, &!$-$-! &,(+)*#%&, -!$#%*+)( )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<<4=;:>385679>64=3:9;85<78=67>345;:9<%$+) #,(-!*&$&) -%(#!*+,&%(-)*#,$+! (!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<68=37>;45<:9=<4>;:5389674>6:=389;75<,*+!(#% -)$&*-)(&% +!$#,-,(&!*+%$#) ()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>8664>3:=;89<75=68>375;49<:4=<:>;853796,$#! +%(&)*-*&!(-, #)$+%-% &)$+,*#!(","I 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","I 41/a -3 2/d":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<$%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*4<97358;=:6>6>:;=8357<94=8;>:694<573()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46*,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$865:;943>7<=<=73>4;9:658>43=7<5869:;","P 1 1 2":" !#$%#","P 1 1 21":" !#$%+","B 1 1 2":" !#$%#(g+*%+","A 1 2 1":" !#$!& )+$)-","C 1 21 1":" !#$)&()#*!&","I 1 2 1":" !#$!&.'/0'2","I 1 21 1":" !#$)&.'/0!-","P 1 1 m":" !# !&","P 1 1 b":" !# )&","B 1 1 m":" !# !&(!+(!-","B 1 1 b":" !# )&(!+()-","P 1 1 2/m":" !# !&$%#$%&","P 1 1 21/m":" !#$%+$%& !-","B 1 1 2/m":" !# !&$%#$%&(!+(!-*%+*%-","P 1 1 2/b":" !#$,#$%& )&","P 1 1 21/b":" !#$%&$,+ )-","B 1 1 2/b":" !#$,#$%& )&(!+*,+*%-()-","P 21 2 2":" !#$!&(%&*%#","P 2 21 2":" !# ,&$)&$%#","P 21 21 2 (a)":" !#*,#.%&$'&","P 21 2 21":" !#$!&(%-*%+","P 2 21 21":" !# %&$)-$,+","C 2 2 21a)":" !#*%+(,&$)-()#$,+ %&*!-","C 2 2 2a":" !#*,#.%&$'&()#$%# ,&*!&","F 2 2 2a":" !#*,#.%&$'& '/*%/.12$!2.!/$,/ %20'2.'#$%# 1&0!&","I 2 2 2a":" !#*,#.%&$'&()+$%+*!- ,-","P 21/m 21/m 2/n a":" !#*,#$)&(%&$%&.'& ,#*!#","P 42 21 2a":" !#*,#%.+'$+$'&.%&! -,*-","I 2 3a":" !#*,#.%&$'&!# ,- '&$%/$# !-*!/$%&.%()+$%+ ,-*!-)+(%&(!-*,#*+()&$)#*,- ,"},YM=/^[1-9]$/;function ZM(e){var t=qM[e],r={};if(t===void 0)return console.warn("spacegroup '"+e+"' not found in symop library"),r;for(var i=[],n=0,a=t.length;n<a;n+=3){for(var o=[],s=0;s<3;++s)o.push(XM[t[n+s]]);i.push(o)}return i.forEach(function(u){var c=0,f=new Ae().set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1),l=f.elements;r[u.toString()]=f,u.forEach(function(h){for(var d=!1,p=!1,v=0,m=h.length;v<m;++v){var g=h[v];if(g==="-")d=!0;else if(g==="+")d=!1;else if(g==="/")p=!0;else if(g==="X")l[0+c]=d?-1:1;else if(g==="Y")l[4+c]=d?-1:1;else if(g==="Z")l[8+c]=d?-1:1;else if(YM.test(g)){var x=parseInt(g);p?l[12+c]/=x:l[12+c]=x}else fe.warn("getSymmetryOperations: unknown token '"+g+"'")}c+=1})}),r}function my(e){var t="";return e.length>0&&(t=":"+Bd(e).join(" OR :")),new Kt(t)}var Br=function(t){t===void 0&&(t=""),this.name=t,this.partList=[]},gy={type:{configurable:!0}};gy.type.get=function(){return"Assembly"};Br.prototype.addPart=function(t,r){var i=new Hn(t,r);return this.partList.push(i),i};Br.prototype.getAtomCount=function(t){return this.partList.reduce(function(r,i){return r+i.getAtomCount(t)},0)};Br.prototype.getResidueCount=function(t){return this.partList.reduce(function(r,i){return r+i.getResidueCount(t)},0)};Br.prototype.getInstanceCount=function(){var t=0;return this.partList.forEach(function(r){t+=r.matrixList.length}),t};Br.prototype.isIdentity=function(t){if(this.partList.length!==1)return!1;var r=this.partList[0];if(r.matrixList.length!==1)return!1;var i=new Ae;if(!i.equals(r.matrixList[0]))return!1;var n=[];return t.eachChain(function(a){n.push(a.chainname)}),n=Bd(n),r.chainList.length===n.length};Br.prototype.getBoundingBox=function(t){var r=new ir;return this.partList.forEach(function(i){var n=i.getBoundingBox(t);r.expandByPoint(n.min),r.expandByPoint(n.max)}),r};Br.prototype.getCenter=function(t){return this.getBoundingBox(t).getCenter(new I)};Br.prototype.getSelection=function(){var t=[];return this.partList.forEach(function(r){t=t.concat(r.chainList)}),my(t)};Object.defineProperties(Br.prototype,gy);var Hn=function(t,r){t===void 0&&(t=[]),r===void 0&&(r=[]),this.matrixList=t,this.chainList=r},yy={type:{configurable:!0}};yy.type.get=function(){return"AssemblyPart"};Hn.prototype._getCount=function(t,r){var i=this,n=0;return t.eachChain(function(a){(i.chainList.length===0||i.chainList.includes(a.chainname))&&(n+=a[r])}),this.matrixList.length*n};Hn.prototype.getAtomCount=function(t){return this._getCount(t,"atomCount")};Hn.prototype.getResidueCount=function(t){return this._getCount(t,"residueCount")};Hn.prototype.getBoundingBox=function(t){var r=new ir,i=new ir,n=this.getSelection(),a=t.getBoundingBox(n);return this.matrixList.forEach(function(o){i.copy(a).applyMatrix4(o),r.expandByPoint(i.min),r.expandByPoint(i.max)}),r};Hn.prototype.getSelection=function(){return my(this.chainList)};Hn.prototype.getView=function(t){var r=this.getSelection();return r?t.getView(r):t};Hn.prototype.getInstanceList=function(){for(var t=this,r=[],i=0,n=this.matrixList.length;i<n;++i)r.push({id:i+1,name:i,matrix:t.matrixList[i]});return r};Object.defineProperties(Hn.prototype,yy);var sl=function(t){this.structure=t,this.currentModelindex=null,this.currentChainid=null,this.currentResname=null,this.currentResno=null,this.currentInscode=void 0,this.currentHetero=null,this.previousResname="",this.previousHetero=null,this.ai=-1,this.ri=-1,this.ci=-1,this.mi=-1};sl.prototype.addResidueType=function(t){for(var r=this.structure.atomStore,i=this.structure.residueStore,n=this.structure.residueMap,a=i.atomCount[t],o=i.atomOffset[t],s=new Array(a),u=0;u<a;++u)s[u]=r.atomTypeId[o+u];i.residueTypeId[t]=n.add(this.previousResname,s,this.previousHetero)};sl.prototype.addAtom=function(t,r,i,n,a,o,s,u){var c=this.structure.atomStore,f=this.structure.residueStore,l=this.structure.chainStore,h=this.structure.modelStore,d=!1,p=!1,v=!1;this.currentModelindex!==t?(d=!0,p=!0,v=!0,this.mi+=1,this.ci+=1,this.ri+=1):this.currentChainid!==i?(p=!0,v=!0,this.ci+=1,this.ri+=1):(this.currentResno!==a||this.currentResname!==n||this.currentInscode!==u)&&(v=!0,this.ri+=1),this.ai+=1,d&&(h.growIfFull(),h.chainOffset[this.mi]=this.ci,h.chainCount[this.mi]=0,h.count+=1,l.modelIndex[this.ci]=this.mi),p&&(l.growIfFull(),l.setChainname(this.ci,r),l.setChainid(this.ci,i),l.residueOffset[this.ci]=this.ri,l.residueCount[this.ci]=0,l.count+=1,l.modelIndex[this.ci]=this.mi,h.chainCount[this.mi]+=1,f.chainIndex[this.ri]=this.ci),v&&(this.previousResname=this.currentResname,this.previousHetero=this.currentHetero,this.ri>0&&this.addResidueType(this.ri-1),f.growIfFull(),f.resno[this.ri]=a,s!==void 0&&(f.sstruc[this.ri]=s.charCodeAt(0)),u!==void 0&&(f.inscode[this.ri]=u.charCodeAt(0)),f.atomOffset[this.ri]=this.ai,f.atomCount[this.ri]=0,f.count+=1,f.chainIndex[this.ri]=this.ci,l.residueCount[this.ci]+=1),c.count+=1,c.residueIndex[this.ai]=this.ri,f.atomCount[this.ri]+=1,this.currentModelindex=t,this.currentChainid=i,this.currentResname=n,this.currentResno=a,this.currentInscode=u,this.currentHetero=o};sl.prototype.finalize=function(){this.previousResname=this.currentResname,this.previousHetero=this.currentHetero,this.ri>-1&&this.addResidueType(this.ri)};function by(e,t){if(t){ge&&fe.time("assignSecondaryStructure");var r=[];e.eachModel(function(c){c.eachChain(function(f){r.push(f.chainname)})});var i=r.slice().sort(),n=[];i.forEach(function(c){n.push(r.indexOf(c))});var a=t.helices.filter(function(c){return Aa(i,c[0])>=0});a.sort(function(c,f){var l=c[0],h=f[0],d=c[1],p=f[1];if(l===h)return d===p?0:d<p?-1:1;var v=Aa(i,l),m=Aa(i,h);return n[v]<n[m]?-1:1});var o=e.residueStore;e.eachModel(function(c){var f=0,l=a.length;if(l!==0){var h=a[f],d=!1,p=!1;c.eachChain(function(v){var m=!1;if(v.chainname===h[0]){for(var g=v.residueCount,x=v.residueOffset,y=x+g,b=x;b<y;++b)if(o.resno[b]===h[1]&&o.getInscode(b)===h[2]&&(d=!0),d&&(o.sstruc[b]=h[6],o.resno[b]===h[4]&&o.getInscode(b)===h[5]&&(d=!1,f+=1,f<l?(b=x-1,h=a[f],m=v.chainname!==h[0]):p=!0)),m||p)return}})}});var s=t.sheets.filter(function(c){return Aa(i,c[0])>=0});s.sort(function(c,f){var l=c[0],h=f[0];if(l===h)return 0;var d=Aa(i,l),p=Aa(i,h);return n[d]<n[p]?-1:1});var u=101;e.eachModel(function(c){var f=0,l=s.length;if(l!==0){var h=s[f],d=!1,p=!1;c.eachChain(function(v){var m=!1;if(v.chainname===h[0]){for(var g=v.residueCount,x=v.residueOffset,y=x+g,b=x;b<y;++b)if(o.resno[b]===h[1]&&o.getInscode(b)===h[2]&&(d=!0),d&&(o.sstruc[b]=u,o.resno[b]===h[4]&&o.getInscode(b)===h[5]&&(d=!1,f+=1,f<l?(b=x-1,h=s[f],m=v.chainname!==h[0]):p=!0)),m||p)return}})}}),ge&&fe.timeEnd("assignSecondaryStructure")}}var ul=function(){var e=function(a,o,s,u){for(var c=a.structure,f=a.residueIndexStart,l=c.getResidueProxy(),h=c.getResidueProxy(),d=c.getAtomProxy(),p=c.getAtomProxy(),v=Math.max(0,o-2);v<=o;++v)for(var m=2;m<5;++m)if(!(v+m>=a.residueCount)){l.index=f+v,h.index=f+v+m,d.index=l.traceAtomIndex,p.index=h.traceAtomIndex;var g=d.distanceTo(p);if(Math.abs(g-s[m-2])>u)return!1}return!0},t=function(a,o){var s=[5.45,5.18,6.37],u=2.1;return e(a,o,s,u)},r=function(a,o){var s=[6.1,10.4,13],u=1.42;return e(a,o,s,u)},i=function(a){for(var o=a.residueStore,s=a.residueIndexStart,u=0,c=a.residueCount;u<c;++u){var f="c";t(a,u)?f="h":r(a,u)&&(f="e"),o.sstruc[s+u]=f.charCodeAt(0)}},n=function(a){for(var o=20,s=2,u=a.residueStore,c=a.residueIndexStart,f=new up(a),l=f.position,h=new I,d=new I,p=0,v=a.residueCount;p<v;++p){h.fromArray(l.center,p*3),d.fromArray(l.center,p*3+3);var m=h.distanceTo(d);m<s&&m>1&&l.bending[p]<o&&(u.sstruc[c+p]=104,u.sstruc[c+p+1]=104)}};return function(o){ge&&fe.time("calculateSecondaryStructure"),o.eachPolymer(function(s){if(!(s.residueCount<4)){if(s.isCg())n(s);else if(s.isProtein())i(s);else return;var u,c=0;s.eachResidue(function(f){f.sstruc===u?c+=1:(c===1&&(f.index-=1,f.sstruc="c"),c=1,u=f.sstruc)})}}),ge&&fe.timeEnd("calculateSecondaryStructure")}}(),jl="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function Au(e){for(var t=jl.length,r=e,i=0,n=jl[r%t];r>=t;)r=Math.floor(r/t),n+=jl[r%t],i+=1;return i>=5&&fe.warn("chainname overflow"),n}function cl(e,t){t===void 0&&(t=!1),ge&&fe.time("calculateChainnames");var r=!0;if(e.eachChain(function(v){v.chainname&&(r=!1)}),r){var i=e.modelStore,n=e.chainStore,a=e.residueStore,o=function(v,m,g,x){for(var y=n.count,b=0;b<x;++b)a.chainIndex[g+b]=y;n.growIfFull(),n.modelIndex[y]=v,n.setChainname(y,m),n.setChainid(y,m),n.residueOffset[y]=g,n.residueCount[y]=x,n.count+=1,i.chainCount[v]+=1},s=e.getAtomProxy(),u=e.getAtomProxy(),c=0,f=0,l=0,h=0,d=[];a.count===1?d.push({mIndex:0,chainname:"A",rStart:0,rCount:1}):e.eachResidueN(2,function(v,m){var g=!1,x=v.backboneType,y=m.backboneType,b=Va;h=v.index,v.modelIndex!==m.modelIndex||v.moleculeType!==m.moleculeType?g=!0:x!==b&&x===y&&(s.index=v.backboneEndAtomIndex,u.index=m.backboneStartAtomIndex,t?g=!s.hasBondTo(u):g=!s.connectedTo(u)),!g&&m.index===a.count-1&&(g=!0,h=m.index),g&&(d.push({mIndex:f,chainname:Au(c),rStart:l,rCount:h-l+1}),c+=1,v.modelIndex!==m.modelIndex&&(c=0,f+=1),m.index===a.count-1&&h!==m.index&&d.push({mIndex:f,chainname:Au(c),rStart:a.count-1,rCount:1}),l=m.index,h=m.index)}),n.count=0,d.forEach(function(v){o(v.mIndex,v.chainname,v.rStart,v.rCount)});var p=0;e.eachModel(function(v){i.chainOffset[v.index]=p,i.chainCount[v.index]-=1,p+=i.chainCount[v.index]})}ge&&fe.timeEnd("calculateChainnames")}function Mf(e){ge&&fe.time("calculateBonds"),ns(e),as(e),ge&&fe.timeEnd("calculateBonds")}var KM={"HIS|CD2|CG":2,"HIS|CE1|ND1":2,"ARG|CZ|NH2":2,"PHE|CE1|CZ":2,"PHE|CD2|CE2":2,"PHE|CD1|CG":2,"TRP|CD1|CG":2,"TRP|CD2|CE2":2,"TRP|CE3|CZ3":2,"TRP|CH2|CZ2":2,"ASN|CG|OD1":2,"GLN|CD|OE1":2,"TYR|CD1|CG":2,"TYR|CD2|CE2":2,"TYR|CE1|CZ":2,"ASP|CG|OD1":2,"GLU|CD|OE1":2,"G|C8|N7":2,"G|C4|C5":2,"G|C2|N3":2,"G|C6|O6":2,"C|C4|N3":2,"C|C5|C6":2,"C|C2|O2":2,"A|C2|N3":2,"A|C6|N1":2,"A|C4|C5":2,"A|C8|N7":2,"U|C5|C6":2,"U|C2|O2":2,"U|C4|O4":2,"DG|C8|N7":2,"DG|C4|C5":2,"DG|C2|N3":2,"DG|C6|O6":2,"DC|C4|N3":2,"DC|C5|C6":2,"DC|C2|O2":2,"DA|C2|N3":2,"DA|C6|N1":2,"DA|C4|C5":2,"DA|C8|N7":2,"DT|C5|C6":2,"DT|C2|O2":2,"DT|C4|O4":2};function Vv(e,t,r){var i;return i=t<r?[t,r]:[r,t],t=i[0],r=i[1],Qo.includes(e)&&t==="C"&&r==="O"||wu.includes(e)&&t==="OP1"&&r==="P"?2:KM[e+"|"+t+"|"+r]||1}function JM(e){var t=e.structure,r=t.getAtomProxy(),i=t.getAtomProxy(),n=e.atomCount,a=e.atomOffset,o=a+n,s=o-1,u=[],c=[],f=[];if(n>500)ge&&fe.warn("more than 500 atoms, skip residue for auto-bonding",e.qualifiedName());else if(n>50)for(var l=new vy(e,!0),h=e.isCg()?1.2:2.3,d=a;d<s;++d){r.index=d;for(var p=r.covalent+h+.3,v=l.nearest(r,1/0,p*p),m=v.length,g=0;g<m;++g)i.index=v[g].index,r.index<i.index&&r.connectedTo(i)&&(u.push(r.index-a),c.push(i.index-a),f.push(Vv(r.resname,r.atomname,i.atomname)))}else for(var x=a;x<s;++x){r.index=x;for(var y=x+1;y<=s;++y)i.index=y,r.connectedTo(i)&&(u.push(x-a),c.push(y-a),f.push(Vv(r.resname,r.atomname,i.atomname)))}return{atomIndices1:u,atomIndices2:c,bondOrders:f}}function QM(e){ge&&fe.time("calculateAtomBondMap");var t=[];return e.eachBond(function(r){var i=r.atomIndex1,n=r.atomIndex2;t[i]===void 0&&(t[i]=[]),t[i][n]=r.index}),ge&&fe.timeEnd("calculateAtomBondMap"),t}function ns(e,t){t===void 0&&(t=!1),ge&&fe.time("calculateBondsWithin");var r=e.bondStore,i=e.rungBondStore,n=e.getAtomSet(!1),a=e.getAtomProxy(),o=e.getAtomProxy(),s=e.getBondProxy(),u=t?null:QM(e);e.eachResidue(function(c){if(!t&&u){var f=c.atomCount,l=c.atomOffset;if(f>500){fe.warn("more than 500 atoms, skip residue for auto-bonding",c.qualifiedName());return}for(var h=c.getBonds(),d=h.atomIndices1,p=h.atomIndices2,v=h.bondOrders,m=d.length,g=0;g<m;++g){var x=d[g],y=p[g],b=x+l,_=y+l,w=u[b];if(w!==void 0&&w[_]!==void 0){s.index=w[_];var A=c.residueType.getBondIndex(x,y);v[A]=s.bondOrder}else a.index=b,o.index=_,r.addBond(a,o,v[g])}}var S=c.residueType.traceAtomIndex,M=c.residueType.rungEndAtomIndex;S!==-1&&M!==-1&&(a.index=c.traceAtomIndex,o.index=c.rungEndAtomIndex,i.addBond(a,o),n.set(a.index),n.set(o.index))}),e.atomSetDict.rung=n,ge&&fe.timeEnd("calculateBondsWithin")}function as(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!1),ge&&fe.time("calculateBondsBetween");var i=e.bondStore,n=e.backboneBondStore,a=e.getAtomSet(!1),o=e.getAtomProxy(),s=e.getAtomProxy();n.count===0&&n.resize(e.residueStore.count);function u(h,d){var p=h.backboneType,v=d.backboneType;p!==Va&&p===v&&(o.index=h.backboneEndAtomIndex,s.index=d.backboneStartAtomIndex,(r&&o.hasBondTo(s)||o.connectedTo(s))&&(t||i.addBond(o,s,1),o.index=h.traceAtomIndex,s.index=d.traceAtomIndex,n.addBond(o,s),a.set(o.index),a.set(s.index)))}e.eachResidueN(2,u);var c=e.getResidueProxy(),f=e.getResidueProxy();if(e.eachChain(function(h){h.residueCount!==0&&(c.index=h.residueOffset,f.index=h.residueOffset+h.residueCount-1,u(f,c))}),e.atomSetDict.backbone=a,!t){ge&&fe.time("calculateBondsBetween inter");var l=e.spatialHash;e.eachResidue(function(h){h.backboneType===Va&&!h.isWater()&&h.eachAtom(function(d){d.isMetal()||l.eachWithin(d.x,d.y,d.z,4,function(p){s.index=p,d.modelIndex===s.modelIndex&&d.residueIndex!==s.residueIndex&&!s.isMetal()&&i.addBondIfConnected(d,s,1)})})}),ge&&fe.timeEnd("calculateBondsBetween inter")}ge&&fe.timeEnd("calculateBondsBetween")}function fl(e){if(!e.unitcell)return;ge&&fe.time("buildUnitcellAssembly");var t=e.unitcell,r=e.center.clone().applyMatrix4(t.cartToFrac),i=r.clone().floor(),n=ZM(t.spacegroup),a=new I,o=new I;function s(m){var g=[];return Object.keys(n).forEach(function(x){var y=n[x].clone();a.copy(r).applyMatrix4(y).floor(),o.setFromMatrixPosition(y),o.sub(a),o.add(i),m&&o.add(m),y.setPosition(o),y.multiplyMatrices(t.fracToCart,y),y.multiply(t.cartToFrac),g.push(y)}),g}var u=new Br("UNITCELL"),c=s(),f=[];if(e.biomolDict.NCS){f.push.apply(f,[new Ae].concat(e.biomolDict.NCS.partList[0].matrixList));var l=[];c.forEach(function(m){f.forEach(function(g){l.push(m.clone().multiply(g))})}),u.addPart(l)}else u.addPart(c);var h=new I,d=new Br("SUPERCELL"),p=Array.prototype.concat.call(s(h.set(1,0,0)),s(h.set(0,1,0)),s(h.set(0,0,1)),s(h.set(-1,0,0)),s(h.set(0,-1,0)),s(h.set(0,0,-1)),s(h.set(1,1,0)),s(h.set(1,0,1)),s(h.set(0,1,1)),s(h.set(-1,-1,0)),s(h.set(-1,0,-1)),s(h.set(0,-1,-1)),s(h.set(1,-1,-1)),s(h.set(1,1,-1)),s(h.set(1,-1,1)),s(h.set(-1,1,1)),s(h.set(-1,-1,1)),s(h.set(-1,1,-1)),s(h.set(0,1,-1)),s(h.set(0,-1,1)),s(h.set(1,0,-1)),s(h.set(-1,0,1)),s(h.set(1,-1,0)),s(h.set(-1,1,0)),s(),s(h.set(1,1,1)),s(h.set(-1,-1,-1)));if(e.biomolDict.NCS){var v=[];p.forEach(function(m){f.forEach(function(g){v.push(m.clone().multiply(g))})}),d.addPart(v)}else d.addPart(p);e.biomolDict.UNITCELL=u,e.biomolDict.SUPERCELL=d,ge&&fe.timeEnd("buildUnitcellAssembly")}var Wv=["H","C","O","N","S","P"],$M=["NA","CL","FE"];function cp(e){var t=e.trim().toUpperCase();parseInt(t.charAt(0))&&(t=t.substr(1)),parseInt(t.charAt(0))&&(t=t.substr(1));var r=t.length;if(r===0)return"";if(r===1)return t;if(r===2){if($M.indexOf(t)!==-1)return t;if(Wv.indexOf(t[0])!==-1)return t[0]}return r>=3&&Wv.indexOf(t[0])!==-1?t[0]:""}function Wa(e){var t=e.bondHash,r=t.countArray,i=t.offsetArray,n=t.indexArray,a=e.getBondProxy();e.eachResidue(function(o){var s=o.residueType;if(s.bonds===void 0){var u=o.atomOffset,c=[],f=[],l=[],h={},d=u+o.atomCount;o.eachAtom(function(p){for(var v=p.index,m=i[v],g=r[v],x=0,y=g;x<y;++x){a.index=n[m+x];var b=a.atomIndex1;if(!(b<u||b>=d)){var _=a.atomIndex2;if(!(_<u||_>=d)){if(b>_){var w=_;_=b,b=w}var A=b+"|"+_;h[A]===void 0&&(h[A]=!0,c.push(b-u),f.push(_-u),l.push(a.bondOrder))}}}}),s.bonds={atomIndices1:c,atomIndices2:f,bondOrders:l}}})}var eC=[3,11,19,37,55,87],tC=[4,12,20,38,56,88],rC=[6,15,16,34],iC=[1,7,8,9,17,35,53],nC=[2,10,18,36,54,86],aC=[13,30,31,48,49,50,80,81,82,83,84,85,112],oC=[5,14,32,33,51,52,85],sC=[9,17,35,53,85],kr=function(t,r,i){this.structure=t,this.atomname=r,i=i||cp(r),this.element=i,this.number=VS[i]||WS,this.vdw=jS[this.number]||XS,this.covalent=qS[this.number]||YS};kr.prototype.getDefaultValence=function(){var t=X0[this.number];return t?t[0]:ZS};kr.prototype.getValenceList=function(){return X0[this.number]||[]};kr.prototype.getOuterShellElectronCount=function(){return KS[this.number]||JS};kr.prototype.isMetal=function(){return this.isAlkaliMetal()||this.isAlkalineEarthMetal()||this.isLanthanide()||this.isActinide()||this.isTransitionMetal()||this.isPostTransitionMetal()};kr.prototype.isNonmetal=function(){return this.isDiatomicNonmetal()||this.isPolyatomicNonmetal()||this.isNobleGas()};kr.prototype.isMetalloid=function(){return oC.includes(this.number)};kr.prototype.isHalogen=function(){return sC.includes(this.number)};kr.prototype.isDiatomicNonmetal=function(){return iC.includes(this.number)};kr.prototype.isPolyatomicNonmetal=function(){return rC.includes(this.number)};kr.prototype.isAlkaliMetal=function(){return eC.includes(this.number)};kr.prototype.isAlkalineEarthMetal=function(){return tC.includes(this.number)};kr.prototype.isNobleGas=function(){return nC.includes(this.number)};kr.prototype.isTransitionMetal=function(){var t=this.number;return t>=21&&t<=29||t>=39&&t<=47||t>=72&&t<=79||t>=104&&t<=108};kr.prototype.isPostTransitionMetal=function(){return aC.includes(this.number)};kr.prototype.isLanthanide=function(){return this.number>=57&&this.number<=71};kr.prototype.isActinide=function(){return this.number>=89&&this.number<=103};function uC(e,t){return e+"|"+t}var fp=function(t){this.structure=t,this.dict={},this.list=[],this.structure=t};fp.prototype.add=function(t,r){t=t.toUpperCase(),r?r=r.toUpperCase():r=cp(t);var i=uC(t,r),n=this.dict[i];if(n===void 0){var a=new kr(this.structure,t,r);n=this.list.length,this.dict[i]=n,this.list.push(a)}return n};fp.prototype.get=function(t){return this.list[t]};var Ot=function(t,r,i,n,a,o){this.structure=t,this.bondReferenceAtomIndices=[],this.resname=r,this.atomTypeIdList=i,this.hetero=n?1:0,this.chemCompType=a,this.bonds=o,this.atomCount=i.length,this.moleculeType=this.getMoleculeType(),this.backboneType=this.getBackboneType(0),this.backboneEndType=this.getBackboneType(-1),this.backboneStartType=this.getBackboneType(1),this.backboneIndexList=this.getBackboneIndexList();var s=Ui[this.backboneType],u=Ui[this.backboneStartType],c=Ui[this.backboneEndType],f=this.getAtomIndexByName(s.trace);this.traceAtomIndex=O(f,-1);var l=this.getAtomIndexByName(s.direction1);this.direction1AtomIndex=O(l,-1);var h=this.getAtomIndexByName(s.direction2);this.direction2AtomIndex=O(h,-1);var d=this.getAtomIndexByName(u.backboneStart);this.backboneStartAtomIndex=O(d,-1);var p=this.getAtomIndexByName(c.backboneEnd);this.backboneEndAtomIndex=O(p,-1);var v;$S.includes(r)?v=this.getAtomIndexByName("N1"):v=this.getAtomIndexByName("N3"),this.rungEndAtomIndex=O(v,-1)};Ot.prototype.getBackboneIndexList=function(){var t=[],r;switch(this.moleculeType){case Ya:r=r3;break;case Un:case Gn:r=Z0;break;default:return t}for(var i=this.structure.atomMap,n=this.atomTypeIdList,a=0,o=this.atomCount;a<o;++a){var s=i.get(n[a]);r.includes(s.atomname)&&t.push(a)}return t};Ot.prototype.getMoleculeType=function(){return this.isProtein()?Ya:this.isRna()?Un:this.isDna()?Gn:this.isWater()?rl:this.isIon()?il:this.isSaccharide()?nl:BS};Ot.prototype.getBackboneType=function(t){return this.hasProteinBackbone(t)?Kd:this.hasRnaBackbone(t)?Jd:this.hasDnaBackbone(t)?Qd:this.hasCgProteinBackbone(t)?Zo:this.hasCgRnaBackbone(t)?Ko:this.hasCgDnaBackbone(t)?Jo:Va};Ot.prototype.isProtein=function(){return this.chemCompType?NS.includes(this.chemCompType):this.hasAtomWithName("CA","C","N")||Qo.includes(this.resname)};Ot.prototype.isCg=function(){var t=this.backboneType;return t===Zo||t===Ko||t===Jo};Ot.prototype.isNucleic=function(){return this.isRna()||this.isDna()};Ot.prototype.isRna=function(){return this.chemCompType?kS.includes(this.chemCompType):this.hetero===1?!1:this.hasAtomWithName(["P","O3'","O3*"],["C4'","C4*"],["O2'","O2*","F2'","F2*"])||q0.includes(this.resname)&&this.hasAtomWithName(["O2'","O2*","F2'","F2*"])};Ot.prototype.isDna=function(){return this.chemCompType?zS.includes(this.chemCompType):this.hetero===1?!1:this.hasAtomWithName(["P","O3'","O3*"],["C3'","C3*"])&&!this.hasAtomWithName(["O2'","O2*","F2'","F2*"])||Y0.includes(this.resname)};Ot.prototype.isHetero=function(){return this.hetero===1};Ot.prototype.isIon=function(){return e3.includes(this.resname)};Ot.prototype.isWater=function(){return Af.includes(this.resname)};Ot.prototype.isSaccharide=function(){return this.chemCompType?H0.includes(this.chemCompType):t3.includes(this.resname)};Ot.prototype.isStandardAminoacid=function(){return Qo.includes(this.resname)};Ot.prototype.isStandardBase=function(){return wu.includes(this.resname)};Ot.prototype.hasBackboneAtoms=function(t,r){var i=Ui[r];return t===-1?this.hasAtomWithName(i.trace,i.backboneEnd,i.direction1,i.direction2):t===0?this.hasAtomWithName(i.trace,i.direction1,i.direction2):t===1?this.hasAtomWithName(i.trace,i.backboneStart,i.direction1,i.direction2):this.hasAtomWithName(i.trace,i.backboneStart,i.backboneEnd,i.direction1,i.direction2)};Ot.prototype.hasProteinBackbone=function(t){return this.isProtein()&&this.hasBackboneAtoms(t,Kd)};Ot.prototype.hasRnaBackbone=function(t){return this.isRna()&&this.hasBackboneAtoms(t,Jd)};Ot.prototype.hasDnaBackbone=function(t){return this.isDna()&&this.hasBackboneAtoms(t,Qd)};Ot.prototype.hasCgProteinBackbone=function(t){return this.atomCount<7&&this.isProtein()&&this.hasBackboneAtoms(t,Zo)};Ot.prototype.hasCgRnaBackbone=function(t){return this.atomCount<11&&this.isRna()&&this.hasBackboneAtoms(t,Ko)};Ot.prototype.hasCgDnaBackbone=function(t){return this.atomCount<11&&this.isDna()&&this.hasBackboneAtoms(t,Jo)};Ot.prototype.hasBackbone=function(t){return this.hasProteinBackbone(t)||this.hasRnaBackbone(t)||this.hasDnaBackbone(t)||this.hasCgProteinBackbone(t)||this.hasCgRnaBackbone(t)||this.hasCgDnaBackbone(t)};Ot.prototype.getAtomIndexByName=function(t){var r=this.atomCount,i=this.structure.atomMap,n=this.atomTypeIdList;if(Array.isArray(t))for(var a=0;a<r;++a){var o=n[a];if(t.includes(i.get(o).atomname))return a}else for(var s=0;s<r;++s){var u=n[s];if(t===i.get(u).atomname)return s}};Ot.prototype.hasAtomWithName=function(){for(var t=this,r=[],i=arguments.length;i--;)r[i]=arguments[i];for(var n=r.length,a=0;a<n;++a)if(r[a]!==void 0&&t.getAtomIndexByName(r[a])===void 0)return!1;return!0};Ot.prototype.getBonds=function(t){return this.bonds===void 0&&(this.bonds=JM(t)),this.bonds};Ot.prototype.getRings=function(){return this.rings===void 0&&this.calculateRings(),this.rings};Ot.prototype.getBondGraph=function(){return this.bondGraph===void 0&&this.calculateBondGraph(),this.bondGraph};Ot.prototype.getAromatic=function(t){return this.aromaticAtoms===void 0&&this.calculateAromatic(this.structure.getResidueProxy(t.residueIndex)),this.aromaticAtoms};Ot.prototype.getAromaticRings=function(t){return this.aromaticRings===void 0&&this.calculateAromatic(t),this.aromaticRings};Ot.prototype.calculateBondGraph=function(){for(var t=this.bondGraph={},r=this.getBonds(),i=r.atomIndices1.length,n=r.atomIndices1,a=r.atomIndices2,o=0;o<i;++o){var s=n[o],u=a[o],c=t[s]=t[s]||[];c.push(u);var f=t[u]=t[u]||[];f.push(s)}};Ot.prototype.calculateRings=function(){for(var t=this.getBondGraph(),r=pC(t,this.atomCount),i=0;i<r.count;i++)r.visited[i]>=0||dC(r,i);this.rings={atomRings:r.atomRings,rings:r.rings}};Ot.prototype.isAromatic=function(t){return this.aromaticAtoms=this.getAromatic(t),this.aromaticAtoms[t.index-t.residueAtomOffset]===1};Ot.prototype.calculateAromatic=function(t){var r=this,i=this.aromaticAtoms=new Uint8Array(this.atomCount),n=this.getRings().rings,a=n.map(function(s){return lC(s.map(function(u){return r.structure.getAtomProxy(u+t.atomOffset)}))}),o=this.aromaticRings=[];n.forEach(function(s,u){a[u]&&(o.push(s),s.forEach(function(c){return i[c]=1}))})};Ot.prototype.assignBondReferenceAtomIndices=function(){var t=this.getBondGraph(),r=this.getRings(),i=r.atomRings,n=r.rings,a=this.bonds,o=a.atomIndices1,s=a.atomIndices2,u=a.bondOrders,c=this.bondReferenceAtomIndices,f=a.atomIndices1.length;c.length=0;for(var l=0;l<f;++l)if(!(u[l]<=1)){var h=void 0,d=o[l],p=s[l],v=i[d],m=i[p];if(v&&m){for(var g=0;g<v.length;g++)if(m.indexOf(v[g])!==-1){h=n[v[g]];break}}if(t[d].length>1)for(var x=0;x<t[d].length;++x){var y=t[d][x];if(y!==p&&(h===void 0||h.indexOf(y)!==-1)){c[l]=y;break}}else if(t[p].length>1)for(var b=0;b<t[p].length;++b){var _=t[p][b];if(_!==d&&(h===void 0||h.indexOf(_)!==-1)){c[l]=_;break}}}};Ot.prototype.getBondIndex=function(t,r){for(var i=this.bonds,n=i.atomIndices1,a=i.atomIndices2,o=n.indexOf(t),s=a.indexOf(r),u=s;o!==-1;){for(;s!==-1;){if(o===s)return o;s=a.indexOf(r,s+1)}o=n.indexOf(t,o+1),s=u}};Ot.prototype.getBondReferenceAtomIndex=function(t,r){var i=this.getBondIndex(t,r);if(i!==void 0)return this.bondReferenceAtomIndices.length===0&&this.assignBondReferenceAtomIndices(),this.bondReferenceAtomIndices[i]};var cC=[5,6,7,8,14,15,16,32,33,50,51,83],fC=.05;function lC(e){if(e.some(function(a){return!cC.includes(a.number)}))return!1;var t=0,r=new Wt(3,e.length),i=r.data;e.forEach(function(a){i[t+0]=a.x,i[t+1]=a.y,i[t+2]=a.z,t+=3});var n=new zu(r);return n.vecC.length()<fC}function hC(e,t,r){if(!(r<t)){for(var i=e.pred,n=e.color,a=e.left,o=e.right,s=++e.currentColor,u=t,c=0;c<Rs&&(n[u]=s,u=i[u],!(u<0));c++);var f=0,l=0,h=!1,d=0;u=r;for(var p=0;p<Rs;p++){if(n[u]===s){d=u,h=!0;break}if(o[l++]=u,u=i[u],u<0)break}if(h){u=t;for(var v=0;v<Rs&&(a[f++]=u,!(d===u||(u=i[u],u<0)));v++);for(var m=f+l,g=new Array(m),x=0,y=0;y<f;y++)g[x++]=a[y];for(var b=l-1;b>=0;b--)g[x++]=o[b];for(var _=e.rings.length,w=0;w<m;++w){var A=g[w];e.atomRings[A]?e.atomRings[A].push(_):e.atomRings[A]=[_]}e.rings.push(g)}}}function dC(e,t){var r=e.bonds,i=e.visited,n=e.queue,a=e.pred;i[t]=1,n[0]=t;for(var o=0,s=1;o<s;){var u=n[o++],c=0;if(r[u]!==void 0)for(var f=r[u].length,l=c;l<f;l++){var h=r[u][l];if(i[h]>0){a[h]!==u&&a[u]!==h&&hC(e,u,h);continue}i[h]=1,n[s++]=h,a[h]=u}}}var Rs=4;function pC(e,t){for(var r={count:t,visited:new Int32Array(t),queue:new Int32Array(t),pred:new Int32Array(t),left:new Int32Array(Rs),right:new Int32Array(Rs),color:new Int32Array(t),currentColor:0,rings:[],atomRings:[],bonds:e},i=0;i<t;i++)r.visited[i]=-1,r.pred[i]=-1;return r}function vC(e,t,r,i){return i===void 0&&(i=""),e+"|"+t.join(",")+"|"+(r?1:0)+"|"+i}var lp=function(t){this.structure=t,this.dict={},this.list=[]};lp.prototype.add=function(t,r,i,n,a){n===void 0&&(n=""),t=t.toUpperCase();var o=vC(t,r,i,n),s=this.dict[o];if(s===void 0){var u=new Ot(this.structure,t,r,i,n,a);s=this.list.length,this.dict[o]=s,this.list.push(u)}return s};lp.prototype.get=function(t){return this.list[t]};var vn=function(t,r){r===void 0&&(r=0),this.structure=t,this.index=r,this.bondStore=t.bondStore,this._v12=new I,this._v13=new I,this._ap1=this.structure.getAtomProxy(),this._ap2=this.structure.getAtomProxy(),this._ap3=this.structure.getAtomProxy()},Vn={atom1:{configurable:!0},atom2:{configurable:!0},atomIndex1:{configurable:!0},atomIndex2:{configurable:!0},bondOrder:{configurable:!0}};Vn.atom1.get=function(){return this.structure.getAtomProxy(this.atomIndex1)};Vn.atom2.get=function(){return this.structure.getAtomProxy(this.atomIndex2)};Vn.atomIndex1.get=function(){return this.bondStore.atomIndex1[this.index]};Vn.atomIndex1.set=function(e){this.bondStore.atomIndex1[this.index]=e};Vn.atomIndex2.get=function(){return this.bondStore.atomIndex2[this.index]};Vn.atomIndex2.set=function(e){this.bondStore.atomIndex2[this.index]=e};Vn.bondOrder.get=function(){return this.bondStore.bondOrder[this.index]};Vn.bondOrder.set=function(e){this.bondStore.bondOrder[this.index]=e};vn.prototype.getOtherAtomIndex=function(t){return t===this.atomIndex1?this.atomIndex2:this.atomIndex1};vn.prototype.getOtherAtom=function(t){return this.structure.getAtomProxy(this.getOtherAtomIndex(t.index))};vn.prototype.getReferenceAtomIndex=function(){var t=this._ap1,r=this._ap2;if(t.index=this.atomIndex1,r.index=this.atomIndex2,t.residueIndex===r.residueIndex){var i=t.index-t.residueAtomOffset,n=r.index-r.residueAtomOffset,a=t.residueType,o=a.getBondReferenceAtomIndex(i,n);if(o!==void 0)return o+t.residueAtomOffset;console.warn("No reference atom found",t.index,r.index)}};vn.prototype.calculateShiftDir=function(t){t===void 0&&(t=new I);var r=this._ap1,i=this._ap2,n=this._ap3,a=this._v12,o=this._v13;r.index=this.atomIndex1,i.index=this.atomIndex2;var s=this.getReferenceAtomIndex();a.subVectors(r,i).normalize(),s!==void 0?(n.index=s,o.subVectors(r,n)):o.copy(r),o.normalize();var u=a.dot(o);return 1-Math.abs(u)<1e-5&&(o.set(1,0,0),u=a.dot(o),1-Math.abs(u)<1e-5&&(o.set(0,1,0),u=a.dot(o))),t.copy(o.sub(a.multiplyScalar(u))).normalize()};vn.prototype.qualifiedName=function(){return this.atomIndex1+"="+this.atomIndex2};vn.prototype.clone=function(){return new vn(this.structure,this.index)};vn.prototype.toObject=function(){return{atomIndex1:this.atomIndex1,atomIndex2:this.atomIndex2,bondOrder:this.bondOrder}};Object.defineProperties(vn.prototype,Vn);var kt=function(t,r){r===void 0&&(r=0),this.structure=t,this.index=r,this.chainStore=t.chainStore,this.residueStore=t.residueStore,this.atomStore=t.atomStore,this.residueMap=t.residueMap,this.atomMap=t.atomMap},Bt={entity:{configurable:!0},entityIndex:{configurable:!0},chain:{configurable:!0},chainIndex:{configurable:!0},atomOffset:{configurable:!0},atomCount:{configurable:!0},atomEnd:{configurable:!0},modelIndex:{configurable:!0},chainname:{configurable:!0},chainid:{configurable:!0},resno:{configurable:!0},sstruc:{configurable:!0},inscode:{configurable:!0},residueType:{configurable:!0},resname:{configurable:!0},hetero:{configurable:!0},moleculeType:{configurable:!0},backboneType:{configurable:!0},backboneStartType:{configurable:!0},backboneEndType:{configurable:!0},traceAtomIndex:{configurable:!0},direction1AtomIndex:{configurable:!0},direction2AtomIndex:{configurable:!0},backboneStartAtomIndex:{configurable:!0},backboneEndAtomIndex:{configurable:!0},rungEndAtomIndex:{configurable:!0},x:{configurable:!0},y:{configurable:!0},z:{configurable:!0}};Bt.entity.get=function(){return this.structure.entityList[this.entityIndex]};Bt.entityIndex.get=function(){return this.chainStore.entityIndex[this.chainIndex]};Bt.chain.get=function(){return this.structure.getChainProxy(this.chainIndex)};Bt.chainIndex.get=function(){return this.residueStore.chainIndex[this.index]};Bt.chainIndex.set=function(e){this.residueStore.chainIndex[this.index]=e};Bt.atomOffset.get=function(){return this.residueStore.atomOffset[this.index]};Bt.atomOffset.set=function(e){this.residueStore.atomOffset[this.index]=e};Bt.atomCount.get=function(){return this.residueStore.atomCount[this.index]};Bt.atomCount.set=function(e){this.residueStore.atomCount[this.index]=e};Bt.atomEnd.get=function(){return this.atomOffset+this.atomCount-1};Bt.modelIndex.get=function(){return this.chainStore.modelIndex[this.chainIndex]};Bt.chainname.get=function(){return this.chainStore.getChainname(this.chainIndex)};Bt.chainid.get=function(){return this.chainStore.getChainid(this.chainIndex)};Bt.resno.get=function(){return this.residueStore.resno[this.index]};Bt.resno.set=function(e){this.residueStore.resno[this.index]=e};Bt.sstruc.get=function(){return this.residueStore.getSstruc(this.index)};Bt.sstruc.set=function(e){this.residueStore.setSstruc(this.index,e)};Bt.inscode.get=function(){return this.residueStore.getInscode(this.index)};Bt.inscode.set=function(e){this.residueStore.setInscode(this.index,e)};Bt.residueType.get=function(){return this.residueMap.get(this.residueStore.residueTypeId[this.index])};Bt.resname.get=function(){return this.residueType.resname};Bt.hetero.get=function(){return this.residueType.hetero};Bt.moleculeType.get=function(){return this.residueType.moleculeType};Bt.backboneType.get=function(){return this.residueType.backboneType};Bt.backboneStartType.get=function(){return this.residueType.backboneStartType};Bt.backboneEndType.get=function(){return this.residueType.backboneEndType};Bt.traceAtomIndex.get=function(){return this.residueType.traceAtomIndex+this.atomOffset};Bt.direction1AtomIndex.get=function(){return this.residueType.direction1AtomIndex+this.atomOffset};Bt.direction2AtomIndex.get=function(){return this.residueType.direction2AtomIndex+this.atomOffset};Bt.backboneStartAtomIndex.get=function(){return this.residueType.backboneStartAtomIndex+this.atomOffset};Bt.backboneEndAtomIndex.get=function(){return this.residueType.backboneEndAtomIndex+this.atomOffset};Bt.rungEndAtomIndex.get=function(){return this.residueType.rungEndAtomIndex+this.atomOffset};Bt.x.get=function(){for(var e=this,t=0,r=this.atomOffset;r<=this.atomEnd;++r)t+=e.atomStore.x[r];return t/this.atomCount};Bt.y.get=function(){for(var e=this,t=0,r=this.atomOffset;r<=this.atomEnd;++r)t+=e.atomStore.y[r];return t/this.atomCount};Bt.z.get=function(){for(var e=this,t=0,r=this.atomOffset;r<=this.atomEnd;++r)t+=e.atomStore.z[r];return t/this.atomCount};kt.prototype.eachAtom=function(t,r){var i=this.atomCount,n=this.atomOffset,a=this.structure._ap,o=n+i;if(r&&r.atomOnlyTest)for(var s=r.atomOnlyTest,u=n;u<o;++u)a.index=u,s(a)&&t(a);else for(var c=n;c<o;++c)a.index=c,t(a)};kt.prototype.positionToArray=function(t,r){return t===void 0&&(t=[]),r===void 0&&(r=0),t[r+0]=this.x,t[r+1]=this.y,t[r+2]=this.z,t};kt.prototype.isProtein=function(){return this.residueType.moleculeType===Ya};kt.prototype.isNucleic=function(){var t=this.residueType.moleculeType;return t===Un||t===Gn};kt.prototype.isRna=function(){return this.residueType.moleculeType===Un};kt.prototype.isDna=function(){return this.residueType.moleculeType===Gn};kt.prototype.isCg=function(){var t=this.residueType.backboneType;return t===Zo||t===Ko||t===Jo};kt.prototype.isPolymer=function(){if(this.structure.entityList.length>0)return this.entity.isPolymer();var t=this.residueType.moleculeType;return t===Ya||t===Un||t===Gn};kt.prototype.isHetero=function(){return this.residueType.hetero===1};kt.prototype.isWater=function(){return this.residueType.moleculeType===rl};kt.prototype.isIon=function(){return this.residueType.moleculeType===il};kt.prototype.isSaccharide=function(){return this.residueType.moleculeType===nl};kt.prototype.isStandardAminoacid=function(){return this.residueType.isStandardAminoacid()};kt.prototype.isStandardBase=function(){return this.residueType.isStandardBase()};kt.prototype.isHelix=function(){return V0.includes(this.sstruc)};kt.prototype.isSheet=function(){return W0.includes(this.sstruc)};kt.prototype.isTurn=function(){return j0.includes(this.sstruc)&&this.isProtein()};kt.prototype.getAtomType=function(t){return this.atomMap.get(this.atomStore.atomTypeId[t])};kt.prototype.getResname1=function(){return wf[this.resname.toUpperCase()]||"X"};kt.prototype.getBackboneType=function(t){switch(t){case-1:return this.residueType.backboneStartType;case 1:return this.residueType.backboneEndType;default:return this.residueType.backboneType}};kt.prototype.getAtomIndexByName=function(t){var r=this.residueType.getAtomIndexByName(t);return r!==void 0&&(r+=this.atomOffset),r};kt.prototype.hasAtomWithName=function(t){return this.residueType.hasAtomWithName(t)};kt.prototype.getAtomnameList=function(){var t=this;console.warn("getAtomnameList - might be expensive");for(var r=this.atomCount,i=this.atomOffset,n=new Array(r),a=0;a<r;++a)n[a]=t.getAtomType(i+a).atomname;return n};kt.prototype.connectedTo=function(t){var r=this.structure.getAtomProxy(this.backboneEndAtomIndex),i=this.structure.getAtomProxy(t.backboneStartAtomIndex);return r&&i?r.connectedTo(i):!1};kt.prototype.getNextConnectedResidue=function(){var t=this.chainStore.residueOffset[this.chainIndex],r=this.chainStore.residueCount[this.chainIndex],i=this.index+1;if(i<t+r){var n=this.structure.getResidueProxy(i);if(this.connectedTo(n))return n}else if(i===t+r){var a=this.structure.getResidueProxy(t);if(this.connectedTo(a))return a}};kt.prototype.getPreviousConnectedResidue=function(t){var r=this.chainStore.residueOffset[this.chainIndex],i=this.index-1;if(i>=r){var n=O(t,this.structure.getResidueProxy());if(n.index=i,n.connectedTo(this))return n}else if(i===r-1){var a=this.chainStore.residueCount[this.chainIndex],o=O(t,this.structure.getResidueProxy());if(o.index=r+a-1,o.connectedTo(this))return o}};kt.prototype.getBonds=function(){return this.residueType.getBonds(this)};kt.prototype.getRings=function(){return this.residueType.getRings()};kt.prototype.getAromaticRings=function(){return this.residueType.getAromaticRings(this)};kt.prototype.qualifiedName=function(t){t===void 0&&(t=!1);var r="";return this.resname&&!t&&(r+="["+this.resname+"]"),this.resno!==void 0&&(r+=this.resno),this.inscode&&(r+="^"+this.inscode),this.chain&&(r+=":"+this.chainname),r+="/"+this.modelIndex,r};kt.prototype.clone=function(){return new kt(this.structure,this.index)};kt.prototype.toObject=function(){return{index:this.index,chainIndex:this.chainIndex,atomOffset:this.atomOffset,atomCount:this.atomCount,resno:this.resno,resname:this.resname,sstruc:this.sstruc}};Object.defineProperties(kt.prototype,Bt);var ui=function(t,r,i){this.structure=t,this.residueIndexStart=r,this.residueIndexEnd=i,this.chainStore=t.chainStore,this.residueStore=t.residueStore,this.atomStore=t.atomStore,this.residueCount=i-r+1;var n=this.structure.getResidueProxy(this.residueIndexStart),a=this.structure.getResidueProxy(this.residueIndexEnd);this.isPrevConnected=n.getPreviousConnectedResidue()!==void 0;var o=a.getNextConnectedResidue();this.isNextConnected=o!==void 0,this.isNextNextConnected=o!==void 0&&o.getNextConnectedResidue()!==void 0,this.isCyclic=a.connectedTo(n),this.__residueProxy=this.structure.getResidueProxy()},ll={chainIndex:{configurable:!0},modelIndex:{configurable:!0},chainname:{configurable:!0}};ll.chainIndex.get=function(){return this.residueStore.chainIndex[this.residueIndexStart]};ll.modelIndex.get=function(){return this.chainStore.modelIndex[this.chainIndex]};ll.chainname.get=function(){return this.chainStore.getChainname(this.chainIndex)};ui.prototype.isProtein=function(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isProtein()};ui.prototype.isCg=function(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isCg()};ui.prototype.isNucleic=function(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isNucleic()};ui.prototype.getMoleculeType=function(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.moleculeType};ui.prototype.getBackboneType=function(t){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.getBackboneType(t)};ui.prototype.getAtomIndexByType=function(t,r){this.isCyclic?t===-1?t=this.residueCount-1:t===this.residueCount&&(t=0):(t===-1&&!this.isPrevConnected&&(t+=1),t===this.residueCount&&!this.isNextNextConnected&&(t-=1));var i=this.__residueProxy;i.index=this.residueIndexStart+t;var n;switch(r){case"trace":n=i.traceAtomIndex;break;case"direction1":n=i.direction1AtomIndex;break;case"direction2":n=i.direction2AtomIndex;break;default:n=i.getAtomIndexByName(r)}return n};ui.prototype.eachAtom=function(t,r){this.eachResidue(function(i){i.eachAtom(t,r)})};ui.prototype.eachAtomN=function(t,r,i){for(var n=this,a=this.residueCount,o=new Array(t),s=0;s<t;++s)o[s]=n.structure.getAtomProxy(n.getAtomIndexByType(s,i));r.apply(this,o);for(var u=t;u<a;++u){for(var c=1;c<t;++c)o[c-1].index=o[c].index;o[t-1].index=n.getAtomIndexByType(u,i),r.apply(n,o)}};ui.prototype.eachResidue=function(t){for(var r=this.structure.getResidueProxy(),i=this.residueCount,n=this.residueIndexStart,a=0;a<i;++a)r.index=n+a,t(r)};ui.prototype.qualifiedName=function(){var t=this.structure.getResidueProxy(this.residueIndexStart),r=this.structure.getResidueProxy(this.residueIndexEnd);return t.qualifiedName()+" - "+r.qualifiedName()};Object.defineProperties(ui.prototype,ll);var mn=function(t,r){r===void 0&&(r=0),this.structure=t,this.index=r,this.chainStore=t.chainStore,this.residueStore=t.residueStore},Pr={entity:{configurable:!0},model:{configurable:!0},entityIndex:{configurable:!0},modelIndex:{configurable:!0},residueOffset:{configurable:!0},residueCount:{configurable:!0},residueEnd:{configurable:!0},atomOffset:{configurable:!0},atomEnd:{configurable:!0},atomCount:{configurable:!0},chainname:{configurable:!0},chainid:{configurable:!0}};Pr.entity.get=function(){return this.structure.entityList[this.entityIndex]};Pr.model.get=function(){return this.structure.getModelProxy(this.modelIndex)};Pr.entityIndex.get=function(){return this.chainStore.entityIndex[this.index]};Pr.entityIndex.set=function(e){this.chainStore.entityIndex[this.index]=e};Pr.modelIndex.get=function(){return this.chainStore.modelIndex[this.index]};Pr.modelIndex.set=function(e){this.chainStore.modelIndex[this.index]=e};Pr.residueOffset.get=function(){return this.chainStore.residueOffset[this.index]};Pr.residueOffset.set=function(e){this.chainStore.residueOffset[this.index]=e};Pr.residueCount.get=function(){return this.chainStore.residueCount[this.index]};Pr.residueCount.set=function(e){this.chainStore.residueCount[this.index]=e};Pr.residueEnd.get=function(){return this.residueOffset+this.residueCount-1};Pr.atomOffset.get=function(){return this.residueStore.atomOffset[this.residueOffset]};Pr.atomEnd.get=function(){return this.residueStore.atomOffset[this.residueEnd]+this.residueStore.atomCount[this.residueEnd]-1};Pr.atomCount.get=function(){return this.residueCount===0?0:this.atomEnd-this.atomOffset+1};Pr.chainname.get=function(){return this.chainStore.getChainname(this.index)};Pr.chainname.set=function(e){this.chainStore.setChainname(this.index,e)};Pr.chainid.get=function(){return this.chainStore.getChainid(this.index)};Pr.chainid.set=function(e){this.chainStore.setChainid(this.index,e)};mn.prototype.eachAtom=function(t,r){this.eachResidue(function(i){i.eachAtom(t,r)},r)};mn.prototype.eachResidue=function(t,r){var i=this.residueCount,n=this.residueOffset,a=this.structure._rp,o=n+i;if(r&&r.test){var s=r.residueOnlyTest;if(s)for(var u=n;u<o;++u)a.index=u,s(a)&&t(a);else for(var c=n;c<o;++c)a.index=c,t(a)}else for(var f=n;f<o;++f)a.index=f,t(a)};mn.prototype.eachResidueN=function(t,r){var i=this,n=this.residueCount,a=this.residueOffset,o=a+n;if(!(n<t)){for(var s=new Array(t),u=0;u<t;++u)s[u]=i.structure.getResidueProxy(a+u);r.apply(this,s);for(var c=a+t;c<o;++c){for(var f=0;f<t;++f)s[f].index+=1;r.apply(i,s)}}};mn.prototype.eachPolymer=function(t,r){for(var i=0,n=0,a=r?r.residueOnlyTest:void 0,o=this.model.structure,s=this.residueCount,u=this.residueOffset,c=u+s,f=this.structure.getResidueProxy(),l=this.structure.getResidueProxy(u),h=this.structure.getAtomProxy(),d=this.structure.getAtomProxy(),p=!0,v=u+1;v<c;++v){f.index=l.index,l.index=v;var m=p?f.backboneEndType:f.backboneType,g=l.backboneType;if(p&&(i=f.index,p=!1),n=l.index,m!==Va&&m===g)h.index=f.backboneEndAtomIndex,d.index=l.backboneStartAtomIndex;else{m!==Va&&f.index-i>1&&t(new ui(o,i,f.index)),i=n;continue}(!h||!d||!h.connectedTo(d)||a&&(!a(f)||!a(l)))&&(f.index-i>1&&t(new ui(o,i,f.index)),i=n)}n-i>1&&this.structure.getResidueProxy(i).backboneEndType&&t(new ui(o,i,n))};mn.prototype.qualifiedName=function(){var t=":"+this.chainname+"/"+this.modelIndex;return t};mn.prototype.clone=function(){return new mn(this.structure,this.index)};mn.prototype.toObject=function(){return{index:this.index,residueOffset:this.residueOffset,residueCount:this.residueCount,chainname:this.chainname}};Object.defineProperties(mn.prototype,Pr);var gn=function(t,r){r===void 0&&(r=0),this.structure=t,this.index=r,this.modelStore=t.modelStore,this.chainStore=t.chainStore,this.residueStore=t.residueStore},Oi={chainOffset:{configurable:!0},chainCount:{configurable:!0},residueOffset:{configurable:!0},atomOffset:{configurable:!0},chainEnd:{configurable:!0},residueEnd:{configurable:!0},atomEnd:{configurable:!0},residueCount:{configurable:!0},atomCount:{configurable:!0}};Oi.chainOffset.get=function(){return this.modelStore.chainOffset[this.index]};Oi.chainOffset.set=function(e){this.modelStore.chainOffset[this.index]=e};Oi.chainCount.get=function(){return this.modelStore.chainCount[this.index]};Oi.chainCount.set=function(e){this.modelStore.chainCount[this.index]=e};Oi.residueOffset.get=function(){return this.chainStore.residueOffset[this.chainOffset]};Oi.atomOffset.get=function(){return this.residueStore.atomOffset[this.residueOffset]};Oi.chainEnd.get=function(){return this.chainOffset+this.chainCount-1};Oi.residueEnd.get=function(){return this.chainStore.residueOffset[this.chainEnd]+this.chainStore.residueCount[this.chainEnd]-1};Oi.atomEnd.get=function(){return this.residueStore.atomOffset[this.residueEnd]+this.residueStore.atomCount[this.residueEnd]-1};Oi.residueCount.get=function(){return this.chainCount===0?0:this.residueEnd-this.residueOffset+1};Oi.atomCount.get=function(){return this.residueCount===0?0:this.atomEnd-this.atomOffset+1};gn.prototype.eachAtom=function(t,r){this.eachChain(function(i){i.eachAtom(t,r)},r)};gn.prototype.eachResidue=function(t,r){this.eachChain(function(i){i.eachResidue(t,r)},r)};gn.prototype.eachPolymer=function(t,r){if(r&&r.chainOnlyTest){var i=r.chainOnlyTest;this.eachChain(function(n){i(n)&&n.eachPolymer(t,r)})}else this.eachChain(function(n){n.eachPolymer(t,r)})};gn.prototype.eachChain=function(t,r){var i=this.chainCount,n=this.chainOffset,a=this.structure._cp,o=n+i;if(r&&r.test){var s=r.chainOnlyTest;if(s)for(var u=n;u<o;++u)a.index=u,s(a)&&t(a);else for(var c=n;c<o;++c)a.index=c,t(a)}else for(var f=n;f<o;++f)a.index=f,t(a)};gn.prototype.qualifiedName=function(){var t="/"+this.index;return t};gn.prototype.clone=function(){return new gn(this.structure,this.index)};gn.prototype.toObject=function(){return{index:this.index,chainOffset:this.chainOffset,chainCount:this.chainCount}};Object.defineProperties(gn.prototype,Oi);var ct=function(t,r){t===void 0&&(t=""),r===void 0&&(r=""),this.signals={refreshed:new ht},this.init(t,r)},xy={type:{configurable:!0}};ct.prototype.init=function(t,r){this.name=t,this.path=r,this.title="",this.id="",this.data=s3(this),this.header={},this.extraData={},this.atomSetCache={},this.atomSetDict={},this.biomolDict={},this.entityList=[],this.unitcell=void 0,this.frames=[],this.boxes=[],this.validation=void 0,this.bondStore=new Tc(0),this.backboneBondStore=new Tc(0),this.rungBondStore=new Tc(0),this.atomStore=new GM(0),this.residueStore=new HM(0),this.chainStore=new VM(0),this.modelStore=new WM(0),this.atomMap=new fp(this),this.residueMap=new lp(this),this.bondHash=void 0,this.spatialHash=void 0,this.atomSet=void 0,this.bondSet=void 0,this.center=new I,this.boundingBox=new ir,this._bp=this.getBondProxy(),this._ap=this.getAtomProxy(),this._rp=this.getResidueProxy(),this._cp=this.getChainProxy()};xy.type.get=function(){return"Structure"};ct.prototype.finalizeAtoms=function(){this.atomSet=this.getAtomSet(),this.atomCount=this.atomStore.count,this.boundingBox=this.getBoundingBox(void 0,this.boundingBox),this.center=this.boundingBox.getCenter(new I),this.spatialHash=new Ha(this.atomStore,this.boundingBox)};ct.prototype.finalizeBonds=function(){var t=this;this.bondSet=this.getBondSet(),this.bondCount=this.bondStore.count,this.bondHash=new UM(this.bondStore,this.atomStore.count),this.atomSetCache={},this.atomSetDict.rung||(this.atomSetDict.rung=this.getAtomSet(!1));for(var r in t.atomSetDict)t.atomSetCache["__"+r]=t.atomSetDict[r].clone()};ct.prototype.getBondProxy=function(t){return new vn(this,t)};ct.prototype.getAtomProxy=function(t){return new tt(this,t)};ct.prototype.getResidueProxy=function(t){return new kt(this,t)};ct.prototype.getChainProxy=function(t){return new mn(this,t)};ct.prototype.getModelProxy=function(t){return new gn(this,t)};ct.prototype.getBondSet=function(){var t=this.bondStore.count,r=new lt(t),i=this.atomSet;if(i)if(i.isAllSet())r.setAll();else if(i.isAllClear())r.clearAll();else for(var n=this.getBondProxy(),a=0;a<t;++a)n.index=a,i.isSet(n.atomIndex1,n.atomIndex2)&&r.set(n.index);else r.setAll();return r};ct.prototype.getBackboneBondSet=function(){var t=this.backboneBondStore.count,r=new lt(t),i=this.atomSetCache.__backbone;if(i){var n=this.getBondProxy();n.bondStore=this.backboneBondStore;for(var a=0;a<t;++a)n.index=a,i.isSet(n.atomIndex1,n.atomIndex2)&&r.set(n.index)}else r.setAll();return r};ct.prototype.getRungBondSet=function(){var t=this.rungBondStore.count,r=new lt(t),i=this.atomSetCache.__rung;if(i){var n=this.getBondProxy();n.bondStore=this.rungBondStore;for(var a=0;a<t;++a)n.index=a,i.isSet(n.atomIndex1,n.atomIndex2)&&r.set(n.index)}else r.setAll();return r};ct.prototype.getAtomSet=function(t){var r=this.atomStore.count;if(t===void 0)return new lt(r,!0);if(t instanceof lt)return t;if(t===!0)return new lt(r,!0);if(t&&t.test){var i=t.string;if(i in this.atomSetCache)return this.atomSetCache[i];if(i==="")return new lt(r,!0);var n=new lt(r);return this.eachAtom(function(a){n.set(a.index)},t),this.atomSetCache[i]=n,n}else if(t===!1)return new lt(r);return new lt(r,!0)};ct.prototype.getAtomSetWithinSelection=function(t,r){var i=this.spatialHash,n=this.getAtomSet(!1),a=this.getAtomProxy();return i&&this.getAtomSet(t).forEach(function(o){a.index=o,i.within(a.x,a.y,a.z,r).forEach(function(s){n.set(s)})}),n};ct.prototype.getAtomSetWithinPoint=function(t,r){var i=t,n=this.getAtomSet(!1);return this.spatialHash&&this.spatialHash.within(i.x,i.y,i.z,r).forEach(function(a){n.set(a)}),n};ct.prototype.getAtomSetWithinVolume=function(t,r,i,n,a){var o=this,s=new Li(t,i,n,a),u=s.getDataPosition(),c=u.length,f=s.matrix.getMaxScaleOnAxis(),l=this.getAtomSet(!1);if(!this.spatialHash)return l;for(var h=0;h<c;h+=3)o.spatialHash.within(u[h],u[h+1],u[h+2],f).forEach(function(d){l.set(d)});return l};ct.prototype.getAtomSetWithinGroup=function(t){var r=this.atomStore.residueIndex,i=this.getAtomSet(!1),n=this.getResidueProxy();return this.getAtomSet(t).forEach(function(a){n.index=r[a];for(var o=n.atomOffset;o<=n.atomEnd;++o)i.set(o)}),i};ct.prototype.getSelection=function(){return!1};ct.prototype.getStructure=function(){return this};ct.prototype.eachEntity=function(t,r){this.entityList.forEach(function(i){(r===void 0||i.getEntityType()===r)&&t(i)})};ct.prototype.eachBond=function(t,r){var i=this.getBondProxy(),n;if(r&&r.test&&(n=this.getBondSet(),this.bondSet&&n.intersection(this.bondSet)),n)n.forEach(function(s){i.index=s,t(i)});else for(var a=this.bondStore.count,o=0;o<a;++o)i.index=o,t(i)};ct.prototype.eachAtom=function(t,r){if(r&&r.test)this.eachModel(function(o){o.eachAtom(t,r)},r);else for(var i=this.atomStore.count,n=this.getAtomProxy(),a=0;a<i;++a)n.index=a,t(n)};ct.prototype.eachResidue=function(t,r){if(r&&r.test){var i=this.modelStore.count,n=this.getModelProxy(),a=r.modelOnlyTest;if(a)for(var o=0;o<i;++o)n.index=o,a(n)&&n.eachResidue(t,r);else for(var s=0;s<i;++s)n.index=s,n.eachResidue(t,r)}else for(var u=this.residueStore.count,c=this.getResidueProxy(),f=0;f<u;++f)c.index=f,t(c)};ct.prototype.eachResidueN=function(t,r){var i=this,n=this.residueStore.count;if(!(n<t)){for(var a=new Array(t),o=0;o<t;++o)a[o]=i.getResidueProxy(o);r.apply(this,a);for(var s=t;s<n;++s){for(var u=0;u<t;++u)a[u].index+=1;r.apply(i,a)}}};ct.prototype.eachPolymer=function(t,r){if(r&&r.modelOnlyTest){var i=r.modelOnlyTest;this.eachModel(function(n){i(n)&&n.eachPolymer(t,r)})}else this.eachModel(function(n){n.eachPolymer(t,r)})};ct.prototype.eachChain=function(t,r){if(r&&r.test)this.eachModel(function(o){o.eachChain(t,r)});else for(var i=this.chainStore.count,n=this.getChainProxy(),a=0;a<i;++a)n.index=a,t(n)};ct.prototype.eachModel=function(t,r){var i=this.modelStore.count,n=this.getModelProxy();if(r&&r.test){var a=r.modelOnlyTest;if(a)for(var o=0;o<i;++o)n.index=o,a(n)&&t(n);else for(var s=0;s<i;++s)n.index=s,t(n)}else for(var u=0;u<i;++u)n.index=u,t(n)};ct.prototype.getAtomData=function(t){var r=Object.assign({},t);r.colorParams&&(r.colorParams.structure=this.getStructure());var i=r.what,n=O(r.atomSet,this.atomSet),a,o,s={},u=this.getAtomProxy(),c=n.getSize();(!i||i.position)&&(s.position=new Float32Array(c*3)),(!i||i.color)&&r.colorParams&&(s.color=new Float32Array(c*3),o=Tt.getScheme(r.colorParams)),(!i||i.picking)&&(s.picking=new Za(new Float32Array(c),this.getStructure())),(!i||i.radius)&&(s.radius=new Float32Array(c),a=new pn(r.radiusParams)),(!i||i.index)&&(s.index=new Uint32Array(c));var f=s.position,l=s.color,h=s.picking,d=s.radius,p=s.index;return n.forEach(function(v,m){var g=m*3;u.index=v,f&&u.positionToArray(f,g),l&&o.atomColorToArray(u,l,g),h&&(h.array[m]=v),d&&(d[m]=a.atomRadius(u)),p&&(p[m]=v)}),s};ct.prototype.getBondData=function(t){var r=Object.assign({},t);r.colorParams&&(r.colorParams.structure=this.getStructure());var i=r.what,n=O(r.bondSet,this.bondSet),a=O(r.multipleBond,"off"),o=a!=="off",s=a==="offset",u=O(r.bondScale,.4),c=O(r.bondSpacing,1),f,l,h={},d=this.getBondProxy();r.bondStore&&(d.bondStore=r.bondStore);var p=this.getAtomProxy(),v=this.getAtomProxy(),m;if(o){var g=d.bondStore.bondOrder;m=0,n.forEach(function(W){m+=g[W]})}else m=n.getSize();(!i||i.position)&&(h.position1=new Float32Array(m*3),h.position2=new Float32Array(m*3)),(!i||i.color)&&r.colorParams&&(h.color=new Float32Array(m*3),h.color2=new Float32Array(m*3),l=Tt.getScheme(r.colorParams)),(!i||i.picking)&&(h.picking=new Q0(new Float32Array(m),this.getStructure(),r.bondStore)),(!i||i.radius||o&&i.position)&&(f=new pn(r.radiusParams)),(!i||i.radius)&&(h.radius=new Float32Array(m),r.radius2&&(h.radius2=new Float32Array(m)));var x=h.position1,y=h.position2,b=h.color,_=h.color2,w=h.picking,A=h.radius,S=h.radius2,M=0,E,T,H,X,q,Z,Q=new I,N=new I,D=new I;return n.forEach(function(W){if(T=M*3,d.index=W,p.index=d.atomIndex1,v.index=d.atomIndex2,X=d.bondOrder,x)if(o&&X>1){var L=f.atomRadius(p);Z=L*u/(.5*X),d.calculateShiftDir(D),s?(q=2*c*L,D.multiplyScalar(q),D.negate(),N.subVectors(v,p).multiplyScalar(Math.max(.1,q/1.88)),p.positionToArray(x,T),v.positionToArray(y,T),X>=2&&(Q.addVectors(p,D).add(N).toArray(x,T+3),Q.addVectors(v,D).sub(N).toArray(y,T+3),X>=3&&(Q.subVectors(p,D).add(N).toArray(x,T+6),Q.subVectors(v,D).sub(N).toArray(y,T+6)))):(q=(c-u)*L,D.multiplyScalar(q),X===2?(Q.addVectors(p,D).toArray(x,T),Q.subVectors(p,D).toArray(x,T+3),Q.addVectors(v,D).toArray(y,T),Q.subVectors(v,D).toArray(y,T+3)):X===3?(p.positionToArray(x,T),Q.addVectors(p,D).toArray(x,T+3),Q.subVectors(p,D).toArray(x,T+6),v.positionToArray(y,T),Q.addVectors(v,D).toArray(y,T+3),Q.subVectors(v,D).toArray(y,T+6)):(p.positionToArray(x,T),v.positionToArray(y,T)))}else p.positionToArray(x,T),v.positionToArray(y,T);if(b&&_&&(l.bondColorToArray(d,1,b,T),l.bondColorToArray(d,0,_,T),o&&X>1))for(E=1;E<X;++E)H=E*3+T,_v(b,T,H,3),_v(_,T,H,3);if(w&&w.array&&(w.array[M]=W,o&&X>1))for(E=1;E<X;++E)w.array[M+E]=W;if(A&&(A[M]=f.atomRadius(p),o&&X>1))for(Z=A[M]*u/(s?1:.5*X),E=s?1:0;E<X;++E)A[M+E]=Z;if(S&&(S[M]=f.atomRadius(v),o&&X>1))for(Z=S[M]*u/(s?1:.5*X),E=s?1:0;E<X;++E)S[M+E]=Z;M+=o?X:1}),h};ct.prototype.getBackboneAtomData=function(t){return t=Object.assign({atomSet:this.atomSetCache.__backbone},t),this.getAtomData(t)};ct.prototype.getBackboneBondData=function(t){return t=Object.assign({bondSet:this.getBackboneBondSet(),bondStore:this.backboneBondStore},t),this.getBondData(t)};ct.prototype.getRungAtomData=function(t){return t=Object.assign({atomSet:this.atomSetCache.__rung},t),this.getAtomData(t)};ct.prototype.getRungBondData=function(t){return t=Object.assign({bondSet:this.getRungBondSet(),bondStore:this.rungBondStore},t),this.getBondData(t)};ct.prototype.getBoundingBox=function(t,r){ge&&fe.time("getBoundingBox"),r=r||new ir;var i=1/0,n=1/0,a=1/0,o=-1/0,s=-1/0,u=-1/0;return this.eachAtom(function(c){var f=c.x,l=c.y,h=c.z;f<i&&(i=f),l<n&&(n=l),h<a&&(a=h),f>o&&(o=f),l>s&&(s=l),h>u&&(u=h)},t),r.min.set(i,n,a),r.max.set(o,s,u),ge&&fe.timeEnd("getBoundingBox"),r};ct.prototype.getPrincipalAxes=function(t){ge&&fe.time("getPrincipalAxes");var r=0,i=new Wt(3,this.atomCount),n=i.data;return this.eachAtom(function(a){n[r+0]=a.x,n[r+1]=a.y,n[r+2]=a.z,r+=3},t),ge&&fe.timeEnd("getPrincipalAxes"),new zu(i)};ct.prototype.atomCenter=function(t){return t?this.getBoundingBox(t).getCenter(new I):this.center.clone()};ct.prototype.hasCoords=function(){if(this._hasCoords===void 0){var t=this.atomStore;this._hasCoords=Ac(t.x)!==0||wc(t.x)!==0||Ac(t.y)!==0||wc(t.y)!==0||Ac(t.z)!==0||wc(t.z)!==0||t.count/this.modelStore.count===1}return this._hasCoords};ct.prototype.getSequence=function(t){var r=[],i=this.getResidueProxy();return this.eachAtom(function(n){i.index=n.residueIndex,n.index===i.traceAtomIndex&&r.push(i.getResname1())},t),r};ct.prototype.getAtomIndices=function(t){if(t&&t.string){var r=[];return this.eachAtom(function(n){r.push(n.index)},t),new Uint32Array(r)}else{var i={what:{index:!0}};return this.getAtomData(i).index}};ct.prototype.getChainnameCount=function(t){var r=new Set;return this.eachChain(function(i){i.residueCount&&r.add(i.chainname)},t),r.size};ct.prototype.updatePosition=function(t){var r=0;this.eachAtom(function(i){i.positionFromArray(t,r),r+=3},void 0),this._hasCoords=void 0};ct.prototype.refreshPosition=function(){this.getBoundingBox(void 0,this.boundingBox),this.boundingBox.getCenter(this.center),this.spatialHash=new Ha(this.atomStore,this.boundingBox)};ct.prototype.dispose=function(){this.frames&&(this.frames.length=0),this.boxes&&(this.boxes.length=0),this.bondStore.dispose(),this.backboneBondStore.dispose(),this.rungBondStore.dispose(),this.atomStore.dispose(),this.residueStore.dispose(),this.chainStore.dispose(),this.modelStore.dispose(),delete this.bondStore,delete this.atomStore,delete this.residueStore,delete this.chainStore,delete this.modelStore,delete this.frames,delete this.boxes,delete this.bondSet,delete this.atomSet};Object.defineProperties(ct.prototype,xy);var jv=new ir,hp=[qf,Xa,Yf,qa,Yo,jf,qo,Xf,Kf,Zf,Ou,Du],mC={aspectRatio:1.5,sphereDetail:2,radialSegments:50,disableImpostor:!1,openEnded:!1,dashedCylinder:!1,labelParams:{},pointSize:2,sizeAttenuation:!1,useTexture:!0,lineWidth:2},Tr=function(t,r){var i=this;t===void 0&&(t="shape"),r===void 0&&(r={}),this.boundingBox=new ir,this.bufferList=[],this.meshCount=0,this._primitiveData={},this.name=t,this.parameters=vi(r,mC),hp.forEach(function(n){Object.keys(n.fields).forEach(function(a){i._primitiveData[n.getShapeKey(a)]=[]}),i._primitiveData[n.getShapeKey("name")]=[]})},dp={center:{configurable:!0},type:{configurable:!0}};Tr.prototype.addBuffer=function(t){this.bufferList.push(t);var r=t.geometry;return r.boundingBox||r.computeBoundingBox(),this.boundingBox.union(r.boundingBox),this};Tr.prototype.addMesh=function(t,r,i,n,a){t=Rl(t),r=Rl(r),Array.isArray(i)&&(i=dn(i,t.length)),n&&(n=Rl(n));var o={position:t,color:r,index:i,normal:n},s=new _M(this,Object.assign({serial:this.meshCount,name:a},o)),u=new ua(Object.assign({picking:s},o));return this.bufferList.push(u),jv.setFromArray(t),this.boundingBox.union(jv),this.meshCount+=1,this};Tr.prototype.addSphere=function(t,r,i,n){return qo.objectToShape(this,{position:t,color:r,radius:i,name:n}),this};Tr.prototype.addEllipsoid=function(t,r,i,n,a,o){return Yo.objectToShape(this,{position:t,color:r,radius:i,majorAxis:n,minorAxis:a,name:o}),this};Tr.prototype.addTorus=function(t,r,i,n,a,o){return Zf.objectToShape(this,{position:t,color:r,radius:i,majorAxis:n,minorAxis:a,name:o}),this};Tr.prototype.addCylinder=function(t,r,i,n,a){return qa.objectToShape(this,{position1:t,position2:r,color:i,radius:n,name:a}),this};Tr.prototype.addCone=function(t,r,i,n,a){return Yf.objectToShape(this,{position1:t,position2:r,color:i,radius:n,name:a}),this};Tr.prototype.addArrow=function(t,r,i,n,a){return qf.objectToShape(this,{position1:t,position2:r,color:i,radius:n,name:a}),this};Tr.prototype.addBox=function(t,r,i,n,a,o){return Xa.objectToShape(this,{position:t,color:r,size:i,heightAxis:n,depthAxis:a,name:o}),this};Tr.prototype.addOctahedron=function(t,r,i,n,a,o){return jf.objectToShape(this,{position:t,color:r,size:i,heightAxis:n,depthAxis:a,name:o}),this};Tr.prototype.addTetrahedron=function(t,r,i,n,a,o){return Xf.objectToShape(this,{position:t,color:r,size:i,heightAxis:n,depthAxis:a,name:o}),this};Tr.prototype.addText=function(t,r,i,n){return Kf.objectToShape(this,{position:t,color:r,size:i,text:n}),this};Tr.prototype.addPoint=function(t,r,i){return Ou.objectToShape(this,{position:t,color:r,name:i}),this};Tr.prototype.addWideline=function(t,r,i,n){return Du.objectToShape(this,{position1:t,position2:r,color:i,name:n}),this};Tr.prototype.addLabel=function(t,r,i,n){return console.warn("Shape.addLabel is deprecated, use .addText instead"),this.addText(t,r,i,n)};Tr.prototype.getBufferList=function(){var t=this,r=[];return hp.forEach(function(i){t._primitiveData[i.getShapeKey("color")].length&&r.push(i.bufferFromShape(t,t.parameters))}),this.bufferList.concat(r)};Tr.prototype.dispose=function(){var t=this;this.bufferList.forEach(function(r){r.dispose()}),this.bufferList.length=0,hp.forEach(function(r){Object.keys(r.fields).forEach(function(i){t._primitiveData[r.getShapeKey(i)].length=0}),t._primitiveData[r.getShapeKey("name")].length=0})};dp.center.get=function(){return this._center||(this._center=this.boundingBox.getCenter(new I)),this._center};dp.type.get=function(){return"Shape"};Object.defineProperties(Tr.prototype,dp);var Xv=function(e){function t(r,i,n){Array.isArray(r)||(r=[r]),e.call(this,r,i,n),this.type="buffer",this.parameters=Object.assign({},this.parameters,{colorScheme:null,colorScale:null,colorValue:null,colorDomain:null,colorMode:null}),this.buffer=r,this.init(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){e.prototype.init.call(this,i),this.build()},t.prototype.create=function(){this.bufferList.push.apply(this.bufferList,this.buffer)},t.prototype.attach=function(i){var n=this;this.bufferList.forEach(function(a){n.viewer.add(a),a.setParameters(n.getBufferParams())}),this.setVisibility(this.visible),i()},t}(wr),ac=new Ae,qv=new Ur;function gC(e,t){var r=t.attributes.position.array,i=t.index?t.index.array:void 0,n=e.position.length/3,a=r.length/3,o=n*a,s=new Float32Array(o*3),u=new Float32Array(o*3),c=new Float32Array(o*3),f;return i&&(f=dn(n*i.length,o)),{position:s,color:c,index:f,normal:u,primitiveId:e.primitiveId||sd(n,a),picking:e.picking}}var ma=function(e){function t(r,i,n){i===void 0&&(i={}),e.call(this,gC(r,n),i),this.updateNormals=!1;var a=n.attributes.position.array,o=n.attributes.normal.array,s=n.index?n.index.array:void 0;this.geoPosition=a,this.geoNormal=o,this.geoIndex=s,this.positionCount=r.position.length/3,this.geoPositionCount=a.length/3,this.transformedGeoPosition=new Float32Array(this.geoPositionCount*3),this.transformedGeoNormal=new Float32Array(this.geoPositionCount*3);var u=this.geometry.attributes;this.meshPosition=u.position.array,this.meshColor=u.color.array,this.meshNormal=u.normal.array,this.setAttributes(r),s&&(this.meshIndex=this.geometry.getIndex().array,this.makeIndex())}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setAttributes=function(i,n){var a=this;i===void 0&&(i={}),n===void 0&&(n=!1);var o=this.geometry.attributes,s,u,c,f,l,h,d,p,v,m=this.updateNormals;i.position&&(s=i.position,c=this.geoPosition,d=this.meshPosition,l=this.transformedGeoPosition,o.position.needsUpdate=!0,(m||n)&&(f=this.geoNormal,v=this.meshNormal,h=this.transformedGeoNormal,o.normal.needsUpdate=!0)),i.color&&(u=i.color,p=this.meshColor,o.color.needsUpdate=!0);for(var g=this.positionCount,x=this.geoPositionCount,y=0;y<g;++y){var b=void 0,_=void 0,w=y*x*3,A=y*3;if(s&&l&&d&&v&&c&&f&&(l.set(c),ac.makeTranslation(s[A],s[A+1],s[A+2]),a.applyPositionTransform(ac,y,A),Wf(ac.elements,l),d.set(l,w),m&&h?(h.set(f),qv.getNormalMatrix(ac),qd(qv.elements,h),v.set(h,w)):n&&v.set(f,w)),u&&p)for(b=0;b<x;++b)_=w+3*b,p[_]=u[A],p[_+1]=u[A+1],p[_+2]=u[A+2]}},t.prototype.makeIndex=function(){var i=this.geoIndex,n=this.meshIndex;if(i)for(var a=this.positionCount,o=this.geoPositionCount,s=i.length/3,u=s*3,c=0;c<a;++c){var f=c*u,l=f+u;n.set(i,f);for(var h=f;h<l;++h)n[h]+=c*o}},t}(ua),Yv=new I,_y=Object.assign({sphereDetail:1},ti),yC=function(e){function t(i,n){n===void 0&&(n={}),e.call(this,i,n,new za(1,O(n.sphereDetail,1))),this.setAttributes(i,!0)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={defaultParameters:{configurable:!0}};return r.defaultParameters.get=function(){return _y},t.prototype.applyPositionTransform=function(n,a){var o=this._radius[a];Yv.set(o,o,o),n.scale(Yv)},t.prototype.setAttributes=function(n,a){n===void 0&&(n={}),n.radius&&(this._radius=n.radius),e.prototype.setAttributes.call(this,n,a)},Object.defineProperties(t.prototype,r),t}(ma);Ut.add("shader/SphereImpostor.vert",`uniform mat4 projectionMatrixInverse;
uniform float clipNear;
varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;
attribute vec2 mapping;
attribute float radius;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
#endif
#include matrix_scale
const mat4 D = mat4(
1.0, 0.0, 0.0, 0.0,
0.0, 1.0, 0.0, 0.0,
0.0, 0.0, 1.0, 0.0,
0.0, 0.0, 0.0, -1.0
);
mat4 transpose( in mat4 inMatrix ) {
vec4 i0 = inMatrix[0];
vec4 i1 = inMatrix[1];
vec4 i2 = inMatrix[2];
vec4 i3 = inMatrix[3];
mat4 outMatrix = mat4(
vec4(i0.x, i1.x, i2.x, i3.x),
vec4(i0.y, i1.y, i2.y, i3.y),
vec4(i0.z, i1.z, i2.z, i3.z),
vec4(i0.w, i1.w, i2.w, i3.w)
);
return outMatrix;
}
void ComputePointSizeAndPositionInClipCoordSphere(){
vec2 xbc;
vec2 ybc;
mat4 T = mat4(
radius, 0.0, 0.0, 0.0,
0.0, radius, 0.0, 0.0,
0.0, 0.0, radius, 0.0,
position.x, position.y, position.z, 1.0
);
mat4 R = transpose( projectionMatrix * modelViewMatrix * T );
float A = dot( R[ 3 ], D * R[ 3 ] );
float B = -2.0 * dot( R[ 0 ], D * R[ 3 ] );
float C = dot( R[ 0 ], D * R[ 0 ] );
xbc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
xbc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
float sx = abs( xbc[ 0 ] - xbc[ 1 ] ) * 0.5;
A = dot( R[ 3 ], D * R[ 3 ] );
B = -2.0 * dot( R[ 1 ], D * R[ 3 ] );
C = dot( R[ 1 ], D * R[ 1 ] );
ybc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
ybc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
float sy = abs( ybc[ 0 ] - ybc[ 1 ] ) * 0.5;
gl_Position.xy = vec2( 0.5 * ( xbc.x + xbc.y ), 0.5 * ( ybc.x + ybc.y ) );
gl_Position.xy -= mapping * vec2( sx, sy );
gl_Position.xy *= gl_Position.w;
}
void main(void){
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#endif
vRadius = radius * matrixScale( modelViewMatrix );
vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
mvPosition.z -= vRadius;
gl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );
ComputePointSizeAndPositionInClipCoordSphere();
vRadiusSq = vRadius * vRadius;
vec4 vPoint4 = projectionMatrixInverse * gl_Position;
vPoint = vPoint4.xyz / vPoint4.w;
vPointViewPosition = -mvPosition.xyz / mvPosition.w;
}`);Ut.add("shader/SphereImpostor.frag",`#define STANDARD
#define IMPOSTOR
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform mat4 projectionMatrix;
uniform float ortho;
varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
#include common
#include color_pars_fragment
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
bool flag2 = false;
bool interior = false;
vec3 cameraPos;
vec3 cameraNormal;
float calcDepth( in vec3 cameraPos ){
vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;
return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
float calcClip( vec3 cameraPos ){
return dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );
}
bool Impostor( out vec3 cameraPos, out vec3 cameraNormal ){
vec3 cameraSpherePos = -vPointViewPosition;
cameraSpherePos.z += vRadius;
vec3 rayOrigin = mix( vec3( 0.0, 0.0, 0.0 ), vPoint, ortho );
vec3 rayDirection = mix( normalize( vPoint ), vec3( 0.0, 0.0, 1.0 ), ortho );
vec3 cameraSphereDir = mix( cameraSpherePos, rayOrigin - cameraSpherePos, ortho );
float B = dot( rayDirection, cameraSphereDir );
float det = B * B + vRadiusSq - dot( cameraSphereDir, cameraSphereDir );
if( det < 0.0 ){
discard;
return false;
}
float sqrtDet = sqrt( det );
float posT = mix( B + sqrtDet, B + sqrtDet, ortho );
float negT = mix( B - sqrtDet, sqrtDet - B, ortho );
cameraPos = rayDirection * negT + rayOrigin;
#ifdef NEAR_CLIP
if( calcDepth( cameraPos ) <= 0.0 ){
cameraPos = rayDirection * posT + rayOrigin;
interior = true;
}else if( calcClip( cameraPos ) > 0.0 ){
cameraPos = rayDirection * posT + rayOrigin;
interior = true;
flag2 = true;
}
#else
if( calcDepth( cameraPos ) <= 0.0 ){
cameraPos = rayDirection * posT + rayOrigin;
interior = true;
}
#endif
cameraNormal = normalize( cameraPos - cameraSpherePos );
cameraNormal *= float(!interior) * 2.0 - 1.0;
return !interior;
}
void main(void){
bool flag = Impostor( cameraPos, cameraNormal );
#ifdef NEAR_CLIP
if( calcClip( cameraPos ) > 0.0 )
discard;
#endif
gl_FragDepthEXT = calcDepth( cameraPos );
if( !flag ){
#ifdef NEAR_CLIP
if( flag2 ){
gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );
}else if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
#else
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
#endif
}
if (gl_FragDepthEXT < 0.0)
discard;
if (gl_FragDepthEXT > 1.0)
discard;
#ifdef PICKING
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 vNormal = cameraNormal;
vec3 vViewPosition = -cameraPos;
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
#include normal_fragment_begin
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
if( interior ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include encodings_fragment
#include fog_fragment
#endif
}`);var pp=function(e){function t(i,n,a){a===void 0&&(a={}),e.call(this,n,a),this.index=dn(this.indexSize,this.attributeSize),this.makeIndex(),this.initIndex(this.index),this.addAttributes({mapping:{type:i,value:null}}),this.setAttributes({primitiveId:jo(this.size)})}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={attributeSize:{configurable:!0},indexSize:{configurable:!0}};return r.attributeSize.get=function(){return this.size*this.mappingSize},r.indexSize.get=function(){return this.size*this.mappingIndicesSize},t.prototype.addAttributes=function(n){var a={};for(var o in n){var s=n[o];a[o]={type:s.type,value:null}}e.prototype.addAttributes.call(this,a)},t.prototype.getAttributeIndex=function(n){return n*3*this.mappingSize},t.prototype.setAttributes=function(n){n&&!n.position&&n.position1&&n.position2&&(n.position=on(n.position1,n.position2));var a=this.size,o=this.mappingSize,s=this.geometry.attributes,u,c,f,l,h,d,p;for(var v in n)if(!(v==="index"||v==="picking")){c=n[v],u=s[v],f=u.itemSize,l=u.array;for(var m=0;m<a;++m){h=m*f,d=h*o;for(var g=0;g<o;++g){p=d+f*g;for(var x=0;x<f;++x)l[p+x]=c[h+x]}}u.needsUpdate=!0}},t.prototype.makeMapping=function(){for(var n=this.size,a=this.mapping,o=this.mappingSize,s=this.mappingItemSize,u=this.geometry.attributes,c=u.mapping.array,f=0;f<n;f++)c.set(a,f*s*o)},t.prototype.makeIndex=function(){for(var n=this.size,a=this.mappingSize,o=this.mappingIndices,s=this.mappingIndicesSize,u=this.index,c=0;c<n;c++){var f=c*s,l=c*a;u.set(o,f);for(var h=0;h<s;++h)u[f+h]+=l}},Object.defineProperties(t.prototype,r),t}(It),bC=new Float32Array([-1,1,-1,-1,1,1,1,-1]),xC=new Uint16Array([0,1,2,1,3,2]),vp=function(e){function t(i,n){n===void 0&&(n={}),e.call(this,"v2",i,n)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={mapping:{configurable:!0},mappingIndices:{configurable:!0},mappingIndicesSize:{configurable:!0},mappingSize:{configurable:!0},mappingItemSize:{configurable:!0}};return r.mapping.get=function(){return bC},r.mappingIndices.get=function(){return xC},r.mappingIndicesSize.get=function(){return 6},r.mappingSize.get=function(){return 4},r.mappingItemSize.get=function(){return 2},Object.defineProperties(t.prototype,r),t}(pp),_C=function(e){function t(r,i){i===void 0&&(i={}),e.call(this,r,i),this.isImpostor=!0,this.vertexShader="SphereImpostor.vert",this.fragmentShader="SphereImpostor.frag",this.addUniforms({projectionMatrixInverse:{value:new Ae},ortho:{value:0}}),this.addAttributes({radius:{type:"f",value:null}}),this.setAttributes(r),this.makeMapping()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(vp);Object.assign({disableImpostor:!1},_y);var ga=function(t,r){return!an||r&&r.disableImpostor?new yC(t,r):new _C(t,r)};mi.add("sphere",ga);Ut.add("shader/Point.vert",`uniform float clipNear;
uniform float clipRadius;
uniform vec3 clipCenter;
uniform float size;
uniform float canvasHeight;
uniform float pixelRatio;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
varying vec3 vViewPosition;
#endif
#include common
void main(){
#if defined( PICKING )
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#endif
#include begin_vertex
#include project_vertex
#ifdef USE_SIZEATTENUATION
gl_PointSize = size * pixelRatio * ( ( canvasHeight / 2.0 ) / -mvPosition.z );
#else
gl_PointSize = size * pixelRatio;
#endif
#ifndef PICKING
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
#include radiusclip_vertex
}`);Ut.add("shader/Point.frag",`uniform vec3 diffuse;
uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#ifdef USE_MAP
uniform sampler2D map;
#endif
#if defined( PICKING )
uniform float objectId;
varying vec3 vPickingColor;
#else
#include common
#include color_pars_fragment
#include fog_pars_fragment
varying vec3 vViewPosition;
#endif
void main(){
#include nearclip_fragment
#include radiusclip_fragment
#if defined( PICKING )
#ifdef USE_MAP
if( texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) ).a < 0.5 )
discard;
#endif
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 outgoingLight = vec3( 0.0 );
vec4 diffuseColor = vec4( diffuse, 1.0 );
#ifdef USE_MAP
diffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );
#endif
#include color_fragment
#include alphatest_fragment
outgoingLight = diffuseColor.rgb;
gl_FragColor = vec4( outgoingLight, diffuseColor.a * opacity );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include encodings_fragment
#include fog_fragment
#endif
}`);function wC(e,t,r,i){var n=r-e,a=i-t;return Math.sqrt(n*n+a*a)}function AC(e){for(var t=e||{},r=O(t.width,256),i=O(t.height,256),n=[r/2,i/2],a=Math.min(r/2,i/2),o=O(t.delta,1/(a+1))*a,s=0,u=0,c=new Uint8Array(r*i*4),f=0,l=c.length;f<l;f+=4){var h=wC(s,u,n[0],n[1]),d=1-Pu(a-o,a,h);c[f]=d*255,c[f+1]=d*255,c[f+2]=d*255,c[f+3]=d*255,++s===r&&(s=0,u++)}var p=new Rn(c,r,i);return p.needsUpdate=!0,p}var SC=Object.assign({pointSize:1,sizeAttenuation:!0,sortParticles:!1,alphaTest:.5,useTexture:!1,forceTransparent:!1,edgeBleach:0},ti),MC=Object.assign({pointSize:{uniform:"size"},sizeAttenuation:{updateShader:!0},sortParticles:{},alphaTest:{updateShader:!0},useTexture:{updateShader:!0},forceTransparent:{},edgeBleach:{uniform:!0}},Ka),mp=function(e){function t(i,n){n===void 0&&(n={}),e.call(this,i,n),this.parameterTypes=MC,this.vertexShader="Point.vert",this.fragmentShader="Point.frag",this.isPoint=!0,this.addUniforms({size:{value:this.parameters.pointSize},canvasHeight:{value:1},pixelRatio:{value:1},map:{value:null}})}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={defaultParameters:{configurable:!0}};return r.defaultParameters.get=function(){return SC},t.prototype.makeMaterial=function(){e.prototype.makeMaterial.call(this),this.makeTexture();var n=this.material,a=this.wireframeMaterial,o=this.pickingMaterial;n.uniforms.map.value=this.tex,n.needsUpdate=!0,a.uniforms.map.value=this.tex,a.needsUpdate=!0,o.uniforms.map.value=this.tex,o.needsUpdate=!0},t.prototype.makeTexture=function(){this.tex&&this.tex.dispose(),this.tex=AC({delta:this.parameters.edgeBleach})},t.prototype.getDefines=function(n){var a=e.prototype.getDefines.call(this,n);return this.parameters.sizeAttenuation&&(a.USE_SIZEATTENUATION=1),this.parameters.useTexture&&(a.USE_MAP=1),this.parameters.alphaTest>0&&this.parameters.alphaTest<=1&&(a.ALPHATEST=this.parameters.alphaTest.toPrecision(2)),a},t.prototype.setUniforms=function(n){n&&n.edgeBleach!==void 0&&(this.makeTexture(),n.map=this.tex),e.prototype.setUniforms.call(this,n)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.tex&&this.tex.dispose()},Object.defineProperties(t.prototype,r),t}(It);mi.add("point",mp);var Zv=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="dot",this.parameters=Object.assign({thresholdType:{type:"select",rebuild:!0,options:{value:"value",sigma:"sigma"}},thresholdMin:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdMax:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdOut:{type:"boolean",rebuild:!0},dotType:{type:"select",rebuild:!0,options:{"":"",sphere:"sphere",point:"point"}},radiusType:{type:"select",options:{"":"",value:"value","abs-value":"abs-value","value-min":"value-min",deviation:"deviation",size:"size"}},radius:{type:"number",precision:3,max:10,min:.001,property:"size"},scale:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,disableImpostor:!0,pointSize:{type:"number",precision:1,max:100,min:0,buffer:!0},sizeAttenuation:{type:"boolean",buffer:!0},sortParticles:{type:"boolean",rebuild:!0},useTexture:{type:"boolean",buffer:!0},alphaTest:{type:"range",step:.001,max:1,min:0,buffer:!0},forceTransparent:{type:"boolean",buffer:!0},edgeBleach:{type:"range",step:.001,max:1,min:0,buffer:!0}},this.parameters,{colorScheme:{type:"select",update:"color",options:{"":"",value:"value",uniform:"uniform",random:"random"}}}),r instanceof jt?(this.surface=void 0,this.volume=new Li(r)):(this.surface=r,this.volume=void 0),this.init(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};n.colorScheme=O(n.colorScheme,"uniform"),n.colorValue=O(n.colorValue,14540253),this.thresholdType=O(n.thresholdType,"sigma"),this.thresholdMin=O(n.thresholdMin,2),this.thresholdMax=O(n.thresholdMax,1/0),this.thresholdOut=O(n.thresholdOut,!1),this.dotType=O(n.dotType,"point"),this.radius=O(n.radius,.1),this.scale=O(n.scale,1),this.pointSize=O(n.pointSize,1),this.sizeAttenuation=O(n.sizeAttenuation,!0),this.sortParticles=O(n.sortParticles,!1),this.useTexture=O(n.useTexture,!1),this.alphaTest=O(n.alphaTest,.5),this.forceTransparent=O(n.forceTransparent,!1),this.edgeBleach=O(n.edgeBleach,0),e.prototype.init.call(this,n),this.build()},t.prototype.attach=function(i){var n=this;this.bufferList.forEach(function(a){n.viewer.add(a)}),this.setVisibility(this.visible),i()},t.prototype.create=function(){var i={};if(this.volume){var n=this.volume,a,o;this.thresholdType==="sigma"?(a=n.getValueForSigma(this.thresholdMin),o=n.getValueForSigma(this.thresholdMax)):(a=this.thresholdMin,o=this.thresholdMax),n.setFilter(a,o,this.thresholdOut),Object.assign(i,{position:n.getDataPosition(),color:n.getDataColor(this.getColorParams())}),this.dotType==="sphere"&&Object.assign(i,{radius:n.getDataSize(this.radius,this.scale),picking:n.getDataPicking()})}else{var s=this.surface;Object.assign(i,{position:s.getPosition(),color:s.getColor(this.getColorParams())}),this.dotType==="sphere"&&Object.assign(i,{radius:s.getSize(this.radius,this.scale),picking:s.getPicking()})}this.dotType==="sphere"?this.dotBuffer=new ga(i,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!1})):this.dotBuffer=new mp(i,this.getBufferParams({pointSize:this.pointSize,sizeAttenuation:this.sizeAttenuation,sortParticles:this.sortParticles,useTexture:this.useTexture,alphaTest:this.alphaTest,forceTransparent:this.forceTransparent,edgeBleach:this.edgeBleach})),this.bufferList.push(this.dotBuffer)},t.prototype.update=function(i){if(i===void 0&&(i={}),this.bufferList.length!==0){var n={};i.color&&(this.volume?Object.assign(n,{color:this.volume.getDataColor(this.getColorParams())}):Object.assign(n,{color:this.surface.getColor(this.getColorParams())})),this.dotType==="sphere"&&(i.radius||i.scale)&&(this.volume?Object.assign(n,{radius:this.volume.getDataSize(this.radius,this.scale)}):Object.assign(n,{radius:this.surface.getSize(this.radius,this.scale)})),this.dotBuffer.setAttributes(n)}},t.prototype.setParameters=function(i,n,a){return n===void 0&&(n={}),i&&i.thresholdType!==void 0&&this.volume instanceof jt&&(this.thresholdType==="value"&&i.thresholdType==="sigma"?(this.thresholdMin=this.volume.getSigmaForValue(this.thresholdMin),this.thresholdMax=this.volume.getSigmaForValue(this.thresholdMax)):this.thresholdType==="sigma"&&i.thresholdType==="value"&&(this.thresholdMin=this.volume.getValueForSigma(this.thresholdMin),this.thresholdMax=this.volume.getValueForSigma(this.thresholdMax)),this.thresholdType=i.thresholdType),i&&i.radiusType!==void 0&&(i.radiusType==="radius"?this.radius=.1:this.radius=parseFloat(i.radiusType),n.radius=!0,this.dotType==="sphere"&&(!an||this.disableImpostor)&&(a=!0)),i&&i.radius!==void 0&&(n.radius=!0,this.dotType==="sphere"&&(!an||this.disableImpostor)&&(a=!0)),i&&i.scale!==void 0&&(n.scale=!0,this.dotType==="sphere"&&(!an||this.disableImpostor)&&(a=!0)),e.prototype.setParameters.call(this,i,n,a),this},t}(wr);Ut.add("shader/Image.vert",`uniform float clipRadius;
uniform vec3 clipCenter;
varying vec2 vUv;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
void main() {
#include begin_vertex
#include project_vertex
vUv = uv;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
}`);Ut.add("shader/Image.frag",`uniform sampler2D map;
uniform float opacity;
uniform vec2 mapSize;
uniform float clipNear;
uniform float clipRadius;
varying vec2 vUv;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
uniform sampler2D pickingMap;
uniform float objectId;
#else
#include fog_pars_fragment
#endif
#if defined( CUBIC_INTERPOLATION )
#if defined( CATMULROM_FILTER ) || defined( MITCHELL_FILTER )
#if defined( CATMULROM_FILTER )
const float B = 0.0;
const float C = 0.5;
#elif defined( MITCHELL_FILTER )
const float B = 0.333;
const float C = 0.333;
#endif
float filter( float x ){
float f = x;
if( f < 0.0 ){
f = -f;
}
if( f < 1.0 ){
return ( ( 12.0 - 9.0 * B - 6.0 * C ) * ( f * f * f ) +
( -18.0 + 12.0 * B + 6.0 *C ) * ( f * f ) +
( 6.0 - 2.0 * B ) ) / 6.0;
}else if( f >= 1.0 && f < 2.0 ){
return ( ( -B - 6.0 * C ) * ( f * f * f )
+ ( 6.0 * B + 30.0 * C ) * ( f *f ) +
( - ( 12.0 * B ) - 48.0 * C ) * f +
8.0 * B + 24.0 * C ) / 6.0;
}else{
return 0.0;
}
}
#elif defined( BSPLINE_FILTER )
float filter( float x ){
float f = x;
if( f < 0.0 ){
f = -f;
}
if( f >= 0.0 && f <= 1.0 ){
return ( 2.0 / 3.0 ) + ( 0.5 ) * ( f * f * f ) - ( f * f );
}else if( f > 1.0 && f <= 2.0 ){
return 1.0 / 6.0 * pow( ( 2.0 - f ), 3.0 );
}
return 1.0;
}
#else
float filter( float x ){
return 1.0;
}
#endif
vec4 biCubic( sampler2D tex, vec2 texCoord ){
vec2 texelSize = 1.0 / mapSize;
texCoord -= texelSize / 2.0;
vec4 nSum = vec4( 0.0 );
float nDenom = 0.0;
vec2 cell = fract( texCoord * mapSize );
for( float m = -1.0; m <= 2.0; ++m ){
for( float n = -1.0; n <= 2.0; ++n ){
vec4 vecData = texture2D(
tex, texCoord + texelSize * vec2( m, n )
);
float c = filter( m - cell.x ) * filter( -n + cell.y );
nSum += vecData * c;
nDenom += c;
}
}
return nSum / nDenom;
}
#endif
void main(){
#include nearclip_fragment
#include radiusclip_fragment
#if defined( CUBIC_INTERPOLATION )
gl_FragColor = biCubic( map, vUv );
#else
gl_FragColor = texture2D( map, vUv );
#endif
#if defined( PICKING )
if( gl_FragColor.a < 0.3 )
discard;
gl_FragColor = vec4( texture2D( pickingMap, vUv ).xyz, objectId );
#else
if( gl_FragColor.a < 0.01 )
discard;
gl_FragColor.a *= opacity;
#include fog_fragment
#endif
}`);var CC=new Uint16Array([0,1,2,1,3,2]),PC=new Float32Array([0,1,0,0,1,1,1,0]),TC=Object.assign({filter:"nearest",forceTransparent:!0},ti),EC=Object.assign({filter:{updateShader:!0,uniform:!0}},Ka),IC=function(e){function t(i,n){e.call(this,{position:i.position,index:CC,picking:i.picking},n),this.parameterTypes=EC,this.alwaysTransparent=!0,this.hasWireframe=!1,this.vertexShader="Image.vert",this.fragmentShader="Image.frag";var a=i.imageData,o=i.width,s=i.height,u=new Rn(a,o,s);u.flipY=!0,this.tex=u;for(var c=a.length,f=new Uint8Array(c),l=0;l<c;l+=4){var h=l/4;f[l]=h>>16&255,f[l+1]=h>>8&255,f[l+2]=h&255}var d=new Rn(f,o,s);d.flipY=!0,d.minFilter=vr,d.magFilter=vr,this.pickingTex=d,this.addUniforms({map:{value:u},pickingMap:{value:d},mapSize:{value:new Ee(o,s)}}),this.geometry.addAttribute("uv",new ft(PC,2))}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={defaultParameters:{configurable:!0}};return r.defaultParameters.get=function(){return TC},t.prototype.getDefines=function(n){var a=e.prototype.getDefines.call(this,n),o=this.parameters.filter;return o.startsWith("cubic")&&(a.CUBIC_INTERPOLATION=1,o.endsWith("bspline")?a.BSPLINE_FILTER=1:o.endsWith("catmulrom")?a.CATMULROM_FILTER=1:o.endsWith("mitchell")&&(a.MITCHELL_FILTER=1)),a},t.prototype.updateTexture=function(){var n=this.tex,a=this.parameters.filter;a.startsWith("cubic")?(n.minFilter=vr,n.magFilter=vr):a==="linear"?(n.minFilter=Dr,n.magFilter=Dr):(n.minFilter=vr,n.magFilter=vr),n.needsUpdate=!0,this.pickingTex.needsUpdate=!0},t.prototype.makeMaterial=function(){e.prototype.makeMaterial.call(this),this.updateTexture();var n=this.material;n.uniforms.map.value=this.tex,n.blending=$n,n.needsUpdate=!0;var a=this.wireframeMaterial;a.uniforms.map.value=this.tex,a.blending=$n,a.needsUpdate=!0;var o=this.pickingMaterial;o.uniforms.map.value=this.tex,o.uniforms.pickingMap.value=this.pickingTex,o.blending=$n,o.needsUpdate=!0},t.prototype.setUniforms=function(n){n&&n.filter!==void 0&&(this.updateTexture(),n.map=this.tex),e.prototype.setUniforms.call(this,n)},Object.defineProperties(t.prototype,r),t}(It),gp=function(t,r){var i=r||{};this.dimension=O(i.dimension,"x"),this.positionType=O(i.positionType,"percent"),this.position=O(i.position,30),this.thresholdType=O(i.thresholdType,"sigma"),this.thresholdMin=O(i.thresholdMin,-1/0),this.thresholdMax=O(i.thresholdMax,1/0),this.normalize=O(i.normalize,!1),this.volume=t};gp.prototype.getPositionFromCoordinate=function(t){var r=this.dimension,i=this.volume,n=i.matrix,a=new I().setFromMatrixPosition(n)[r],o=new I().setFromMatrixScale(n)[r],s;return r==="x"?s=i.nx:r==="y"?s=i.ny:s=i.nz,Math.round(((t-a)/(s/100)+1)/o)};gp.prototype.getData=function(t){var r=this;t=t||{};var i=this.volume,n=i.data,a=i.matrix,o;this.positionType==="coordinate"?o=this.getPositionFromCoordinate(this.position):o=this.position;function s(le){return Math.round(le/100*(o-1))}function u(le,Se,_e,ne){return(_e*i.ny*i.nx+Se*i.nx+le)*3+ne}var c=new Float32Array(4*3),f=new I,l,h,d,p,v,m=0,g=0,x=0,y=i.nx,b=i.ny,_=i.nz;function w(le,Se,_e,ne){f.set(le,Se,_e).applyMatrix4(a).toArray(c,ne)}this.dimension==="x"?(d=s(i.nx),p=i.ny-1,v=i.nz-1,l=i.nz,h=i.ny,m=d,y=m+1,w(d,0,0,0),w(d,p,0,3),w(d,0,v,6),w(d,p,v,9)):this.dimension==="y"?(d=i.nx-1,p=s(i.ny),v=i.nz-1,l=i.nz,h=i.nx,g=p,b=g+1,w(0,p,0,0),w(d,p,0,3),w(0,p,v,6),w(d,p,v,9)):this.dimension==="z"&&(d=i.nx-1,p=i.ny-1,v=s(i.nz),l=i.nx,h=i.ny,x=v,_=x+1,w(0,0,v,0),w(0,p,v,3),w(d,0,v,6),w(d,p,v,9));var A=0,S=0,M=new Uint8Array(l*h*4),E=new Float32Array(l*h),T,H;this.thresholdType==="sigma"?(T=i.getValueForSigma(this.thresholdMin),H=i.getValueForSigma(this.thresholdMax)):(T=this.thresholdMin,H=this.thresholdMax);var X=Object.assign({},t.colorParams,{volume:i});this.normalize&&(X.domain=[0,1]);var q=Tt.getScheme(X),Z=new Float32Array(3),Q=q.getScale(),N=0,D,W=0;if(this.normalize){N=1/0,D=-1/0;for(var L=g;L<b;++L)for(var U=m;U<y;++U)for(var k=x;k<_;++k){var ee=u(U,L,k,0)/3,K=n[ee];K<N&&(N=K),K>D&&(D=K)}W=D-N}for(var te=g;te<b;++te)for(var Y=m;Y<y;++Y)for(var J=x;J<_;++J){var j=u(Y,te,J,0)/3,ae=n[j];r.normalize&&(ae=(ae-N)/W),q.colorToArray(Q(ae),Z),M[A]=Math.round(Z[0]*255),M[A+1]=Math.round(Z[1]*255),M[A+2]=Math.round(Z[2]*255),M[A+3]=ae>T&&ae<H?255:0,E[S]=j,++S,A+=4}var re=new PM(E,i);return{position:c,imageData:M,width:l,height:h,picking:re}};var RC=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="slice",this.parameters=Object.assign({filter:{type:"select",buffer:!0,options:{nearest:"nearest",linear:"linear","cubic-bspline":"cubic-bspline","cubic-catmulrom":"cubic-catmulrom","cubic-mitchell":"cubic-mitchell"}},positionType:{type:"select",rebuild:!0,options:{percent:"percent",coordinate:"coordinate"}},position:{type:"range",step:.1,max:100,min:1,rebuild:!0},dimension:{type:"select",rebuild:!0,options:{x:"x",y:"y",z:"z"}},thresholdType:{type:"select",rebuild:!0,options:{value:"value",sigma:"sigma"}},thresholdMin:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdMax:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},normalize:{type:"boolean",rebuild:!0}},this.parameters,{flatShaded:null,side:null,wireframe:null,linewidth:null,colorScheme:null,roughness:null,metalness:null,diffuse:null}),this.volume=r,this.init(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=this.volume,a=i||{};a.colorDomain=O(a.colorDomain,[n.min,n.max]),a.colorScheme=O(a.colorScheme,"value"),a.colorScale=O(a.colorScale,"Spectral"),this.colorScheme="value",this.dimension=O(a.dimension,"x"),this.filter=O(a.filter,"cubic-bspline"),this.positionType=O(a.positionType,"percent"),this.position=O(a.position,30),this.thresholdType=O(a.thresholdType,"sigma"),this.thresholdMin=O(a.thresholdMin,-1/0),this.thresholdMax=O(a.thresholdMax,1/0),this.normalize=O(a.normalize,!1),e.prototype.init.call(this,a),this.build()},t.prototype.attach=function(i){var n=this;this.bufferList.forEach(function(a){n.viewer.add(a)}),this.setVisibility(this.visible),i()},t.prototype.create=function(){var i=new gp(this.volume,{positionType:this.positionType,position:this.position,dimension:this.dimension,thresholdType:this.thresholdType,thresholdMin:this.thresholdMin,thresholdMax:this.thresholdMax,normalize:this.normalize}),n=new IC(i.getData({colorParams:this.getColorParams()}),this.getBufferParams({filter:this.filter}));this.bufferList.push(n)},t}(wr);function Xl(e){fe.error("makeRepresentation: representation type "+e+" unknown")}function LC(e,t,r,i){ge&&fe.time("makeRepresentation "+e);var n;if(t instanceof ct){if(n=or.get(e),!n){Xl(e);return}}else if(t instanceof jr)if(e==="surface")n=pd;else if(e==="dot")n=Zv;else{Xl(e);return}else if(t instanceof jt)if(e==="surface")n=pd;else if(e==="dot")n=Zv;else if(e==="slice")n=RC;else{Xl(e);return}else if(t instanceof Tr)n=Xv,t=t.getBufferList();else if(e==="buffer")n=Xv;else{fe.error("makeRepresentation: object "+t+" unknown");return}var a=new n(t,r,i);return ge&&fe.timeEnd("makeRepresentation "+e),a}var yp={name:"some element",status:""},os=function(t,r){r===void 0&&(r={}),this.stage=t,this.signals={statusChanged:new ht,nameChanged:new ht,disposed:new ht},this.parameters=vi(r,this.defaultParameters),this.uuid=Nd()},bp={defaultParameters:{configurable:!0},name:{configurable:!0}};bp.defaultParameters.get=function(){return yp};bp.name.get=function(){return this.parameters.name};os.prototype.setStatus=function(t){return this.parameters.status=t,this.signals.statusChanged.dispatch(t),this};os.prototype.setName=function(t){return this.parameters.name=t,this.signals.nameChanged.dispatch(t),this};os.prototype.dispose=function(){this.signals.disposed.dispatch()};Object.defineProperties(os.prototype,bp);var OC=Object.assign({visible:!0},yp),DC=function(e){function t(i,n,a,o){a===void 0&&(a={}),e.call(this,i,Object.assign({name:n.type},a)),this.parent=o,this.signals=Object.assign({visibilityChanged:new ht,parametersChanged:new ht},this.signals),this.setRepresentation(n)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={defaultParameters:{configurable:!0},visible:{configurable:!0},type:{configurable:!0}};return r.defaultParameters.get=function(){return OC},r.visible.get=function(){return this.parameters.visible},r.type.get=function(){return"representation"},t.prototype.getType=function(){return this.repr.type},t.prototype.setRepresentation=function(n){this._disposeRepresentation(),this.repr=n,this.stage.tasks.listen(this.repr.tasks),this.updateVisibility()},t.prototype._disposeRepresentation=function(){this.repr&&(this.stage.tasks.unlisten(this.repr.tasks),this.repr.dispose())},t.prototype.dispose=function(){this.parent&&this.parent.hasRepresentation(this)?this.parent.removeRepresentation(this):(this._disposeRepresentation(),this.signals.disposed.dispatch())},t.prototype.setVisibility=function(n){return this.parameters.visible=n,this.updateVisibility(),this.signals.visibilityChanged.dispatch(this.parameters.visible),this},t.prototype.getVisibility=function(){return this.parent?this.parent.parameters.visible&&this.parameters.visible:this.parameters.visible},t.prototype.toggleVisibility=function(){return this.setVisibility(!this.parameters.visible)},t.prototype.updateVisibility=function(){this.repr.setVisibility(this.getVisibility())},t.prototype.update=function(n){return this.repr.update(n),this},t.prototype.build=function(n){return this.repr.build(n),this},t.prototype.setSelection=function(n){var a=this.repr;return a.setSelection&&a.setSelection(n),this},t.prototype.setParameters=function(n){return this.repr.setParameters(n),this.signals.parametersChanged.dispatch(this.repr.getParameters()),this},t.prototype.getParameters=function(){return this.repr.getParameters()},t.prototype.setColor=function(n){return this.repr.setColor(n),this},Object.defineProperties(t.prototype,r),t}(os),io=new Ae,FC=new I,wy={name:"",status:"",visible:!0},Yt=function(t,r,i){i===void 0&&(i={}),this.stage=t,this.object=r,this.signals={representationAdded:new ht,representationRemoved:new ht,visibilityChanged:new ht,matrixChanged:new ht,statusChanged:new ht,nameChanged:new ht,disposed:new ht},this.reprList=[],this.annotationList=[],this.matrix=new Ae,this.position=new I,this.quaternion=new er,this.scale=new I(1,1,1),this.transform=new Ae,this.parameters=vi(i,this.defaultParameters),this.uuid=Nd(),this.viewer=t.viewer,this.controls=new ol(this)},Gu={defaultParameters:{configurable:!0},name:{configurable:!0},status:{configurable:!0},visible:{configurable:!0}};Gu.defaultParameters.get=function(){return wy};Gu.name.get=function(){return this.parameters.name};Gu.status.get=function(){return this.parameters.status};Gu.visible.get=function(){return this.parameters.visible};Yt.prototype.setPosition=function(t){return Array.isArray(t)?this.position.fromArray(t):this.position.copy(t),this.updateMatrix(),this};Yt.prototype.setRotation=function(t){if(Array.isArray(t))if(t.length===3){var r=new ra().fromArray(t);this.quaternion.setFromEuler(r)}else this.quaternion.fromArray(t);else t instanceof ra?this.quaternion.setFromEuler(t):this.quaternion.copy(t);return this.updateMatrix(),this};Yt.prototype.setScale=function(t){return this.scale.set(t,t,t),this.updateMatrix(),this};Yt.prototype.setTransform=function(t){return this.transform.copy(t),this.updateMatrix(),this};Yt.prototype.updateMatrix=function(){var t=this,r=this.getCenterUntransformed(FC);this.matrix.makeTranslation(-r.x,-r.y,-r.z),io.makeRotationFromQuaternion(this.quaternion),this.matrix.premultiply(io),io.makeScale(this.scale.x,this.scale.y,this.scale.z),this.matrix.premultiply(io);var i=this.position;io.makeTranslation(i.x+r.x,i.y+r.y,i.z+r.z),this.matrix.premultiply(io),this.matrix.premultiply(this.transform),this.reprList.forEach(function(n){n.setParameters({matrix:t.matrix})}),this.stage.viewer.updateBoundingBox(),this.signals.matrixChanged.dispatch(this.matrix)};Yt.prototype.addAnnotation=function(t,r,i){var n=new pa(this,t,r,i);return this.annotationList.push(n),n};Yt.prototype.eachAnnotation=function(t){this.annotationList.slice().forEach(t)};Yt.prototype.removeAnnotation=function(t){var r=this.annotationList.indexOf(t);r!==-1&&(this.annotationList.splice(r,1),t.dispose())};Yt.prototype.removeAllAnnotations=function(){this.eachAnnotation(function(t){return t.dispose()}),this.annotationList.length=0};Yt.prototype._addRepresentation=function(t,r,i,n){n===void 0&&(n=!1);var a=i||{},o=this.stage.getParameters();a.matrix=this.matrix.clone(),a.quality=a.quality||o.quality,a.disableImpostor=O(a.disableImpostor,!o.impostor),a.useWorker=O(a.useWorker,o.workerDefault),a.visible=O(a.visible,!0);var s=Object.assign({},a,{visible:this.parameters.visible&&a.visible}),u=LC(t,r,this.viewer,s),c=new DC(this.stage,u,a,this);return n||(this.reprList.push(c),this.signals.representationAdded.dispatch(c)),c};Yt.prototype.addBufferRepresentation=function(t,r){return this._addRepresentation.call(this,"buffer",t,r)};Yt.prototype.hasRepresentation=function(t){return this.reprList.indexOf(t)!==-1};Yt.prototype.eachRepresentation=function(t){this.reprList.slice().forEach(t)};Yt.prototype.removeRepresentation=function(t){var r=this.reprList.indexOf(t);r!==-1&&(this.reprList.splice(r,1),t.dispose(),this.signals.representationRemoved.dispatch(t))};Yt.prototype.updateRepresentations=function(t){this.reprList.forEach(function(r){return r.update(t)}),this.stage.viewer.requestRender()};Yt.prototype.removeAllRepresentations=function(){this.eachRepresentation(function(t){return t.dispose()})};Yt.prototype.dispose=function(){this.removeAllAnnotations(),this.removeAllRepresentations(),delete this.annotationList,delete this.reprList,this.signals.disposed.dispatch()};Yt.prototype.setVisibility=function(t){return this.parameters.visible=t,this.eachRepresentation(function(r){return r.updateVisibility()}),this.eachAnnotation(function(r){return r.updateVisibility()}),this.signals.visibilityChanged.dispatch(t),this};Yt.prototype.setStatus=function(t){return this.parameters.status=t,this.signals.statusChanged.dispatch(t),this};Yt.prototype.setName=function(t){return this.parameters.name=t,this.signals.nameChanged.dispatch(t),this};Yt.prototype.getBox=function(){for(var t,r=[],i=arguments.length;i--;)r[i]=arguments[i];return(t=this).getBoxUntransformed.apply(t,r).clone().applyMatrix4(this.matrix)};Yt.prototype.getCenter=function(){for(var t,r=[],i=arguments.length;i--;)r[i]=arguments[i];return(t=this).getCenterUntransformed.apply(t,r).clone().applyMatrix4(this.matrix)};Yt.prototype.getZoom=function(){for(var t,r=[],i=arguments.length;i--;)r[i]=arguments[i];return this.stage.getZoomForBox((t=this).getBox.apply(t,r))};Yt.prototype.getBoxUntransformed=function(){return new ir};Yt.prototype.getCenterUntransformed=function(){return this.getBoxUntransformed().getCenter(new I)};Yt.prototype.autoView=function(t){this.stage.animationControls.zoomMove(this.getCenter(),this.getZoom(),O(t,0))};Object.defineProperties(Yt.prototype,Gu);var ss=function(t){var r=this;t===void 0&&(t=[]),this.list=t;for(var i=t.length,n=0;n<i;++n){var a=t[n];a.signals.disposed.add(r._remove,r)}},Ay={first:{configurable:!0}};ss.prototype._remove=function(t){var r=this.list.indexOf(t);r!==-1&&this.list.splice(r,1)};Ay.first.get=function(){return this.list.length>0?this.list[0]:void 0};ss.prototype.forEach=function(t){return this.list.forEach(t),this};ss.prototype.dispose=function(){return this.forEach(function(t){return t.dispose()})};Object.defineProperties(ss.prototype,Ay);var Sy=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setParameters=function(i){return this.forEach(function(n){return n.setParameters(i)})},t.prototype.setVisibility=function(i){return this.forEach(function(n){return n.setVisibility(i)})},t.prototype.setSelection=function(i){return this.forEach(function(n){return n.setSelection(i)})},t.prototype.setColor=function(i){return this.forEach(function(n){return n.setColor(i)})},t.prototype.update=function(i){return this.forEach(function(n){return n.update(i)})},t.prototype.build=function(i){return this.forEach(function(n){return n.build(i)})},t.prototype.dispose=function(i){return this.forEach(function(n){return n.dispose()})},t}(ss),BC=Object.assign({defaultStep:1,defaultTimeout:50,defaultInterpolateType:"",defaultInterpolateStep:5,defaultMode:"loop",defaultDirection:"forward",initialFrame:0},yp),NC=function(e){function t(i,n,a){var o=this;a===void 0&&(a={}),e.call(this,i,Object.assign({name:n.name},a)),this.trajectory=n,this.signals=Object.assign(this.signals,{frameChanged:new ht,playerChanged:new ht,countChanged:new ht,parametersChanged:new ht}),n.signals.frameChanged.add(function(s){o.signals.frameChanged.dispatch(s)}),n.signals.playerChanged.add(function(s){o.signals.playerChanged.dispatch(s)}),n.signals.countChanged.add(function(s){o.signals.countChanged.dispatch(s)}),a.initialFrame!==void 0&&this.setFrame(a.initialFrame)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={defaultParameters:{configurable:!0},type:{configurable:!0}};return r.defaultParameters.get=function(){return BC},r.type.get=function(){return"trajectory"},t.prototype.setFrame=function(n){this.trajectory.setFrame(n)},t.prototype.setParameters=function(n){n===void 0&&(n={}),this.trajectory.setParameters(n),this.signals.parametersChanged.dispatch(n)},t.prototype.dispose=function(){this.trajectory.dispose(),e.prototype.dispose.call(this)},Object.defineProperties(t.prototype,r),t}(os),xp=function(t,r){this.name=t,this.path=r,this.coordinates=[],this.boxes=[],this.times=[],this.timeOffset=0,this.deltaTime=1},My={type:{configurable:!0}};My.type.get=function(){return"Frames"};Object.defineProperties(xp.prototype,My);var Hu=function(t,r){this.A=new Wt(3,3),this.W=new Wt(1,3),this.U=new Wt(3,3),this.V=new Wt(3,3),this.VH=new Wt(3,3),this.R=new Wt(3,3),this.tmp=new Wt(3,3),this.c=new Wt(3,3);var i;if(t instanceof ct)i=t.atomCount;else if(t instanceof Float32Array)i=t.length/3;else return;var n;if(r instanceof ct)n=r.atomCount;else if(r instanceof Float32Array)n=r.length/3;else return;var a=Math.min(i,n),o=new Wt(3,a),s=new Wt(3,a);this.coords1t=new Wt(a,3),this.coords2t=new Wt(a,3),this.transformationMatrix=new Ae,this.c.data.set([1,0,0,0,1,0,0,0,-1]),this.prepCoords(t,o,a,!1),this.prepCoords(r,s,a,!1),this._superpose(o,s)};Hu.prototype._superpose=function(t,r){this.mean1=hd(t),this.mean2=hd(r),dd(t,this.mean1),dd(r,this.mean2),ki(this.coords1t,t),ki(this.coords2t,r),Cc(this.A,this.coords2t,this.coords1t),iy(this.A,this.W,this.U,this.V),RM(this.V,this.VH),Gl(this.R,this.U,this.VH),LM(this.R)<0&&(ge&&fe.log("R not a right handed system"),Gl(this.tmp,this.c,this.VH),Gl(this.R,this.U,this.tmp));var i=new Wt(4,4),n=new Wt(4,4),a=new Wt(4,4),o=new Wt(4,4),s=new Wt(4,4),u=new Wt(4,4),c=this.R.data,f=this.mean1,l=this.mean2;o.data.set([1,0,0,-f[0],0,1,0,-f[1],0,0,1,-f[2],0,0,0,1]),s.data.set([c[0],c[1],c[2],0,c[3],c[4],c[5],0,c[6],c[7],c[8],0,0,0,0,1]),u.data.set([1,0,0,l[0],0,1,0,l[1],0,0,1,l[2],0,0,0,1]),ki(n,o),Cc(i,s,n),ki(a,i),Cc(n,u,a),ki(i,n),this.transformationMatrix.elements=i.data};Hu.prototype.prepCoords=function(t,r,i,n){var a=0,o=r.data,s=3,u=i*3;if(n&&(u=i*4,s=4),t instanceof ct)t.eachAtom(function(c){a<u&&(o[a+0]=c.x,o[a+1]=c.y,o[a+2]=c.z,n&&(o[a+3]=1),a+=s)});else if(t instanceof Float32Array)for(;a<u;a+=s)a<u&&(o[a]=t[a],o[a+1]=t[a+1],o[a+2]=t[a+2],n&&(o[a+3]=1));else fe.warn("prepCoords: input type unknown")};Hu.prototype.transform=function(t){var r;if(t instanceof ct)r=t.atomCount;else if(t instanceof Float32Array)r=t.length/3;else return;var i=new Wt(4,r),n=new Wt(r,4);this.prepCoords(t,i,r,!0);var a=this.transformationMatrix,o=a.determinant();if(!o)return o;var s=new Wt(4,4);s.data=a.elements,IM(n,i,s);var u=0,c=n.data;if(t instanceof ct){t.eachAtom(function(v){v.x=c[u],v.y=c[u+1],v.z=c[u+2],u+=4});var f=new Ae;f.getInverse(a);var l=t.biomolDict;for(var h in l)if(l.hasOwnProperty(h)){var d=l[h];d.partList.forEach(function(v){v.matrixList.forEach(function(m){m.premultiply(a),m.multiply(f)})})}}else if(t instanceof Float32Array)for(var p=r*4;u<p;u+=4)t[u]=c[u],t[u+1]=c[u+1],t[u+2]=c[u+2];else fe.warn("transform: input type unknown");return this.transformationMatrix};var kC={step:1,timeout:50,start:0,end:0,interpolateType:"",interpolateStep:5,mode:"loop",direction:"forward"},bn=function(t,r){var i=this;r===void 0&&(r={}),this.signals={startedRunning:new ht,haltedRunning:new ht},this._run=!1,this._previousTime=0,this._currentTime=0,this._currentStep=1,t.signals.playerChanged.add(function(a){a!==i&&i.pause()},this);var n=O(t.frameCount,1);this.traj=t,this.parameters=vi(r,kC),this.parameters.end=Math.min(O(r.end,n-1),n-1),this.parameters.step=O(r.step,Math.ceil((n+1)/100)),this._currentFrame=this.parameters.start,this._direction=this.parameters.direction==="bounce"?"forward":this.parameters.direction,t.signals.countChanged.add(function(a){i.parameters.end=Math.min(O(i.parameters.end,a-1),a-1)},this),this._animate=this._animate.bind(this)},Cy={isRunning:{configurable:!0}};Cy.isRunning.get=function(){return this._run};bn.prototype.setParameters=function(t){t===void 0&&(t={}),l0(this.parameters,t),t.direction!==void 0&&this.parameters.direction!=="bounce"&&(this._direction=this.parameters.direction)};bn.prototype._animate=function(){if(this._run){this._currentTime=window.performance.now();var t=this._currentTime-this._previousTime,r=this.parameters.interpolateType?this.parameters.interpolateStep:1,i=this.parameters.timeout/r,n=this.traj;if(n&&n.frameCount&&!n.inProgress&&t>=i)if(this.parameters.interpolateType)if(this._currentStep>this.parameters.interpolateStep&&(this._currentStep=1),this._currentStep===1&&(this._currentFrame=this._nextInterpolated()),n.hasFrame(this._currentFrame)){this._currentStep+=1;var a=this._currentStep/(this.parameters.interpolateStep+1),o=this._currentFrame,s=o[0],u=o[1],c=o[2],f=o[3];n.setFrameInterpolated(s,u,c,f,a,this.parameters.interpolateType),this._previousTime=this._currentTime}else n.loadFrame(this._currentFrame);else{var l=this._next();n.hasFrame(l)?(n.setFrame(l),this._previousTime=this._currentTime):n.loadFrame(l)}window.requestAnimationFrame(this._animate)}};bn.prototype._next=function(){var t=this.parameters,r;return this._direction==="forward"?r=this.traj.currentFrame+t.step:r=this.traj.currentFrame-t.step,(r>t.end||r<t.start)&&(t.direction==="bounce"&&(this._direction==="forward"?this._direction="backward":this._direction="forward"),t.mode==="once"?(this.pause(),t.direction==="forward"?r=t.end:t.direction==="backward"||this._direction==="forward"?r=t.start:r=t.end):this._direction==="forward"?(r=t.start,t.interpolateType&&(r=Math.min(t.end,r+t.step))):(r=t.end,t.interpolateType&&(r=Math.max(t.start,r-t.step)))),r};bn.prototype._nextInterpolated=function(){var t=this.parameters,r=this._next(),i,n,a;return this._direction==="forward"?(i=Math.max(t.start,r-t.step),n=Math.max(t.start,r-2*t.step),a=Math.max(t.start,r-3*t.step)):(i=Math.min(t.end,r+t.step),n=Math.min(t.end,r+2*t.step),a=Math.min(t.end,r+3*t.step)),[r,i,n,a]};bn.prototype.toggle=function(){this._run?this.pause():this.play()};bn.prototype.play=function(){if(!this._run){this.traj.player!==this&&this.traj.setPlayer(this),this._currentStep=1;var t=this.parameters,r=this.traj.currentFrame,i=Math.ceil(r/t.step)*t.step;t.direction==="forward"&&r>=t.end?i=t.start:t.direction==="backward"&&r<=t.start&&(i=t.end),this.traj.setFrame(i),this._run=!0,this._animate(),this.signals.startedRunning.dispatch()}};bn.prototype.pause=function(){this._run=!1,this.signals.haltedRunning.dispatch()};bn.prototype.stop=function(){this.pause(),this.traj.setFrame(this.parameters.start)};Object.defineProperties(bn.prototype,Cy);function zC(e,t,r){if(!(r[0]===0||r[8]===0||r[4]===0))for(var i=e.length,n=r[0],a=r[1],o=r[2],s=t[0],u=t[1],c=t[2],f=-s+n+n/2,l=-u+a+a/2,h=-c+o+o/2,d=0;d<i;d+=3)e[d+0]=(e[d+0]+f)%n,e[d+1]=(e[d+1]+l)%a,e[d+2]=(e[d+2]+h)%o}function UC(e,t){if(!(t[0]===0||t[8]===0||t[4]===0)){for(var r=e.length,i=3;i<r;i+=3)for(var n=0;n<3;++n){var a=e[i+n]-e[i-3+n];if(Math.abs(a)>.9*t[n*3+n])if(a>0)for(var o=0;o<3;++o)e[i+o]-=t[n*3+o];else for(var s=0;s<3;++s)e[i+s]+=t[n*3+s]}return e}}function GC(e,t,r){if(!(t[0]===0||t[8]===0||t[4]===0)){for(var i=e.length,n=3;n<i;n+=3)for(var a=0;a<3;++a){var o=(e[n+a]-r[a])/t[a*3+a];Math.abs(o)>.5&&(e[n+a]-=t[a*3+a]*Math.round(o))}return e}}function HC(e,t,r){return[Bl(t,r[0],3,0,e),Bl(t,r[1],3,1,e),Bl(t,r[2],3,2,e)]}function VC(e){return[Sc(e,3,0),Sc(e,3,1),Sc(e,3,2)]}function WC(e,t,r,i,n){for(var a=e.length,o=new Float32Array(a),s=0;s<a;s+=3){var u=s+1,c=s+2;o[s]=In(i[s],r[s],t[s],e[s],n,1),o[u]=In(i[u],r[u],t[u],e[u],n,1),o[c]=In(i[c],r[c],t[c],e[c],n,1)}return o}function jC(e,t,r){for(var i=e.length,n=new Float32Array(i),a=0;a<i;a+=3){var o=a+1,s=a+2;n[a]=yi(t[a],e[a],r),n[o]=yi(t[o],e[o],r),n[s]=yi(t[s],e[s],r)}return n}var tr=function(t,r,i){var n=this;i===void 0&&(i={}),this.signals={countChanged:new ht,frameChanged:new ht,playerChanged:new ht},this.frameCache={},this.loadQueue={},this.boxCache={},this.pathCache={},this.frameCacheSize=0,this._frameCount=0,this._currentFrame=-1,this._disposed=!1,this.deltaTime=O(i.deltaTime,0),this.timeOffset=O(i.timeOffset,0),this.centerPbc=O(i.centerPbc,!1),this.removePbc=O(i.removePbc,!1),this.removePeriodicity=O(i.removePeriodicity,!1),this.superpose=O(i.superpose,!1),this.name=t.replace(/^.*[\\/]/,""),this.trajPath=t,this.selection=new Kt(O(i.sele,"backbone and not hydrogen")),this.selection.signals.stringChanged.add(function(){n.selectionIndices=n.structure.getAtomIndices(n.selection),n._resetCache(),n._saveInitialCoords(),n.setFrame(n._currentFrame)})},_p={frameCount:{configurable:!0},currentFrame:{configurable:!0}};_p.frameCount.get=function(){return this._frameCount};_p.currentFrame.get=function(){return this._currentFrame};tr.prototype._init=function(t){this.setStructure(t),this._loadFrameCount(),this.setPlayer(new bn(this))};tr.prototype._loadFrameCount=function(){};tr.prototype.setStructure=function(t){this.structure=t,this.atomCount=t.atomCount,this.backboneIndices=this._getIndices(new Kt("backbone and not hydrogen")),this._makeAtomIndices(),this._saveStructureCoords(),this.selectionIndices=this._getIndices(this.selection),this._resetCache(),this._saveInitialCoords(),this.setFrame(this._currentFrame)};tr.prototype._saveInitialCoords=function(){var t=this;this.structure.hasCoords()?(this.initialCoords=new Float32Array(this.structureCoords),this._makeSuperposeCoords()):this.frameCache[0]?(this.initialCoords=new Float32Array(this.frameCache[0]),this._makeSuperposeCoords()):this.loadFrame(0,function(){return t._saveInitialCoords()})};tr.prototype._saveStructureCoords=function(){var t={what:{position:!0}};this.structureCoords=this.structure.getAtomData(t).position};tr.prototype.setSelection=function(t){return this.selection.setString(t),this};tr.prototype._getIndices=function(t){var r=0,i=t.test,n=[];return i&&this.structure.eachAtom(function(a){i(a)&&n.push(r),r+=1}),n};tr.prototype._makeSuperposeCoords=function(){var t=this,r=this.selectionIndices.length*3;this.coords1=new Float32Array(r),this.coords2=new Float32Array(r);for(var i=this.initialCoords,n=this.coords2,a=0;a<r;a+=3){var o=t.selectionIndices[a/3]*3;n[a+0]=i[o+0],n[a+1]=i[o+1],n[a+2]=i[o+2]}};tr.prototype._makeAtomIndices=function(){fe.error("Trajectory._makeAtomIndices not implemented")};tr.prototype._resetCache=function(){this.frameCache={},this.loadQueue={},this.boxCache={},this.pathCache={},this.frameCacheSize=0,this.initialCoords=new Float32Array(0)};tr.prototype.setParameters=function(t){t===void 0&&(t={});var r=!1;t.centerPbc!==void 0&&t.centerPbc!==this.centerPbc&&(this.centerPbc=t.centerPbc,r=!0),t.removePeriodicity!==void 0&&t.removePeriodicity!==this.removePeriodicity&&(this.removePeriodicity=t.removePeriodicity,r=!0),t.removePbc!==void 0&&t.removePbc!==this.removePbc&&(this.removePbc=t.removePbc,r=!0),t.superpose!==void 0&&t.superpose!==this.superpose&&(this.superpose=t.superpose,r=!0),this.deltaTime=O(t.deltaTime,this.deltaTime),this.timeOffset=O(t.timeOffset,this.timeOffset),r&&(this._resetCache(),this.setFrame(this._currentFrame))};tr.prototype.hasFrame=function(t){var r=this;return Array.isArray(t)?t.every(function(i){return!!r.frameCache[i]}):!!this.frameCache[t]};tr.prototype.setFrame=function(t,r){var i=this;return t===void 0?this:(this.inProgress=!0,t===-1||this.frameCache[t]?(this._updateStructure(t),r&&r()):this.loadFrame(t,function(){i._updateStructure(t),r&&r()}),this)};tr.prototype._interpolate=function(t,r,i,n,a,o){var s=this.frameCache,u;o==="spline"?u=WC(s[t],s[r],s[i],s[n],a):u=jC(s[t],s[r],a),this.structure.updatePosition(u),this._currentFrame=t,this.signals.frameChanged.dispatch(t)};tr.prototype.setFrameInterpolated=function(t,r,i,n,a,o,s){var u=this;if(t===void 0)return this;var c=this.frameCache,f=[];return c[n]||f.push(n),c[i]||f.push(i),c[r]||f.push(r),c[t]||f.push(t),f.length?this.loadFrame(f,function(){u._interpolate(t,r,i,n,a,o),s&&s()}):(this._interpolate(t,r,i,n,a,o),s&&s()),this};tr.prototype.loadFrame=function(t,r){var i=this;Array.isArray(t)?t.forEach(function(n){!i.loadQueue[n]&&!i.frameCache[n]&&(i.loadQueue[n]=!0,i._loadFrame(n,function(){delete i.loadQueue[n]}))}):!this.loadQueue[t]&&!this.frameCache[t]&&(this.loadQueue[t]=!0,this._loadFrame(t,function(){delete i.loadQueue[t],r&&r()}))};tr.prototype._loadFrame=function(t,r){fe.error("Trajectory._loadFrame not implemented",t,r)};tr.prototype._updateStructure=function(t){if(this._disposed){console.error("updateStructure: traj disposed");return}t===-1?this.structureCoords&&this.structure.updatePosition(this.structureCoords):this.structure.updatePosition(this.frameCache[t]),this.structure.trajectory={name:this.trajPath,frame:t},this._currentFrame=t,this.inProgress=!1,this.signals.frameChanged.dispatch(t)};tr.prototype._doSuperpose=function(t){for(var r=this,i=this.selectionIndices.length*3,n=this.coords1,a=this.coords2,o=0;o<i;o+=3){var s=r.selectionIndices[o/3]*3;n[o+0]=t[s+0],n[o+1]=t[s+1],n[o+2]=t[s+2]}var u=new Hu(n,a);u.transform(t)};tr.prototype._process=function(t,r,i,n){if(this._setFrameCount(n),r){if(this.backboneIndices.length>0&&this.centerPbc){var a=[r[0],r[4],r[8]],o=HC(this.backboneIndices,i,a);zC(i,o,a)}if(this.removePeriodicity){var s=VC(i);GC(i,r,s)}this.removePbc&&UC(i,r)}this.selectionIndices.length>0&&this.coords1&&this.superpose&&this._doSuperpose(i),this.frameCache[t]=i,this.boxCache[t]=r,this.frameCacheSize+=1};tr.prototype._setFrameCount=function(t){t!==this._frameCount&&(this._frameCount=t,this.signals.countChanged.dispatch(t))};tr.prototype.dispose=function(){this._resetCache(),this._disposed=!0,this.player&&this.player.stop()};tr.prototype.setPlayer=function(t){this.player=t,this.signals.playerChanged.dispatch(t)};tr.prototype.getFrameTime=function(t){return this.timeOffset+t*this.deltaTime};Object.defineProperties(tr.prototype,_p);var XC=function(e){function t(i,n,a){var o=a||{};o.timeOffset=O(o.timeOffset,i.timeOffset),o.deltaTime=O(o.deltaTime,i.deltaTime),e.call(this,"",n,o),this.name=i.name,this.path=i.path,this.frames=i.coordinates,this.boxes=i.boxes,this._init(n)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"frames"},t.prototype._makeAtomIndices=function(){this.structure.type==="StructureView"?this.atomIndices=this.structure.getAtomIndices():this.atomIndices=void 0},t.prototype._loadFrame=function(n,a){var o,s=this.frames[n];if(this.atomIndices){var u=this.atomIndices,c=u.length;o=new Float32Array(c*3);for(var f=0;f<c;++f){var l=f*3,h=u[f]*3;o[l+0]=s[h+0],o[l+1]=s[h+1],o[l+2]=s[h+2]}}else o=new Float32Array(s);var d=this.boxes[n],p=this.frames.length;this._process(n,d,o,p),typeof a=="function"&&a()},t.prototype._loadFrameCount=function(){this.frames&&this._setFrameCount(this.frames.length)},Object.defineProperties(t.prototype,r),t}(tr),qC=function(e){function t(i,n,a){e.call(this,"",n,a),this._init(n)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"structure"},t.prototype._makeAtomIndices=function(){this.structure.atomSet&&this.structure.atomSet.getSize()<this.structure.atomStore.count?this.atomIndices=this.structure.getAtomIndices():this.atomIndices=void 0},t.prototype._loadFrame=function(n,a){var o,s=this.structure,u=s.frames[n];if(this.atomIndices){var c=this.atomIndices,f=c.length;o=new Float32Array(f*3);for(var l=0;l<f;++l){var h=l*3,d=c[l]*3;o[h+0]=u[d+0],o[h+1]=u[d+1],o[h+2]=u[d+2]}}else o=new Float32Array(u);var p=s.boxes[n],v=s.frames.length;this._process(n,p,o,v),typeof a=="function"&&a()},t.prototype._loadFrameCount=function(){this._setFrameCount(this.structure.frames.length)},Object.defineProperties(t.prototype,r),t}(tr),YC=function(e){function t(i,n,a){e.call(this,i,n,a),this._init(n)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"remote"},t.prototype._makeAtomIndices=function(){var n=[];if(this.structure.type==="StructureView"){for(var a=this.structure.getAtomIndices(),o=a.length,s=a[0],u=a[0],c=1;c<o;++c){var f=a[c];u+1<f&&(n.push([s,u+1]),s=f),u=f}n.push([s,u+1])}else n.push([0,this.atomCount]);this.atomIndices=n},t.prototype._loadFrame=function(n,a){var o=this,s=new XMLHttpRequest,u=Ll.getFrameUrl(this.trajPath,n),c=Ll.getFrameParams(this.trajPath,this.atomIndices);s.open("POST",u,!0),s.responseType="arraybuffer",s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.addEventListener("load",function(){var f=s.response;if(!f){fe.error("empty arrayBuffer for '"+u+"'");return}var l=new Int32Array(f,0,1)[0],h=new Float32Array(f,2*4,9),d=new Float32Array(f,11*4);o._process(n,h,d,l),typeof a=="function"&&a()},!1),s.send(c)},t.prototype._loadFrameCount=function(){var n=this,a=new XMLHttpRequest,o=Ll.getCountUrl(this.trajPath);a.open("GET",o,!0),a.addEventListener("load",function(){n._setFrameCount(parseInt(a.response))},!1),a.send()},Object.defineProperties(t.prototype,r),t}(tr);function ZC(e,t,r){var i;return e&&e instanceof xp?i=new XC(e,t,r):!e&&t.frames?i=new qC(e,t,r):i=new YC(e,t,r),i}ct.prototype.getView=function(e){return new Py(this,e)};var Py=function(e){function t(i,n){e.call(this),this.structure=i,this.selection=n,this.center=new I,this.boundingBox=new ir,this._bp=this.getBondProxy(),this._ap=this.getAtomProxy(),this._rp=this.getResidueProxy(),this._cp=this.getChainProxy(),this.selection&&this.selection.signals.stringChanged.add(this.refresh,this),this.structure.signals.refreshed.add(this.refresh,this),this.refresh()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},name:{configurable:!0},path:{configurable:!0},title:{configurable:!0},id:{configurable:!0},data:{configurable:!0},atomSetDict:{configurable:!0},biomolDict:{configurable:!0},entityList:{configurable:!0},unitcell:{configurable:!0},frames:{configurable:!0},boxes:{configurable:!0},validation:{configurable:!0},bondStore:{configurable:!0},backboneBondStore:{configurable:!0},rungBondStore:{configurable:!0},atomStore:{configurable:!0},residueStore:{configurable:!0},chainStore:{configurable:!0},modelStore:{configurable:!0},atomMap:{configurable:!0},residueMap:{configurable:!0},bondHash:{configurable:!0},spatialHash:{configurable:!0},_hasCoords:{configurable:!0}};return t.prototype.init=function(){},r.type.get=function(){return"StructureView"},r.name.get=function(){return this.structure.name},r.path.get=function(){return this.structure.path},r.title.get=function(){return this.structure.title},r.id.get=function(){return this.structure.id},r.data.get=function(){return this.structure.data},r.atomSetDict.get=function(){return this.structure.atomSetDict},r.biomolDict.get=function(){return this.structure.biomolDict},r.entityList.get=function(){return this.structure.entityList},r.unitcell.get=function(){return this.structure.unitcell},r.frames.get=function(){return this.structure.frames},r.boxes.get=function(){return this.structure.boxes},r.validation.get=function(){return this.structure.validation},r.bondStore.get=function(){return this.structure.bondStore},r.backboneBondStore.get=function(){return this.structure.backboneBondStore},r.rungBondStore.get=function(){return this.structure.rungBondStore},r.atomStore.get=function(){return this.structure.atomStore},r.residueStore.get=function(){return this.structure.residueStore},r.chainStore.get=function(){return this.structure.chainStore},r.modelStore.get=function(){return this.structure.modelStore},r.atomMap.get=function(){return this.structure.atomMap},r.residueMap.get=function(){return this.structure.residueMap},r.bondHash.get=function(){return this.structure.bondHash},r.spatialHash.get=function(){return this.structure.spatialHash},r._hasCoords.get=function(){return this.structure._hasCoords},r._hasCoords.set=function(i){this.structure._hasCoords=i},t.prototype.refresh=function(){var n=this;ge&&fe.time("StructureView.refresh"),this.atomSetCache={};var a=this.structure;if(this.selection.isAllSelection()&&a!==this&&a.atomSet&&a.bondSet){this.atomSet=a.atomSet.clone(),this.bondSet=a.bondSet.clone();for(var o in n.atomSetDict){var s=n.atomSetDict[o];n.atomSetCache["__"+o]=s.clone()}this.atomCount=a.atomCount,this.bondCount=a.bondCount,this.boundingBox.copy(a.boundingBox),this.center.copy(a.center)}else if(this.selection.isNoneSelection()&&a!==this&&a.atomSet&&a.bondSet){this.atomSet=new lt(a.atomCount),this.bondSet=new lt(a.bondCount);for(var u in n.atomSetDict)n.atomSetCache["__"+u]=new lt(a.atomCount);this.atomCount=0,this.bondCount=0,this.boundingBox.makeEmpty(),this.center.set(0,0,0)}else{this.atomSet=this.getAtomSet(this.selection,!0),a.atomSet&&(this.atomSet=this.atomSet.intersection(a.atomSet)),this.bondSet=this.getBondSet();for(var c in n.atomSetDict){var f=n.atomSetDict[c];n.atomSetCache["__"+c]=f.makeIntersection(n.atomSet)}this.atomCount=this.atomSet.getSize(),this.bondCount=this.bondSet.getSize(),this.boundingBox=this.getBoundingBox(),this.center=this.boundingBox.getCenter(new I)}ge&&fe.timeEnd("StructureView.refresh"),this.signals.refreshed.dispatch()},t.prototype.setSelection=function(n){this.selection=n,this.refresh()},t.prototype.getSelection=function(n){var a=[];n&&n.string&&a.push(n.string);var o=this.structure.getSelection();o&&o.string&&a.push(o.string),this.selection&&this.selection.string&&a.push(this.selection.string);var s="";return a.length>0&&(s="( "+a.join(" ) AND ( ")+" )"),new Kt(s)},t.prototype.getStructure=function(){return this.structure.getStructure()},t.prototype.eachBond=function(n,a){this.structure.eachBond(n,this.getSelection(a))},t.prototype.eachAtom=function(n,a){var o=this.getAtomProxy(),s=this.getAtomSet(a),u=this.atomStore.count;if(s.getSize()<u)s.forEach(function(f){o.index=f,n(o)});else for(var c=0;c<u;++c)o.index=c,n(o)},t.prototype.eachResidue=function(n,a){this.structure.eachResidue(n,this.getSelection(a))},t.prototype.eachResidueN=function(n,a){console.error("StructureView.eachResidueN() not implemented")},t.prototype.eachChain=function(n,a){this.structure.eachChain(n,this.getSelection(a))},t.prototype.eachModel=function(n,a){this.structure.eachModel(n,this.getSelection(a))},t.prototype.getAtomSet=function(n,a){a===void 0&&(a=!1);var o=this.structure.getAtomSet(n);return!a&&this.atomSet&&(o=o.makeIntersection(this.atomSet)),o},t.prototype.getAtomIndices=function(n){return this.structure.getAtomIndices(this.getSelection(n))},t.prototype.refreshPosition=function(){return this.structure.refreshPosition()},t.prototype.dispose=function(){this.selection&&this.selection.signals.stringChanged.remove(this.refresh,this),this.structure.signals.refreshed.remove(this.refresh,this),delete this.structure,delete this.atomSet,delete this.bondSet,delete this.atomCount,delete this.bondCount},Object.defineProperties(t.prototype,r),t}(ct),KC="ACDEFGHIKLMNPQRSTVWY",JC="ARNDCQEGHILKMFPSTWYVBZ?",QC=[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]],$C=[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]];function Kv(e,t){var r,i=0,n={};return t.forEach(function(a){r=0;var o={};a.forEach(function(s){o[e[r++]]=s}),n[e[i++]]=o}),n}var eP=function(){return{blosum62:Kv(JC,$C),blosum62x:Kv(KC,QC)}}(),us=function(t,r,i,n,a){i===void 0&&(i=-10),n===void 0&&(n=-1),a===void 0&&(a="blosum62"),this.seq1=t,this.seq2=r,this.gapPenalty=i,this.gapExtensionPenalty=n,a&&(this.substMatrix=eP[a])};us.prototype.initMatrices=function(){var t=this;this.n=this.seq1.length,this.m=this.seq2.length,this.score=void 0,this.ali="",this.S=[],this.V=[],this.H=[];for(var r=0;r<=this.n;++r){t.S[r]=[],t.V[r]=[],t.H[r]=[];for(var i=0;i<=this.m;++i)t.S[r][i]=0,t.V[r][i]=0,t.H[r][i]=0}for(var n=0;n<=this.n;++n)t.S[n][0]=t.gap(0),t.H[n][0]=-1/0;for(var a=0;a<=this.m;++a)t.S[0][a]=t.gap(0),t.V[0][a]=-1/0;this.S[0][0]=0};us.prototype.gap=function(t){return this.gapPenalty+t*this.gapExtensionPenalty};us.prototype.makeScoreFn=function(){var t=this.seq1,r=this.seq2,i=this.substMatrix;return i?function(a,o){var s=t[a],u=r[o];try{return i[s][u]}catch{return-4}}:(fe.warn("Alignment: no subst matrix"),function(a,o){var s=t[a],u=r[o];return s===u?5:-3})};us.prototype.calc=function(){ge&&fe.time("Alignment.calc"),this.initMatrices();for(var t=this.gap(0),r=this.makeScoreFn(),i=this.gapExtensionPenalty,n=this.V,a=this.H,o=this.S,s=this.n,u=this.m,c,f,l,h,d,p=1;p<=s;++p){f=o[p-1],c=n[p-1],l=n[p],h=a[p],d=o[p];for(var v=1;v<=u;++v)l[v]=Math.max(f[v]+t,c[v]+i),h[v]=Math.max(d[v-1]+t,h[v-1]+i),d[v]=Math.max(f[v-1]+r(p-1,v-1),l[v],h[v])}ge&&fe.timeEnd("Alignment.calc"),ge&&fe.log(this.S,this.V,this.H)};us.prototype.trace=function(){var t=this;ge&&fe.time("Alignment.trace"),this.ali1="",this.ali2="";var r=this.makeScoreFn(),i=this.n,n=this.m,a;for(this.S[i][n]>=this.V[i][n]?(a="S",this.score=this.S[i][n]):this.V[i][n]>=this.H[i][n]?(a="V",this.score=this.V[i][n]):(a="H",this.score=this.H[i][n]),ge&&fe.log("Alignment: SCORE",this.score),ge&&fe.log("Alignment: S, V, H",this.S[i][n],this.V[i][n],this.H[i][n]);i>0&&n>0;)a==="S"?t.S[i][n]===t.S[i-1][n-1]+r(i-1,n-1)?(t.ali1=t.seq1[i-1]+t.ali1,t.ali2=t.seq2[n-1]+t.ali2,--i,--n,a="S"):t.S[i][n]===t.V[i][n]?a="V":t.S[i][n]===t.H[i][n]?a="H":(--i,--n):a==="V"?t.V[i][n]===t.V[i-1][n]+t.gapExtensionPenalty?(t.ali1=t.seq1[i-1]+t.ali1,t.ali2="-"+t.ali2,--i,a="V"):t.V[i][n]===t.S[i-1][n]+t.gap(0)?(t.ali1=t.seq1[i-1]+t.ali1,t.ali2="-"+t.ali2,--i,a="S"):--i:a==="H"?t.H[i][n]===t.H[i][n-1]+t.gapExtensionPenalty?(t.ali1="-"+t.ali1,t.ali2=t.seq2[n-1]+t.ali2,--n,a="H"):t.H[i][n]===t.S[i][n-1]+t.gap(0)?(t.ali1="-"+t.ali1,t.ali2=t.seq2[n-1]+t.ali2,--n,a="S"):--n:fe.error("Alignment: no matrix");for(;i>0;)t.ali1=t.seq1[i-1]+t.ali1,t.ali2="-"+t.ali2,--i;for(;n>0;)t.ali1="-"+t.ali1,t.ali2=t.seq2[n-1]+t.ali2,--n;ge&&fe.timeEnd("Alignment.trace"),ge&&fe.log([this.ali1,this.ali2])};function tP(e,t,r,i,n){r===void 0&&(r=!1),i===void 0&&(i=""),n===void 0&&(n="");var a,o,s,u,c;if(r){var f=e,l=t;i&&n&&(f=e.getView(new Kt(i)),l=t.getView(new Kt(n)));var h=f.getSequence(),d=l.getSequence(),p=new us(h.join(""),d.join(""));p.calc(),p.trace();var v,m;a=0,o=0,s=p.ali1.length;for(var g=[],x=[],y=0;y<s;++y){var b=p.ali1[y],_=p.ali2[y];v=0,m=0,b==="-"?x[o]=!1:(x[o]=!0,v=1),_==="-"?g[a]=!1:(g[a]=!0,m=1),a+=v,o+=m}var w=[],A=[],S=f.getAtomProxy(),M=l.getAtomProxy();a=0,f.eachResidue(function(q){q.traceAtomIndex===void 0||q.traceAtomIndex!==q.getAtomIndexByName("CA")||(g[a]&&(S.index=q.getAtomIndexByName("CA"),w.push(S.x,S.y,S.z)),a+=1)}),a=0,l.eachResidue(function(q){q.traceAtomIndex===void 0||q.traceAtomIndex!==q.getAtomIndexByName("CA")||(x[a]&&(M.index=q.getAtomIndexByName("CA"),A.push(M.x,M.y,M.z)),a+=1)}),u=new Float32Array(w),c=new Float32Array(A)}else{var E=e.getView(new Kt(i+" and .CA")),T=t.getView(new Kt(n+" and .CA"));u=E,c=T}var H=new Hu(u,c),X=H.transform(e);return e.refreshPosition(),X}var rP=Object.assign({sele:"",defaultAssembly:""},wy),wp=function(e){function t(i,n,a){a===void 0&&(a={}),e.call(this,i,n,Object.assign({name:n.name},a)),this.structure=n,this.trajList=[],this.signals=Object.assign(this.signals,{trajectoryAdded:new ht,trajectoryRemoved:new ht,defaultAssemblyChanged:new ht}),this.initSelection(this.parameters.sele),this.pickBuffer=K2(4),this.pickDict=J2(),this.spacefillRepresentation=this.addRepresentation("spacefill",{sele:"none",opacity:ys.opacity,color:ys.color,disablePicking:!0,radiusType:"data"},!0),this.distanceRepresentation=this.addRepresentation("distance",ys,!0),this.angleRepresentation=this.addRepresentation("angle",ys,!0),this.dihedralRepresentation=this.addRepresentation("dihedral",ys,!0),this.measureRepresentations=new Sy([this.spacefillRepresentation,this.distanceRepresentation,this.angleRepresentation,this.dihedralRepresentation]),this.setDefaultAssembly(this.parameters.defaultAssembly)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={defaultParameters:{configurable:!0},type:{configurable:!0}};return r.defaultParameters.get=function(){return rP},r.type.get=function(){return"structure"},t.prototype.initSelection=function(n){var a=this;this.selection=new Kt(n),this.structureView=new Py(this.structure,this.selection),this.selection.signals.stringChanged.add(function(){a.structureView.setSelection(a.selection),a.rebuildRepresentations(),a.rebuildTrajectories()})},t.prototype.setSelection=function(n){return this.parameters.sele=n,this.selection.setString(n),this},t.prototype.setDefaultAssembly=function(n){if(this.structure.biomolDict[n]===void 0&&(n=""),this.parameters.defaultAssembly!==n){var a={defaultAssembly:n};this.reprList.forEach(function(o){return o.setParameters(a)}),this.measureRepresentations.setParameters(a),this.parameters.defaultAssembly=n,this.signals.defaultAssemblyChanged.dispatch(n)}return this},t.prototype.rebuildRepresentations=function(){this.reprList.forEach(function(n){n.build()}),this.measureRepresentations.build()},t.prototype.rebuildTrajectories=function(){var n=this;this.trajList.forEach(function(a){a.trajectory.setStructure(n.structureView)})},t.prototype.updateRepresentations=function(n){e.prototype.updateRepresentations.call(this,n),this.measureRepresentations.update(n)},t.prototype.addRepresentation=function(n,a,o){var s=this;a===void 0&&(a={}),o===void 0&&(o=!1),a.defaultAssembly=this.parameters.defaultAssembly;var u=this._addRepresentation(n,this.structureView,a,o);return o||u.signals.parametersChanged.add(function(){return s.measureUpdate()}),u},t.prototype.addTrajectory=function(n,a){var o=this;n===void 0&&(n=""),a===void 0&&(a={});var s=ZC(n,this.structureView,a);s.signals.frameChanged.add(function(){o.updateRepresentations({position:!0})});var u=new NC(this.stage,s,a);return this.trajList.push(u),this.signals.trajectoryAdded.dispatch(u),u},t.prototype.removeTrajectory=function(n){var a=this.trajList.indexOf(n);a!==-1&&this.trajList.splice(a,1),n.dispose(),this.signals.trajectoryRemoved.dispatch(n)},t.prototype.dispose=function(){this.trajList.slice().forEach(function(n){return n.dispose()}),this.trajList.length=0,this.structure.dispose(),this.measureRepresentations.dispose(),e.prototype.dispose.call(this)},t.prototype.autoView=function(n,a){typeof n=="number"&&(a=n,n=""),this.stage.animationControls.zoomMove(this.getCenter(n),this.getZoom(n),O(a,0))},t.prototype.getBoxUntransformed=function(n){var a;return n?a=this.structureView.getBoundingBox(new Kt(n)):a=this.structureView.boundingBox,a},t.prototype.getCenterUntransformed=function(n){return n&&typeof n=="string"?this.structure.atomCenter(new Kt(n)):this.structure.center},t.prototype.superpose=function(n,a,o,s){return tP(this.structureView,n.structureView,a,o,s),this.updateRepresentations({position:!0}),this},t.prototype.getMaxRepresentationRadius=function(n){var a=0,o=this.structure.getAtomProxy(n);return this.eachRepresentation(function(s){if(s.getVisibility()){var u=s.repr;a=Math.max(u.getAtomRadius(o),a)}}),a},t.prototype.measurePick=function(n){var a=this.pickBuffer.count;if(this.lastPick===n.index&&a>=1){if(a>1){var o=this.pickBuffer.data,s=this.pickBuffer.data.sort();this.pickDict.has(s)?this.pickDict.del(s):this.pickDict.add(s,o),a===2?this.distanceRepresentation.setParameters({atomPair:this.pickDict.values.filter(function(u){return u.length===2})}):a===3?this.angleRepresentation.setParameters({atomTriple:this.pickDict.values.filter(function(u){return u.length===3})}):a===4&&this.dihedralRepresentation.setParameters({atomQuad:this.pickDict.values.filter(function(u){return u.length===4})})}this.pickBuffer.clear(),this.lastPick=void 0}else this.pickBuffer.has(n.index)||this.pickBuffer.push(n.index),this.lastPick=n.index;this.measureUpdate()},t.prototype.measureClear=function(){this.pickBuffer.clear(),this.lastPick=void 0,this.spacefillRepresentation.setSelection("none")},t.prototype.measureBuild=function(){var n=this.measureData();this.distanceRepresentation.setParameters({atomPair:n.distance}),this.angleRepresentation.setParameters({atomTriple:n.angle}),this.dihedralRepresentation.setParameters({atomQuad:n.dihedral})},t.prototype.measureUpdate=function(){var n=this,a=this.pickBuffer.data,o={};a.forEach(function(s){var u=Math.max(.1,n.getMaxRepresentationRadius(s));o[s]=u*(2.3-Pu(.1,2,u))}),this.spacefillRepresentation.setSelection(a.length?"@"+a.join(","):"none"),this.spacefillRepresentation.setParameters({radiusData:o})},t.prototype.measureData=function(){var n=this.pickDict.values;return{distance:n.filter(function(a){return a.length===2}),angle:n.filter(function(a){return a.length===3}),dihedral:n.filter(function(a){return a.length===4})}},t.prototype.removeAllMeasurements=function(n){var a=this.pickDict,o=a.values,s=function(u){o.filter(function(c){return c.length===u}).forEach(function(c){return a.del(c.slice().sort())})};(!n||n&1)&&s(2),(!n||n&2)&&s(3),(!n||n&4)&&s(4),this.measureBuild()},t.prototype.removeMeasurement=function(n){this.pickDict.del(n.slice().sort()),this.measureBuild()},t.prototype.addMeasurement=function(n){if(!(n.length<2||n.length>4)){var a=n.slice().sort();this.pickDict.has(a)||this.pickDict.add(a,n),this.measureBuild()}},Object.defineProperties(t.prototype,r),t}(Yt);Wo.add("structure",wp);Wo.add("structureview",wp);var Ty=function(e){function t(i,n,a){a===void 0&&(a={}),e.call(this,i,n,Object.assign({name:n.name},a)),this.surface=n}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"surface"},t.prototype.addRepresentation=function(n,a){return a===void 0&&(a={}),this._addRepresentation(n,this.surface,a)},t.prototype.getBoxUntransformed=function(){return this.surface.boundingBox},t.prototype.getCenterUntransformed=function(){return this.surface.center},t.prototype.dispose=function(){this.surface.dispose(),e.prototype.dispose.call(this)},Object.defineProperties(t.prototype,r),t}(Yt);Wo.add("surface",Ty);var Ey=function(e){function t(i,n,a){a===void 0&&(a={}),e.call(this,i,n,Object.assign({name:n.name},a)),this.volume=n}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"volume"},t.prototype.addRepresentation=function(n,a){return a===void 0&&(a={}),this._addRepresentation(n,this.volume,a)},t.prototype.getBoxUntransformed=function(){return this.volume.boundingBox},t.prototype.getCenterUntransformed=function(){return this.volume.center},t.prototype.dispose=function(){this.volume.dispose(),e.prototype.dispose.call(this)},Object.defineProperties(t.prototype,r),t}(Yt);Wo.add("volume",Ey);var Iy=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addRepresentation=function(i,n){return this.forEach(function(a){return a.addRepresentation(i,n)})},t.prototype.autoView=function(i){return this.forEach(function(n){return n.autoView(i)})},t}(ss);function Ry(e,t){return e instanceof RegExp?t.name.match(e)!==null:t.name===e}var iP=new I,nP={impostor:!0,quality:"medium",workerDefault:!0,sampleLevel:0,backgroundColor:"black",rotateSpeed:2,zoomSpeed:1.2,panSpeed:1,clipNear:0,clipFar:100,clipDist:10,clipMode:"scene",clipScale:"relative",fogNear:50,fogFar:100,fogMode:"scene",fogScale:"relative",cameraFov:40,cameraEyeSep:.3,cameraType:"perspective",lightColor:14540253,lightIntensity:1,ambientColor:14540253,ambientIntensity:.2,hoverTimeout:0,tooltip:!0,mousePreset:"default"},Dt=function(t,r){r===void 0&&(r={}),this.signals={parametersChanged:new ht,fullscreenChanged:new ht,componentAdded:new ht,componentRemoved:new ht,clicked:new ht,hovered:new ht},this.tasks=new yn,this.compList=[],this.defaultFileParams={},this.logList=[],this.viewer=new St(t),this.viewer.renderer&&(this.tooltip=document.createElement("div"),Object.assign(this.tooltip.style,{display:"none",position:"fixed",zIndex:"1000000",pointerEvents:"none",backgroundColor:"rgba( 0, 0, 0, 0.6 )",color:"lightgrey",padding:"8px",fontFamily:"sans-serif"}),this.viewer.container.appendChild(this.tooltip),this.mouseObserver=new Vr(this.viewer.renderer.domElement),this.viewerControls=new ei(this),this.trackballControls=new Ei(this),this.pickingControls=new L0(this),this.animationControls=new br(this),this.mouseControls=new ts(this),this.keyControls=new rs(this),this.pickingBehavior=new al(this),this.mouseBehavior=new da(this),this.animationBehavior=new op(this),this.keyBehavior=new is(this),this.spinAnimation=this.animationControls.spin([0,1,0],.005),this.spinAnimation.pause(!0),this.rockAnimation=this.animationControls.rock([0,1,0],.005),this.rockAnimation.pause(!0),this.parameters=vi(r,nP),this.setParameters(this.parameters),this.viewer.animate())};Dt.prototype.setParameters=function(t){t===void 0&&(t={}),l0(this.parameters,t);var r=t,i=this.parameters,n=this.viewer,a=this.trackballControls;return r.quality!==void 0&&this.setQuality(i.quality),r.impostor!==void 0&&this.setImpostor(i.impostor),r.rotateSpeed!==void 0&&(a.rotateSpeed=i.rotateSpeed),r.zoomSpeed!==void 0&&(a.zoomSpeed=i.zoomSpeed),r.panSpeed!==void 0&&(a.panSpeed=i.panSpeed),r.mousePreset!==void 0&&this.mouseControls.preset(i.mousePreset),this.mouseObserver.setParameters({hoverTimeout:i.hoverTimeout}),n.setClip(i.clipNear,i.clipFar,i.clipDist,i.clipMode,i.clipScale),n.setFog(void 0,i.fogNear,i.fogFar,i.fogMode,i.fogScale),n.setCamera(i.cameraType,i.cameraFov,i.cameraEyeSep),n.setSampling(i.sampleLevel),n.setBackground(i.backgroundColor),n.setLight(i.lightColor,i.lightIntensity,i.ambientColor,i.ambientIntensity),this.signals.parametersChanged.dispatch(this.getParameters()),this};Dt.prototype.log=function(t){console.log("STAGE LOG",t),this.logList.push(t)};Dt.prototype.getParameters=function(){return Object.assign({},this.parameters)};Dt.prototype.defaultFileRepresentation=function(t){if(t instanceof wp){t.setSelection("/0");var r,i,n,a=t.structure;if(a.biomolDict.BU1){var o=a.biomolDict.BU1;r=o.getAtomCount(a),i=o.getResidueCount(a),n=o.getInstanceCount(),t.setDefaultAssembly("BU1")}else r=a.getModelProxy(0).atomCount,i=a.getModelProxy(0).residueCount,n=1;var s=r;S0&&(s*=4);var u=a.atomStore.count/a.residueStore.count<2;u&&(s*=10);var c="chainname",f="RdYlBu",l=!1;if(a.getChainnameCount(new Kt("polymer and /0"))===1&&(c="residueindex",f="spectral",l=!0),ge&&console.log(s,r,n,u),i/n<4)t.addRepresentation("ball+stick",{colorScheme:"element",radiusScale:2,aspectRatio:1.5,bondScale:.3,bondSpacing:.75,quality:"auto"});else if(n>5&&s>15e3||s>7e5){var h=Math.min(1.5,Math.max(.1,2e3/(s/n)));u&&(h=Math.min(h,.15)),t.addRepresentation("surface",{colorScheme:c,colorScale:f,colorReverse:l,sele:"polymer",surfaceType:"sas",probeRadius:1.4,scaleFactor:h,useWorker:!1})}else s>25e4?t.addRepresentation("backbone",{colorScheme:c,colorScale:f,colorReverse:l,lineOnly:!0}):s>1e5?t.addRepresentation("backbone",{colorScheme:c,colorScale:f,colorReverse:l,quality:"low",disableImpostor:!0,radiusScale:2}):s>8e4?t.addRepresentation("backbone",{colorScheme:c,colorScale:f,colorReverse:l,radiusScale:2}):(t.addRepresentation("cartoon",{colorScheme:c,colorScale:f,colorReverse:l,radiusScale:.7,aspectRatio:5,quality:"auto"}),s<5e4&&t.addRepresentation("base",{colorScheme:c,colorScale:f,colorReverse:l,quality:"auto"}),t.addRepresentation("ball+stick",{sele:"ligand",colorScheme:"element",radiusScale:2,aspectRatio:1.5,bondScale:.3,bondSpacing:.75,quality:"auto"}));t.structure.frames.length&&t.addTrajectory()}else(t instanceof Ty||t instanceof Ey)&&t.addRepresentation("surface");this.tasks.onZeroOnce(this.autoView,this)};Dt.prototype.loadFile=function(t,r){var i=this;r===void 0&&(r={});var n=Object.assign({},this.defaultFileParams,r),a=Or(t).name;this.tasks.increment(),this.log("loading file '"+a+"'");var o=function(f){i.log("loaded '"+a+"'");var l=i.addComponentFromObject(f,n);return n.defaultRepresentation&&i.defaultFileRepresentation(l),i.tasks.decrement(),l},s=function(f){i.tasks.decrement();var l="error loading file: '"+f+"'";throw i.log(l),l},u=O(n.ext,Or(t).ext),c;return ut.isTrajectory(u)?c=Promise.reject(new Error("loadFile: ext '"+u+"' is a trajectory and must be loaded into a structure component")):c=Vd(t,n),c.then(o,s)};Dt.prototype.loadScript=function(t){var r=this,i=Or(t).name;return this.log("loading script '"+i+"'"),Vd(t).then(function(n){r.tasks.increment(),r.log("running script '"+i+"'"),n.run(r).then(function(){r.tasks.decrement(),r.log("finished script '"+i+"'")}),r.log("called script '"+i+"'")},function(n){r.tasks.decrement();var a="errored script '"+i+`' "`+n+'"';throw r.log(a),a})};Dt.prototype.addComponent=function(t){if(!t){fe.warn("Stage.addComponent: no component given");return}this.compList.push(t),this.signals.componentAdded.dispatch(t)};Dt.prototype.addComponentFromObject=function(t,r){r===void 0&&(r={});var i=Wo.get(t.type);if(i){var n=new i(this,t,r);return this.addComponent(n),n}fe.warn("no component for object type",t.type)};Dt.prototype.removeComponent=function(t){var r=this.compList.indexOf(t);r!==-1&&(this.compList.splice(r,1),t.dispose(),this.signals.componentRemoved.dispatch(t))};Dt.prototype.removeAllComponents=function(){var t=this;this.compList.slice().forEach(function(r){return t.removeComponent(r)})};Dt.prototype.handleResize=function(){this.viewer.handleResize()};Dt.prototype.setSize=function(t,r){var i=this.viewer.container;i!==document.body&&(t!==void 0&&(i.style.width=t),r!==void 0&&(i.style.height=r),this.handleResize())};Dt.prototype.toggleFullscreen=function(t){if(!document.fullscreenEnabled&&!document.mozFullScreenEnabled&&!document.webkitFullscreenEnabled&&!document.msFullscreenEnabled){fe.log("fullscreen mode (currently) not possible");return}var r=this;t=t||this.viewer.container,this.lastFullscreenElement=t;function i(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function n(){if(!i()&&r.lastFullscreenElement){var a=r.lastFullscreenElement;a.style.width=a.dataset.normalWidth||"",a.style.height=a.dataset.normalHeight||"",document.removeEventListener("fullscreenchange",n),document.removeEventListener("mozfullscreenchange",n),document.removeEventListener("webkitfullscreenchange",n),document.removeEventListener("MSFullscreenChange",n),r.handleResize(),r.signals.fullscreenChanged.dispatch(!1)}}i()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():(t.dataset.normalWidth=t.style.width||"",t.dataset.normalHeight=t.style.height||"",t.style.width=window.screen.width+"px",t.style.height=window.screen.height+"px",t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen(),document.addEventListener("fullscreenchange",n),document.addEventListener("mozfullscreenchange",n),document.addEventListener("webkitfullscreenchange",n),document.addEventListener("MSFullscreenChange",n),this.handleResize(),this.signals.fullscreenChanged.dispatch(!0),setTimeout(function(){r.handleResize()},100))};Dt.prototype.setSpin=function(t){t?(this.spinAnimation.resume(!0),this.rockAnimation.pause(!0)):this.spinAnimation.pause(!0)};Dt.prototype.setRock=function(t){t?(this.rockAnimation.resume(!0),this.spinAnimation.pause(!0)):this.rockAnimation.pause(!0)};Dt.prototype.toggleSpin=function(){this.setSpin(this.spinAnimation.paused)};Dt.prototype.toggleRock=function(){this.setRock(this.rockAnimation.paused)};Dt.prototype.setFocus=function(t){var r=kd(t/2,0,49.9),i=100-r,n=(i-r)/2;this.parameters.clipMode=="scene"&&this.setParameters({clipNear:r,clipFar:i}),this.parameters.fogMode=="scene"&&this.setParameters({fogNear:mv(i-n),fogFar:mv(i+n)})};Dt.prototype.getZoomForBox=function(t){var r=t.getSize(iP),i=Math.max(r.x,r.y,r.z),n=Math.min(r.x,r.y,r.z),a=i+Math.sqrt(n),o=lr(this.viewer.perspectiveCamera.fov),s=this.viewer.width,u=this.viewer.height,c=s/u,f=u<s?1:c;return a=Math.abs(a*.5/f/Math.sin(o/2)),a+=this.parameters.clipDist,-a};Dt.prototype.getBox=function(){return this.viewer.boundingBox};Dt.prototype.getZoom=function(){return this.getZoomForBox(this.getBox())};Dt.prototype.getCenter=function(t){return this.getBox().getCenter(t||new I)};Dt.prototype.autoView=function(t){this.animationControls.zoomMove(this.getCenter(),this.getZoom(),O(t,0))};Dt.prototype.makeImage=function(t){var r=this;return t===void 0&&(t={}),new Promise(function(i,n){r.tasks.onZeroOnce(function(){r.tasks.increment(),r.viewer.makeImage(t).then(function(a){r.tasks.decrement(),i(a)}).catch(function(a){r.tasks.decrement(),n(a)})})})};Dt.prototype.setImpostor=function(t){this.parameters.impostor=t;var r=["spacefill","ball+stick","licorice","hyperball","backbone","rocket","helixorient","contact","distance","dot"];this.eachRepresentation(function(i){if(r.includes(i.getType())){var n=i.getParameters();n.disableImpostor=!t,i.build(n)}})};Dt.prototype.setQuality=function(t){this.parameters.quality=t;var r=["tube","cartoon","ribbon","trace","rope"],i=["spacefill","ball+stick","licorice","hyperball","backbone","rocket","helixorient","contact","distance","dot"];this.eachRepresentation(function(n){var a=n.getParameters();if(!r.includes(n.getType())){if(!i.includes(n.getType()))return;if(!a.disableImpostor){n.repr.quality=t;return}}a.quality=t,n.build(a)})};Dt.prototype.eachComponent=function(t,r){this.compList.slice().forEach(function(i){(r===void 0||r===i.type)&&t(i)})};Dt.prototype.eachRepresentation=function(t,r){this.eachComponent(function(i){i.reprList.slice().forEach(function(n){(r===void 0||r===n.getType())&&t(n,i)})})};Dt.prototype.getComponentsByName=function(t){var r=[];return this.eachComponent(function(i){(t===void 0||Ry(t,i))&&r.push(i)}),new Iy(r)};Dt.prototype.getComponentsByObject=function(t){var r=[];return this.eachComponent(function(i){i.object===t&&r.push(i)}),new Iy(r)};Dt.prototype.getRepresentationsByName=function(t){var r=[];return this.eachRepresentation(function(i,n){(t===void 0||Ry(t,i))&&r.push(i)}),new Sy(r)};Dt.prototype.measureClear=function(){this.eachComponent(function(t){return t.measureClear()},"structure")};Dt.prototype.measureUpdate=function(){this.eachComponent(function(t){return t.measureUpdate()},"structure")};Dt.prototype.dispose=function(){this.tasks.dispose(),this.viewer.dispose()};var aP=function(e){function t(i,n,a){a===void 0&&(a={}),e.call(this,i,n,Object.assign({name:n.name},a)),this.shape=n}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"shape"},t.prototype.addRepresentation=function(n,a){return a===void 0&&(a={}),this._addRepresentation(n,this.shape,a)},t.prototype.getBoxUntransformed=function(){return this.shape.boundingBox},t.prototype.getCenterUntransformed=function(){return this.shape.center},t.prototype.dispose=function(){this.shape.dispose(),e.prototype.dispose.call(this)},Object.defineProperties(t.prototype,r),t}(Yt);Wo.add("shape",aP);var oP=function(e){function t(r){var i=this;e.call(this,r),r.scale||(this.parameters.scale="rainbow",this.parameters.reverse=O(r.reverse,!0)),this.scalePerModel={},r.structure.eachModel(function(n){i.parameters.domain=[n.atomOffset,n.atomEnd],i.scalePerModel[n.index]=i.getScale()})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(i){return this.scalePerModel[i.modelIndex](i.index)},t}(Lt);Tt.add("atomindex",oP);var sP=function(e){function t(r){if(e.call(this,r),r.scale||(this.parameters.scale="OrRd"),!r.domain){var i,n=1/0,a=-1/0;r.sele&&(i=new Kt(r.sele)),r.structure.eachAtom(function(o){var s=o.bfactor;n=Math.min(n,s),a=Math.max(a,s)},i),this.parameters.domain=[n,a]}this.bfactorScale=this.getScale()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(i){return this.bfactorScale(i.bfactor)},t}(Lt);Tt.add("bfactor",sP);var uP=function(e){function t(r){var i=this;e.call(this,r),this.chainidDictPerModel={},this.scalePerModel={},r.scale||(this.parameters.scale="Spectral"),r.structure.eachModel(function(n){var a=0,o={};n.eachChain(function(s){o[s.chainid]===void 0&&(o[s.chainid]=a,a+=1)}),i.parameters.domain=[0,a-1],i.chainidDictPerModel[n.index]=o,i.scalePerModel[n.index]=i.getScale()})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(i){var n=this.chainidDictPerModel[i.modelIndex];return this.scalePerModel[i.modelIndex](n[i.chainid])},t}(Lt);Tt.add("chainid",uP);var cP=function(e){function t(r){var i=this;e.call(this,r),this.scalePerModel={},r.scale||(this.parameters.scale="Spectral"),r.structure.eachModel(function(n){i.parameters.domain=[n.chainOffset,n.chainEnd],i.scalePerModel[n.index]=i.getScale()})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(i){return this.scalePerModel[i.modelIndex](i.chainIndex)},t}(Lt);Tt.add("chainindex",cP);var fP=function(e){function t(r){var i=this;e.call(this,r),this.chainnameDictPerModel={},this.scalePerModel={},r.scale||(this.parameters.scale="Spectral"),r.structure.eachModel(function(n){var a=0,o={};n.eachChain(function(s){o[s.chainname]===void 0&&(o[s.chainname]=a,a+=1)}),i.parameters.domain=[0,a-1],i.chainnameDictPerModel[n.index]=o,i.scalePerModel[n.index]=i.getScale()})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(i){var n=this.chainnameDictPerModel[i.modelIndex];return this.scalePerModel[i.modelIndex](n[i.chainname])},t}(Lt);Tt.add("chainname",fP);var lP=function(e){function t(r){e.call(this,r),this.rsrzDict={},this.rsccDict={},r.scale||(this.parameters.scale="RdYlBu"),this.rsrzScale=this.getScale({domain:[2,0]}),this.rsccScale=this.getScale({domain:[.678,1]});var i=r.structure.validation;i&&(this.rsrzDict=i.rsrzDict,this.rsccDict=i.rsccDict)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(i){var n=i.resno+"";i.inscode&&(n+="^"+i.inscode),i.chainname&&(n+=":"+i.chainname),n+="/"+i.modelIndex;var a=this.rsrzDict[n];if(a!==void 0)return this.rsrzScale(a);var o=this.rsccDict[n];return o!==void 0?this.rsccScale(o):9474192},t}(Lt);Tt.add("densityfit",lP);var ql={ARG:{CD:.1,CZ:.5,NE:-.1},ASN:{CG:.55,OD1:-.55},ASP:{CB:-.16,CG:.36,OD1:-.6,OD2:-.6},CYS:{CB:.19,SG:-.19},GLN:{CD:.55,OE1:-.55},GLU:{CD:.36,CG:-.16,OE1:-.6,OE2:-.6},HIS:{CB:.1,CD2:.2,CE1:.45,CG:.15,ND1:.05,NE2:.05},LYS:{CE:.25,NZ:.75},MET:{CE:.06,CG:.06,SD:-.12},PTR:{C:.55,CA:.1,CZ:.25,N:-.35,O:-.55,O1P:-.85,O2P:-.85,O3P:-.85,OG1:-1.1,P:1.4},SEP:{C:.55,CA:.1,CB:.25,N:-.35,O:-.55,O1P:-.85,O2P:-.85,O3P:-.85,OG1:-1.1,P:1.4},SER:{CB:.25,OG:-.25},THR:{CB:.25,OG1:-.25},TPO:{C:.55,CA:.1,CB:.25,N:-.35,O:-.55,OG1:-1.1,O1P:-.85,O2P:-.85,O3P:-.85,P:1.4},TRP:{CD1:.06,CD2:.1,CE2:-.04,CE3:-.03,CG:-.03,NE1:-.06},TYR:{CZ:.25,OH:-.25},backbone:{C:.55,O:-.55,N:-.35,CA:.1}},Jv=12,Ly=1.04,hP=.25;function dP(e,t){t===void 0&&(t=new I);var r=!1,i=!1,n=!1;if(t.set(2*e.x,2*e.y,2*e.z),e.eachBondedAtom(function(a){if(!r){if(a.atomname==="H"){t.set(a.x,a.y,a.z),r=!0;return}!i&&a.atomname==="CA"?(t.sub(a),i=!0):!n&&a.atomname==="C"&&(n=!0,t.sub(a))}}),r)return t;if(i&&n)return t.normalize(),t.multiplyScalar(Ly),t.add(e),t}function pP(e){for(var t=e.length,r=new Float32Array(t),i=new Float32Array(t),n=new Float32Array(t),a=0;a<e.length;a++){var o=e[a];r[a]=o.x,i[a]=o.y,n[a]=o.z}return{x:r,y:i,z:n,count:t}}function vP(e){return e.partialCharge!==null?e.partialCharge:e.isProtein()&&(ql[e.resname]&&ql[e.resname][e.atomname]||ql.backbone[e.atomname])||0}var mP=function(e){function t(r){var i=this;e.call(this,r),this.delta=new I,this.hCharges=[],r.scale||(this.parameters.scale="rwb"),r.domain||(this.parameters.domain=[-50,50]),this.scale=this.getScale(),this.charges=new Float32Array(r.structure.atomCount);var n=[];r.structure.eachAtom(function(o){if(i.charges[o.index]=vP(o)*o.occupancy,o.atomname==="N"){if(o.bondCount>=3||o.bondToElementCount(1))return;var s=dP(o);s!==void 0&&(n.push(s),i.hCharges.push(hP*o.occupancy))}});var a=r.structure.getBoundingBox();a.expandByScalar(Ly),this.hStore=pP(n),this.hHash=new Ha(this.hStore,a),this.hash=new Ha(r.structure.atomStore,a)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.positionColor=function(i){var n=this.charges,a=this.hCharges,o=0;return this.hash.eachWithin(i.x,i.y,i.z,Jv,function(s,u){var c=n[s];c!==0&&(o+=c/u)}),this.hHash.eachWithin(i.x,i.y,i.z,Jv,function(s,u){var c=a[s];c!==0&&(o+=c/u)}),this.scale(o*332)},t}(Lt);Tt.add("electrostatic",mP);var Qv={H:16777215,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215,D:16777152,T:16777120},gP=16777215,yP=function(e){function t(r){r.value=O(r.value,Qv.C),e.call(this,r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(i){var n=i.element;return n==="C"?this.parameters.value:Qv[n]||gP},t}(Lt);Tt.add("element",yP);var bP=function(e){function t(r){e.call(this,r),r.scale||(this.parameters.scale="Spectral"),r.domain||(this.parameters.domain=[0,r.structure.entityList.length-1]),this.entityindexScale=this.getScale()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(i){return this.entityindexScale(i.entityIndex)},t}(Lt);Tt.add("entityindex",bP);var xP=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(i){var n=i.entity,a=n?n.entityType:void 0;switch(a){case Qf:return 8374655;case $f:return 16629894;case el:return 12496596;case tl:return 3697840;default:return 16777113}},t}(Lt);Tt.add("entitytype",xP);var _P=function(e){function t(r){e.call(this,r),this.geoAtomDict={},this.geoDict={};var i=r.structure.validation;i&&(this.geoAtomDict=i.geoAtomDict,this.geoDict=i.geoDict)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(i){var n=i.resno+"";i.inscode&&(n+="^"+i.inscode),i.chainname&&(n+=":"+i.chainname),n+="/"+i.modelIndex;var a,o=this.geoAtomDict[n];if(o!==void 0){var s=o[i.atomname]||0;a=eA(s)}else a=this.geoDict[n]||0;return a===0?2188972:a===1?16703627:a===2?16018755:a>=3?10813478:9474192},t}(Lt);Tt.add("geoquality",_P);var wP=function(e){function t(r){var i=this;e.call(this,r),this.resHF={},r.scale||(this.parameters.scale="RdYlGn");var n=0;for(var a in Fv)i.resHF[a]=Fv[a][n];if(this.defaultResidueHydrophobicity=QS[n],!r.domain){var o=1/0,s=-1/0;for(var u in i.resHF){var c=i.resHF[u];o=Math.min(o,c),s=Math.max(s,c)}this.parameters.domain=[o,0,s]}this.hfScale=this.getScale()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(i){return this.hfScale(this.resHF[i.resname]||this.defaultResidueHydrophobicity)},t}(Lt);Tt.add("hydrophobicity",wP);var AP=function(e){function t(r){e.call(this,r),r.scale||(this.parameters.scale="rainbow"),r.domain||(this.parameters.domain=[0,r.structure.modelStore.count]),this.modelindexScale=this.getScale()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(i){return this.modelindexScale(i.modelIndex)},t}(Lt);Tt.add("modelindex",AP);var SP=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(i){switch(i.residueType.moleculeType){case rl:return 3697840;case il:return 15729279;case Ya:return 12496596;case Un:return 16629894;case Gn:return 12540695;case nl:return 8374655;default:return 16777113}},t}(Lt);Tt.add("moleculetype",SP);var MP=function(e){function t(r){e.call(this,r),r.scale||(this.parameters.scale="PuBu"),r.domain||(this.parameters.domain=[0,1]),this.occupancyScale=this.getScale()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(i){return this.occupancyScale(i.occupancy)},t}(Lt);Tt.add("occupancy",MP);var CP=function(e){function t(r){e.call(this,r),r.scale||(this.parameters.scale="rwb"),r.domain||(this.parameters.domain=[-1,1]),this.partialchargeScale=this.getScale()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(i){return this.partialchargeScale(i.partialCharge||0)},t}(Lt);Tt.add("partialcharge",CP);function Yl(){return Math.random()*16777215}var PP=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(){return Yl()},t.prototype.volumeColor=function(){return Yl()},t.prototype.positionColor=function(){return Yl()},t}(Lt);Tt.add("random",PP);var TP=function(e){function t(r){e.call(this,r),this.rciDict={},r.scale||(this.parameters.scale="RdYlBu"),this.rciScale=this.getScale({domain:[.6,0]});var i=r.structure.validation;i&&(this.rciDict=i.rciDict)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(i){var n="["+i.resname+"]"+i.resno;i.chainname&&(n+=":"+i.chainname);var a=this.rciDict[n];return a!==void 0?this.rciScale(a):9474192},t}(Lt);Tt.add("randomcoilindex",TP);var EP=function(e){function t(r){var i=this;e.call(this,r),this.scalePerChain={},r.scale||(this.parameters.scale="rainbow",this.parameters.reverse=O(r.reverse,!0)),r.structure.eachChain(function(n){i.parameters.domain=[n.residueOffset,n.residueEnd],i.scalePerChain[n.index]=i.getScale()})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(i){return this.scalePerChain[i.chainIndex](i.residueIndex)},t}(Lt);Tt.add("residueindex",EP);var IP={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:16777215,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,ASX:16711935,GLX:16711935,ASH:16711935,GLH:16711935,A:14423100,G:3329330,I:10145074,X:8190976,C:16766720,T:4286945,U:4251856,D:35723,DA:14423100,DG:3329330,DI:10145074,DX:8190976,DC:16766720,DT:4286945,DU:4251856,DD:35723},RP=16711935,LP=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(i){return IP[i.resname]||RP},t}(Lt);Tt.add("resname",LP);var Mn={alphaHelix:16711808,threeTenHelix:10485888,piHelix:6291584,betaStrand:16762880,betaTurn:6324479,coil:16777215,dna:11403518,rna:16580962,carbohydrate:10921722},OP=8421504,DP=function(e){function t(r){e.call(this,r),this.residueProxy=r.structure.getResidueProxy()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(i){var n=i.sstruc,a=this.residueProxy;return n==="h"?Mn.alphaHelix:n==="g"?Mn.threeTenHelix:n==="i"?Mn.piHelix:n==="e"||n==="b"?Mn.betaStrand:n==="t"?Mn.betaTurn:(a.index=i.residueIndex,a.isDna()?Mn.dna:a.isRna()?Mn.rna:a.isSaccharide()?Mn.carbohydrate:a.isProtein()||n==="s"||n==="l"?Mn.coil:OP)},t}(Lt);Tt.add("sstruc",DP);var FP=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(){return this.parameters.value},t.prototype.bondColor=function(){return this.parameters.value},t.prototype.valueColor=function(){return this.parameters.value},t.prototype.volumeColor=function(){return this.parameters.value},t}(Lt);Tt.add("uniform",FP);var BP=function(e){function t(r){e.call(this,r),this.valueScale=this.getScale()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.volumeColor=function(i){return this.valueScale(this.parameters.volume.data[i])},t}(Lt);Tt.add("value",BP);var NP=function(e){function t(r){e.call(this,r),this.vec=new I,this.valueScale=this.getScale()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.positionColor=function(i){var n=this.parameters.volume;if(!n||!n.inverseMatrix)return this.parameters.value;var a=this.vec,o=n.data,s=n.nx,u=n.ny,c=s*u;a.copy(i),a.applyMatrix4(n.inverseMatrix);var f=Math.floor(a.x),l=Math.floor(a.y),h=Math.floor(a.z),d=(h*u+l)*s+f,p=d+1,v=d+s,m=d+c,g=v+1,x=m+1,y=v+c,b=y+1,_=o[d],w=o[p],A=o[v],S=o[m],M=o[g],E=o[x],T=o[y],H=o[b],X=a.x-f,q=a.y-l,Z=a.z-h,Q=yi(_,w,X),N=yi(S,E,X),D=yi(A,M,X),W=yi(T,H,X),L=yi(Q,D,q),U=yi(N,W,q),k=yi(L,U,Z);return this.valueScale(k)},t}(Lt);Tt.add("volume",NP);var Xr=function(e){function t(i,n,a){var o=a||{};if(e.call(this,i,n,o),this.type="structure",this.parameters=Object.assign({radiusType:{type:"select",options:pn.types},radiusData:{type:"hidden"},radiusSize:{type:"number",precision:3,max:10,min:.001},radiusScale:{type:"number",precision:3,max:10,min:.001},assembly:null,defaultAssembly:{type:"hidden"}},this.parameters),this.selection=new Kt(o.sele),this.dataList=[],this.structure=i,this.structureView=this.structure.getView(this.selection),i.biomolDict){var s={default:"default","":i.unitcell?"AU":"FULL"};Object.keys(i.biomolDict).forEach(function(u){s[u]=u}),this.parameters.assembly={type:"select",options:s,rebuild:!0}}else this.parameters.assembly=null}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={defaultScale:{configurable:!0}};return r.defaultScale.get=function(){return{vdw:1,covalent:1,bfactor:.01,sstruc:1}},t.prototype.init=function(n){var a=this,o=n||{};o.colorScheme=O(o.colorScheme,"element"),this.setRadius(o.radius,o),this.radiusType=O(o.radiusType,"vdw"),this.radiusData=O(o.radiusData,{}),this.radiusSize=O(o.radiusSize,1),this.radiusScale=O(o.radiusScale,1),this.assembly=O(o.assembly,"default"),this.defaultAssembly=O(o.defaultAssembly,""),o.quality==="auto"&&(o.quality=this.getQuality()),e.prototype.init.call(this,o),this.selection.signals.stringChanged.add(function(){a.build()}),this.build()},t.prototype.setRadius=function(n,a){var o=Object.keys(dy);return typeof n=="string"&&o.includes(n.toLowerCase())?a.radiusType=n:n!==void 0&&(a.radiusType="size",a.radiusSize=n),this},t.prototype.getAssembly=function(){var n=this.assembly==="default"?this.defaultAssembly:this.assembly;return this.structure.biomolDict[n]},t.prototype.getQuality=function(){var n,a=this.structureView,o=this.getAssembly();o?n=o.getAtomCount(a):n=a.atomCount,S0&&(n*=4);var s=a.atomStore.count/a.residueStore.count<2;return s&&(n*=10),n<15e3?"high":n<8e4?"medium":"low"},t.prototype.create=function(){var n=this;if(this.structureView.atomCount!==0){if(this.structureView.hasCoords())this.needsBuild=!1;else{this.needsBuild=!0;return}var a=this.getAssembly();if(a)a.partList.forEach(function(s,u){var c=s.getView(n.structureView);if(c.atomCount!==0){var f=n.createData(c,u);f&&(f.sview=c,f.instanceList=s.getInstanceList(),n.dataList.push(f))}});else{var o=this.createData(this.structureView,0);o&&(o.sview=this.structureView,this.dataList.push(o))}}},t.prototype.update=function(n){var a=this;if(this.lazy&&!this.visible){Object.assign(this.lazyProps.what,n);return}if(this.needsBuild){this.build();return}this.dataList.forEach(function(o){o.bufferList.length>0&&a.updateData(n,o)},this)},t.prototype.updateData=function(n,a){this.build()},t.prototype.getColorParams=function(){return Object.assign({},e.prototype.getColorParams.call(this),{structure:this.structure})},t.prototype.getRadiusParams=function(n){return{type:this.radiusType,scale:this.radiusScale,size:this.radiusSize,data:this.radiusData}},t.prototype.getAtomParams=function(n,a){return Object.assign({what:n,colorParams:this.getColorParams(),radiusParams:this.getRadiusParams()},a)},t.prototype.getBondParams=function(n,a){return Object.assign({what:n,colorParams:this.getColorParams(),radiusParams:this.getRadiusParams()},a)},t.prototype.getAtomRadius=function(n){if(this.structureView.atomSet.isSet(n.index)){var a=new pn(this.getRadiusParams());return a.atomRadius(n)}return 0},t.prototype.setSelection=function(n,a){return this.selection.setString(n,a),this},t.prototype.setParameters=function(n,a,o){a===void 0&&(a={}),o===void 0&&(o=!1);var s=n||{};return this.setRadius(s.radius,s),(s.radiusType!==void 0||s.radiusData!==void 0||s.radiusSize!==void 0||s.radiusScale!==void 0)&&(a.radius=!0,(!an||this.disableImpostor)&&(o=!0)),s.defaultAssembly!==void 0&&s.defaultAssembly!==this.defaultAssembly&&(this.assembly==="default"&&s.assembly===void 0||s.assembly==="default")&&(o=!0),e.prototype.setParameters.call(this,s,a,o),this},t.prototype.getParameters=function(){var n=Object.assign(e.prototype.getParameters.call(this),{sele:this.selection?this.selection.string:void 0,defaultAssembly:this.defaultAssembly});return n},t.prototype.attach=function(n){var a=this.viewer,o=this.bufferList;this.dataList.forEach(function(s){s.bufferList.forEach(function(u){o.push(u),a.add(u,s.instanceList)})}),this.setVisibility(this.visible),n()},t.prototype.clear=function(){this.dataList.length=0,e.prototype.clear.call(this)},t.prototype.dispose=function(){this.structureView.dispose(),delete this.structure,delete this.structureView,e.prototype.dispose.call(this)},Object.defineProperties(t.prototype,r),t}(wr),Ap=function(e){function t(r,i,n){e.call(this,r,i,n),this.n=0,this.parameters=Object.assign({labelVisible:{type:"boolean"},labelSize:{type:"number",precision:3,max:10,min:.001},labelColor:{type:"color"},labelFontFamily:{type:"select",options:{"sans-serif":"sans-serif",monospace:"monospace",serif:"serif"},buffer:"fontFamily"},labelFontStyle:{type:"select",options:{normal:"normal",italic:"italic"},buffer:"fontStyle"},labelFontWeight:{type:"select",options:{normal:"normal",bold:"bold"},buffer:"fontWeight"},labelsdf:{type:"boolean",buffer:"sdf"},labelXOffset:{type:"number",precision:1,max:20,min:-20,buffer:"xOffset"},labelYOffset:{type:"number",precision:1,max:20,min:-20,buffer:"yOffset"},labelZOffset:{type:"number",precision:1,max:20,min:-20,buffer:"zOffset"},labelAttachment:{type:"select",options:{"bottom-left":"bottom-left","bottom-center":"bottom-center","bottom-right":"bottom-right","middle-left":"middle-left","middle-center":"middle-center","middle-right":"middle-right","top-left":"top-left","top-center":"top-center","top-right":"top-right"},rebuild:!0},labelBorder:{type:"boolean",buffer:"showBorder"},labelBorderColor:{type:"color",buffer:"borderColor"},labelBorderWidth:{type:"number",precision:2,max:.3,min:0,buffer:"borderWidth"},labelBackground:{type:"boolean",rebuild:!0},labelBackgroundColor:{type:"color",buffer:"backgroundColor"},labelBackgroundMargin:{type:"number",precision:2,max:2,min:0,rebuild:!0},labelBackgroundOpacity:{type:"range",step:.01,max:1,min:0,buffer:"backgroundOpacity"},labelFixedSize:{type:"boolean",buffer:"fixedSize"},lineOpacity:{type:"range",min:0,max:1,step:.01},linewidth:{type:"integer",max:50,min:1,buffer:!0}},this.parameters,{flatShaded:null})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};this.labelVisible=O(n.labelVisible,!0),this.labelSize=O(n.labelSize,2),this.labelColor=O(n.labelColor,16777215),this.labelFontFamily=O(n.labelFontFamily,"sans-serif"),this.labelFontStyle=O(n.labelFontstyle,"normal"),this.labelFontWeight=O(n.labelFontWeight,"bold"),this.labelsdf=O(n.labelsdf,w0==="Chrome"),this.labelXOffset=O(n.labelXOffset,0),this.labelYOffset=O(n.labelYOffset,0),this.labelZOffset=O(n.labelZOffset,.5),this.labelAttachment=O(n.labelAttachment,"bottom-left"),this.labelBorder=O(n.labelBorder,!1),this.labelBorderColor=O(n.labelBorderColor,"lightgrey"),this.labelBorderWidth=O(n.labelBorderWidth,.15),this.labelBackground=O(n.labelBackground,!1),this.labelBackgroundColor=O(n.labelBackgroundColor,"lightgrey"),this.labelBackgroundMargin=O(n.labelBackgroundMargin,.5),this.labelBackgroundOpacity=O(n.labelBackgroundOpacity,1),this.labelFixedSize=O(n.labelFixedSize,!1),this.lineOpacity=O(n.lineOpacity,1),this.linewidth=O(n.linewidth,2),e.prototype.init.call(this,n)},t.prototype.update=function(i){i.position?this.build():e.prototype.update.call(this,i)},t.prototype.updateData=function(i,n){var a={};if((!i||i.labelSize)&&Object.assign(a,{size:pi(this.n,this.labelSize)}),!i||i.labelColor){var o=new Oe(this.labelColor);Object.assign(a,{color:Qt(this.n,o.r,o.g,o.b)})}this.textBuffer.setAttributes(a)},t.prototype.setParameters=function(i,n,a){return n===void 0&&(n={}),a===void 0&&(a=!1),i&&i.labelSize&&(n.labelSize=!0),i&&(i.labelColor||i.labelColor===0)&&(n.labelColor=!0),e.prototype.setParameters.call(this,i,n,a),i&&i.opacity!==void 0&&this.textBuffer.setParameters({opacity:1}),i&&i.labelVisible!==void 0&&this.setVisibility(this.visible),this},t.prototype.setVisibility=function(i,n){return e.prototype.setVisibility.call(this,i,!0),this.textBuffer&&this.textBuffer.setVisibility(this.labelVisible&&this.visible),n||this.viewer.requestRender(),this},t.prototype.getLabelBufferParams=function(i){return i===void 0&&(i={}),e.prototype.getBufferParams.call(this,Object.assign({fontFamily:this.labelFontFamily,fontStyle:this.labelFontStyle,fontWeight:this.labelFontWeight,sdf:this.labelsdf,xOffset:this.labelXOffset,yOffset:this.labelYOffset,zOffset:this.labelZOffset,attachment:this.labelAttachment,showBorder:this.labelBorder,borderColor:this.labelBorderColor,borderWidth:this.labelBorderWidth,showBackground:this.labelBackground,backgroundColor:this.labelBackgroundColor,backgroundMargin:this.labelBackgroundMargin,backgroundOpacity:this.labelBackgroundOpacity,fixedSize:this.labelFixedSize,disablePicking:!0,visible:this.labelVisible},i,{opacity:1}))},t.prototype.getAtomRadius=function(){return 0},t}(Xr);function Oy(e,t){var r=e.getAtomProxy(),i=new Kt,n=t.length;if(n===0)return new Float32Array(0);var a=t[0].length,o=e.getAtomSet(),s=new Float32Array(n*a*3),u=0;return t.forEach(function(c){for(var f=!1,l=0;l<a;l++){var h=c[l];if(typeof h=="number"&&Number.isInteger(h))if(o.get(h))r.index=h;else{f=!0;break}else{i.setString(h);var d=e.getAtomIndices(i);if(d.length)r.index=d[0];else{f=!0;break}}var p=u+l*3;s[p++]=r.x,s[p++]=r.y,s[p++]=r.z}f||(u+=3*a)}),s.subarray(0,u)}function Cf(e,t,r,i,n){var a=Math.cos(n),o=Math.sin(n);e[0]=t[0]+r[0]*a+i[0]*o,e[1]=t[1]+r[1]*a+i[1]*o,e[2]=t[2]+r[2]*a+i[2]*o}Ut.add("shader/SDFFont.vert",`uniform float clipNear;
uniform float clipRadius;
uniform vec3 clipCenter;
uniform float xOffset;
uniform float yOffset;
uniform float zOffset;
uniform bool ortho;
uniform float canvasHeight;
uniform float pixelRatio;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
varying vec3 vViewPosition;
#endif
varying vec2 texCoord;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
#endif
attribute vec2 mapping;
attribute vec2 inputTexCoord;
attribute float inputSize;
#include matrix_scale
#include common
void main(void){
#if defined( PICKING )
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#endif
texCoord = inputTexCoord;
float scale = matrixScale( modelViewMatrix );
float _xOffset = xOffset * scale;
float _yOffset = yOffset * scale;
float _zOffset = zOffset * scale;
if( texCoord.x == 10.0 ){
_zOffset -= 0.001;
}
vec4 cameraPos = modelViewMatrix * vec4( position, 1.0 );
#ifdef FIXED_SIZE
if ( ortho ) {
scale /= pixelRatio * (( canvasHeight / 2.0 ) / -cameraPosition.z) * 0.1;
} else {
scale /= pixelRatio * (( canvasHeight / 2.0 ) / -cameraPos.z) * 0.1;
}
#endif
vec4 cameraCornerPos = vec4( cameraPos.xyz, 1.0 );
cameraCornerPos.xy += mapping * inputSize * 0.01 * scale;
cameraCornerPos.x += _xOffset;
cameraCornerPos.y += _yOffset;
if( ortho ){
cameraCornerPos.xyz += normalize( -cameraPosition ) * _zOffset;
} else {
cameraCornerPos.xyz += normalize( -cameraCornerPos.xyz ) * _zOffset;
}
gl_Position = projectionMatrix * cameraCornerPos;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
vViewPosition = -cameraCornerPos.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
#include radiusclip_vertex
}`);Ut.add("shader/SDFFont.frag",`uniform sampler2D fontTexture;
uniform float opacity;
uniform bool showBorder;
uniform vec3 borderColor;
uniform float borderWidth;
uniform vec3 backgroundColor;
uniform float backgroundOpacity;
uniform float clipNear;
uniform float clipRadius;
varying vec3 vViewPosition;
varying vec2 texCoord;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
uniform float objectId;
varying vec3 vPickingColor;
const vec3 vColor = vec3( 0.0 );
#else
#include common
#include color_pars_fragment
#include fog_pars_fragment
#endif
const float gamma = 2.2 * 1.4142 / 128.0;
const float padding = 0.75;
void main(){
#include nearclip_fragment
#include radiusclip_fragment
if( texCoord.x > 1.0 ){
gl_FragColor = vec4( backgroundColor, backgroundOpacity );
}else{
float sdf = texture2D( fontTexture, texCoord ).a;
if( showBorder ) sdf += borderWidth;
float a = smoothstep(padding - gamma, padding + gamma, sdf);
if( a < 0.2 ) discard;
a *= opacity;
vec3 outgoingLight = vColor;
if( showBorder && sdf < ( padding + borderWidth ) ){
outgoingLight = borderColor;
}
gl_FragColor = vec4( outgoingLight, a );
}
#if defined( PICKING )
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include encodings_fragment
#include fog_fragment
#endif
}`);function $v(e,t,r,i,n,a,o){for(var s=0;s<t;s++){for(var u=0;u<r;u++)i[u]=e[u*t+s];em(i,n,a,o,r);for(var c=0;c<r;c++)e[c*t+s]=n[c]}for(var f=0;f<r;f++){for(var l=0;l<t;l++)i[l]=e[f*t+l];em(i,n,a,o,t);for(var h=0;h<t;h++)e[f*t+h]=Math.sqrt(n[h])}}function em(e,t,r,i,n){r[0]=0,i[0]=Number.MIN_SAFE_INTEGER,i[1]=Number.MAX_SAFE_INTEGER;for(var a=1,o=0;a<n;a++){for(var s=(e[a]+a*a-(e[r[o]]+r[o]*r[o]))/(2*a-2*r[o]);s<=i[o];)o--,s=(e[a]+a*a-(e[r[o]]+r[o]*r[o]))/(2*a-2*r[o]);o++,r[o]=a,i[o]=s,i[o+1]=Number.MAX_SAFE_INTEGER}for(var u=0,c=0;u<n;u++){for(;i[c+1]<u;)c++;t[u]=(u-r[c])*(u-r[c])+e[r[c]]}}var Zl={};function kP(e){var t=JSON.stringify(e);return Zl[t]===void 0&&(Zl[t]=new hl(e)),Zl[t]}var zP={font:"sans-serif",size:36,style:"normal",variant:"normal",weight:"normal",outline:3,width:1024,height:1024},hl=function(t){var r=this;t===void 0&&(t={}),this.gamma=1,this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.25,this.parameters=vi(t,zP);var i=this.parameters;this.radius=i.size/8,this.padding=i.size/3;var n=this.lineHeight=i.size+2*i.outline+Math.round(i.size/4),a=this.maxWidth=i.width/4,o=this.canvas=document.createElement("canvas");o.width=a,o.height=n;var s=this.context=this.canvas.getContext("2d");s.font=i.style+" "+i.variant+" "+i.weight+" "+i.size+"px "+i.font,s.fillStyle="black",s.textAlign="left",s.textBaseline="bottom",s.lineJoin="round",this.gridOuter=new Float64Array(n*a),this.gridInner=new Float64Array(n*a),this.f=new Float64Array(Math.max(n,a)),this.d=new Float64Array(Math.max(n,a)),this.z=new Float64Array(Math.max(n,a)+1),this.v=new Int16Array(Math.max(n,a)),this.data=new Uint8Array(i.width*i.height*4),this.canvas2=document.createElement("canvas"),this.canvas2.width=i.width,this.canvas2.height=i.height,this.context2=this.canvas2.getContext("2d"),this.placeholder=this.map("");for(var u=32;u<=126;++u)r.map(String.fromCharCode(u));this.map(""),this.map(""),this.texture=new Xs(this.canvas2),this.texture.flipY=!1,this.texture.needsUpdate=!0};hl.prototype.map=function(t){var r=this.parameters;return this.mapped[t]===void 0&&(this.draw(t),this.currentX+this.scratchW>r.width&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>r.height&&console.warn("canvas to small"),this.mapped[t]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH},this.context2.drawImage(this.canvas,0,0,this.scratchW,this.scratchH,this.currentX,this.currentY,this.scratchW,this.scratchH),this.currentX+=this.scratchW),this.mapped[t]};hl.prototype.get=function(t){return this.mapped[t]||this.placeholder};hl.prototype.draw=function(t){var r=this,i=this.parameters,n=this.lineHeight,a=i.outline,o=this.context,s=this.maxWidth,u=a,c=n-i.outline,f=o.measureText(t),l=Math.min(s,Math.ceil(f.width+2*u+1)),h=l*n;o.clearRect(0,0,l,n),o.fillText(t,u,c);for(var d=o.getImageData(0,0,l,n),p=d.data,v=0;v<h;v++){var m=d.data[v*4+3]/255;r.gridOuter[v]=m===1?0:m===0?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-m),2),r.gridInner[v]=m===1?Number.MAX_SAFE_INTEGER:m===0?0:Math.pow(Math.max(0,m-.5),2)}$v(this.gridOuter,l,n,this.f,this.d,this.v,this.z),$v(this.gridInner,l,n,this.f,this.d,this.v,this.z);for(var g=0;g<h;g++){var x=r.gridOuter[g]-r.gridInner[g];p[g*4+3]=Math.max(0,Math.min(255,Math.round(255-255*(x/r.radius+r.cutoff))))}o.putImageData(d,0,0),this.scratchW=l,this.scratchH=n};var UP=Object.assign({fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"bold",fontSize:36,xOffset:0,yOffset:0,zOffset:.5,attachment:"bottom-left",showBorder:!1,borderColor:"lightgrey",borderWidth:.15,showBackground:!1,backgroundColor:"lightgrey",backgroundMargin:.5,backgroundOpacity:1,forceTransparent:!0,fixedSize:!1},ti),GP=Object.assign({fontFamily:{uniform:!0},fontStyle:{uniform:!0},fontWeight:{uniform:!0},fontSize:{uniform:!0},xOffset:{uniform:!0},yOffset:{uniform:!0},zOffset:{uniform:!0},showBorder:{uniform:!0},borderColor:{uniform:!0},borderWidth:{uniform:!0},backgroundColor:{uniform:!0},backgroundOpacity:{uniform:!0},fixedSize:{updateShader:!0}},Ka);function tm(e,t){for(var r=e.position.length/3,i=0,n=0;n<r;++n)i+=e.text[n].length;return t.showBackground&&(i+=r),i}var cs=function(e){function t(i,n){n===void 0&&(n={}),e.call(this,{position:new Float32Array(tm(i,n)*3),color:new Float32Array(tm(i,n)*3),picking:new xM},n),this.parameterTypes=GP,this.alwaysTransparent=!0,this.hasWireframe=!1,this.isText=!0,this.vertexShader="SDFFont.vert",this.fragmentShader="SDFFont.frag",this.text=i.text,this.positionCount=i.position.length/3,this.addUniforms({fontTexture:{value:null},xOffset:{value:this.parameters.xOffset},yOffset:{value:this.parameters.yOffset},zOffset:{value:this.parameters.zOffset},ortho:{value:!1},showBorder:{value:this.parameters.showBorder},borderColor:{value:new Oe(this.parameters.borderColor)},borderWidth:{value:this.parameters.borderWidth},backgroundColor:{value:new Oe(this.parameters.backgroundColor)},backgroundOpacity:{value:this.parameters.backgroundOpacity},canvasHeight:{value:1},pixelRatio:{value:1}}),this.addAttributes({inputTexCoord:{type:"v2",value:null},inputSize:{type:"f",value:null}}),this.setAttributes(i),this.makeTexture(),this.makeMapping()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={defaultParameters:{configurable:!0}};return r.defaultParameters.get=function(){return UP},t.prototype.makeMaterial=function(){e.prototype.makeMaterial.call(this);var n=this.texture,a=this.material;a.transparent=!0,a.extensions.derivatives=!0,a.lights=!1,a.uniforms.fontTexture.value=n,a.needsUpdate=!0;var o=this.wireframeMaterial;o.transparent=!0,o.extensions.derivatives=!0,o.lights=!1,o.uniforms.fontTexture.value=n,o.needsUpdate=!0;var s=this.pickingMaterial;s.extensions.derivatives=!0,s.lights=!1,s.uniforms.fontTexture.value=n,s.needsUpdate=!0},t.prototype.setAttributes=function(n){var a=this;n===void 0&&(n={});var o,s,u,c,f,l,h=this.text,d=this.geometry.attributes;n.position&&(o=n.position,c=d.position.array,d.position.needsUpdate=!0),n.size&&(s=n.size,f=d.inputSize.array,d.inputSize.needsUpdate=!0),n.color&&(u=n.color,l=d.color.array,d.color.needsUpdate=!0);for(var p=this.positionCount,v,m,g=0,x,y,b,_=0;_<p;++_)for(m=3*_,x=h[_],b=x.length,a.parameters.showBackground&&(b+=1),y=0;y<b;++y,++g)for(var w=0;w<4;w++)v=g*4*3+3*w,o&&(c[v]=o[m],c[v+1]=o[m+1],c[v+2]=o[m+2]),s&&(f[g*4+w]=s[_]),u&&(l[v]=u[m],l[v+1]=u[m+1],l[v+2]=u[m+2])},t.prototype.makeTexture=function(){this.textAtlas=kP({font:this.parameters.fontFamily,style:this.parameters.fontStyle,weight:this.parameters.fontWeight,size:this.parameters.fontSize}),this.texture=this.textAtlas.texture},t.prototype.makeMapping=function(){for(var n=this,a=this.textAtlas,o=this.text,s=this.parameters.attachment,u=a.lineHeight*this.parameters.backgroundMargin*.1-10,c=this.geometry.attributes,f=c.inputTexCoord.array,l=c.mapping.array,h=this.positionCount,d=0,p,v,m,g,x,y,b,_,w=0;w<h;++w){for(m=o[w],g=0,y=m.length,x=0;x<y;++x)p=a.get(m[x]),g+=p.w-2*a.parameters.outline;for(s.startsWith("top")?_=a.lineHeight/1.25:s.startsWith("middle")?_=a.lineHeight/2.5:_=0,s.endsWith("right")?b=g:s.endsWith("center")?b=g/2:b=0,b+=a.parameters.outline,_+=a.parameters.outline,n.parameters.showBackground&&(v=d*2*4,l[v+0]=-a.lineHeight/6-b-u,l[v+1]=a.lineHeight-_+u,l[v+2]=-a.lineHeight/6-b-u,l[v+3]=0-_-u,l[v+4]=g+a.lineHeight/6-b+2*a.parameters.outline+u,l[v+5]=a.lineHeight-_+u,l[v+6]=g+a.lineHeight/6-b+2*a.parameters.outline+u,l[v+7]=0-_-u,f[v+0]=10,f[v+2]=10,f[v+4]=10,f[v+6]=10,d+=1),g=0,x=0;x<y;++x,++d){p=a.get(m[x]),v=d*2*4,l[v+0]=g-b,l[v+1]=p.h-_,l[v+2]=g-b,l[v+3]=0-_,l[v+4]=g+p.w-b,l[v+5]=p.h-_,l[v+6]=g+p.w-b,l[v+7]=0-_;var A=a.parameters.width,S=a.parameters.height,M=[p.x/A,p.y/S,p.x/A,(p.y+p.h)/S,(p.x+p.w)/A,p.y/S,(p.x+p.w)/A,(p.y+p.h)/S];f.set(M,v),g+=p.w-2*a.parameters.outline}}c.inputTexCoord.needsUpdate=!0,c.mapping.needsUpdate=!0},t.prototype.getDefines=function(n){var a=e.prototype.getDefines.call(this,n);return this.parameters.fixedSize&&(a.FIXED_SIZE=1),a},t.prototype.setUniforms=function(n){n&&(n.fontFamily!==void 0||n.fontStyle!==void 0||n.fontWeight!==void 0||n.fontSize!==void 0)&&(this.makeTexture(),this.makeMapping(),this.texture.needsUpdate=!0,n.fontTexture=this.texture),e.prototype.setUniforms.call(this,n)},Object.defineProperties(t.prototype,r),t}(vp);mi.add("text",cs);Ut.add("shader/WideLine.vert",`
uniform float clipNear;
uniform vec3 clipCenter;
uniform float linewidth;
uniform vec2 resolution;
uniform mat4 projectionMatrixInverse;
attribute vec2 mapping;
attribute vec3 position1;
attribute vec3 position2;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
attribute vec3 color2;
varying vec3 vColor;
varying vec3 vColor2;
varying float flag;
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
void trimSegment( const in vec4 start, inout vec4 end ) {
float a = projectionMatrix[ 2 ][ 2 ]; float b = projectionMatrix[ 3 ][ 2 ]; float nearEstimate = - 0.5 * b / a;
float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );
end.xyz = mix( start.xyz, end.xyz, alpha );
}
void main() {
float aspect = resolution.x / resolution.y;
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
flag = mapping.y;
vColor = color;
vColor2 = color2;
#endif
vec4 start = modelViewMatrix * vec4( position1, 1.0 );
vec4 end = modelViewMatrix * vec4( position2, 1.0 );
bool perspective = ( projectionMatrix[ 2 ][ 3 ] == -1.0 ); if ( perspective ) {
if ( start.z < 0.0 && end.z >= 0.0 ) {
trimSegment( start, end );
} else if ( end.z < 0.0 && start.z >= 0.0 ) {
trimSegment( end, start );
}
}
vec4 clipStart = projectionMatrix * start;
vec4 clipEnd = projectionMatrix * end;
vec2 ndcStart = clipStart.xy / clipStart.w;
vec2 ndcEnd = clipEnd.xy / clipEnd.w;
vec2 dir = ndcEnd - ndcStart;
dir.x *= aspect;
dir = normalize( dir );
vec2 offset = vec2( dir.y, - dir.x );
dir.x /= aspect;
offset.x /= aspect;
if ( mapping.x < 0.0 ) offset *= - 1.0;
offset *= linewidth;
offset /= resolution.y;
vec4 clip = ( mapping.y < 0.5 ) ? clipStart : clipEnd;
offset *= clip.w;
clip.xy += offset;
gl_Position = clip;
#ifndef PICKING
vViewPosition = ( projectionMatrixInverse * clip ).xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`);Ut.add("shader/WideLine.frag",`uniform vec3 diffuse;
uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
#include common
#include fog_pars_fragment
varying vec3 vViewPosition;
varying vec3 vColor;
varying vec3 vColor2;
varying float flag;
#endif
void main() {
#include nearclip_fragment
#include radiusclip_fragment
#if defined( PICKING )
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 outgoingLight = vec3( 0.0 );
vec4 diffuseColor = vec4( diffuse, 1.0 );
if ( flag < 0.0 ) {
diffuseColor.rgb *= vColor;
} else {
diffuseColor.rgb *= vColor2;
}
#include alphatest_fragment
outgoingLight = diffuseColor.rgb;
gl_FragColor = vec4( outgoingLight, diffuseColor.a * opacity );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include encodings_fragment
#include fog_fragment
#endif
}`);var HP=Object.assign({linewidth:2},ti),VP=Object.assign({linewidth:{uniform:!0}},Ka),ca=function(e){function t(i,n){n===void 0&&(n={}),e.call(this,i,n),this.parameterTypes=VP,this.vertexShader="WideLine.vert",this.fragmentShader="WideLine.frag",!i.color2&&i.color&&(i.color2=i.color),this.addUniforms({linewidth:{value:this.parameters.linewidth},resolution:{value:new Ee},projectionMatrixInverse:{value:new Ae}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null}}),this.setAttributes(i),this.makeMapping()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={defaultParameters:{configurable:!0}};return r.defaultParameters.get=function(){return HP},t.prototype.setParameters=function(n){e.prototype.setParameters.call(this,n)},Object.defineProperties(t.prototype,r),t}(vp);mi.add("wideline",ca);var WP=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="angle",this.parameters=Object.assign({atomTriple:{type:"hidden",rebuild:!0},vectorVisible:{type:"boolean",default:!0},arcVisible:{type:"boolean",default:!0},sectorVisible:{type:"boolean",default:!0}},this.parameters),this.init(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};n.side=O(n.side,"double"),n.opacity=O(n.opacity,.5),this.atomTriple=O(n.atomTriple,[]),this.arcVisible=O(n.arcVisible,!0),this.sectorVisible=O(n.sectorVisible,!0),this.vectorVisible=O(n.vectorVisible,!0),e.prototype.init.call(this,n)},t.prototype.createData=function(i){if(!(!i.atomCount||!this.atomTriple.length)){var n=XP(i,this.atomTriple),a=qP(n),o=this.n=a.labelPosition.length/3,s=new Oe(this.labelColor);this.textBuffer=new cs({position:a.labelPosition,size:pi(o,this.labelSize),color:Qt(o,s.r,s.g,s.b),text:a.labelText},this.getLabelBufferParams());var u=new Oe(this.colorValue);return this.vectorBuffer=new ca(ld({position1:a.vectorPosition1,position2:a.vectorPosition2,color:Qt(2*o,u.r,u.g,u.b),color2:Qt(2*o,u.r,u.g,u.b)}),this.getBufferParams({linewidth:this.linewidth,visible:this.vectorVisible,opacity:this.lineOpacity})),this.arcLength=a.arcPosition1.length/3,this.arcBuffer=new ca(ld({position1:a.arcPosition1,position2:a.arcPosition2,color:Qt(this.arcLength,u.r,u.g,u.b),color2:Qt(this.arcLength,u.r,u.g,u.b)}),this.getBufferParams({linewidth:this.linewidth,visible:this.arcVisible,opacity:this.lineOpacity})),this.sectorLength=a.sectorPosition.length/3,this.sectorBuffer=new ua({position:a.sectorPosition,color:Qt(this.sectorLength,u.r,u.g,u.b)},this.getBufferParams({visible:this.sectorVisible})),{bufferList:[this.textBuffer,this.vectorBuffer,this.arcBuffer,this.sectorBuffer]}}},t.prototype.updateData=function(i,n){e.prototype.updateData.call(this,i,n);var a={},o={},s={};if(i.color){var u=new Oe(this.colorValue);Object.assign(a,{color:Qt(this.n*2,u.r,u.g,u.b),color2:Qt(this.n*2,u.r,u.g,u.b)}),Object.assign(o,{color:Qt(this.arcLength,u.r,u.g,u.b),color2:Qt(this.arcLength,u.r,u.g,u.b)}),Object.assign(s,{color:Qt(this.sectorLength,u.r,u.g,u.b)})}this.vectorBuffer.setAttributes(a),this.arcBuffer.setAttributes(o),this.sectorBuffer.setAttributes(s)},t.prototype.setParameters=function(i){var n=!1,a={};return e.prototype.setParameters.call(this,i,a,n),i&&(i.vectorVisible!==void 0||i.arcVisible!==void 0||i.sectorVisible!==void 0)&&this.setVisibility(this.visible),i&&i.lineOpacity&&(this.vectorBuffer.setParameters({opacity:i.lineOpacity}),this.arcBuffer.setParameters({opacity:i.lineOpacity})),i&&i.opacity!==void 0&&(this.vectorBuffer.setParameters({opacity:this.lineOpacity}),this.arcBuffer.setParameters({opacity:this.lineOpacity})),i&&i.linewidth&&(this.vectorBuffer.setParameters({linewidth:i.linewidth}),this.arcBuffer.setParameters({linewidth:i.linewidth})),this},t.prototype.setVisibility=function(i,n){return e.prototype.setVisibility.call(this,i,!0),this.vectorBuffer&&this.vectorBuffer.setVisibility(this.vectorVisible&&this.visible),this.arcBuffer&&this.arcBuffer.setVisibility(this.arcVisible&&this.visible),this.sectorBuffer&&this.sectorBuffer.setVisibility(this.sectorVisible&&this.visible),n||this.viewer.requestRender(),this},t}(Ap);function jP(e){for(var t=[],r=e.length/9,i=0;i<r;i++){for(var n=!0,a=i;a<i+3;a+=3)e[a]===e[a+3]&&e[a+1]===e[a+4]&&e[a+2]===e[a+5]&&(n=!1);n&&t.push(i)}var o=new Float32Array(t.length*9),s=0;return t.forEach(function(u){si(e,o,u*9,s*9,9),s++}),o}function XP(e,t){return jP(Oy(e,t))}function qP(e,t){t===void 0&&(t={});for(var r=O(t.angleStep,Math.PI/90),i=e.length/9,n=new Float32Array(i),a=new Float32Array(i*3),o=new Array(i),s=new Float32Array(i*6),u=new Float32Array(i*6),c=new Array(i),f=new Array(i),l=new Array(i),h=0,d=Vt(),p=Vt(),v=Vt(),m=Vt(),g=Vt(),x=Vt(),y=Vt(),b=Vt(),_=Vt(),w=function(W){var L=9*W;ai(d,e,L),ai(p,e,L+3),ai(v,e,L+6);var U=6*W;Ct(d,s,U),Ct(p,u,U),Ct(p,s,U+3),Ct(v,u,U+3),Cr(m,d,p),Cr(g,v,p),zr(m,m),zr(g,g),wi(x,m,g);var k=Ia(x),ee=Bi(m,g),K=n[W]=Math.atan2(k,ee);o[W]=(T0*K).toFixed(1)+"",Ia(x)===0&&(x[0]=1,x[1]=0,x[2]=0),wi(y,x,m),zr(y,y),Cf(b,p,m,y,K/2),Ct(b,a,3*W);var te=Math.ceil(K/r),Y=new Float32Array(te*9);l[W]=Y;var J=new Float32Array(te*3),j=new Float32Array(te*3);c[W]=J,f[W]=j,Sa(_,p,m);for(var ae=function(Se,_e){var ne=_e*9,ve=_e*3;Ct(p,Y,ne),Ct(_,Y,ne+3),Ct(_,J,ve),Cf(_,p,m,y,Se),Ct(_,Y,ne+6),Ct(_,j,ve)},re=0,le=r;le<K;le+=r)ae(le,re),re++;ae(K,re),h+=te},A=0;A<i;A++)w(A);for(var S=h*3,M=h*9,E=new Float32Array(S),T=new Float32Array(S),H=new Float32Array(M),X=0,q=0,Z=0;Z<i;Z++){var Q=c[Z],N=f[Z];si(Q,E,0,q,Q.length),si(N,T,0,q,N.length),q+=Q.length;var D=l[Z];si(D,H,0,X,D.length),X+=D.length}return{labelPosition:a,labelText:o,vectorPosition1:s,vectorPosition2:u,arcPosition1:E,arcPosition2:T,sectorPosition:H}}or.add("angle",WP);var rm=new I,Kl=new I,Jl=new I,YP=new I(0,1,0),Sp=Object.assign({radialSegments:1,openEnded:!0},ti);function ZP(e,t){t===void 0&&(t={});var r=Dy(t),i=e.position1.length,n=r.attributes.position.array.length/3,a=i/3,o=new Float32Array(a*2*n);sd(a,n,0,o),sd(a,n,a*n,o);var s=new Float32Array(i*2),u=new Float32Array(i*2);return{position:s,color:u,primitiveId:o,picking:e.picking}}function Dy(e){e===void 0&&(e={});var t=O(e.radialSegments,10),r=O(e.openEnded,!0),i=new Ae().makeRotationX(Math.PI/2),n=new Dn(1,1,1,t,1,r);return n.applyMatrix(i),n}var Fy=function(e){function t(i,n){n===void 0&&(n={}),e.call(this,ZP(i,n),n,Dy(n)),this.updateNormals=!0;var a=i.position1.length,o=i.radius.length;this.__center=new Float32Array(a),this._position=new Float32Array(a*2),this._color=new Float32Array(a*2),this._from=new Float32Array(a*2),this._to=new Float32Array(a*2),this._radius=new Float32Array(o*2),this.setAttributes(i,!0)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={defaultParameters:{configurable:!0}};return r.defaultParameters.get=function(){return Sp},t.prototype.applyPositionTransform=function(n,a,o){Kl.fromArray(this._from,o),Jl.fromArray(this._to,o),n.lookAt(Kl,Jl,YP);var s=this._radius[a];rm.set(s,s,Kl.distanceTo(Jl)),n.scale(rm)},t.prototype.setAttributes=function(n,a){n===void 0&&(n={});var o={};n.position1&&n.position2&&(on(n.position1,n.position2,this.__center),on(n.position1,this.__center,this._position),on(this.__center,n.position2,this._position,n.position1.length),this._from.set(n.position1),this._from.set(this.__center,n.position1.length),this._to.set(this.__center),this._to.set(n.position2,this.__center.length),o.position=this._position),n.color&&n.color2&&(this._color.set(n.color),this._color.set(n.color2,n.color.length),o.color=this._color),n.radius&&(this._radius.set(n.radius),this._radius.set(n.radius,n.radius.length),o.radius=this._radius),e.prototype.setAttributes.call(this,o,a)},Object.defineProperties(t.prototype,r),t}(ma);Ut.add("shader/CylinderImpostor.vert",`
attribute vec3 mapping;
attribute vec3 position1;
attribute vec3 position2;
attribute float radius;
varying vec3 axis;
varying vec4 base_radius;
varying vec4 end_b;
varying vec3 U;
varying vec3 V;
varying vec4 w;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
attribute vec3 color2;
varying vec3 vColor1;
varying vec3 vColor2;
#endif
uniform mat4 modelViewMatrixInverse;
uniform float ortho;
#include matrix_scale
void main(){
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
vColor1 = color;
vColor2 = color2;
#endif
base_radius.w = radius * matrixScale( modelViewMatrix );
vec3 center = position;
vec3 dir = normalize( position2 - position1 );
float ext = length( position2 - position1 ) / 2.0;
vec3 cam_dir;
if( ortho == 0.0 ){
cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 0, 1 ) ).xyz - center;
}else{
cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 1, 0 ) ).xyz;
}
cam_dir = normalize( cam_dir );
vec3 ldir;
float b = dot( cam_dir, dir );
end_b.w = b;
if( b < 0.0 )
ldir = -ext * dir;
else
ldir = ext * dir;
vec3 left = normalize( cross( cam_dir, ldir ) );
left = radius * left;
vec3 up = radius * normalize( cross( left, ldir ) );
axis = normalize( normalMatrix * ldir );
U = normalize( normalMatrix * up );
V = normalize( normalMatrix * left );
vec4 base4 = modelViewMatrix * vec4( center - ldir, 1.0 );
base_radius.xyz = base4.xyz / base4.w;
vec4 top_position = modelViewMatrix * vec4( center + ldir, 1.0 );
vec4 end4 = top_position;
end_b.xyz = end4.xyz / end4.w;
w = modelViewMatrix * vec4(
center + mapping.x*ldir + mapping.y*left + mapping.z*up, 1.0
);
gl_Position = projectionMatrix * w;
gl_Position.z = 0.99;
}`);Ut.add("shader/CylinderImpostor.frag",`#define STANDARD
#define IMPOSTOR
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform mat4 projectionMatrix;
uniform float ortho;
varying vec3 axis;
varying vec4 base_radius;
varying vec4 end_b;
varying vec3 U;
varying vec3 V;
varying vec4 w;
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
varying vec3 vColor1;
varying vec3 vColor2;
#include common
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
bool interior = false;
float distSq3( vec3 v3a, vec3 v3b ){
return (
( v3a.x - v3b.x ) * ( v3a.x - v3b.x ) +
( v3a.y - v3b.y ) * ( v3a.y - v3b.y ) +
( v3a.z - v3b.z ) * ( v3a.z - v3b.z )
);
}
float calcDepth( in vec3 cameraPos ){
vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;
return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
float calcClip( vec3 cameraPos ){
return dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );
}
void main(){
vec3 point = w.xyz / w.w;
vec3 base = base_radius.xyz;
float vRadius = base_radius.w;
vec3 end = end_b.xyz;
float b = end_b.w;
vec3 end_cyl = end;
vec3 surface_point = point;
vec3 ray_target = surface_point;
vec3 ray_origin = vec3(0.0);
vec3 ray_direction = mix(normalize(ray_origin - ray_target), vec3(0.0, 0.0, 1.0), ortho);
mat3 basis = mat3( U, V, axis );
vec3 diff = ray_target - 0.5 * (base + end_cyl);
vec3 P = diff * basis;
float dz = dot( axis, ray_direction );
float radius2 = vRadius*vRadius;
vec3 D = vec3(dot(U, ray_direction),
dot(V, ray_direction),
dz);
float a0 = P.x*P.x + P.y*P.y - radius2;
float a1 = P.x*D.x + P.y*D.y;
float a2 = D.x*D.x + D.y*D.y;
float d = a1*a1 - a0*a2;
if (d < 0.0)
discard;
float dist = (-a1 + sqrt(d)) / a2;
vec3 new_point = ray_target + dist * ray_direction;
vec3 tmp_point = new_point - base;
vec3 _normal = normalize( tmp_point - axis * dot(tmp_point, axis) );
ray_origin = mix( ray_origin, surface_point, ortho );
float front_cap_test = dot( tmp_point, axis );
float end_cap_test = dot((new_point - end_cyl), axis);
#ifndef CAP
vec3 new_point2 = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;
vec3 tmp_point2 = new_point2 - base;
#endif
if (front_cap_test < 0.0)
{
float dNV = dot(-axis, ray_direction);
if (dNV < 0.0)
discard;
float near = dot(-axis, (base)) / dNV;
vec3 front_point = ray_direction * near + ray_origin;
if (dot(front_point - base, front_point-base) > radius2)
discard;
#ifdef CAP
new_point = front_point;
_normal = axis;
#else
new_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;
dNV = dot(-axis, ray_direction);
near = dot(axis, end_cyl) / dNV;
new_point2 = ray_direction * near + ray_origin;
if (dot(new_point2 - end_cyl, new_point2-base) < radius2)
discard;
interior = true;
#endif
}
if( end_cap_test > 0.0 )
{
float dNV = dot(axis, ray_direction);
if (dNV < 0.0)
discard;
float near = dot(axis, end_cyl) / dNV;
vec3 end_point = ray_direction * near + ray_origin;
if( dot(end_point - end_cyl, end_point-base) > radius2 )
discard;
#ifdef CAP
new_point = end_point;
_normal = axis;
#else
new_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;
dNV = dot(-axis, ray_direction);
near = dot(-axis, (base)) / dNV;
new_point2 = ray_direction * near + ray_origin;
if (dot(new_point2 - base, new_point2-base) < radius2)
discard;
interior = true;
#endif
}
gl_FragDepthEXT = calcDepth( new_point );
#ifdef NEAR_CLIP
if( calcClip( new_point ) > 0.0 ){
dist = (-a1 - sqrt(d)) / a2;
new_point = ray_target + dist * ray_direction;
if( calcClip( new_point ) > 0.0 )
discard;
interior = true;
gl_FragDepthEXT = calcDepth( new_point );
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );
}
}else if( gl_FragDepthEXT <= 0.0 ){
dist = (-a1 - sqrt(d)) / a2;
new_point = ray_target + dist * ray_direction;
interior = true;
gl_FragDepthEXT = calcDepth( new_point );
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
}
#else
if( gl_FragDepthEXT <= 0.0 ){
dist = (-a1 - sqrt(d)) / a2;
new_point = ray_target + dist * ray_direction;
interior = true;
gl_FragDepthEXT = calcDepth( new_point );
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
}
#endif
if (gl_FragDepthEXT < 0.0)
discard;
if (gl_FragDepthEXT > 1.0)
discard;
#ifdef PICKING
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 vViewPosition = -new_point;
vec3 vNormal = _normal;
vec3 vColor;
if( distSq3( new_point, end_cyl ) < distSq3( new_point, base ) ){
if( b < 0.0 ){
vColor = vColor1;
}else{
vColor = vColor2;
}
}else{
if( b > 0.0 ){
vColor = vColor1;
}else{
vColor = vColor2;
}
}
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
vec3 normal = normalize( vNormal );
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
if( interior ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include encodings_fragment
#include fog_fragment
#endif
}`);var KP=new Float32Array([-1,1,-1,-1,-1,-1,1,1,-1,1,1,1,1,-1,-1,1,-1,1]),JP=new Uint16Array([0,1,2,1,4,2,2,4,3,4,5,3]),QP=function(e){function t(i,n){n===void 0&&(n={}),e.call(this,"v3",i,n)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={mapping:{configurable:!0},mappingIndices:{configurable:!0},mappingIndicesSize:{configurable:!0},mappingSize:{configurable:!0},mappingItemSize:{configurable:!0}};return r.mapping.get=function(){return KP},r.mappingIndices.get=function(){return JP},r.mappingIndicesSize.get=function(){return 12},r.mappingSize.get=function(){return 6},r.mappingItemSize.get=function(){return 3},Object.defineProperties(t.prototype,r),t}(pp),By=Object.assign({openEnded:!1},ti),$P=Object.assign({openEnded:{updateShader:!0}},Ka),eT=function(e){function t(i,n){n===void 0&&(n={}),e.call(this,i,n),this.parameterTypes=$P,this.isImpostor=!0,this.vertexShader="CylinderImpostor.vert",this.fragmentShader="CylinderImpostor.frag",this.addUniforms({modelViewMatrixInverse:{value:new Ae},ortho:{value:0}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null},radius:{type:"f",value:null}}),this.setAttributes(i),this.makeMapping()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={defaultParameters:{configurable:!0}};return r.defaultParameters.get=function(){return By},t.prototype.getDefines=function(n){var a=e.prototype.getDefines.call(this,n);return this.parameters.openEnded||(a.CAP=1),a},Object.defineProperties(t.prototype,r),t}(QP);Object.assign({disableImpostor:!1},Sp,By);var Wn=function(t,r){return r===void 0&&(r={}),!t.color2&&t.color&&(t.color2=t.color),!an||r&&r.disableImpostor?new Fy(t,r):new eT(t,r)};mi.add("cylinder",Wn);var tT=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="axes",this.parameters=Object.assign({radiusSize:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,radialSegments:!0,disableImpostor:!0,showAxes:{type:"boolean",rebuild:!0},showBox:{type:"boolean",rebuild:!0}},this.parameters,{assembly:null}),this.init(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};n.radiusSize=O(n.radiusSize,.5),n.colorValue=O(n.colorValue,"lightgreen"),n.useInteriorColor=O(n.useInteriorColor,!0),this.showAxes=O(n.showAxes,!0),this.showBox=O(n.showBox,!1),e.prototype.init.call(this,n)},t.prototype.getPrincipalAxes=function(){var i,n=this.getAssembly();return n&&(i=n.partList[0].getSelection()),this.structureView.getPrincipalAxes(i)},t.prototype.getAxesData=function(i){var n=this.getPrincipalAxes(),a=new Oe(this.colorValue),o=0,s=0;this.showAxes&&(o+=6,s+=3),this.showBox&&(o+=8,s+=12);var u=new Float32Array(3*o),c=Qt(o,a.r,a.g,a.b),f=pi(o,this.radiusSize),l=new Float32Array(3*s),h=new Float32Array(3*s),d=Qt(s,a.r,a.g,a.b),p=pi(s,this.radiusSize),v=0;if(this.showAxes){var m=function(q,Z){q.toArray(u,v*2),Z.toArray(u,v*2+3),q.toArray(l,v),Z.toArray(h,v),v+=3};m(n.begA,n.endA),m(n.begB,n.endB),m(n.begC,n.endC)}if(this.showBox){var g=new I,x=n.getProjectedScaleForAtoms(i),y=x.d1a,b=x.d2a,_=x.d3a,w=x.d1b,A=x.d2b,S=x.d3b,M=v*2,E=function(q,Z,Q){g.copy(n.center).addScaledVector(n.normVecA,q).addScaledVector(n.normVecB,Z).addScaledVector(n.normVecC,Q),g.toArray(u,M),M+=3};E(y,b,_),E(y,b,S),E(y,A,S),E(y,A,_),E(w,A,S),E(w,A,_),E(w,b,_),E(w,b,S);var T=v,H=function(q,Z){g.fromArray(u,v*2+q*3).toArray(l,T),g.fromArray(u,v*2+Z*3).toArray(h,T),T+=3};H(0,1),H(0,3),H(0,6),H(1,2),H(1,7),H(2,3),H(2,4),H(3,5),H(4,5),H(4,7),H(5,6),H(6,7)}var X=new hM(n);return{vertex:{position:u,color:c,radius:f,picking:X},edge:{position1:l,position2:h,color:d,color2:d,radius:p,picking:X}}},t.prototype.create=function(){var i=this.getAxesData(this.structureView);this.sphereBuffer=new ga(i.vertex,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),this.cylinderBuffer=new Wn(i.edge,this.getBufferParams({openEnded:!0,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})),this.dataList.push({sview:this.structureView,bufferList:[this.sphereBuffer,this.cylinderBuffer]})},t.prototype.createData=function(i){},t.prototype.updateData=function(i,n){var a=this.getAxesData(n.sview),o={},s={};(!i||i.position)&&(Object.assign(o,{position:a.vertex.position}),Object.assign(s,{position1:a.edge.position1,position2:a.edge.position2})),(!i||i.color)&&(Object.assign(o,{color:a.vertex.color}),Object.assign(s,{color:a.edge.color,color2:a.edge.color})),(!i||i.radius)&&(Object.assign(o,{radius:a.vertex.radius}),Object.assign(s,{radius:a.edge.radius})),this.sphereBuffer.setAttributes(o),this.cylinderBuffer.setAttributes(s)},t}(Xr);or.add("axes",tT);var dl=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="ball+stick",this.parameters=Object.assign({sphereDetail:!0,radialSegments:!0,openEnded:!0,disableImpostor:!0,aspectRatio:{type:"number",precision:1,max:10,min:1},lineOnly:{type:"boolean",rebuild:!0},cylinderOnly:{type:"boolean",rebuild:!0},multipleBond:{type:"select",rebuild:!0,options:{off:"off",symmetric:"symmetric",offset:"offset"}},bondScale:{type:"number",precision:2,max:1,min:.01},bondSpacing:{type:"number",precision:2,max:2,min:.5},linewidth:{type:"integer",max:50,min:1,buffer:!0}},this.parameters),this.init(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};n.radiusType=O(n.radiusType,"size"),n.radiusSize=O(n.radiusSize,.15),n.useInteriorColor=O(n.useInteriorColor,!0),this.aspectRatio=O(n.aspectRatio,2),this.lineOnly=O(n.lineOnly,!1),this.cylinderOnly=O(n.cylinderOnly,!1),this.multipleBond=O(n.multipleBond,"off"),this.bondSpacing=O(n.bondSpacing,1),this.bondScale=O(n.bondScale,.4),this.linewidth=O(n.linewidth,2),e.prototype.init.call(this,n)},t.prototype.getAtomRadius=function(i){return this.aspectRatio*e.prototype.getAtomRadius.call(this,i)},t.prototype.getAtomParams=function(i,n){var a=e.prototype.getAtomParams.call(this,i,n);return a.radiusParams.scale*=this.aspectRatio,a},t.prototype.getAtomData=function(i,n,a){return i.getAtomData(this.getAtomParams(n,a))},t.prototype.getBondParams=function(i,n){return n=Object.assign({multipleBond:this.multipleBond,bondSpacing:this.bondSpacing,bondScale:this.bondScale},n),e.prototype.getBondParams.call(this,i,n)},t.prototype.getBondData=function(i,n,a){return i.getBondData(this.getBondParams(n,a))},t.prototype.createData=function(i){var n=[];if(this.lineOnly)this.lineBuffer=new ca(this.getBondData(i,{position:!0,color:!0,picking:!0}),this.getBufferParams({linewidth:this.linewidth})),n.push(this.lineBuffer);else{var a=new Wn(this.getBondData(i),this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}));if(n.push(a),!this.cylinderOnly){var o=new ga(this.getAtomData(i),this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0}));n.push(o)}}return{bufferList:n}},t.prototype.updateData=function(i,n){this.multipleBond!=="off"&&i&&i.radius&&(i.position=!0);var a=this.getBondData(n.sview,i);if(this.lineOnly){var o={};(!i||i.position)&&Object.assign(o,{position1:a.position1,position2:a.position2}),(!i||i.color)&&Object.assign(o,{color:a.color,color2:a.color2}),n.bufferList[0].setAttributes(o)}else{var s={};if((!i||i.position)&&Object.assign(s,{position1:a.position1,position2:a.position2}),(!i||i.color)&&Object.assign(s,{color:a.color,color2:a.color2}),(!i||i.radius)&&Object.assign(s,{radius:a.radius}),n.bufferList[0].setAttributes(s),!this.cylinderOnly){var u=this.getAtomData(n.sview,i),c={};(!i||i.position)&&Object.assign(c,{position:u.position}),(!i||i.color)&&Object.assign(c,{color:u.color}),(!i||i.radius)&&Object.assign(c,{radius:u.radius}),n.bufferList[1].setAttributes(c)}}},t.prototype.setParameters=function(i){i===void 0&&(i={});var n=!1,a={};return(i.aspectRatio||i.bondSpacing||i.bondScale)&&(Object.assign(a,{radius:!0}),(!an||this.disableImpostor)&&(n=!0)),e.prototype.setParameters.call(this,i,a,n),this},t}(Xr);or.add("ball+stick",dl);var rT=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="backbone",this.parameters=Object.assign({},this.parameters,{multipleBond:null,bondSpacing:null}),this.init(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};n.aspectRatio=O(n.aspectRatio,1),n.radiusSize=O(n.radiusSize,.25),e.prototype.init.call(this,n)},t.prototype.getAtomRadius=function(i){return i.isTrace()?e.prototype.getAtomRadius.call(this,i):0},t.prototype.getAtomData=function(i,n,a){return i.getBackboneAtomData(this.getAtomParams(n,a))},t.prototype.getBondData=function(i,n,a){return i.getBackboneBondData(this.getBondParams(n,a))},t}(dl);or.add("backbone",rT);var iT=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="base",this.parameters=Object.assign({},this.parameters,{multipleBond:null,bondSpacing:null})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};n.aspectRatio=O(n.aspectRatio,1),n.radiusSize=O(n.radiusSize,.3),e.prototype.init.call(this,n)},t.prototype.getAtomData=function(i,n,a){return i.getRungAtomData(this.getAtomParams(n,a))},t.prototype.getBondData=function(i,n,a){var o=this.getBondParams(n,a);return Object.assign(o.colorParams,{rung:!0}),i.getRungBondData(o)},t}(dl);or.add("base",iT);var Rr=function(t,r){this.m=t,this.tension=r,this.dt=1/this.m,this.delta=1e-4,this.vec1=new I,this.vec2=new I,this.vDir=new I,this.vTan=new I,this.vNorm=new I,this.vBin=new I,this.m2=Math.ceil(this.m/2)};Rr.prototype.interpolateToArr=function(t,r,i,n,a,o,s){o[s+0]=In(t.x,r.x,i.x,n.x,a,this.tension),o[s+1]=In(t.y,r.y,i.y,n.y,a,this.tension),o[s+2]=In(t.z,r.z,i.z,n.z,a,this.tension)};Rr.prototype.interpolateToVec=function(t,r,i,n,a,o){o.x=In(t.x,r.x,i.x,n.x,a,this.tension),o.y=In(t.y,r.y,i.y,n.y,a,this.tension),o.z=In(t.z,r.z,i.z,n.z,a,this.tension)};Rr.prototype.interpolatePosition=function(t,r,i,n,a,o){for(var s=this,u=0;u<this.m;++u){var c=o+u*3,f=s.dt*u;s.interpolateToArr(t,r,i,n,f,a,c)}};Rr.prototype.interpolateTangent=function(t,r,i,n,a,o){for(var s=this,u=0;u<this.m;++u){var c=s.dt*u,f=c-s.delta,l=c+s.delta,h=o+u*3;f<0&&(f=0),l>1&&(l=1),s.interpolateToVec(t,r,i,n,f,s.vec1),s.interpolateToVec(t,r,i,n,l,s.vec2),s.vec2.sub(s.vec1).normalize(),s.vec2.toArray(a,h)}};Rr.prototype.vectorSubdivide=function(t,r,i,n,a){for(var o=this,s,u=r.next(),c=r.next(),f=r.next(),l=r.size,h=l-1,d=n||0,p=0;p<h;++p)s=u,u=c,c=f,f=r.next(),t.apply(o,[s,u,c,f,i,d]),d+=3*o.m;a&&(s=r.get(l-2),u=r.get(l-1),c=r.get(0),f=r.get(1),t.apply(this,[s,u,c,f,i,d]),d+=3*this.m)};Rr.prototype.getPosition=function(t,r,i,n){t.reset(),this.vectorSubdivide(this.interpolatePosition,t,r,i,n);var a=t.size-1,o=a*this.m*3;n&&(o+=this.m*3);var s=t.get(n?0:a);r[o]=s.x,r[o+1]=s.y,r[o+2]=s.z};Rr.prototype.getTangent=function(t,r,i,n){t.reset(),this.vectorSubdivide(this.interpolateTangent,t,r,i,n);var a=t.size-1,o=a*this.m*3;n&&(o+=this.m*3),si(r,r,o-3,o,3)};Rr.prototype.interpolateNormalDir=function(t,r,i,n,a,o,s,u,c,f,l,h,d){for(var p=this,v=0;v<this.m;++v){var m=h+v*3;d&&(m+=p.m2*3);var g=p.dt*v;p.interpolateToVec(t,r,i,n,g,p.vec1),p.interpolateToVec(a,o,s,u,g,p.vec2),p.vDir.subVectors(p.vec2,p.vec1).normalize(),p.vTan.fromArray(c,m),p.vBin.crossVectors(p.vDir,p.vTan).normalize(),p.vBin.toArray(l,m),p.vNorm.crossVectors(p.vTan,p.vBin).normalize(),p.vNorm.toArray(f,m)}};Rr.prototype.interpolateNormal=function(t,r,i,n,a){for(var o=this,s=0;s<this.m;++s){var u=a+s*3;t.copy(o.vNorm),o.vTan.fromArray(r,u),o.vBin.crossVectors(t,o.vTan).normalize(),o.vBin.toArray(n,u),o.vNorm.crossVectors(o.vTan,o.vBin).normalize(),o.vNorm.toArray(i,u)}};Rr.prototype.getNormal=function(t,r,i,n,a,o){var s=this;this.vNorm.set(0,0,1);for(var u=t,c=u-1,f=a||0,l=0;l<c;++l)s.interpolateNormal(s.vDir,r,i,n,f),f+=3*s.m;o&&(this.interpolateNormal(this.vDir,r,i,n,f),f+=3*this.m),this.vBin.toArray(n,f),this.vNorm.toArray(i,f)};Rr.prototype.getNormalDir=function(t,r,i,n,a,o,s,u){var c=this;t.reset(),r.reset();var f=new I,l=new I,h=new I,d=new I,p=new I,v=new I().copy(t.next()),m=new I().copy(t.next()),g=new I().copy(t.next()),x=new I,y=new I().copy(r.next()),b=new I().copy(r.next()),_=new I().copy(r.next());this.vNorm.set(0,0,1);for(var w=t.size,A=w-1,S=o||0,M=0;M<A;++M)p.copy(v),v.copy(m),m.copy(g),g.copy(t.next()),x.copy(y),y.copy(b),b.copy(_),_.copy(r.next()),M===0?(f.subVectors(x,p),l.subVectors(y,v),f.dot(l)<0&&(l.multiplyScalar(-1),y.addVectors(v,l)),h.subVectors(b,m),l.dot(h)<0&&(h.multiplyScalar(-1),b.addVectors(m,h))):h.copy(d),d.subVectors(_,g),h.dot(d)<0&&(d.multiplyScalar(-1),_.addVectors(g,d)),c.interpolateNormalDir(p,v,m,g,x,y,b,_,i,n,a,S,u),S+=3*c.m;if(s&&(p.copy(t.get(w-2)),v.copy(t.get(w-1)),m.copy(t.get(0)),g.copy(t.get(1)),x.copy(r.get(w-2)),y.copy(r.get(w-1)),b.copy(r.get(0)),_.copy(r.get(1)),h.copy(d),d.subVectors(_,g),h.dot(d)<0&&(d.multiplyScalar(-1),_.addVectors(g,d)),this.interpolateNormalDir(p,v,m,g,x,y,b,_,i,n,a,S,u),S+=3*this.m),u){this.vBin.fromArray(a,this.m2*3),this.vNorm.fromArray(n,this.m2*3);for(var E=0;E<this.m2;++E)c.vBin.toArray(a,E*3),c.vNorm.toArray(n,E*3)}else this.vBin.toArray(a,S),this.vNorm.toArray(n,S)};Rr.prototype.interpolateColor=function(t,r,i,n,a){var o=this,s,u;for(s=0;s<this.m2;++s)u=a+s*3,i.apply(o,[t,n,u]);for(s=this.m2;s<this.m;++s)u=a+s*3,i.apply(o,[r,n,u])};Rr.prototype.getColor=function(t,r,i,n,a){var o=this;t.reset(),t.next();for(var s,u=t.next(),c=t.size,f=c-1,l=n||0,h=0;h<f;++h)s=u,u=t.next(),o.interpolateColor(s,u,r,i,l),l+=3*o.m;a&&(s=t.get(c-1),u=t.get(0),this.interpolateColor(s,u,r,i,l),l+=3*this.m),i[l]=i[l-3],i[l+1]=i[l-2],i[l+2]=i[l-1]};Rr.prototype.interpolatePicking=function(t,r,i,n,a){var o=this,s;for(s=0;s<this.m2;++s)n[a+s]=i.apply(o,[t]);for(s=this.m2;s<this.m;++s)n[a+s]=i.apply(o,[r])};Rr.prototype.getPicking=function(t,r,i,n,a){var o=this;t.reset(),t.next();for(var s,u=t.next(),c=t.size,f=c-1,l=n||0,h=0;h<f;++h)s=u,u=t.next(),o.interpolatePicking(s,u,r,i,l),l+=o.m;a&&(s=t.get(c-1),u=t.get(0),this.interpolatePicking(s,u,r,i,l),l+=this.m),i[l]=i[l-1]};Rr.prototype.interpolateSize=function(t,r,i,n,a){for(var o=this,s=i.apply(this,[t]),u=i.apply(this,[r]),c=0;c<this.m;++c){var f=c/o.m;n[a+c]=(1-f)*s+f*u}};Rr.prototype.getSize=function(t,r,i,n,a){var o=this;t.reset(),t.next();for(var s,u=t.next(),c=t.size,f=c-1,l=n||0,h=0;h<f;++h)s=u,u=t.next(),o.interpolateSize(s,u,r,i,l),l+=o.m;a&&(s=t.get(c-1),u=t.get(0),this.interpolateSize(s,u,r,i,l),l+=this.m),i[l]=i[l-1]};var Qr=function(t,r){this.polymer=t,this.size=t.residueCount;var i=r||{};this.directional=i.directional||!1,this.positionIterator=i.positionIterator||!1,this.subdiv=i.subdiv||1,this.smoothSheet=i.smoothSheet||!1,i.tension?this.tension=i.tension:this.tension=this.polymer.isNucleic()?.5:.9,this.interpolator=new Rr(this.subdiv,this.tension)};Qr.prototype.getAtomIterator=function(t,r){var i=this.polymer,n=i.structure,a=i.residueCount,o=0,s=-1,u=[n.getAtomProxy(),n.getAtomProxy(),n.getAtomProxy(),n.getAtomProxy()],c=[new I,new I,new I,new I];function f(){var v=d(s);return s+=1,v}var l=n.getAtomProxy(),h=n.getAtomProxy();function d(v){var m=u[o%4];if(m.index=i.getAtomIndexByType(v,t),r&&v>0&&v<a&&m.sstruc==="e"){var g=c[o%4];return l.index=i.getAtomIndexByType(v+1,t),h.index=i.getAtomIndexByType(v-1,t),g.addVectors(l,h).add(m).add(m).multiplyScalar(.25),o+=1,g}return o+=1,m}function p(){o=0,s=-1}return{size:a,next:f,get:d,reset:p}};Qr.prototype.getSubdividedColor=function(t){var r=this.subdiv,i=this.polymer,n=i.residueCount,a=n-1,o=a*r*3+3;i.isCyclic&&(o+=r*3);var s=new Float32Array(o),u=this.getAtomIterator("trace"),c=t||{};c.structure=i.structure;var f=Tt.getScheme(c);function l(h,d,p){f.atomColorToArray(h,d,p)}return this.interpolator.getColor(u,l,s,0,i.isCyclic),{color:s}};Qr.prototype.getSubdividedPicking=function(){var t=this.subdiv,r=this.polymer,i=r.residueCount,n=i-1,a=n*t+1;r.isCyclic&&(a+=t);var o=r.structure,s=this.getAtomIterator("trace"),u=new Float32Array(a);function c(f){return f.index}return this.interpolator.getPicking(s,c,u,0,r.isCyclic),{picking:new Za(u,o)}};Qr.prototype.getSubdividedPosition=function(){var t=this.getPosition();return{position:t}};Qr.prototype.getSubdividedOrientation=function(){var t=this.getTangent(),r=this.getNormals(t);return{tangent:t,normal:r.normal,binormal:r.binormal}};Qr.prototype.getSubdividedSize=function(t){var r=this.subdiv,i=this.polymer,n=i.residueCount,a=n-1,o=a*r+1;i.isCyclic&&(o+=r);var s=new Float32Array(o),u=this.getAtomIterator("trace"),c=new pn(t);function f(l){return c.atomRadius(l)}return this.interpolator.getSize(u,f,s,0,i.isCyclic),{size:s}};Qr.prototype.getPosition=function(){var t=this.subdiv,r=this.polymer,i=r.residueCount,n=i-1,a=n*t*3+3;r.isCyclic&&(a+=t*3);var o=new Float32Array(a),s=this.positionIterator||this.getAtomIterator("trace",this.smoothSheet);return this.interpolator.getPosition(s,o,0,r.isCyclic),o};Qr.prototype.getTangent=function(){var t=this.subdiv,r=this.polymer,i=this.size,n=i-1,a=n*t*3+3;r.isCyclic&&(a+=t*3);var o=new Float32Array(a),s=this.positionIterator||this.getAtomIterator("trace",this.smoothSheet);return this.interpolator.getTangent(s,o,0,r.isCyclic),o};Qr.prototype.getNormals=function(t){var r=this.subdiv,i=this.polymer,n=i.isProtein(),a=this.size,o=a-1,s=o*r*3+3;i.isCyclic&&(s+=r*3);var u=new Float32Array(s),c=new Float32Array(s);if(this.directional&&!this.polymer.isCg()){var f=this.getAtomIterator("direction1"),l=this.getAtomIterator("direction2");this.interpolator.getNormalDir(f,l,t,u,c,0,i.isCyclic,n)}else this.interpolator.getNormal(a,t,u,c,0,i.isCyclic);return{normal:u,binormal:c}};var im=new I,oc=new I,nT=Object.assign({radialSegments:4,capped:!1,aspectRatio:1},ti);function aT(e,t){t===void 0&&(t={});var r=O(t.radialSegments,4),i=O(t.capped,!1),n=i?r:0,a=i?r-2:0,o=e.position.length/3,s=o-1,u=o*r*3+2*n*3,c=s*2*r*3+2*a*3;return{position:new Float32Array(u),color:new Float32Array(u),index:dn(c,u/3),normal:new Float32Array(u),picking:e.picking}}var oT=function(e){function t(i,n){n===void 0&&(n={}),e.call(this,aT(i,n),n),this.capVertices=this.parameters.capped?this.parameters.radialSegments:0,this.capTriangles=this.parameters.capped?this.parameters.radialSegments-2:0,this.size2=i.position.length/3,i.primitiveId=jo(this.size2),this.setAttributes(i),this.makeIndex()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={defaultParameters:{configurable:!0}};return r.defaultParameters.get=function(){return nT},t.prototype.setAttributes=function(n){n===void 0&&(n={});var a=this.parameters.aspectRatio,o=this.size2,s=o-1,u=this.parameters.radialSegments,c=this.geometry.attributes,f,l,h,d,p,v,m,g,x,y,b;n.position&&(f=n.position,l=n.normal,h=n.binormal,d=n.tangent,v=n.size,g=c.position.array,y=c.normal.array,c.position.needsUpdate=!0,c.normal.needsUpdate=!0),n.color&&(p=n.color,x=c.color.array,c.color.needsUpdate=!0),n.primitiveId&&(m=n.primitiveId,b=c.primitiveId.array,c.primitiveId.needsUpdate=!0);var _,w,A=0,S=0,M=0,E=0,T=0,H=0,X=0,q=0,Z=0,Q=0,N=[],D=[],W=[],L=[],U=[],k=[];if(f)for(var ee=0;ee<u;++ee){var K=ee/u*2*Math.PI;N[ee]=a*Math.cos(K),D[ee]=Math.sin(K),W[ee]=a*Math.cos(K-.01),L[ee]=Math.sin(K-.01),U[ee]=a*Math.cos(K+.01),k[ee]=Math.sin(K+.01)}for(var te=0;te<o;++te){_=te*3,w=_*u,f&&d&&l&&h&&v&&(im.set(d[_],d[_+1],d[_+2]),S=l[_],M=l[_+1],E=l[_+2],T=h[_],H=h[_+1],X=h[_+2],q=f[_],Z=f[_+1],Q=f[_+2],A=v[te]);for(var Y=0;Y<u;++Y){var J=w+Y*3;if(f){var j=-A*N[Y],ae=A*D[Y],re=-A*W[Y],le=A*L[Y],Se=-A*U[Y],_e=A*k[Y];g[J]=q+j*S+ae*T,g[J+1]=Z+j*M+ae*H,g[J+2]=Q+j*E+ae*X,oc.set(Se*S+_e*T-(re*S+le*T),Se*M+_e*H-(re*M+le*H),Se*E+_e*X-(re*E+le*X)).cross(im),y[J]=oc.x,y[J+1]=oc.y,y[J+2]=oc.z}p&&(x[J]=p[_],x[J+1]=p[_+1],x[J+2]=p[_+2]),m&&(b[te*u+Y]=m[te])}}_=0,w=o*3*u;for(var ne=0;ne<u;++ne){var ve=_+ne*3,se=w+ne*3;f&&d&&(g[se]=g[ve],g[se+1]=g[ve+1],g[se+2]=g[ve+2],y[se]=d[_],y[se+1]=d[_+1],y[se+2]=d[_+2]),p&&(x[se]=x[ve],x[se+1]=x[ve+1],x[se+2]=x[ve+2]),m&&(b[o*u+ne]=b[0+ne])}_=(o-1)*3*u,w=(o+1)*3*u;for(var xe=0;xe<u;++xe){var he=_+xe*3,ye=w+xe*3;f&&d&&(g[ye]=g[he],g[ye+1]=g[he+1],g[ye+2]=g[he+2],y[ye]=d[s*3],y[ye+1]=d[s*3+1],y[ye+2]=d[s*3+2]),p&&(x[ye]=x[he],x[ye+1]=x[he+1],x[ye+2]=x[he+2]),m&&(b[(o+1)*u+xe]=b[(o-1)*u+xe])}},t.prototype.makeIndex=function(){for(var n=this.geometry.getIndex().array,a=this.size2,o=a-1,s=this.capTriangles,u=this.parameters.radialSegments,c=this.parameters.radialSegments+1,f,l,h=0;h<o;++h)for(var d=h*u*3*2,p=h*u,v=(h+1)*u,m=0;m<u;++m)l=d+m*3*2,n[l]=p+m,n[l+1]=p+(m+1)%u,n[l+2]=v+m,n[l+3]=v+m,n[l+4]=p+(m+1)%u,n[l+5]=v+(m+1)%u;for(var g=[0],x=1;x<c/2;++x)g.push(x),u-x!==x&&g.push(u-x);l=o*u*3*2,f=a*u;for(var y=0;y<g.length-2;++y)y%2===0?(n[l+y*3+0]=f+g[y+0],n[l+y*3+1]=f+g[y+1],n[l+y*3+2]=f+g[y+2]):(n[l+y*3+0]=f+g[y+2],n[l+y*3+1]=f+g[y+1],n[l+y*3+2]=f+g[y+0]);l=o*u*3*2+3*s,f=a*u+u;for(var b=0;b<g.length-2;++b)b%2===0?(n[l+b*3+0]=f+g[b+0],n[l+b*3+1]=f+g[b+1],n[l+b*3+2]=f+g[b+2]):(n[l+b*3+0]=f+g[b+2],n[l+b*3+1]=f+g[b+1],n[l+b*3+2]=f+g[b+0])},Object.defineProperties(t.prototype,r),t}(ua),Mp=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="cartoon",this.parameters=Object.assign({aspectRatio:{type:"number",precision:1,max:10,min:1,rebuild:!0},subdiv:{type:"integer",max:50,min:1,rebuild:!0},radialSegments:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},capped:{type:"boolean",rebuild:!0},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters),this.init(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};n.colorScheme=O(n.colorScheme,"chainname"),n.colorScale=O(n.colorScale,"RdYlBu"),n.radiusType=O(n.radiusType,"sstruc"),n.radiusScale=O(n.radiusScale,.7),n.useInteriorColor=O(n.useInteriorColor,!0),this.aspectRatio=O(n.aspectRatio,5),this.tension=O(n.tension,NaN),this.capped=O(n.capped,!0),this.smoothSheet=O(n.smoothSheet,!1),n.quality==="low"?(this.subdiv=3,this.radialSegments=6):n.quality==="medium"?this.subdiv=6:n.quality==="high"?this.subdiv=12:this.subdiv=O(n.subdiv,6),e.prototype.init.call(this,n)},t.prototype.getSplineParams=function(i){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:this.aspectRatio!==1,smoothSheet:this.smoothSheet},i)},t.prototype.getSpline=function(i){return new Qr(i,this.getSplineParams())},t.prototype.getAspectRatio=function(i){return i.isCg()?1:this.aspectRatio},t.prototype.getAtomRadius=function(i){return i.isTrace()?e.prototype.getAtomRadius.call(this,i):0},t.prototype.createData=function(i){var n=this,a=[],o=[];return this.structure.eachPolymer(function(s){if(!(s.residueCount<4)){o.push(s);var u=n.getSpline(s),c=n.getAspectRatio(s),f=u.getSubdividedPosition(),l=u.getSubdividedOrientation(),h=u.getSubdividedColor(n.getColorParams()),d=u.getSubdividedPicking(),p=u.getSubdividedSize(n.getRadiusParams());a.push(new oT(Object.assign({},f,l,h,d,p),n.getBufferParams({radialSegments:n.radialSegments,aspectRatio:c,capped:n.capped})))}},i.getSelection()),{bufferList:a,polymerList:o}},t.prototype.updateData=function(i,n){var a=this;ge&&fe.time(this.type+" repr update"),i=i||{};for(var o=0,s=n.polymerList.length;o<s;++o){var u={},c=n.polymerList[o],f=a.getSpline(c),l=a.getAspectRatio(c);if(Object.assign(n.bufferList[o],{aspectRatio:l}),i.position||i.radius){var h=f.getSubdividedPosition(),d=f.getSubdividedOrientation(),p=f.getSubdividedSize(a.getRadiusParams(l));u.position=h.position,u.normal=d.normal,u.binormal=d.binormal,u.tangent=d.tangent,u.size=p.size}if(i.color){var v=f.getSubdividedColor(a.getColorParams());u.color=v.color}if(i.picking){var m=f.getSubdividedPicking();u.picking=m.picking}n.bufferList[o].setAttributes(u)}ge&&fe.timeEnd(this.type+" repr update")},t.prototype.setParameters=function(i){var n=!1,a={};return i&&i.aspectRatio&&(a.radius=!0),i&&i.tension&&(a.position=!0),e.prototype.setParameters.call(this,i,a,n),this},t}(Xr);or.add("cartoon",Mp);var sT=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="contact",this.parameters=Object.assign({hydrogenBond:{type:"boolean",rebuild:!0},weakHydrogenBond:{type:"boolean",rebuild:!0},waterHydrogenBond:{type:"boolean",rebuild:!0},backboneHydrogenBond:{type:"boolean",rebuild:!0},hydrophobic:{type:"boolean",rebuild:!0},halogenBond:{type:"boolean",rebuild:!0},ionicInteraction:{type:"boolean",rebuild:!0},metalCoordination:{type:"boolean",rebuild:!0},cationPi:{type:"boolean",rebuild:!0},piStacking:{type:"boolean",rebuild:!0},filterSele:{type:"text",rebuild:!0},labelVisible:{type:"boolean",rebuild:!0},labelFixedSize:{type:"boolean",buffer:"fixedSize"},labelSize:{type:"number",precision:3,max:10,min:.001,rebuild:!0},labelUnit:{type:"select",rebuild:!0,options:{"":"",angstrom:"angstrom",nm:"nm"}},maxHydrophobicDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondSulfurDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondAccAngle:{type:"integer",max:180,min:0,rebuild:!0},maxHbondDonAngle:{type:"integer",max:180,min:0,rebuild:!0},maxHbondAccPlaneAngle:{type:"integer",max:90,min:0,rebuild:!0},maxHbondDonPlaneAngle:{type:"integer",max:90,min:0,rebuild:!0},maxPiStackingDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxPiStackingOffset:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxPiStackingAngle:{type:"integer",max:180,min:0,rebuild:!0},maxCationPiDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxCationPiOffset:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxIonicDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHalogenBondDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHalogenBondAngle:{type:"integer",max:180,min:0,rebuild:!0},maxMetalDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},refineSaltBridges:{type:"boolean",rebuild:!0},masterModelIndex:{type:"integer",max:1e3,min:-1,rebuild:!0},lineOfSightDistFactor:{type:"number",precision:1,max:10,min:0,rebuild:!0},radialSegments:!0,disableImpostor:!0},this.parameters),this.init(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};n.radiusSize=O(n.radiusSize,.05),n.useInteriorColor=O(n.useInteriorColor,!0),this.hydrogenBond=O(n.hydrogenBond,!0),this.weakHydrogenBond=O(n.weakHydrogenBond,!1),this.waterHydrogenBond=O(n.waterHydrogenBond,!1),this.backboneHydrogenBond=O(n.backboneHydrogenBond,!1),this.hydrophobic=O(n.hydrophobic,!1),this.halogenBond=O(n.halogenBond,!0),this.ionicInteraction=O(n.ionicInteraction,!0),this.metalCoordination=O(n.metalCoordination,!0),this.cationPi=O(n.cationPi,!0),this.piStacking=O(n.piStacking,!0),this.filterSele=O(n.filterSele,""),this.labelVisible=O(n.labelVisible,!1),this.labelFixedSize=O(n.labelFixedSize,!1),this.labelSize=O(n.labelSize,2),this.labelUnit=O(n.labelUnit,""),this.maxHydrophobicDist=O(n.maxHydrophobicDist,4),this.maxHbondDist=O(n.maxHbondDist,3.5),this.maxHbondSulfurDist=O(n.maxHbondSulfurDist,4.1),this.maxHbondAccAngle=O(n.maxHbondAccAngle,45),this.maxHbondDonAngle=O(n.maxHbondDonAngle,45),this.maxHbondAccPlaneAngle=O(n.maxHbondAccPlaneAngle,90),this.maxHbondDonPlaneAngle=O(n.maxHbondDonPlaneAngle,30),this.maxPiStackingDist=O(n.maxPiStackingDist,5.5),this.maxPiStackingOffset=O(n.maxPiStackingOffset,2),this.maxPiStackingAngle=O(n.maxPiStackingAngle,30),this.maxCationPiDist=O(n.maxCationPiDist,6),this.maxCationPiOffset=O(n.maxCationPiOffset,2),this.maxIonicDist=O(n.maxIonicDist,5),this.maxHalogenBondDist=O(n.maxHalogenBondDist,3.5),this.maxHalogenBondAngle=O(n.maxHalogenBondAngle,30),this.maxMetalDist=O(n.maxMetalDist,3),this.refineSaltBridges=O(n.refineSaltBridges,!0),this.masterModelIndex=O(n.masterModelIndex,-1),this.lineOfSightDistFactor=O(n.lineOfSightDistFactor,1),e.prototype.init.call(this,n)},t.prototype.getAtomRadius=function(){return 0},t.prototype.getContactData=function(i){var n={maxHydrophobicDist:this.maxHydrophobicDist,maxHbondDist:this.maxHbondDist,maxHbondSulfurDist:this.maxHbondSulfurDist,maxHbondAccAngle:this.maxHbondAccAngle,maxHbondDonAngle:this.maxHbondDonAngle,maxHbondAccPlaneAngle:this.maxHbondAccPlaneAngle,maxHbondDonPlaneAngle:this.maxHbondDonPlaneAngle,maxPiStackingDist:this.maxPiStackingDist,maxPiStackingOffset:this.maxPiStackingOffset,maxPiStackingAngle:this.maxPiStackingAngle,maxCationPiDist:this.maxCationPiDist,maxCationPiOffset:this.maxCationPiOffset,maxIonicDist:this.maxIonicDist,maxHalogenBondDist:this.maxHalogenBondDist,maxHalogenBondAngle:this.maxHalogenBondAngle,maxMetalDist:this.maxMetalDist,refineSaltBridges:this.refineSaltBridges,masterModelIndex:this.masterModelIndex,lineOfSightDistFactor:this.lineOfSightDistFactor},a={hydrogenBond:this.hydrogenBond,weakHydrogenBond:this.weakHydrogenBond,waterHydrogenBond:this.waterHydrogenBond,backboneHydrogenBond:this.backboneHydrogenBond,hydrophobic:this.hydrophobic,halogenBond:this.halogenBond,ionicInteraction:this.ionicInteraction,metalCoordination:this.metalCoordination,cationPi:this.cationPi,piStacking:this.piStacking,radius:this.radiusSize*this.radiusScale,filterSele:this.filterSele},o=nM(i,n);return uM(o,i,a)},t.prototype.createData=function(i){var n=this.getContactData(i),a=[new Wn(IS(n),this.getBufferParams({sphereDetail:1,dullInterior:!0,disableImpostor:this.disableImpostor}))];if(this.labelVisible){var o={size:this.labelSize,unit:this.labelUnit};a.push(new cs(cM(n,o),{fixedSize:this.labelFixedSize}))}return{bufferList:a}},t}(Xr);or.add("contact",sT);var uT=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="dihedral",this.parameters=Object.assign({atomQuad:{type:"hidden",rebuild:!0},extendLine:{type:"boolean",rebuild:!0,default:!0},lineVisible:{type:"boolean",default:!0},planeVisible:{type:"boolean",default:!0},sectorVisible:{type:"boolean",default:!0}},this.parameters),this.init(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};n.side=O(n.side,"double"),n.opacity=O(n.opacity,.5),this.atomQuad=O(n.atomQuad,[]),this.extendLine=O(n.extendLine,!0),this.lineVisible=O(n.lineVisible,!0),this.planeVisible=O(n.planeVisible,!0),this.sectorVisible=O(n.sectorVisible,!0),e.prototype.init.call(this,n)},t.prototype.createData=function(i){if(!(!i.atomCount||!this.atomQuad.length)){var n=Oy(i,this.atomQuad),a=cT(n,{extendLine:this.extendLine}),o=this.n=a.labelText.length,s=new Oe(this.labelColor);this.textBuffer=new cs({position:a.labelPosition,size:pi(o,this.labelSize),color:Qt(o,s.r,s.g,s.b),text:a.labelText},this.getLabelBufferParams());var u=new Oe(this.colorValue);this.lineLength=a.linePosition1.length/3;var c=Qt(this.lineLength,u.r,u.g,u.b);return this.lineBuffer=new ca(ld({position1:a.linePosition1,position2:a.linePosition2,color:c,color2:c}),this.getBufferParams({linewidth:this.linewidth,visible:this.lineVisible,opacity:this.lineOpacity})),this.planeLength=a.planePosition.length/3,this.planeBuffer=new ua({position:a.planePosition,color:Qt(this.planeLength,u.r,u.g,u.b)},this.getBufferParams({visible:this.planeVisible})),this.sectorLength=a.sectorPosition.length/3,this.sectorBuffer=new ua({position:a.sectorPosition,color:Qt(this.sectorLength,u.r,u.g,u.b)},this.getBufferParams({visible:this.sectorVisible})),{bufferList:[this.textBuffer,this.lineBuffer,this.planeBuffer,this.sectorBuffer]}}},t.prototype.updateData=function(i,n){e.prototype.updateData.call(this,i,n);var a={},o={},s={};if(i.color){var u=new Oe(this.colorValue);Object.assign(a,{color:Qt(this.lineLength,u.r,u.g,u.b),color2:Qt(this.lineLength,u.r,u.g,u.b)}),Object.assign(o,{color:Qt(this.planeLength,u.r,u.g,u.b)}),Object.assign(s,{color:Qt(this.sectorLength,u.r,u.g,u.b)})}this.lineBuffer.setAttributes(a),this.planeBuffer.setAttributes(o),this.sectorBuffer.setAttributes(s)},t.prototype.setParameters=function(i){var n=!1,a={};return e.prototype.setParameters.call(this,i,a,n),i&&(i.lineVisible!==void 0||i.sectorVisible!==void 0||i.planeVisible!==void 0)&&this.setVisibility(this.visible),i&&i.lineOpacity&&this.lineBuffer.setParameters({opacity:i.lineOpacity}),i&&i.opacity!==void 0&&this.lineBuffer.setParameters({opacity:this.lineOpacity}),i&&i.linewidth&&this.lineBuffer.setParameters({linewidth:i.linewidth}),this},t.prototype.setVisibility=function(i,n){return e.prototype.setVisibility.call(this,i,!0),this.lineBuffer&&this.lineBuffer.setVisibility(this.lineVisible&&this.visible),this.planeBuffer&&this.planeBuffer.setVisibility(this.planeVisible&&this.visible),this.sectorBuffer&&this.sectorBuffer.setVisibility(this.sectorVisible&&this.visible),n||this.viewer.requestRender(),this},t}(Ap);function cT(e,t){t===void 0&&(t={});for(var r=O(t.angleStep,Math.PI/90),i=e.length,n=e.length/12,a=new Float32Array(n),o=new Float32Array(n*3),s=new Array(n),u=new Array(n),c=new Array(n),f=new Array(n),l=new Array(n),h=0,d=0,p=0,v=Vt(),m=Vt(),g=Vt(),x=Vt(),y=Vt(),b=Vt(),_=Vt(),w=Vt(),A=Vt(),S=Vt(),M=Vt(),E=Vt(),T=Vt(),H=Vt(),X=Vt(),q=0,Z=function(re){if(ai(v,e,re),ai(m,e,re+3),ai(g,e,re+6),ai(x,e,re+9),Cr(y,v,m),Cr(b,g,m),Ia(b)!==0){Cr(_,x,g),pr(w,b,.5),Sa(A,m,w),zr(y,y),zr(b,b),zr(_,_),Cr(w,v,A);var le=Bi(w,b)>0;Cr(w,x,A);var Se=Bi(w,b)<0;if(pr(w,b,Bi(b,y)),Cr(S,y,w),pr(w,b,Bi(b,_)),Cr(M,_,w),!(Ia(S)===0||Ia(M)===0)){zr(S,S),zr(M,M);var _e=a[q]=Math.acos(Bi(S,M));s[q]=(T0*_e).toFixed(1)+"",wi(H,S,b),zr(H,H),Bi(H,M)<0&&Yd(H,H),Cf(w,A,S,H,_e/2),Ct(w,o,3*q);var ne=Math.ceil(_e/r),ve=ne+(t.extendLine?4:2),se=t.extendLine?36:0,xe=new Float32Array(ve*3),he=new Float32Array(ve*3),ye=new Float32Array(ne*9),pe=new Float32Array(se);u[q]=xe,c[q]=he,f[q]=ye,l[q]=pe,t.extendLine&&(le?(Cr(w,v,g),zr(w,w),pr(E,w,1/Bi(S,w)),Sa(E,E,g)):(pr(E,y,1/Bi(S,y)),Sa(E,E,m)),Se?(Cr(w,x,m),zr(w,w),pr(T,w,1/Bi(M,w)),Sa(T,T,m)):(pr(T,_,1/Bi(M,_)),Sa(T,T,g))),Sa(X,A,S);var Pe=0;t.extendLine?(Ct(v,xe,Pe),Ct(E,he,Pe),Pe+=3,Ct(E,xe,Pe),Ct(X,he,Pe),Pe+=3,Ct(E,pe,0),Ct(X,pe,3),Ct(le?g:m,pe,6),Ct(le?g:m,pe,9),Ct(X,pe,12),Ct(A,pe,15)):(Ct(A,xe,Pe),Ct(X,he,Pe),Pe+=3);for(var He=function(Be,ie){var we=ie*9;Ct(A,ye,we),Ct(X,ye,we+3),Ct(X,xe,Pe),Cf(X,A,S,H,Be),Ct(X,ye,we+6),Ct(X,he,Pe),Pe+=3},Je=0,We=r;We<_e;We+=r)He(We,Je++);He(_e,Je++),t.extendLine?(Ct(X,xe,(ve-2)*3),Ct(T,he,(ve-2)*3),Ct(T,xe,(ve-1)*3),Ct(x,he,(ve-1)*3),Ct(T,pe,18),Ct(X,pe,21),Ct(Se?m:g,pe,24),Ct(Se?m:g,pe,27),Ct(X,pe,30),Ct(A,pe,33)):(Ct(X,xe,Pe),Ct(A,he,Pe),Pe+=3),h+=ve*3,d+=ne*9,p+=se,q+=1}}},Q=0;Q<i;Q+=12)Z(Q);for(var N=q,D=new Float32Array(h),W=new Float32Array(h),L=new Float32Array(d),U=new Float32Array(p),k=0,ee=0,K=0,te=0;te<N;te++){var Y=u[te],J=c[te],j=f[te],ae=l[te];si(Y,D,0,k,Y.length),si(J,W,0,k,J.length),si(j,L,0,ee,j.length),si(ae,U,0,K,ae.length),k+=Y.length,ee+=j.length,K+=ae.length}return{labelPosition:o.subarray(0,N*3),labelText:s.slice(0,N),linePosition1:D,linePosition2:W,planePosition:U,sectorPosition:L}}or.add("dihedral",uT);var fT=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="distance",this.parameters=Object.assign({radialSegments:!0,openEnded:!0,disableImpostor:!0,labelUnit:{type:"select",rebuild:!0,options:{"":"",angstrom:"angstrom",nm:"nm"}},useCylinder:{type:"boolean",rebuild:!0},atomPair:{type:"hidden",rebuild:!0}},this.parameters),this.init(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};n.linewidth=O(n.linewidth,5),n.radiusType=O(n.radiusType,"size"),n.radiusSize=O(n.radiusSize,.2),this.labelUnit=O(n.labelUnit,""),this.useCylinder=O(n.useCylinder,!1),this.atomPair=O(n.atomPair,[]),e.prototype.init.call(this,n)},t.prototype.getDistanceData=function(i,n){var a=this,o=n.length,s=new Array(o),u=new Float32Array(o*3),c=new Kt,f=new Kt,l=new Tc,h=i.getAtomProxy(),d=i.getAtomProxy(),p=0,v=i.getAtomSet();n.forEach(function(g,x){var y=g[0],b=g[1];if(typeof y=="number"&&Number.isInteger(y)&&typeof b=="number"&&Number.isInteger(b))if(v.get(y)&&v.get(b))h.index=y,d.index=b;else{p+=1;return}else{c.setString(y),f.setString(b);var _=i.getAtomIndices(c),w=i.getAtomIndices(f);if(_.length&&w.length)h.index=_[0],d.index=w[0];else{p+=1;return}}l.addBond(h,d,1),x-=p;var A=h.distanceTo(d);switch(a.labelUnit){case"angstrom":s[x]=A.toFixed(2)+" ";break;case"nm":s[x]=(A/10).toFixed(2)+" nm";break;default:s[x]=A.toFixed(2);break}var S=x*3;u[S+0]=(h.x+d.x)/2,u[S+1]=(h.y+d.y)/2,u[S+2]=(h.z+d.z)/2}),p>0&&(o-=p,u=u.subarray(0,o*3));var m=new lt(l.count,!0);return{text:s,position:u,bondSet:m,bondStore:l}},t.prototype.getBondData=function(i,n,a){var o=i.getBondData(this.getBondParams(n,a));return o.picking&&(o.picking=new mM(o.picking.array,o.picking.structure,a.bondStore)),o},t.prototype.createData=function(i){if(!(!i.atomCount||!this.atomPair.length)){var n=this.atomPair.length,a=new Oe(this.labelColor),o=this.getDistanceData(i,this.atomPair);this.textBuffer=new cs({position:o.position,size:pi(n,this.labelSize),color:Qt(n,a.r,a.g,a.b),text:o.text},this.getLabelBufferParams());var s={bondSet:o.bondSet,bondStore:o.bondStore},u=this.getBondData(i,{position:!0,color:!0,picking:!0,radius:this.useCylinder},s);return this.useCylinder?this.distanceBuffer=new Wn(u,this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})):this.distanceBuffer=new ca(U0(u),this.getBufferParams({linewidth:this.linewidth,visible:this.lineVisible,opacity:this.lineOpacity})),{bondSet:o.bondSet,bondStore:o.bondStore,position:o.position,bufferList:[this.textBuffer,this.distanceBuffer]}}},t.prototype.updateData=function(i,n){e.prototype.updateData.call(this,i,n);var a={bondSet:n.bondSet,bondStore:n.bondStore},o=this.getBondData(n.sview,i,a),s={};(!i||i.color)&&Object.assign(s,{color:o.color,color2:o.color2}),(!i||i.radius)&&Object.assign(s,{radius:o.radius}),this.distanceBuffer.setAttributes(s)},t.prototype.setParameters=function(i){var n=!1,a={};return e.prototype.setParameters.call(this,i,a,n),this.useCylinder||(i&&i.lineOpacity&&this.distanceBuffer.setParameters({opacity:i.lineOpacity}),i&&i.opacity!==void 0&&this.distanceBuffer.setParameters({opacity:this.lineOpacity}),i&&i.linewidth&&this.distanceBuffer.setParameters({linewidth:i.linewidth})),this},t}(Ap);or.add("distance",fT);function Ql(e){var t=e.position.length/3;return t*2*3}var lT=Object.assign({scale:1,color:"grey"},ti),nm=function(e){function t(i,n){n===void 0&&(n={}),e.call(this,{position:new Float32Array(Ql(i)),color:new Float32Array(Ql(i))},n),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag";var a=new Oe(this.parameters.color),o=this.geometry.attributes;Qt(Ql(i)/3,a.r,a.g,a.b,o.color.array),this.setAttributes(i)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={defaultParameters:{configurable:!0}};return r.defaultParameters.get=function(){return lT},t.prototype.setAttributes=function(n){n===void 0&&(n={});var a=this.geometry.attributes,o,s,u;n.position&&n.vector&&(o=n.position,s=n.vector,u=a.position.array,a.position.needsUpdate=!0);var c=this.size/2,f=this.parameters.scale;if(o&&s)for(var l=0;l<c;l++){var h=l*2*3,d=l*3;u[h+0]=o[d+0],u[h+1]=o[d+1],u[h+2]=o[d+2],u[h+3]=o[d+0]+s[d+0]*f,u[h+4]=o[d+1]+s[d+1]*f,u[h+5]=o[d+2]+s[d+2]*f}},Object.defineProperties(t.prototype,r),t}(It),hT=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="helixorient",this.parameters=Object.assign({sphereDetail:!0,disableImpostor:!0},this.parameters),this.init(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};n.colorScheme=O(n.colorScheme,"sstruc"),n.radiusType=O(n.radiusType,"size"),n.radiusSize=O(n.radiusSize,.15),n.radiusScale=O(n.radiusScale,1),n.useInteriorColor=O(n.useInteriorColor,!0),e.prototype.init.call(this,n)},t.prototype.createData=function(i){var n=this,a=[],o=[];return this.structure.eachPolymer(function(s){if(!(s.residueCount<4)){o.push(s);var u=new kn(s),c=u.getPosition(),f=u.getColor(n.getColorParams()),l=u.getSize(n.getRadiusParams()),h=u.getPicking();a.push(new ga({position:c.center,color:f.color,radius:l.size,picking:h.picking},n.getBufferParams({sphereDetail:n.sphereDetail,disableImpostor:n.disableImpostor,dullInterior:!0})),new nm({position:c.center,vector:c.axis},n.getBufferParams({color:"skyblue",scale:1})),new nm({position:c.center,vector:c.resdir},n.getBufferParams({color:"lightgreen",scale:1})))}},i.getSelection()),{bufferList:a,polymerList:o}},t.prototype.updateData=function(i,n){ge&&fe.time(this.type+" repr update"),i=i||{};for(var a=0,o=n.polymerList.length;a<o;++a){var s=a*3,u={},c=n.polymerList[a],f=new kn(c);if(i.position){var l=f.getPosition();Object.assign(u,{position:l.center}),n.bufferList[s+1].setAttributes({position:l.center,vector:l.axis}),n.bufferList[s+2].setAttributes({position:l.center,vector:l.resdir})}n.bufferList[s].setAttributes(u)}ge&&fe.timeEnd(this.type+" repr update")},t}(Xr);or.add("helixorient",hT);var Ny=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="licorice",this.parameters=Object.assign({},this.parameters,{aspectRatio:null})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};n.aspectRatio=1,e.prototype.init.call(this,n)},t}(dl);or.add("licorice",Ny);Ut.add("shader/HyperballStickImpostor.vert",`
attribute vec3 mapping;
attribute float radius;
attribute float radius2;
attribute vec3 position1;
attribute vec3 position2;
varying mat4 matrix_near;
varying vec4 prime1;
varying vec4 prime2;
varying float vRadius;
varying float vRadius2;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
attribute vec3 color2;
varying vec3 vColor1;
varying vec3 vColor2;
#endif
uniform float shrink;
uniform mat4 modelViewProjectionMatrix;
uniform mat4 modelViewProjectionMatrixInverse;
void main(){
vRadius = radius;
vRadius2 = radius2;
vec4 spaceposition;
vec3 position_atom1;
vec3 position_atom2;
vec4 vertex_position;
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
vColor1 = color;
vColor2 = color2;
#endif
float radius1 = radius;
position_atom1 = position1;
position_atom2 = position2;
float distance = distance( position_atom1, position_atom2 );
spaceposition.z = mapping.z * distance;
if (radius1 > radius2) {
spaceposition.y = mapping.y * 1.5 * radius1;
spaceposition.x = mapping.x * 1.5 * radius1;
} else {
spaceposition.y = mapping.y * 1.5 * radius2;
spaceposition.x = mapping.x * 1.5 * radius2;
}
spaceposition.w = 1.0;
vec4 e3 = vec4( 1.0 );
vec3 e1, e1_temp, e2, e2_temp;
e3.xyz = normalize(position_atom1-position_atom2);
if (e3.z == 0.0) { e3.z = 0.0000000000001;}
if ( (position_atom1.x - position_atom2.x) == 0.0) { position_atom1.x += 0.001;}
if ( (position_atom1.y - position_atom2.y) == 0.0) { position_atom1.y += 0.001;}
if ( (position_atom1.z - position_atom2.z) == 0.0) { position_atom1.z += 0.001;}
vec4 focus = vec4( 1.0 );
focus.x = ( position_atom1.x*position_atom1.x - position_atom2.x*position_atom2.x +
( radius2*radius2 - radius1*radius1 )*e3.x*e3.x/shrink )/(2.0*(position_atom1.x - position_atom2.x));
focus.y = ( position_atom1.y*position_atom1.y - position_atom2.y*position_atom2.y +
( radius2*radius2 - radius1*radius1 )*e3.y*e3.y/shrink )/(2.0*(position_atom1.y - position_atom2.y));
focus.z = ( position_atom1.z*position_atom1.z - position_atom2.z*position_atom2.z +
( radius2*radius2 - radius1*radius1 )*e3.z*e3.z/shrink )/(2.0*(position_atom1.z - position_atom2.z));
e1.x = 1.0;
e1.y = 1.0;
e1.z = ( (e3.x*focus.x + e3.y*focus.y + e3.z*focus.z) - e1.x*e3.x - e1.y*e3.y)/e3.z;
e1_temp = e1 - focus.xyz;
e1 = normalize(e1_temp);
e2_temp = e1.yzx * e3.zxy - e1.zxy * e3.yzx;
e2 = normalize(e2_temp);
mat3 R= mat3( e1.xyz, e2.xyz, e3.xyz );
vertex_position.xyz = R * spaceposition.xyz;
vertex_position.w = 1.0;
vertex_position.x += (position_atom1.x+position_atom2.x) / 2.0;
vertex_position.y += (position_atom1.y+position_atom2.y) / 2.0;
vertex_position.z += (position_atom1.z+position_atom2.z) / 2.0;
gl_Position = modelViewProjectionMatrix * vertex_position;
vec4 i_near, i_far;
vec4 near = gl_Position;
near.z = 0.0 ;
near = modelViewProjectionMatrixInverse * near;
i_near = near;
vec4 far = gl_Position;
far.z = far.w ;
i_far = modelViewProjectionMatrixInverse * far;
prime1 = vec4( position_atom1 - (position_atom1 - focus.xyz)*shrink, 1.0 );
prime2 = vec4( position_atom2 - (position_atom2 - focus.xyz)*shrink, 1.0 );
float Rsquare = (radius1*radius1/shrink) - (
(position_atom1.x - focus.x)*(position_atom1.x - focus.x) +
(position_atom1.y - focus.y)*(position_atom1.y - focus.y) +
(position_atom1.z - focus.z)*(position_atom1.z - focus.z)
);
focus.w = Rsquare;
matrix_near = mat4( i_near, i_far, focus, e3 );
gl_Position.z = 1.0;
}`);Ut.add("shader/HyperballStickImpostor.frag",`#define STANDARD
#define IMPOSTOR
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform float shrink;
uniform mat4 modelViewMatrix;
uniform mat4 modelViewProjectionMatrix;
uniform mat4 modelViewMatrixInverseTranspose;
uniform mat4 projectionMatrix;
varying mat4 matrix_near;
varying vec4 prime1;
varying vec4 prime2;
varying float vRadius;
varying float vRadius2;
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
varying vec3 vColor1;
varying vec3 vColor2;
#include common
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
bool interior = false;
float calcClip( vec4 cameraPos ){
return dot( cameraPos, vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );
}
float calcClip( vec3 cameraPos ){
return calcClip( vec4( cameraPos, 1.0 ) );
}
float calcDepth( in vec3 cameraPos ){
vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;
return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
struct Ray {
vec3 origin ;
vec3 direction ;
};
bool cutoff_plane (vec3 M, vec3 cutoff, vec3 x3){
float a = x3.x;
float b = x3.y;
float c = x3.z;
float d = -x3.x*cutoff.x-x3.y*cutoff.y-x3.z*cutoff.z;
float l = a*M.x+b*M.y+c*M.z+d;
if (l<0.0) {return true;}
else{return false;}
}
vec3 isect_surf(Ray r, mat4 matrix_coef){
vec4 direction = vec4(r.direction, 0.0);
vec4 origin = vec4(r.origin, 1.0);
float a = dot(direction,(matrix_coef*direction));
float b = dot(origin,(matrix_coef*direction));
float c = dot(origin,(matrix_coef*origin));
float delta =b*b-a*c;
gl_FragColor.a = 1.0;
if (delta<0.0){
discard;
}
float t1 =(-b-sqrt(delta))/a;
return r.origin+t1*r.direction;
}
vec3 isect_surf2(Ray r, mat4 matrix_coef){
vec4 direction = vec4(r.direction, 0.0);
vec4 origin = vec4(r.origin, 1.0);
float a = dot(direction,(matrix_coef*direction));
float b = dot(origin,(matrix_coef*direction));
float c = dot(origin,(matrix_coef*origin));
float delta =b*b-a*c;
gl_FragColor.a = 1.0;
if (delta<0.0){
discard;
}
float t2 =(-b+sqrt(delta))/a;
return r.origin+t2*r.direction;
}
Ray primary_ray(vec4 near1, vec4 far1){
vec3 near=near1.xyz/near1.w;
vec3 far=far1.xyz/far1.w;
return Ray(near,far-near);
}
float update_z_buffer(vec3 M, mat4 ModelViewP){
float depth1;
vec4 Ms=(ModelViewP*vec4(M,1.0));
return depth1=(1.0+Ms.z/Ms.w)/2.0;
}
void main(){
float radius = max( vRadius, vRadius2 );
vec4 i_near, i_far, focus;
vec3 e3, e1, e1_temp, e2;
i_near = vec4(matrix_near[0][0],matrix_near[0][1],matrix_near[0][2],matrix_near[0][3]);
i_far = vec4(matrix_near[1][0],matrix_near[1][1],matrix_near[1][2],matrix_near[1][3]);
focus = vec4(matrix_near[2][0],matrix_near[2][1],matrix_near[2][2],matrix_near[2][3]);
e3 = vec3(matrix_near[3][0],matrix_near[3][1],matrix_near[3][2]);
e1.x = 1.0;
e1.y = 1.0;
e1.z = ( (e3.x*focus.x + e3.y*focus.y + e3.z*focus.z) - e1.x*e3.x - e1.y*e3.y)/e3.z;
e1_temp = e1 - focus.xyz;
e1 = normalize(e1_temp);
e2 = normalize(cross(e1,e3));
vec4 equation = focus;
float shrinkfactor = shrink;
float t1 = -1.0/(1.0-shrinkfactor);
float t2 = 1.0/(shrinkfactor);
vec4 colonne1, colonne2, colonne3, colonne4;
mat4 mat;
vec3 equation1 = vec3(t2,t2,t1);
float A1 = - e1.x*equation.x - e1.y*equation.y - e1.z*equation.z;
float A2 = - e2.x*equation.x - e2.y*equation.y - e2.z*equation.z;
float A3 = - e3.x*equation.x - e3.y*equation.y - e3.z*equation.z;
float A11 = equation1.x*e1.x*e1.x + equation1.y*e2.x*e2.x + equation1.z*e3.x*e3.x;
float A21 = equation1.x*e1.x*e1.y + equation1.y*e2.x*e2.y + equation1.z*e3.x*e3.y;
float A31 = equation1.x*e1.x*e1.z + equation1.y*e2.x*e2.z + equation1.z*e3.x*e3.z;
float A41 = equation1.x*e1.x*A1 + equation1.y*e2.x*A2 + equation1.z*e3.x*A3;
float A22 = equation1.x*e1.y*e1.y + equation1.y*e2.y*e2.y + equation1.z*e3.y*e3.y;
float A32 = equation1.x*e1.y*e1.z + equation1.y*e2.y*e2.z + equation1.z*e3.y*e3.z;
float A42 = equation1.x*e1.y*A1 + equation1.y*e2.y*A2 + equation1.z*e3.y*A3;
float A33 = equation1.x*e1.z*e1.z + equation1.y*e2.z*e2.z + equation1.z*e3.z*e3.z;
float A43 = equation1.x*e1.z*A1 + equation1.y*e2.z*A2 + equation1.z*e3.z*A3;
float A44 = equation1.x*A1*A1 + equation1.y*A2*A2 + equation1.z*A3*A3 - equation.w;
colonne1 = vec4(A11,A21,A31,A41);
colonne2 = vec4(A21,A22,A32,A42);
colonne3 = vec4(A31,A32,A33,A43);
colonne4 = vec4(A41,A42,A43,A44);
mat = mat4(colonne1,colonne2,colonne3,colonne4);
Ray ray = primary_ray(i_near,i_far) ;
vec3 M;
M = isect_surf(ray, mat);
if (cutoff_plane(M, prime1.xyz, -e3) || cutoff_plane(M, prime2.xyz, e3)){ discard; }
vec4 M1 = vec4(M,1.0);
vec4 M2 = mat*M1;
vec3 _normal = ( modelViewMatrixInverseTranspose * M2 ).xyz;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;
#ifdef NEAR_CLIP
if( calcClip( modelViewMatrix * vec4( M, 1.0 ) ) > 0.0 ){
M = isect_surf2(ray, mat);
if( calcClip( modelViewMatrix * vec4( M, 1.0 ) ) > 0.0 )
discard;
interior = true;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / radius ) );
}
}else if( gl_FragDepthEXT <= 0.0 ){
M = isect_surf2(ray, mat);
interior = true;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix);
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / radius );
}
}
#else
if( gl_FragDepthEXT <= 0.0 ){
M = isect_surf2(ray, mat);
interior = true;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / radius );
}
}
#endif
if (cutoff_plane(M, prime1.xyz, -e3) || cutoff_plane(M, prime2.xyz, e3)){ discard; }
if (gl_FragDepthEXT < 0.0)
discard;
if (gl_FragDepthEXT > 1.0)
discard;
float distance_ratio = ((M.x-prime2.x)*e3.x + (M.y-prime2.y)*e3.y +(M.z-prime2.z)*e3.z) /
distance(prime2.xyz,prime1.xyz);
#ifdef PICKING
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 vViewPosition = -( modelViewMatrix * vec4( M, 1.0 ) ).xyz;
vec3 vNormal = _normal;
vec3 vColor;
if( distance_ratio>0.5 ){
vColor = vColor1;
}else{
vColor = vColor2;
}
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
vec3 normal = normalize( vNormal );
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
if( interior ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include encodings_fragment
#include fog_fragment
#endif
}`);var dT=new Float32Array([-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,-1,1,1]),pT=new Uint16Array([0,1,2,0,2,3,1,5,6,1,6,2,4,6,5,4,7,6,0,7,4,0,3,7,0,5,1,0,4,5,3,2,6,3,6,7]),vT=function(e){function t(i,n){n===void 0&&(n={}),e.call(this,"v3",i,n)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={mapping:{configurable:!0},mappingIndices:{configurable:!0},mappingIndicesSize:{configurable:!0},mappingSize:{configurable:!0},mappingItemSize:{configurable:!0}};return r.mapping.get=function(){return dT},r.mappingIndices.get=function(){return pT},r.mappingIndicesSize.get=function(){return 36},r.mappingSize.get=function(){return 8},r.mappingItemSize.get=function(){return 3},Object.defineProperties(t.prototype,r),t}(pp),ky=Object.assign({shrink:.14},ti),mT=Object.assign({shrink:{uniform:!0}},Ka),gT=function(e){function t(i,n){n===void 0&&(n={}),e.call(this,i,n),this.parameterTypes=mT,this.isImpostor=!0,this.vertexShader="HyperballStickImpostor.vert",this.fragmentShader="HyperballStickImpostor.frag",this.addUniforms({modelViewProjectionMatrix:{value:new Ae},modelViewProjectionMatrixInverse:{value:new Ae},modelViewMatrixInverseTranspose:{value:new Ae},shrink:{value:this.parameters.shrink}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null},radius:{type:"f",value:null},radius2:{type:"f",value:null}}),this.setAttributes(i),this.makeMapping()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={defaultParameters:{configurable:!0}};return r.defaultParameters.get=function(){return ky},Object.defineProperties(t.prototype,r),t}(vT);Object.assign({disableImpostor:!1},Sp,ky);var yT=function(t,r){return r===void 0&&(r={}),!an||r&&r.disableImpostor?(t.radius=aS(t.radius,t.radius2),new Fy(t,r)):new gT(t,r)},bT=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="hyperball",this.parameters=Object.assign({shrink:{type:"number",precision:3,max:1,min:.001,buffer:!0}},this.parameters,{multipleBond:null,bondSpacing:null})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};n.radiusScale=O(n.radiusScale,.2),n.radiusType=O(n.radiusType,"vdw"),n.useInteriorColor=O(n.useInteriorColor,!0),this.shrink=O(n.shrink,.12),e.prototype.init.call(this,n)},t.prototype.getBondParams=function(i,n){return(!i||i.radius)&&(n=Object.assign({radius2:!0},n)),e.prototype.getBondParams.call(this,i,n)},t.prototype.createData=function(i){var n=new ga(i.getAtomData(this.getAtomParams()),this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0}));this.__center=new Float32Array(i.bondCount*3);var a=new yT(i.getBondData(this.getBondParams()),this.getBufferParams({shrink:this.shrink,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}));return{bufferList:[n,a]}},t.prototype.updateData=function(i,n){var a=n.sview.getAtomData(this.getAtomParams()),o=n.sview.getBondData(this.getBondParams()),s={},u={};if(!i||i.position){Object.assign(s,{position:a.position});var c=o.position1,f=o.position2;Object.assign(u,{position:on(c,f,this.__center),position1:c,position2:f})}(!i||i.color)&&(Object.assign(s,{color:a.color}),Object.assign(u,{color:o.color,color2:o.color2})),(!i||i.radius)&&(Object.assign(s,{radius:a.radius}),Object.assign(u,{radius:o.radius,radius2:o.radius2})),n.bufferList[0].setAttributes(s),n.bufferList[1].setAttributes(u)},t}(Ny);or.add("hyperball",bT);var xT={"":"",atomname:"atom name",atomindex:"atom index",occupancy:"occupancy",bfactor:"b-factor",serial:"serial",element:"element",atom:"atom name + index",resname:"residue name",resno:"residue no",res:"one letter code + no",residue:"[residue name] + no + inscode",text:"text",format:"format",qualified:"qualified name"},Pf=function(t,r,i){r===void 0&&(r={}),i===void 0&&(i=""),this.type=t,this.text=r,this.format=i};Pf.prototype.atomLabel=function(t){var r=this.type,i;switch(r){case"atomname":i=t.atomname;break;case"atomindex":i=""+t.index;break;case"occupancy":i=t.occupancy.toFixed(2);break;case"bfactor":i=t.bfactor.toFixed(2);break;case"serial":i=""+t.serial;break;case"element":i=t.element;break;case"atom":i=t.atomname+"|"+t.index;break;case"resname":i=t.resname;break;case"resno":i=""+t.resno;break;case"res":i=""+(wf[t.resname.toUpperCase()]||t.resname)+t.resno;break;case"residue":var n=wf[t.resname.toUpperCase()];n&&!t.inscode?i=""+n+t.resno:i="["+t.resname+"]"+t.resno+t.inscode;break;case"text":i=this.text[t.index];break;case"format":i=ii(this.format,t);break;default:i=t.qualifiedName();break}return i===void 0?"":i};Pf.types=xT;var _T=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="label",this.parameters=Object.assign({labelType:{type:"select",options:Pf.types,rebuild:!0},labelText:{type:"hidden",rebuild:!0},labelFormat:{type:"text",rebuild:!0},labelGrouping:{type:"select",options:{atom:"atom",residue:"residue"},rebuild:!0},fontFamily:{type:"select",options:{"sans-serif":"sans-serif",monospace:"monospace",serif:"serif"},buffer:!0},fontStyle:{type:"select",options:{normal:"normal",italic:"italic"},buffer:!0},fontWeight:{type:"select",options:{normal:"normal",bold:"bold"},buffer:!0},xOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},yOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},zOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},attachment:{type:"select",options:{"bottom-left":"bottom-left","bottom-center":"bottom-center","bottom-right":"bottom-right","middle-left":"middle-left","middle-center":"middle-center","middle-right":"middle-right","top-left":"top-left","top-center":"top-center","top-right":"top-right"},rebuild:!0},showBorder:{type:"boolean",buffer:!0},borderColor:{type:"color",buffer:!0},borderWidth:{type:"number",precision:2,max:.3,min:0,buffer:!0},showBackground:{type:"boolean",rebuild:!0},backgroundColor:{type:"color",buffer:!0},backgroundMargin:{type:"number",precision:2,max:2,min:0,rebuild:!0},backgroundOpacity:{type:"range",step:.01,max:1,min:0,buffer:!0},fixedSize:{type:"boolean",buffer:!0}},this.parameters,{side:null,flatShaded:null,wireframe:null,linewidth:null,roughness:null,metalness:null,diffuse:null}),this.init(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};this.labelType=O(n.labelType,"res"),this.labelText=O(n.labelText,{}),this.labelFormat=O(n.labelFormat,""),this.labelGrouping=O(n.labelGrouping,"atom"),this.fontFamily=O(n.fontFamily,"sans-serif"),this.fontStyle=O(n.fontStyle,"normal"),this.fontWeight=O(n.fontWeight,"bold"),this.xOffset=O(n.xOffset,0),this.yOffset=O(n.yOffset,0),this.zOffset=O(n.zOffset,.5),this.attachment=O(n.attachment,"bottom-left"),this.showBorder=O(n.showBorder,!1),this.borderColor=O(n.borderColor,"lightgrey"),this.borderWidth=O(n.borderWidth,.15),this.showBackground=O(n.showBackground,!1),this.backgroundColor=O(n.backgroundColor,"lightgrey"),this.backgroundMargin=O(n.backgroundMargin,.5),this.backgroundOpacity=O(n.backgroundOpacity,1),this.fixedSize=O(n.fixedSize,!1),e.prototype.init.call(this,n)},t.prototype.getTextData=function(i,n){var a=this.getAtomParams(n),o=new Pf(this.labelType,this.labelText,this.labelFormat),s,u,c,f,l,h,d;if(this.labelGrouping==="atom"){var p=i.getAtomData(a);s=p.position,u=p.radius,c=p.color,(!n||n.text)&&(f=[],i.eachAtom(function(y){return f.push(o.atomLabel(y))}))}else if(this.labelGrouping==="residue"){(!n||n.position)&&(l=[]),(!n||n.color)&&(d=[]),(!n||n.radius)&&(h=[]),(!n||n.text)&&(f=[]),a.colorParams&&(a.colorParams.structure=i.getStructure());var v=Tt.getScheme(a.colorParams),m=new pn(a.radiusParams),g=i.getAtomProxy(),x=0;i.eachResidue(function(y){var b=x*3;y.isProtein()||y.isNucleic()?(g.index=y.traceAtomIndex,(!n||n.position)&&g.positionToArray(l,b)):(g.index=y.atomOffset,(!n||n.position)&&y.positionToArray(l,b)),(!n||n.color)&&v.atomColorToArray(g,d,b),(!n||n.radius)&&(h[x]=m.atomRadius(g)),(!n||n.text)&&f.push(o.atomLabel(g)),++x}),(!n||n.position)&&(s=new Float32Array(l)),(!n||n.color)&&(c=new Float32Array(d)),(!n||n.radius)&&(u=new Float32Array(h))}return{position:s,size:u,color:c,text:f}},t.prototype.createData=function(i){var n={position:!0,color:!0,radius:!0,text:!0},a=new cs(this.getTextData(i,n),this.getBufferParams({fontFamily:this.fontFamily,fontStyle:this.fontStyle,fontWeight:this.fontWeight,xOffset:this.xOffset,yOffset:this.yOffset,zOffset:this.zOffset,attachment:this.attachment,showBorder:this.showBorder,borderColor:this.borderColor,borderWidth:this.borderWidth,showBackground:this.showBackground,backgroundColor:this.backgroundColor,backgroundMargin:this.backgroundMargin,backgroundOpacity:this.backgroundOpacity,fixedSize:this.fixedSize}));return{bufferList:[a]}},t.prototype.updateData=function(i,n){n.bufferList[0].setAttributes(this.getTextData(n.sview,i))},t.prototype.getAtomRadius=function(){return 0},t}(Xr);or.add("label",_T);function wT(e){var t=e.getAtomSet(),r=e.getBondSet(),i=e.getBondProxy();return r.forEach(function(n){i.index=n,t.clear(i.atomIndex1),t.clear(i.atomIndex2)}),t}var AT=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="line",this.parameters=Object.assign({multipleBond:{type:"select",rebuild:!0,options:{off:"off",symmetric:"symmetric",offset:"offset"}},bondSpacing:{type:"number",precision:2,max:2,min:.5},linewidth:{type:"integer",max:50,min:1,buffer:!0},lines:{type:"boolean",rebuild:!0},crosses:{type:"select",rebuild:!0,options:{off:"off",lone:"lone",all:"all"}},crossSize:{type:"number",precision:2,max:2,min:.1}},this.parameters,{flatShaded:null,side:null,wireframe:null,roughness:null,metalness:null}),this.init(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};this.multipleBond=O(n.multipleBond,"off"),this.bondSpacing=O(n.bondSpacing,1),this.linewidth=O(n.linewidth,2),this.lines=O(n.lines,!0),this.crosses=O(n.crosses,"lone"),this.crossSize=O(n.crossSize,.4),e.prototype.init.call(this,n)},t.prototype.getAtomRadius=function(i){return .1},t.prototype.getBondParams=function(i,n){return n=Object.assign({multipleBond:this.multipleBond,bondSpacing:this.bondSpacing,radiusParams:{type:"size",size:.1,scale:1}},n),e.prototype.getBondParams.call(this,i,n)},t.prototype._crossData=function(i,n){if(!(i&&!i.position&&!i.color)){var a={};this.crosses==="lone"&&Object.assign(a,{atomSet:wT(n)});var o=n.getAtomData(this.getAtomParams(i,a)),s={},u=o.position,c=o.color,f=o.picking,l=(u||c).length,h=l*3,d=new Float32Array(0),p=new Float32Array(0),v=new Float32Array(0),m=new Float32Array(0),g,x=new Float32Array(0);(!i||i.position)&&(d=s.position1=new Float32Array(h),p=s.position2=new Float32Array(h),g=this.crossSize/2),(!i||i.color)&&(v=s.color=new Float32Array(h),m=s.color2=new Float32Array(h)),(!i||i.picking)&&(x=new Float32Array(o.picking.array.length*3));for(var y=0;y<l;y++){var b=y*3,_=b*3;if(!i||i.position){var w=u[b],A=u[b+1],S=u[b+2];d[_]=w-g,d[_+1]=A,d[_+2]=S,p[_]=w+g,p[_+1]=A,p[_+2]=S,d[_+3]=w,d[_+4]=A-g,d[_+5]=S,p[_+3]=w,p[_+4]=A+g,p[_+5]=S,d[_+6]=w,d[_+7]=A,d[_+8]=S-g,p[_+6]=w,p[_+7]=A,p[_+8]=S+g}if(!i||i.color)for(var M=_+9,E=_;E<M;E+=3)v[E]=m[E]=c[b],v[E+1]=m[E+1]=c[b+1],v[E+2]=m[E+2]=c[b+2];(!i||i.picking)&&(x[b]=x[b+1]=x[b+2]=f.array[y])}return(!i||i.picking)&&(s.picking=new Za(x,f.structure)),s}},t.prototype.createData=function(i){var n={position:!0,color:!0,picking:!0},a=[];if(this.lines){var o=i.getBondData(this.getBondParams(n)),s=new ca(o,this.getBufferParams({linewidth:this.linewidth}));a.push(s)}if(this.crosses!=="off"){var u=new ca(this._crossData(n,i),this.getBufferParams({linewidth:this.linewidth}));a.push(u)}return{bufferList:a}},t.prototype.updateData=function(i,n){var a=0;if(this.lines){var o=n.sview.getBondData(this.getBondParams(i)),s={};(!i||i.position)&&Object.assign(s,{position1:o.position1,position2:o.position2}),(!i||i.color)&&Object.assign(s,{color:o.color,color2:o.color2}),n.bufferList[a++].setAttributes(s)}if(this.crosses!=="off"){var u=this._crossData(i,n.sview),c={};(!i||i.position)&&Object.assign(c,{position1:u.position1,position2:u.position2}),(!i||i.color)&&Object.assign(c,{color:u.color,color2:u.color2}),n.bufferList[a++].setAttributes(c)}},t.prototype.setParameters=function(i){var n=!1,a={};return i&&(i.bondSpacing||i.crossSize)&&Object.assign(a,{position:!0}),e.prototype.setParameters.call(this,i,a,n),this},t}(Xr);or.add("line",AT);function zy(e,t,r,i,n){i=i||Int32Array,n=n||1;var a=new i(e*t*r*n);function o(l,h,d){return((l*t+h)*r+d)*n}function s(l,h,d){for(var p=[],v=arguments.length-3;v-- >0;)p[v]=arguments[v+3];for(var m=o(l,h,d),g=0;g<n;++g)a[m+g]=p[g]}function u(l,h,d,p,v){p===void 0&&(p=[]),v===void 0&&(v=0);for(var m=o(l,h,d),g=0;g<n;++g)p[v+g]=a[m+g]}function c(l,h,d,p,v){v===void 0&&(v=0);for(var m=o(l,h,d),g=0;g<n;++g)a[m+g]=p[v+g]}function f(l){a.set(l.data)}return{data:a,index:o,set:s,toArray:u,fromArray:c,copy:f}}function Tf(e,t,r){var i=ay(t),n=Lu(e);e.length===0&&(n[0].set([0,0,0]),n[1].set([0,0,0]));var a=n[0],o=n[1],s,u,c,f,l,h,d,p,v,m,g,x,y,b,_;function w(L,U,k,ee,K){s=U||1.4,u=k||2,x=K||!0;var te=0;for(var Y in i)te=Math.max(te,Y);var J=Nu(a,o,te,u,L?s:0);f=J.dim[0],l=J.dim[1],h=J.dim[2],d=J.matrix,p=J.tran,u=J.scaleFactor,v={},m={},T(L),g=s*u,ee?c=ee:c=s/u,y=new Uint8Array(f*l*h),L&&(b=new Float64Array(f*l*h)),x&&(_=new Int32Array(f*l*h))}var A=1,S=2,M=4,E=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])];this.getVolume=function(L,U,k,ee,K){console.time("EDTSurface.getVolume");var te=L!=="vws";w(te,U,k,ee,K),X(te),Q(),(L==="ms"||L==="ses")&&N(),L==="ses"&&(T(!1),Z()),W(L);for(var Y=0,J=_.length;Y<J;++Y)_[Y]=r[_[Y]];return console.timeEnd("EDTSurface.getVolume"),{data:y,nx:h,ny:l,nz:f,atomindex:_}},this.getSurface=function(L,U,k,ee,K,te,Y){var J=this.getVolume(L,U,k,ee,K),j=new sa(J.data,J.nx,J.ny,J.nz,J.atomindex);return j.getSurface(1,te,void 0,d,Y)};function T(L){var U,k,ee,K,te,Y,J,j,ae,re;for(var le in i)if(U=parseFloat(le),!v[le]){for(L?J=(U+s)*u+.5:J=U*u+.5,Y=J*J,j=Math.floor(J)+1,ae=new Int32Array(j*j),re=0,k=0;k<j;++k)for(ee=0;ee<j;++ee)K=k*k+ee*ee,K>Y?ae[re]=-1:(te=Math.sqrt(Y-K),ae[re]=Math.floor(te)),++re;m[le]=j,v[le]=ae}}function H(L){var U=L*3,k=L,ee,K,te,Y,J,j,ae,re,le,Se,_e,ne,ve,se,xe,he,ye,pe;ee=Math.floor(.5+u*(e[U]+p[0])),K=Math.floor(.5+u*(e[U+1]+p[1])),te=Math.floor(.5+u*(e[U+2]+p[2]));var Pe=t[k],He=v[Pe],Je=0,We=l*h,Be=m[Pe],ie;for(Se=0;Se<Be;++Se)for(_e=0;_e<Be;++_e){if(ie=He[Je],ie!==-1){for(he=-1;he<2;++he)for(ye=-1;ye<2;++ye)for(pe=-1;pe<2;++pe)if(he!==0&&ye!==0&&pe!==0){for(ae=he*Se,le=pe*_e,ne=0;ne<=ie;++ne)if(re=ne*ye,ve=ee+ae,se=K+re,xe=te+le,!(ve<0||se<0||xe<0||ve>=f||se>=l||xe>=h)){var we=ve*We+se*h+xe;if(!x)y[we]|=A;else if(!(y[we]&A))y[we]|=A,_[we]=L;else if(y[we]&A){var Ie=_[we];Ie!==U&&(Y=ee+ae-Math.floor(.5+u*(e[Ie]+p[0])),J=K+re-Math.floor(.5+u*(e[Ie+1]+p[1])),j=te+le-Math.floor(.5+u*(e[Ie+2]+p[2])),ae*ae+re*re+le*le<Y*Y+J*J+j*j&&(_[we]=L))}}}}Je++}}function X(L){console.time("EDTSurface fillvoxels");var U,k;for(U=0,k=y.length;U<k;++U)y[U]=0,L&&(b[U]=-1),x&&(_[U]=-1);for(U=0,k=e.length/3;U<k;++U)H(U);for(U=0,k=y.length;U<k;++U)y[U]&A&&(y[U]|=S);console.timeEnd("EDTSurface fillvoxels")}function q(L){var U=L*3,k=L,ee,K,te,Y,J,j,ae=0,re,le,Se,_e,ne,ve,se,xe,he,ye,pe,Pe,He;ee=Math.floor(.5+u*(e[U]+p[0])),K=Math.floor(.5+u*(e[U+1]+p[1])),te=Math.floor(.5+u*(e[U+2]+p[2]));var Je=t[k],We=l*h;for(se=0,He=m[Je];se<He;++se)for(xe=0;xe<He;++xe){if(v[Je][ae]!==-1){for(ye=-1;ye<2;++ye)for(pe=-1;pe<2;++pe)for(Pe=-1;Pe<2;++Pe)if(ye!==0&&pe!==0&&Pe!==0){for(re=ye*se,Se=Pe*xe,he=0;he<=v[Je][ae];++he)if(le=he*pe,_e=ee+re,ne=K+le,ve=te+Se,!(_e<0||ne<0||ve<0||_e>=f||ne>=l||ve>=h)){var Be=_e*We+ne*h+ve;if(!(y[Be]&S))y[Be]|=S,x&&(_[Be]=L);else if(x){var ie=_[Be];Y=Math.floor(.5+u*(e[ie]+p[0])),J=Math.floor(.5+u*(e[ie+1]+p[1])),j=Math.floor(.5+u*(e[ie+2]+p[2])),re*re+le*le+Se*Se<Y*Y+J*J+j*j&&(_[Be]=L)}}}}ae++}}function Z(){var L,U;for(L=0,U=y.length;L<U;++L)y[L]&=~S;for(L=0,U=e.length/3;L<U;++L)q(L)}function Q(){var L,U,k,ee=l*h;for(L=0;L<f;++L)for(U=0;U<h;++U)for(k=0;k<l;++k){var K=L*ee+k*h+U;if(y[K]&A)for(var te=0;te<26;){var Y=L+E[te][0],J=U+E[te][2],j=k+E[te][1];if(Y>-1&&Y<f&&j>-1&&j<l&&J>-1&&J<h&&!(y[Y*ee+j*h+J]&A)){y[K]|=M;break}else te++}}}function N(){console.time("EDTSurface fastdistancemap");var L,U,k,ee,K=zy(f,l,h,Uint16Array,3),te=l*h,Y=g*g,J=0,j;for(L=0;L<f;++L)for(U=0;U<l;++U)for(k=0;k<h;++k)j=L*te+U*h+k,y[j]&=~S,y[j]&A&&y[j]&M&&(K.set(L,U,k,L,U,k),b[j]=0,y[j]|=S,J+=1);var ae=new Int32Array(3*J),re=0,le=new Int32Array(3*J),Se=0;for(L=0;L<f;++L)for(U=0;U<l;++U)for(k=0;k<h;++k)j=L*te+U*h+k,y[j]&M&&(ae[re]=L,ae[re+1]=U,ae[re+2]=k,re+=3,y[j]&=~M);do for(Se=D(ae,K,re,le),re=0,L=0,ee=Se;L<ee;L+=3)j=te*le[L]+h*le[L+1]+le[L+2],y[j]&=~M,b[j]<=1.0404*Y&&(ae[re]=le[L],ae[re+1]=le[L+1],ae[re+2]=le[L+2],re+=3);while(re>0);var _e=c*c,ne,ve=new Uint16Array(3);for(L=0;L<f;++L)for(U=0;U<l;++U)for(k=0;k<h;++k)j=L*te+U*h+k,y[j]&=~M,y[j]&A&&(!(y[j]&S)||y[j]&S&&b[j]>=_e)&&(y[j]|=M,x&&y[j]&S&&(K.toArray(L,U,k,ve),ne=ve[0]*te+ve[1]*h+ve[2],_[j]=_[ne]));console.timeEnd("EDTSurface fastdistancemap")}function D(L,U,k,ee){var K,te,Y,J,j,ae,re,le,Se,_e,ne,ve,se=new Uint16Array(3),xe=0;if(k===0)return xe;var he=-1,ye=-1,pe=-1,Pe=l*h;for(re=0,Se=k;re<Se;re+=3)for(K=L[re],te=L[re+1],Y=L[re+2],U.toArray(K,te,Y,se),le=0;le<6;++le)ve=E[le],he=K+ve[0],ye=te+ve[1],pe=Y+ve[2],he<f&&he>-1&&ye<l&&ye>-1&&pe<h&&pe>-1&&(ne=he*Pe+h*ye+pe,y[ne]&A&&!(y[ne]&S)?(U.fromArray(he,ye,pe,se),J=he-se[0],j=ye-se[1],ae=pe-se[2],_e=J*J+j*j+ae*ae,b[ne]=_e,y[ne]|=S,y[ne]|=M,ee[xe]=he,ee[xe+1]=ye,ee[xe+2]=pe,xe+=3):y[ne]&A&&y[ne]&S&&(J=he-se[0],j=ye-se[1],ae=pe-se[2],_e=J*J+j*j+ae*ae,_e<b[ne]&&(U.fromArray(he,ye,pe,se),b[ne]=_e,y[ne]&M||(y[ne]|=M,ee[xe]=he,ee[xe+1]=ye,ee[xe+2]=pe,xe+=3))));for(re=0,Se=k;re<Se;re+=3)for(K=L[re],te=L[re+1],Y=L[re+2],U.toArray(K,te,Y,se),le=6;le<18;le++)ve=E[le],he=K+ve[0],ye=te+ve[1],pe=Y+ve[2],he<f&&he>-1&&ye<l&&ye>-1&&pe<h&&pe>-1&&(ne=he*Pe+h*ye+pe,y[ne]&A&&!(y[ne]&S)?(U.fromArray(he,ye,pe,se),J=he-se[0],j=ye-se[1],ae=pe-se[2],_e=J*J+j*j+ae*ae,b[ne]=_e,y[ne]|=S,y[ne]|=M,ee[xe]=he,ee[xe+1]=ye,ee[xe+2]=pe,xe+=3):y[ne]&A&&y[ne]&S&&(J=he-se[0],j=ye-se[1],ae=pe-se[2],_e=J*J+j*j+ae*ae,_e<b[ne]&&(U.fromArray(he,ye,pe,se),b[ne]=_e,y[ne]&M||(y[ne]|=M,ee[xe]=he,ee[xe+1]=ye,ee[xe+2]=pe,xe+=3))));for(re=0,Se=k;re<Se;re+=3)for(K=L[re],te=L[re+1],Y=L[re+2],U.toArray(K,te,Y,se),le=18;le<26;le++)ve=E[le],he=K+ve[0],ye=te+ve[1],pe=Y+ve[2],he<f&&he>-1&&ye<l&&ye>-1&&pe<h&&pe>-1&&(ne=he*Pe+h*ye+pe,y[ne]&A&&!(y[ne]&S)?(U.fromArray(he,ye,pe,se),J=he-se[0],j=ye-se[1],ae=pe-se[2],_e=J*J+j*j+ae*ae,b[ne]=_e,y[ne]|=S,y[ne]|=M,ee[xe]=he,ee[xe+1]=ye,ee[xe+2]=pe,xe+=3):y[ne]&A&&y[ne]&S&&(J=he-se[0],j=ye-se[1],ae=pe-se[2],_e=J*J+j*j+ae*ae,_e<b[ne]&&(U.fromArray(he,ye,pe,se),b[ne]=_e,y[ne]&M||(y[ne]|=M,ee[xe]=he,ee[xe+1]=ye,ee[xe+2]=pe,xe+=3))));return xe}function W(L){var U,k=y.length;if(L==="vws")for(U=0;U<k;++U)y[U]&=~M,y[U]=y[U]&S?1:0;else if(L==="ms")for(U=0;U<k;++U)y[U]&=~S,y[U]&M&&(y[U]|=S),y[U]&=~M,y[U]=y[U]&S?1:0;else if(L==="ses")for(U=0;U<k;++U)y[U]&M&&y[U]&S?y[U]&=~M:y[U]&M&&!(y[U]&S)&&(y[U]|=S),y[U]=y[U]&S?1:0;else if(L==="sas")for(U=0;U<k;++U)y[U]&=~M,y[U]=y[U]&S?1:0}}Object.assign(Tf,{__deps:[Nu,ay,sa,Lu,zy]});function Uy(e,t,r,i,n,a,o){var s=e.length,u=n[0],c=n[1],f=n[2],l=a[0],h=a[1],d=a[2];function p(W,L){return Math.floor((W-L)/o)}for(var v=p(l,u)+1,m=p(h,c)+1,g=p(d,f)+1,x=v*m*g,y=m*g,b=function(W,L,U){return(p(W,u)*m+p(L,c))*g+p(U,f)},_=[],w=0;w<s;w++){var A=b(e[w],t[w],r[w]);_[A]===void 0?_[A]=[w]:_[A].push(w)}var S=new Uint32Array(x),M=new Uint16Array(x),E=new Uint32Array(s),T=0,H=0;for(w=0;w<x;w++){var X=S[w]=T,q=_[w];if(q!==void 0)for(var Z=0;Z<q.length;Z++)E[T]=q[Z],T++;var Q=T-X;M[w]=Q,Q>H&&(H=Q)}var N=27*H+1,D=function(W,L,U,k,ee){for(var K=0,te=p(W,u),Y=p(L,c),J=p(U,f),j=Math.max(0,te-1),ae=Math.max(0,Y-1),re=Math.max(0,J-1),le=Math.min(v,te+2),Se=Math.min(m,Y+2),_e=Math.min(g,J+2),ne=j;ne<le;++ne)for(var ve=ne*y,se=ae;se<Se;++se)for(var xe=se*g,he=re;he<_e;++he)for(var ye=ve+xe+he,pe=S[ye],Pe=pe+M[ye],He=pe;He<Pe;He++){var Je=E[He],We=e[Je]-W,Be=t[Je]-L,ie=r[Je]-U,we=i[Je]+k;We*We+Be*Be+ie*ie<=we*we&&(ee[K++]=E[He])}ee[K]=-1};return{neighbourListLength:N,withinRadii:D}}function Ef(e,t,r){for(var i=t.length,n=new Float32Array(i),a=new Float32Array(i),o=new Float32Array(i),s=0;s<i;s++){var u=3*s;n[s]=e[u],a[s]=e[u+1],o[s]=e[u+2]}var c=Lu(e);e.length===0&&(c[0].set([0,0,0]),c[1].set([0,0,0]));var f=c[0],l=c[1],h,d,p,v,m,g,x,y=-1,b,_,w,A,S,M,E,T,H,X,q,Z=new Float32Array([0,0,0]),Q=new Float32Array([0,0,0]),N=new Float32Array([0,0,0]),D=new Float32Array([0,0,0]),W;function L(ne,ve,se,xe){v=O(ne,1.4),m=O(ve,2),g=O(se,!0),x=O(xe,30),h=new Float32Array(i),d=new Float32Array(i);for(var he=0;he<h.length;++he){var ye=t[he]+v;h[he]=ye,d[he]=ye*ye}p=0;for(var pe=0;pe<h.length;++pe)h[pe]>p&&(p=h[pe]);k(),ee(),K(),y=-1}function U(ne,ve,se){for(var xe=0;xe<ne.length;xe++)ne[xe]=ve+se*xe}function k(){var ne=Nu(f,l,p,m,0);m=ne.scaleFactor,b=ne.dim,_=ne.matrix,W=Math.max(5,2+Math.floor(v*m)),w=pi(b[0]*b[1]*b[2],-1001),A=new Int32Array(w.length),S=new Float32Array(b[0]),M=new Float32Array(b[1]),E=new Float32Array(b[2]),U(S,f[0],1/m),U(M,f[1],1/m),U(E,f[2],1/m)}function ee(){var ne=0,ve=2*Math.PI/x;H=new Float32Array(x),T=new Float32Array(x);for(var se=0;se<x;se++)H[se]=Math.cos(ne),T[se]=Math.sin(ne),ne+=ve}function K(){X=Uy(n,a,o,h,f,l,2.01*p),q=new Int32Array(X.neighbourListLength)}function te(ne,ve,se,xe,he){var ye;if(y!==-1){if(ye=y,ye!==xe&&ye!==he&&Y(ye,ne,ve,se))return ye;y=-1}var pe=0;for(ye=q[pe];ye>=0;){if(ye!==xe&&ye!==he&&Y(ye,ne,ve,se))return y=ye,ye;ye=q[++pe]}return y=-1,-1}function Y(ne,ve,se,xe){var he=3*ne,ye=d[ne],pe=e[he]-ve,Pe=e[he+1]-se,He=e[he+2]-xe,Je=pe*pe+Pe*Pe+He*He;return Je<ye}function J(){for(var ne=0;ne<i;ne++){var ve=n[ne],se=a[ne],xe=o[ne],he=h[ne],ye=d[ne];X.withinRadii(ve,se,xe,he,q);for(var pe=Math.ceil(he*m),Pe=Math.floor(m*(ve-f[0])),He=Math.floor(m*(se-f[1])),Je=Math.floor(m*(xe-f[2])),We=Math.max(0,Pe-pe),Be=Math.max(0,He-pe),ie=Math.max(0,Je-pe),we=Math.min(b[0],Pe+pe+2),Ie=Math.min(b[1],He+pe+2),qe=Math.min(b[2],Je+pe+2),Ce=We;Ce<we;Ce++)for(var Ne=S[Ce]-ve,Ze=b[1]*b[2]*Ce,Ve=Be;Ve<Ie;Ve++)for(var Qe=M[Ve]-se,Ye=Ne*Ne+Qe*Qe,vt=Ze+b[2]*Ve,Nt=ie;Nt<qe;Nt++){var Rt=E[Nt]-xe,Gt=Ye+Rt*Rt;if(Gt<ye){var Et=Nt+vt;w[Et]<0&&(w[Et]=-w[Et]);var Mt=Math.sqrt(Gt),bt=he/Mt,rt=Ne*bt,Ke=Qe*bt,Ft=Rt*bt;if(rt+=ve,Ke+=se,Ft+=xe,te(rt,Ke,Ft,ne,-1)===-1){var Zt=he-Mt;Zt<w[Et]&&(w[Et]=Zt,g&&(A[Et]=ne))}}}}}function j(){for(var ne=0;ne<i;ne++){X.withinRadii(n[ne],a[ne],o[ne],h[ne],q);for(var ve=0,se=q[ve];se>=0;)ne<se&&ae(ne,se),se=q[++ve]}}function ae(ne,ve){var se=h[ne],xe=h[ve],he=Z[0]=n[ve]-n[ne],ye=Z[1]=a[ve]-a[ne],pe=Z[2]=o[ve]-o[ne],Pe=he*he+ye*ye+pe*pe,He=Math.sqrt(Pe),Je=(se*se+He*He-xe*xe)/(2*se*He),We=se*Je;zr(Z,Z),re(N,Z),zr(N,N),wi(D,Z,N),zr(D,D);var Be=Math.sqrt(se*se-We*We);pr(N,N,Be),pr(D,D,Be),pr(Z,Z,We),Q[0]=Z[0]+n[ne],Q[1]=Z[1]+a[ne],Q[2]=Z[2]+o[ne],y=-1;for(var ie=W,we=0;we<x;we++){var Ie=H[we],qe=T[we],Ce=Q[0]+Ie*N[0]+qe*D[0],Ne=Q[1]+Ie*N[1]+qe*D[1],Ze=Q[2]+Ie*N[2]+qe*D[2];if(te(Ce,Ne,Ze,ne,ve)===-1)for(var Ve=Math.floor(m*(Ce-f[0])),Qe=Math.floor(m*(Ne-f[1])),Ye=Math.floor(m*(Ze-f[2])),vt=Math.max(0,Ve-ie),Nt=Math.max(0,Qe-ie),Rt=Math.max(0,Ye-ie),Gt=Math.min(b[0],Ve+ie+2),Et=Math.min(b[1],Qe+ie+2),Mt=Math.min(b[2],Ye+ie+2),bt=vt;bt<Gt;bt++){he=Ce-S[bt];for(var rt=b[1]*b[2]*bt,Ke=Nt;Ke<Et;Ke++){ye=Ne-M[Ke];for(var Ft=he*he+ye*ye,Zt=rt+b[2]*Ke,dr=Rt;dr<Mt;dr++){pe=Ze-E[dr],Pe=Ft+pe*pe;var Xt=dr+Zt,P=w[Xt];if(P>0&&Pe<P*P&&(w[Xt]=Math.sqrt(Pe),g)){var F=he*Z[0]+ye*Z[1]+pe*Z[2];A[Xt]=F<0?ve:ne}}}}}}function re(ne,ve){return ne[0]=ne[1]=ne[2]=1,ve[0]!==0?ne[0]=(ve[1]+ve[2])/-ve[0]:ve[1]!==0?ne[1]=(ve[0]+ve[2])/-ve[1]:ve[2]!==0&&(ne[2]=(ve[0]+ve[1])/-ve[2]),ne}function le(){for(var ne=0;ne<w.length;ne++)w[ne]<0&&(w[ne]=0)}function Se(){for(var ne=0;ne<A.length;ne++)A[ne]=r[A[ne]]}function _e(ne,ve,se){console.time("AVSurface.getVolume"),console.time("AVSurface.init"),L(ne,ve,se),console.timeEnd("AVSurface.init"),console.time("AVSurface.projectPoints"),J(),console.timeEnd("AVSurface.projectPoints"),console.time("AVSurface.projectTorii"),j(),console.timeEnd("AVSurface.projectTorii"),le(),Se(),console.timeEnd("AVSurface.getVolume")}this.getSurface=function(ne,ve,se,xe,he,ye,pe){_e(ve,se,he);var Pe=new sa(w,b[2],b[1],b[0],A);return Pe.getSurface(ve,!1,void 0,_,pe)}}Object.assign(Ef,{__deps:[Nu,sa,pi,Lu,pr,wi,zr,Uy,O]});xu.add("molsurf",function(t,r){var i=t.data.args,n=t.data.params;if(i&&n){var a=n.type==="av"?Ef:Tf,o=new a(i.coordList,i.radiusList,i.indexList),s=o.getSurface(n.type,n.probeRadius,n.scaleFactor,n.cutoff,!0,n.smooth,n.contour),u=[s.position.buffer,s.index.buffer];s.normal&&u.push(s.normal.buffer),s.atomindex&&u.push(s.atomindex.buffer);var c={sd:s,p:n};r(c,u)}},[Tf,Ef]);var fs=function(t){this.structure=t};fs.prototype._getAtomData=function(t){return this.structure.getAtomData({what:{position:!0,radius:!0,index:!0},radiusParams:O(t.radiusParams,{type:"vdw",scale:1})})};fs.prototype._makeSurface=function(t,r){var i=new jr(r.name,"",t);return i.info.type=r.type,i.info.probeRadius=r.probeRadius,i.info.scaleFactor=r.scaleFactor,i.info.smooth=r.smooth,i.info.cutoff=r.cutoff,i};fs.prototype.getSurface=function(t){var r=t||{},i=this._getAtomData(t),n=i.position,a=i.radius,o=i.index,s=r.type==="av"?Ef:Tf,u=new s(n,a,o),c=u.getSurface(r.type,r.probeRadius,r.scaleFactor,r.cutoff,!0,r.smooth,r.contour);return this._makeSurface(c,r)};fs.prototype.getSurfaceWorker=function(t,r){var i=this,n=Object.assign({},t);if(window.hasOwnProperty("Worker")){this.worker===void 0&&(this.worker=new Vf("molsurf"));var a=this._getAtomData(t),o=a.position,s=a.radius,u=a.index,c={args:{coordList:o,radiusList:s,indexList:u},params:n},f=[o.buffer,s.buffer,u.buffer];this.worker.post(c,f,function(h){r(i._makeSurface(h.data.sd,n))},function(h){console.warn("MolecularSurface.getSurfaceWorker error - trying without worker",h),i.worker.terminate(),i.worker=void 0;var d=i.getSurface(n);r(d)})}else{var l=this.getSurface(n);r(l)}};fs.prototype.dispose=function(){this.worker&&this.worker.terminate()};var ST=function(e){function t(r,i,n){var a=this;e.call(this,r,i,n),this.type="surface",this.parameters=Object.assign({surfaceType:{type:"select",rebuild:!0,options:{vws:"vws",sas:"sas",ms:"ms",ses:"ses",av:"av"}},probeRadius:{type:"number",precision:1,max:20,min:0,rebuild:!0},smooth:{type:"integer",precision:1,max:10,min:0,rebuild:!0},scaleFactor:{type:"number",precision:1,max:5,min:0,rebuild:!0},cutoff:{type:"number",precision:2,max:50,min:0,rebuild:!0},contour:{type:"boolean",rebuild:!0},background:{type:"boolean",rebuild:!0},opaqueBack:{type:"boolean",buffer:!0},filterSele:{type:"text",rebuild:!0},colorVolume:{type:"hidden"},useWorker:{type:"boolean",rebuild:!0}},this.parameters,{radius:null,scale:null}),this.__infoList=[],this.structure.signals.refreshed.add(function(){a.__forceNewMolsurf=!0}),this.toBePrepared=!0,this.init(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};n.colorScheme=O(n.colorScheme,"uniform"),n.colorValue=O(n.colorValue,14540253),n.disablePicking=O(n.disablePicking,!0),this.surfaceType=O(n.surfaceType,"ms"),this.probeRadius=O(n.probeRadius,1.4),this.smooth=O(n.smooth,2),this.scaleFactor=O(n.scaleFactor,2),this.cutoff=O(n.cutoff,0),this.contour=O(n.contour,!1),this.background=O(n.background,!1),this.opaqueBack=O(n.opaqueBack,!0),this.filterSele=O(n.filterSele,""),this.colorVolume=O(n.colorVolume,void 0),this.useWorker=O(n.useWorker,!0),e.prototype.init.call(this,i)},t.prototype.prepareData=function(i,n,a){var o=this.__infoList[n];if(o||(o={},this.__infoList[n]=o),!o.molsurf||o.sele!==i.selection.string){if(this.filterSele){var s=i.structure.getView(new Kt(this.filterSele)),u=s.boundingBox.getSize(new I),c=Math.max(u.x,u.y,u.z),f=i.getAtomSetWithinPoint(s.center,c/2+6);i=i.getView(new Kt(i.getAtomSetWithinSelection(f,3).toSeleString()))}o.sele=i.selection.string,o.molsurf=new fs(i);var l=this.getSurfaceParams(),h=function(d){o.surface=d,a(n)};this.useWorker?o.molsurf.getSurfaceWorker(l,h):h(o.molsurf.getSurface(l))}else a(n)},t.prototype.prepare=function(i){var n=this;if((this.__forceNewMolsurf||this.__sele!==this.selection.string||this.__surfaceParams!==JSON.stringify(this.getSurfaceParams()))&&(this.__infoList.forEach(function(u){u.molsurf.dispose()}),this.__infoList.length=0),this.structureView.atomCount===0){i();return}var a=function(){n.__sele=n.selection.string,n.__surfaceParams=JSON.stringify(n.getSurfaceParams()),n.__forceNewMolsurf=!1,i()},o=this.assembly==="default"?this.defaultAssembly:this.assembly,s=this.structure.biomolDict[o];s?s.partList.forEach(function(u,c){var f=u.getView(n.structureView);n.prepareData(f,c,function(l){l===s.partList.length-1&&a()})}):this.prepareData(this.structureView,0,a)},t.prototype.createData=function(i,n){var a=this.__infoList[n],o=a.surface,s={position:o.getPosition(),color:o.getColor(this.getColorParams()),index:o.getFilteredIndex(this.filterSele,i)},u=[];if(o.contour){var c=new cy(s,this.getBufferParams({wireframe:!1}));u.push(c)}else{Object.assign(s,{normal:o.getNormal(),picking:o.getPicking(i.getStructure())});var f=new uy(s,this.getBufferParams({background:this.background,opaqueBack:this.opaqueBack,dullInterior:!1})),l=new Ri(f);u.push(l)}return{bufferList:u,info:a}},t.prototype.updateData=function(i,n){var a={};if(i.position||i.radius){this.__forceNewMolsurf=!0,this.build();return}i.color&&(a.color=n.info.surface.getColor(this.getColorParams())),i.index&&(a.index=n.info.surface.getFilteredIndex(this.filterSele,n.sview)),n.bufferList[0].setAttributes(a)},t.prototype.setParameters=function(i,n,a){return n===void 0&&(n={}),i&&i.filterSele&&(n.index=!0),i&&i.colorVolume!==void 0&&(n.color=!0),i&&i.wireframe&&(i.contour||i.contour===void 0&&this.contour)&&(i.wireframe=!1),e.prototype.setParameters.call(this,i,n,a),this},t.prototype.getSurfaceParams=function(i){i===void 0&&(i={});var n=Object.assign({type:this.surfaceType,probeRadius:this.probeRadius,scaleFactor:this.scaleFactor,smooth:this.smooth&&!this.contour,cutoff:this.cutoff,contour:this.contour,useWorker:this.useWorker,radiusParams:this.getRadiusParams()},i);return n},t.prototype.getColorParams=function(){var i=e.prototype.getColorParams.call(this);return i.volume=this.colorVolume,i},t.prototype.getAtomRadius=function(){return 0},t.prototype.clear=function(){e.prototype.clear.call(this)},t.prototype.dispose=function(){this.__infoList.forEach(function(i){i.molsurf.dispose()}),this.__infoList.length=0,e.prototype.dispose.call(this)},t}(Xr);or.add("surface",ST);var MT=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="point",this.parameters=Object.assign({pointSize:{type:"number",precision:1,max:100,min:0,buffer:!0},sizeAttenuation:{type:"boolean",buffer:!0},sortParticles:{type:"boolean",rebuild:!0},useTexture:{type:"boolean",buffer:!0},alphaTest:{type:"range",step:.001,max:1,min:0,buffer:!0},forceTransparent:{type:"boolean",buffer:!0},edgeBleach:{type:"range",step:.001,max:1,min:0,buffer:!0}},this.parameters,{flatShaded:null,wireframe:null,linewidth:null,side:null,roughness:null,metalness:null}),this.init(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};this.pointSize=O(n.pointSize,1),this.sizeAttenuation=O(n.sizeAttenuation,!0),this.sortParticles=O(n.sortParticles,!1),this.useTexture=O(n.useTexture,!1),this.alphaTest=O(n.alphaTest,.5),this.forceTransparent=O(n.forceTransparent,!1),this.edgeBleach=O(n.edgeBleach,0),e.prototype.init.call(this,n)},t.prototype.createData=function(i){var n={position:!0,color:!0,picking:!0},a=i.getAtomData(this.getAtomParams(n)),o=new mp(a,this.getBufferParams({pointSize:this.pointSize,sizeAttenuation:this.sizeAttenuation,sortParticles:this.sortParticles,useTexture:this.useTexture,alphaTest:this.alphaTest,forceTransparent:this.forceTransparent,edgeBleach:this.edgeBleach}));return{bufferList:[o]}},t.prototype.updateData=function(i,n){var a=n.sview.getAtomData(this.getAtomParams(i)),o={};(!i||i.position)&&Object.assign(o,{position:a.position}),(!i||i.color)&&Object.assign(o,{color:a.color}),n.bufferList[0].setAttributes(o)},t.prototype.getAtomRadius=function(){return .1},t}(Xr);or.add("point",MT);Ut.add("shader/Ribbon.vert",`#define STANDARD
uniform float clipNear;
uniform vec3 clipCenter;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
attribute vec3 dir;
attribute float size;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#endif
#include common
void main(void){
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#include beginnormal_vertex
#include defaultnormal_vertex
#ifndef FLAT_SHADED
vNormal = normalize( transformedNormal );
#endif
#endif
#include begin_vertex
transformed += normalize( dir ) * size;
#include project_vertex
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`);var CT=new Uint16Array([0,1,2,1,3,2]);function bs(e){var t=e.position.length/3-1,r=t*4,i=r*3;return i}var PT=function(e){function t(r,i){i===void 0&&(i={}),e.call(this,{position:new Float32Array(bs(r)),color:new Float32Array(bs(r)),index:dn(bs(r),bs(r)/3),normal:new Float32Array(bs(r)),picking:r.picking},i),this.vertexShader="Ribbon.vert";var n=r.position.length/3-1,a=n*4,o=a*3;this.addAttributes({dir:{type:"v3",value:new Float32Array(o)}}),this.addAttributes({size:{type:"f",value:new Float32Array(a)}}),r.primitiveId=jo(n),this.setAttributes(r),this.makeIndex()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setAttributes=function(i){i===void 0&&(i={});var n=this.size,a=n/4,o=this.geometry.attributes,s,u,c,f,l,h,d,p,v,m,g,x;i.position&&(s=i.position,d=o.position.array,o.position.needsUpdate=!0),i.normal&&(u=i.normal,p=o.normal.array,o.normal.needsUpdate=!0),i.size&&(c=i.size,v=o.size.array,o.size.needsUpdate=!0),i.dir&&(f=i.dir,m=o.dir.array,o.dir.needsUpdate=!0),i.color&&(l=i.color,g=o.color.array,o.color.needsUpdate=!0),i.primitiveId&&(h=i.primitiveId,x=o.primitiveId.array,o.primitiveId.needsUpdate=!0);var y,b,_,w,A,S,M,E=c?c[0]:null;for(y=0;y<a;++y){for(S=y*3,_=y*3*4,A=y*4,s&&(d[_]=d[_+3]=s[S],d[_+1]=d[_+4]=s[S+1],d[_+2]=d[_+5]=s[S+2],d[_+6]=d[_+9]=s[S+3],d[_+7]=d[_+10]=s[S+4],d[_+8]=d[_+11]=s[S+5]),u&&(p[_]=p[_+3]=-u[S],p[_+1]=p[_+4]=-u[S+1],p[_+2]=p[_+5]=-u[S+2],p[_+6]=p[_+9]=-u[S+3],p[_+7]=p[_+10]=-u[S+4],p[_+8]=p[_+11]=-u[S+5]),b=0;b<4;++b)w=_+3*b,l&&(g[w]=l[S],g[w+1]=l[S+1],g[w+2]=l[S+2]),h&&(x[A+b]=h[y]);c&&(M=c[y],E!==c[y]?(v[A]=E,v[A+1]=E,v[A+2]=M,v[A+3]=M):(v[A]=M,v[A+1]=M,v[A+2]=M,v[A+3]=M),E=M),f&&(m[_]=f[S],m[_+1]=f[S+1],m[_+2]=f[S+2],m[_+3]=-f[S],m[_+4]=-f[S+1],m[_+5]=-f[S+2],m[_+6]=f[S+3],m[_+7]=f[S+4],m[_+8]=f[S+5],m[_+9]=-f[S+3],m[_+10]=-f[S+4],m[_+11]=-f[S+5])}},t.prototype.makeIndex=function(){for(var i=this.geometry.getIndex().array,n=i.length/4/3,a=0;a<n;++a){var o=a*6,s=a*4;i.set(CT,o);for(var u=0;u<6;++u)i[o+u]+=s}},t}(ua),TT=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="ribbon",this.parameters=Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters,{side:null,wireframe:null,linewidth:null}),this.init(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};n.colorScheme=O(n.colorScheme,"chainname"),n.colorScale=O(n.colorScale,"RdYlBu"),n.radiusType=O(n.radiusType,"sstruc"),n.radiusScale=O(n.radiusScale,4),n.quality==="low"?this.subdiv=3:n.quality==="medium"?this.subdiv=6:n.quality==="high"?this.subdiv=12:this.subdiv=O(n.subdiv,6),this.tension=O(n.tension,NaN),this.smoothSheet=O(n.smoothSheet,!1),e.prototype.init.call(this,n)},t.prototype.getSplineParams=function(i){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:!0,smoothSheet:this.smoothSheet},i)},t.prototype.getAtomRadius=function(i){return i.isTrace()?e.prototype.getAtomRadius.call(this,i):0},t.prototype.createData=function(i){var n=this,a=[],o=[];return this.structure.eachPolymer(function(s){if(!(s.residueCount<4)){o.push(s);var u=new Qr(s,n.getSplineParams()),c=u.getSubdividedPosition(),f=u.getSubdividedOrientation(),l=u.getSubdividedColor(n.getColorParams()),h=u.getSubdividedPicking(),d=u.getSubdividedSize(n.getRadiusParams());a.push(new PT({position:c.position,normal:f.binormal,dir:f.normal,color:l.color,size:d.size,picking:h.picking},n.getBufferParams()))}},i.getSelection()),{bufferList:a,polymerList:o}},t.prototype.updateData=function(i,n){var a=this;i=i||{};var o=0,s=n.polymerList.length;for(o=0;o<s;++o){var u={},c=new Qr(n.polymerList[o],a.getSplineParams());if(i.position){var f=c.getSubdividedPosition(),l=c.getSubdividedOrientation();Object.assign(u,{position:f.position,normal:l.binormal,dir:l.normal})}if(i.radius||i.scale){var h=c.getSubdividedSize(a.getRadiusParams());Object.assign(u,{size:h.size})}if(i.color){var d=c.getSubdividedColor(a.getColorParams());Object.assign(u,{color:d.color})}n.bufferList[o].setAttributes(u)}},t.prototype.setParameters=function(i){var n=!1,a={};return i&&i.tension&&Object.assign(a,{position:!0}),e.prototype.setParameters.call(this,i,a,n),this},t}(Xr);or.add("ribbon",TT);var ET=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="rocket",this.parameters=Object.assign({localAngle:{type:"integer",max:180,min:0,rebuild:!0},centerDist:{type:"number",precision:1,max:10,min:0,rebuild:!0},ssBorder:{type:"boolean",rebuild:!0},radialSegments:!0,openEnded:!0,disableImpostor:!0},this.parameters),this.init(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};n.colorScheme=O(n.colorScheme,"sstruc"),n.radiusSize=O(n.radiusSize,1.5),n.radiusScale=O(n.radiusScale,1),n.openEnded=O(n.openEnded,!1),n.useInteriorColor=O(n.useInteriorColor,!0),this.localAngle=O(n.localAngle,30),this.centerDist=O(n.centerDist,2.5),this.ssBorder=O(n.ssBorder,!1),e.prototype.init.call(this,n)},t.prototype.createData=function(i){var n=this,a=0,o=[],s=[];this.structure.eachPolymer(function(h){if(!(h.residueCount<4||h.isNucleic())){var d=new up(h),p=d.getAxis(n.localAngle,n.centerDist,n.ssBorder,n.getColorParams(),n.getRadiusParams());a+=p.size.length,o.push(p),s.push(d)}},i.getSelection());var u={begin:new Float32Array(a*3),end:new Float32Array(a*3),size:new Float32Array(a),color:new Float32Array(a*3),picking:{}},c=new Float32Array(a),f=0;o.forEach(function(h){u.begin.set(h.begin,f*3),u.end.set(h.end,f*3),u.size.set(h.size,f),u.color.set(h.color,f*3),c.set(h.picking.array,f),f+=h.size.length}),a&&(u.picking=new Za(c,i.getStructure()));var l=new Wn({position1:u.begin,position2:u.end,color:u.color,color2:u.color,radius:u.size,picking:u.picking},this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}));return{bufferList:[l],axisList:o,helixbundleList:s,axisData:u}},t.prototype.updateData=function(i,n){var a=this;if(i=i||{},i.position){this.build();return}var o={};if(i.color||i.radius){var s=0;n.helixbundleList.forEach(function(u){var c=u.getAxis(a.localAngle,a.centerDist,a.ssBorder,a.getColorParams(),a.getRadiusParams());i.color&&n.axisData.color.set(c.color,s*3),(i.radius||i.scale)&&n.axisData.size.set(c.size,s),s+=c.size.length}),i.color&&Object.assign(o,{color:n.axisData.color,color2:n.axisData.color}),(i.radius||i.scale)&&Object.assign(o,{radius:n.axisData.size})}n.bufferList[0].setAttributes(o)},t}(Xr);or.add("rocket",ET);var IT=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="rope",this.parameters=Object.assign({smooth:{type:"integer",max:15,min:0,rebuild:!0}},this.parameters,{aspectRatio:null,smoothSheet:null})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};n.aspectRatio=1,n.tension=O(n.tension,.5),n.radiusScale=O(n.radiusScale,5),n.smoothSheet=!1,this.smooth=O(n.smooth,2),e.prototype.init.call(this,n)},t.prototype.getSpline=function(i){var n=new kn(i);return new Qr(i,this.getSplineParams({directional:!1,positionIterator:n.getCenterIterator(this.smooth)}))},t}(Mp);or.add("rope",IT);var RT=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="spacefill",this.parameters=Object.assign({sphereDetail:!0,disableImpostor:!0},this.parameters),this.init(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};n.useInteriorColor=O(n.useInteriorColor,!0),e.prototype.init.call(this,n)},t.prototype.createData=function(i){var n=new ga(i.getAtomData(this.getAtomParams()),this.getBufferParams({sphereDetail:this.sphereDetail,dullInterior:!0,disableImpostor:this.disableImpostor}));return{bufferList:[n]}},t.prototype.updateData=function(i,n){var a=n.sview.getAtomData(this.getAtomParams(i)),o={};(!i||i.position)&&Object.assign(o,{position:a.position}),(!i||i.color)&&Object.assign(o,{color:a.color}),(!i||i.radius)&&Object.assign(o,{radius:a.radius}),n.bufferList[0].setAttributes(o)},t}(Xr);or.add("spacefill",RT);function am(e){var t=e.position.length/3,r=t-1;return r*3*2}var LT=function(e){function t(r,i){i===void 0&&(i={}),e.call(this,{position:new Float32Array(am(r)),color:new Float32Array(am(r))},i),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag",this.setAttributes(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setAttributes=function(i){var n,a,o,s,u=this.geometry.attributes;if(i.position&&(n=i.position,o=u.position.array,u.position.needsUpdate=!0),i.color&&(a=i.color,s=u.color.array,u.color.needsUpdate=!0),!n&&!a){fe.warn("TraceBuffer.prototype.setAttributes no data");return}for(var c,f,l=this.size,h=l-1,d=0;d<h;++d)c=3*d,f=3*d*2,n&&(o[f]=n[c],o[f+1]=n[c+1],o[f+2]=n[c+2],o[f+3]=n[c+3],o[f+4]=n[c+4],o[f+5]=n[c+5]),a&&(s[f]=a[c],s[f+1]=a[c+1],s[f+2]=a[c+2],s[f+3]=a[c+3],s[f+4]=a[c+4],s[f+5]=a[c+5])},t}(It),OT=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="trace",this.parameters=Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters,{flatShaded:null,side:null,wireframe:null}),this.init(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};n.colorScheme=O(n.colorScheme,"chainname"),n.colorScale=O(n.colorScale,"RdYlBu"),n.quality==="low"?this.subdiv=3:n.quality==="medium"?this.subdiv=6:n.quality==="high"?this.subdiv=12:this.subdiv=O(n.subdiv,6),this.tension=O(n.tension,NaN),this.smoothSheet=O(n.smoothSheet,!1),e.prototype.init.call(this,n)},t.prototype.getSplineParams=function(i){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:!1,smoothSheet:this.smoothSheet},i)},t.prototype.getAtomRadius=function(i){return i.isTrace()?.1:0},t.prototype.createData=function(i){var n=this,a=[],o=[];return this.structure.eachPolymer(function(s){if(!(s.residueCount<4)){o.push(s);var u=new Qr(s,n.getSplineParams()),c=u.getSubdividedPosition(),f=u.getSubdividedColor(n.getColorParams());a.push(new LT(Object.assign({},c,f),n.getBufferParams()))}},i.getSelection()),{bufferList:a,polymerList:o}},t.prototype.updateData=function(i,n){var a=this;i=i||{};var o=0,s=n.polymerList.length;for(o=0;o<s;++o){var u={},c=new Qr(n.polymerList[o],a.getSplineParams());if(i.position){var f=c.getSubdividedPosition();Object.assign(u,{position:f.position})}if(i.color){var l=c.getSubdividedColor(a.getColorParams());Object.assign(u,{color:l.color})}n.bufferList[o].setAttributes(u)}},t.prototype.setParameters=function(i){var n=!1,a={};return i&&i.tension&&Object.assign(a,{position:!0}),e.prototype.setParameters.call(this,i,a,n),this},t}(Xr);or.add("trace",OT);var DT=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="tube",this.parameters=Object.assign({},this.parameters,{aspectRatio:null})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};n.aspectRatio=1,n.radiusScale=O(n.radiusScale,2),n.quality==="low"&&(this.radialSegments=5),e.prototype.init.call(this,n)},t.prototype.getSplineParams=function(){return e.prototype.getSplineParams.call(this,{directional:!1})},t}(Mp);or.add("tube",DT);var FT=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="unitcell",this.parameters=Object.assign({radiusSize:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,radialSegments:!0,disableImpostor:!0},this.parameters,{assembly:null}),this.init(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{},a=.5;this.structure.unitcell&&(a=Math.cbrt(this.structure.unitcell.volume)/200),n.radiusSize=O(n.radiusSize,a),n.colorValue=O(n.colorValue,"orange"),n.useInteriorColor=O(n.useInteriorColor,!0),e.prototype.init.call(this,n)},t.prototype.getUnitcellData=function(i){return i.unitcell.getData(i)},t.prototype.create=function(){var i=this.structureView.getStructure();if(i.unitcell){var n=this.getUnitcellData(i);this.sphereBuffer=new ga(n.vertex,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),this.cylinderBuffer=new Wn(n.edge,this.getBufferParams({openEnded:!0,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})),this.dataList.push({sview:this.structureView,bufferList:[this.sphereBuffer,this.cylinderBuffer]})}},t.prototype.createData=function(i){},t.prototype.updateData=function(i,n){var a=n.sview.getStructure();if(a.unitcell){var o=this.getUnitcellData(a),s={},u={};(!i||i.position)&&(Object.assign(s,{position:o.vertex.position}),Object.assign(u,{position1:o.edge.position1,position2:o.edge.position2})),(!i||i.color)&&(Object.assign(s,{color:o.vertex.color}),Object.assign(u,{color:o.edge.color,color2:o.edge.color2})),(!i||i.radius)&&(Object.assign(s,{radius:o.vertex.radius}),Object.assign(u,{radius:o.edge.radius})),this.sphereBuffer.setAttributes(s),this.cylinderBuffer.setAttributes(u)}},t}(Xr);or.add("unitcell",FT);var BT=function(e){function t(r,i,n){e.call(this,r,i,n),this.type="validation",this.parameters=Object.assign({},this.parameters,{radiusType:null,radiusSize:null,radiusScale:null}),this.init(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(i){var n=i||{};n.colorValue=O(n.colorValue,"#f0027f"),n.useInteriorColor=O(n.useInteriorColor,!0),e.prototype.init.call(this,n)},t.prototype.createData=function(i){if(i.validation){var n=i.validation.getClashData({structure:i,color:this.colorValue}),a=new Wn(n,this.getBufferParams({openEnded:!1}));return{bufferList:[a]}}},t}(Xr);or.add("validation",BT);var om=new I,$l=new I,eh=new I,NT=new I(0,1,0);function kT(e){e===void 0&&(e={});var t=new nu(1,1,O(e.radialSegments,60),1,O(e.openEnded,!1));return t.applyMatrix(new Ae().makeRotationX(-Math.PI/2)),t}var zT=Object.assign({radialSegments:60,openEnded:!1},ti),Gy=function(e){function t(i,n){n===void 0&&(n={}),e.call(this,{position:new Float32Array(i.position1.length),color:i.color,picking:i.picking},n,kT(n)),this.updateNormals=!0,this._position=new Float32Array(i.position1.length),this.setAttributes(i,!0)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={defaultParameters:{configurable:!0}};return r.defaultParameters.get=function(){return zT},t.prototype.applyPositionTransform=function(n,a,o){$l.fromArray(this._position1,o),eh.fromArray(this._position2,o),n.lookAt($l,eh,NT);var s=this._radius[a];om.set(s,s,$l.distanceTo(eh)),n.scale(om)},t.prototype.setAttributes=function(n,a){n===void 0&&(n={}),n.position1&&n.position2&&(on(n.position1,n.position2,this._position),this._position1=n.position1,this._position2=n.position2,n.position=this._position),n.radius&&(this._radius=n.radius),e.prototype.setAttributes.call(this,n,a)},Object.defineProperties(t.prototype,r),t}(ma);mi.add("cone",Gy);var Hy=function(t){t===void 0&&(t=[]),this.geometryList=t};Hy.prototype.computeBoundingBox=function(){var t=this;this.boundingBox?this.boundingBox.empty():this.boundingBox=new ir,this.geometryList.forEach(function(r){r.boundingBox||r.computeBoundingBox(),t.boundingBox.union(r.boundingBox)})};var UT=Object.assign({aspectRatio:1.5,radialSegments:50,openEnded:!1,disableImpostor:!1},ti),xn=function(t,r){r===void 0&&(r={}),this.group=new Jt,this.wireframeGroup=new Jt,this.pickingGroup=new Jt,this.visible=!0,this.parameters=vi(r,this.defaultParameters),this.splitPosition=new Float32Array(t.position1.length),this.cylinderRadius=new Float32Array(t.radius.length);var i=this.makeAttributes(t),n={radialSegments:this.parameters.radialSegments,openEnded:this.parameters.openEnded,disableImpostor:this.parameters.disableImpostor};this.cylinderBuffer=new Wn(i.cylinder,n),this.coneBuffer=new Gy(i.cone,n),this.geometry=new Hy([this.cylinderBuffer.geometry,this.coneBuffer.geometry]),this.matrix=O(r.matrix,new Ae),this.picking=t.picking},Vu={defaultParameters:{configurable:!0},matrix:{configurable:!0},pickable:{configurable:!0}};Vu.defaultParameters.get=function(){return UT};Vu.matrix.set=function(e){It.prototype.setMatrix.call(this,e)};Vu.matrix.get=function(){return this.group.matrix.clone()};Vu.pickable.get=function(){return!!this.picking};xn.prototype.makeAttributes=function(t){t===void 0&&(t={});var r=this.splitPosition,i=this.cylinderRadius,n=this.parameters.aspectRatio,a,o,s={},u={};if(t.radius){for(a=0,o=i.length;a<o;++a)i[a]=t.radius[a]/n;s.radius=i,u.radius=t.radius}if(t.position1&&t.position2){var c=new I,f=new I,l=new I,h=new I;for(a=0,o=r.length;a<o;a+=3){c.fromArray(t.position1,a),f.fromArray(t.position2,a),l.subVectors(c,f);var d=l.length(),p=i[a/3]*n*2,v=Math.min(d,p);l.setLength(v),h.copy(f).add(l),h.toArray(r,a)}s.position1=t.position1,s.position2=r,u.position1=r,u.position2=t.position2}return t.color&&(s.color=t.color,s.color2=t.color,u.color=t.color),{cylinder:s,cone:u}};xn.prototype.getMesh=function(){return new Jt().add(this.cylinderBuffer.getMesh(),this.coneBuffer.getMesh())};xn.prototype.getWireframeMesh=function(){return new Jt().add(this.cylinderBuffer.getWireframeMesh(),this.coneBuffer.getWireframeMesh())};xn.prototype.getPickingMesh=function(){return new Jt().add(this.cylinderBuffer.getPickingMesh(),this.coneBuffer.getPickingMesh())};xn.prototype.setAttributes=function(t){t===void 0&&(t={});var r=this.makeAttributes(t);this.cylinderBuffer.setAttributes(r.cylinder),this.coneBuffer.setAttributes(r.cone)};xn.prototype.setParameters=function(t){t===void 0&&(t={}),t=Object.assign({},t),t&&t.matrix!==void 0&&(this.matrix=t.matrix),delete t.matrix,t&&t.wireframe!==void 0&&(this.parameters.wireframe=t.wireframe,this.setVisibility(this.visible)),this.cylinderBuffer.setParameters(t),this.coneBuffer.setParameters(t)};xn.prototype.setVisibility=function(t){It.prototype.setVisibility.call(this,t)};xn.prototype.dispose=function(){this.cylinderBuffer.dispose(),this.coneBuffer.dispose()};Object.defineProperties(xn.prototype,Vu);mi.add("arrow",xn);var sm=new I,th=new I,rh=new I,GT=new I(0,0,0),HT=function(e){function t(r,i){i===void 0&&(i={}),e.call(this,r,i,new Oa(1,1,1)),this.updateNormals=!0,this.setAttributes(r,!0)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.applyPositionTransform=function(i,n,a){th.fromArray(this._heightAxis,a),rh.fromArray(this._depthAxis,a),i.lookAt(GT,th,rh),sm.set(this._size[n],rh.length(),th.length()),i.scale(sm)},t.prototype.setAttributes=function(i,n){i===void 0&&(i={}),i.size&&(this._size=i.size),i.heightAxis&&(this._heightAxis=i.heightAxis),i.depthAxis&&(this._depthAxis=i.depthAxis),e.prototype.setAttributes.call(this,i,n)},t}(ma);mi.add("box",HT);var um=new I,ih=new I,nh=new I,VT=new I(0,0,0),WT=Object.assign({sphereDetail:2},ti),jT=function(e){function t(i,n){n===void 0&&(n={}),e.call(this,i,n,new za(1,O(n.sphereDetail,2))),this.updateNormals=!0,this.setAttributes(i,!0)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={defaultParameters:{configurable:!0}};return r.defaultParameters.get=function(){return WT},t.prototype.applyPositionTransform=function(n,a,o){ih.fromArray(this._majorAxis,o),nh.fromArray(this._minorAxis,o),n.lookAt(VT,ih,nh),um.set(this._radius[a],nh.length(),ih.length()),n.scale(um)},t.prototype.setAttributes=function(n,a){n===void 0&&(n={}),n.radius&&(this._radius=n.radius),n.majorAxis&&(this._majorAxis=n.majorAxis),n.minorAxis&&(this._minorAxis=n.minorAxis),e.prototype.setAttributes.call(this,n,a)},Object.defineProperties(t.prototype,r),t}(ma);mi.add("ellipsoid",jT);var cm=new I,ah=new I,oh=new I,XT=new I(0,0,0),qT=function(e){function t(r,i){i===void 0&&(i={}),e.call(this,r,i,new ka(1,0)),this.updateNormals=!0,this.setAttributes(r,!0)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.applyPositionTransform=function(i,n,a){ah.fromArray(this._heightAxis,a),oh.fromArray(this._depthAxis,a),i.lookAt(XT,ah,oh),cm.set(this._size[n],oh.length(),ah.length()),i.scale(cm)},t.prototype.setAttributes=function(i,n){i===void 0&&(i={}),i.size&&(this._size=i.size),i.heightAxis&&(this._heightAxis=i.heightAxis),i.depthAxis&&(this._depthAxis=i.depthAxis),e.prototype.setAttributes.call(this,i,n)},t}(ma);mi.add("octahedron",qT);var fm=new I,sh=new I,uh=new I,YT=new I(0,0,0),ZT=function(e){function t(r,i){i===void 0&&(i={}),e.call(this,r,i,new wo(1,0)),this.updateNormals=!0,this.setAttributes(r,!0)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.applyPositionTransform=function(i,n,a){sh.fromArray(this._heightAxis,a),uh.fromArray(this._depthAxis,a),i.lookAt(YT,sh,uh),fm.set(this._size[n],uh.length(),sh.length()),i.scale(fm)},t.prototype.setAttributes=function(i,n){i===void 0&&(i={}),i.size&&(this._size=i.size),i.heightAxis&&(this._heightAxis=i.heightAxis),i.depthAxis&&(this._depthAxis=i.depthAxis),e.prototype.setAttributes.call(this,i,n)},t}(ma);mi.add("tetrahedron",ZT);var lm=new I,hm=new I,dm=new I,KT=new I(0,0,0),JT=Object.assign({radiusRatio:.2,radialSegments:16,tubularSegments:32},ti),QT=function(e){function t(i,n){n===void 0&&(n={}),e.call(this,i,n,new Ao(1,O(n.radiusRatio,.2),O(n.radialSegments,16),O(n.tubularSegments,32))),this.updateNormals=!0,this.setAttributes(i,!0)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={defaultParameters:{configurable:!0}};return r.defaultParameters.get=function(){return JT},t.prototype.applyPositionTransform=function(n,a,o){hm.fromArray(this._majorAxis,o),dm.fromArray(this._minorAxis,o),n.lookAt(KT,hm,dm);var s=this._radius[a];lm.set(s,s,s),n.scale(lm)},t.prototype.setAttributes=function(n,a){n===void 0&&(n={}),n.radius&&(this._radius=n.radius),n.majorAxis&&(this._majorAxis=n.majorAxis),n.minorAxis&&(this._minorAxis=n.minorAxis),e.prototype.setAttributes.call(this,n,a)},Object.defineProperties(t.prototype,r),t}(ma);mi.add("torus",QT);var qr=function(t,r){var i=r||{};this.streamer=t,this.name=O(i.name,""),this.path=O(i.path,"")},ls={type:{configurable:!0},__objName:{configurable:!0},isBinary:{configurable:!0},isJson:{configurable:!0},isXml:{configurable:!0}};ls.type.get=function(){return""};ls.__objName.get=function(){return""};ls.isBinary.get=function(){return!1};ls.isJson.get=function(){return!1};ls.isXml.get=function(){return!1};qr.prototype.parse=function(){var t=this;return this.streamer.read().then(function(){return t._beforeParse(),t._parse(),t._afterParse(),t[t.__objName]})};qr.prototype._parse=function(){};qr.prototype._beforeParse=function(){};qr.prototype._afterParse=function(){ge&&fe.log(this[this.__objName])};Object.defineProperties(qr.prototype,ls);var jn=function(e){function t(i,n){var a=n||{};e.call(this,i,a),this.firstModelOnly=O(a.firstModelOnly,!1),this.asTrajectory=O(a.asTrajectory,!1),this.cAlphaOnly=O(a.cAlphaOnly,!1),this.structure=new ct(this.name,this.path),this.structureBuilder=new sl(this.structure)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},__objName:{configurable:!0}};return r.type.get=function(){return"structure"},r.__objName.get=function(){return"structure"},Object.defineProperties(t.prototype,r),t}(qr);function $T(e){switch(e=e.toLowerCase(),e){case"polymer":return Qf;case"non-polymer":return $f;case"macrolide":return el;case"water":return tl;default:return FS}}function eE(e){switch(e){case Qf:return"polymer";case $f:return"non-polymer";case el:return"macrolide";case tl:return"water";default:return}}var Hi=function(t,r,i,n,a){i===void 0&&(i=""),a===void 0&&(a=[]),this.structure=t,this.index=r,this.description=i,this.entityType=$T(n||""),this.chainIndexList=a,a.forEach(function(o){t.chainStore.entityIndex[o]=r})},Vy={type:{configurable:!0}};Vy.type.get=function(){return eE(this.entityType)};Hi.prototype.getEntityType=function(){return this.entityType};Hi.prototype.isPolymer=function(){return this.entityType===Qf};Hi.prototype.isNonPolymer=function(){return this.entityType===$f};Hi.prototype.isMacrolide=function(){return this.entityType===el};Hi.prototype.isWater=function(){return this.entityType===tl};Hi.prototype.eachChain=function(t){var r=this.structure.getChainProxy();this.chainIndexList.forEach(function(i){r.index=i,t(r)})};Object.defineProperties(Hi.prototype,Vy);var tE={a:1,b:1,c:1,alpha:90,beta:90,gamma:90,spacegroup:"P 1"},Ja=function(t){t===void 0&&(t=tE),this.cartToFrac=new Ae,this.fracToCart=new Ae,this.a=t.a,this.b=t.b,this.c=t.c,this.alpha=t.alpha,this.beta=t.beta,this.gamma=t.gamma,this.spacegroup=t.spacegroup;var r=lr(this.alpha),i=lr(this.beta),n=lr(this.gamma),a=Math.cos(r),o=Math.cos(i),s=Math.cos(n),u=Math.sin(i),c=Math.sin(n);if(this.volume=this.a*this.b*this.c*Math.sqrt(1-a*a-o*o-s*s+2*a*o*s),t.cartToFrac===void 0){var f=this.a*this.b*c/this.volume,l=(o*s-a)/(u*c);this.fracToCart.set(this.a,0,0,0,this.b*s,this.b*c,0,0,this.c*o,-this.c*u*l,1/f,0,0,0,0,1).transpose(),this.cartToFrac.getInverse(this.fracToCart)}else this.cartToFrac.copy(t.cartToFrac),this.fracToCart.getInverse(this.cartToFrac)};Ja.prototype.getPosition=function(t){var r=new Float32Array(24);if(t.unitcell){var i=t.unitcell,n=t.center.clone().applyMatrix4(i.cartToFrac).floor(),a=new I,o=0,s=function(u,c,f){a.set(u,c,f).add(n).applyMatrix4(i.fracToCart).toArray(r,o),o+=3};s(0,0,0),s(1,0,0),s(0,1,0),s(0,0,1),s(1,1,0),s(1,0,1),s(0,1,1),s(1,1,1)}return r};Ja.prototype.getCenter=function(t){return iS(this.getPosition(t))};Ja.prototype.getData=function(t,r){r===void 0&&(r={});var i=O(r.colorValue,"orange"),n=O(r.radius,Math.cbrt(this.volume)/200),a=new Oe(i),o=new I,s=this.getPosition(t),u=Qt(8,a.r,a.g,a.b),c=pi(8,n),f=new Float32Array(3*12),l=new Float32Array(3*12),h=Qt(12,a.r,a.g,a.b),d=pi(12,n),p=0;function v(g,x){o.fromArray(s,g*3).toArray(f,p),o.fromArray(s,x*3).toArray(l,p),p+=3}v(0,1),v(0,2),v(0,3),v(1,4),v(1,5),v(2,6),v(3,5),v(4,7),v(5,7),v(2,4),v(7,6),v(3,6);var m=new CM(this,t);return{vertex:{position:s,color:u,radius:c,picking:m},edge:{position1:f,position2:l,color:h,color2:h,radius:d,picking:m}}};var If={1:"h",2:"h",3:"i",4:"h",5:"g",6:"h",7:"h",8:"h",9:"h",10:"h",0:"h"},rE=["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"],iE=["MOL_ID","MOLECULE","CHAIN","FRAGMENT","SYNONYM","EC","ENGINEERED","MUTATION","OTHER_DETAILS"],pm=/\s+/;function vm(e,t,r){var i=""+e;return t&&(i+=":"+t),r&&(i+="^"+r),i}var Wu=function(e){function t(i,n){var a=n||{};e.call(this,i,a),this.hex=O(a.hex,!1)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"pdb"},t.prototype._parse=function(){ge&&fe.time("PdbParser._parse "+this.name);var n=!1,a=this.streamer.peekLines(1)[0],o=a.substr(62,4),s=a.substr(72,4);o===s&&s.trim()&&(n=!0);var u=this.type==="pqr",c=this.type==="pdbqt",f=this.structure,l=this.structureBuilder,h=this.hex,d=10,p=10,v=this.firstModelOnly,m=this.asTrajectory,g=this.cAlphaOnly,x=f.frames,y=f.boxes,b=!1,_,w,A=f.biomolDict,S,M,E,T,H,X,q,Z,Q,N,D,W,L,U,k,ee,K,te,Y,J,j,ae={},re={},le={},Se=[],_e,ne,ve={},se={},xe={},he,ye,pe,Pe,He,Je,We,Be={},ie,we={helices:[],sheets:[]},Ie=we.helices,qe=we.sheets,Ce=f.atomMap,Ne=f.atomStore;Ne.resize(Math.round(this.streamer.data.length/80)),(u||c)&&Ne.addField("partialCharge",1,"float32"),u&&Ne.addField("radius",1,"float32");var Ze=f.getAtomProxy(),Ve=f.getAtomProxy(),Qe=0,Ye=0,vt=!0;function Nt(bt,rt,Ke){for(var Ft,Zt=bt;Zt<rt;++Zt)if(T=Ke[Zt],H=T.substr(0,6),H==="ATOM  "||H==="HETATM"){if(vt&&(m?(b?(_=new Float32Array(Ne.count*3),x.push(_)):_=[],w=0):v||(ae={}),he=1,ye=he.toString(),pe=!0,vt=!1),v&&Ye>0)continue;var dr=void 0,Xt=void 0,P=void 0,F=void 0,B=void 0;if(u){if(F=T.split(pm),B=F.length===10?1:0,W=F[2],g&&W!=="CA")continue;dr=parseFloat(F[6-B]),Xt=parseFloat(F[7-B]),P=parseFloat(F[8-B])}else{if(W=T.substr(12,4).trim(),g&&W!=="CA")continue;dr=parseFloat(T.substr(30,8)),Xt=parseFloat(T.substr(38,8)),P=parseFloat(T.substr(46,8))}if(m){var G=w*3;if(_[G+0]=dr,_[G+1]=Xt,_[G+2]=P,w+=1,b)continue}var V=void 0;u?(X=parseInt(F[1]),V="",L=T[0]==="H"?1:0,q=B?"":F[4],Z=parseInt(F[5-B]),D="",Q=F[3],k="",N=1):(X=parseInt(T.substr(6,5),d),h&&X===99999&&(d=16),L=T[0]==="H"?1:0,q=T[21].trim(),Z=parseInt(T.substr(22,4),p),h&&Z===9999&&(p=16),D=T[26].trim(),Q=T.substr(17,4).trim()||"MOL",U=parseFloat(T.substr(60,6)),k=T[16].trim(),N=parseFloat(T.substr(54,6)),n||(c?V=T.substr(12,2).trim():(V=T.substr(76,2).trim(),q||(q=T.substr(72,4).trim())))),Ne.growIfFull(),Ne.atomTypeId[Qe]=Ce.add(W,V),Ne.x[Qe]=dr,Ne.y[Qe]=Xt,Ne.z[Qe]=P,Ne.serial[Qe]=X,Ne.altloc[Qe]=k.charCodeAt(0),Ne.occupancy[Qe]=isNaN(N)?0:N,u?(Ne.partialCharge[Qe]=parseFloat(F[9-B]),Ne.radius[Qe]=parseFloat(F[10-B])):(Ne.bfactor[Qe]=isNaN(U)?0:U,c&&(Ne.partialCharge[Qe]=parseFloat(T.substr(70,6))));var $=vm(Z,q,D);L&&!se[$]&&!rE.includes(Q)?(Pe!==q||Je!==Q||!Af.includes(Q)&&(He!==Z||We!==D))&&(he+=1,ye=he.toString(),He=Z,Je=Q,We=D):!pe&&Pe!==q&&(he+=1,ye=he.toString()),l.addAtom(Ye,q,ye,Q,Z,L,void 0,D),ae[X]=Qe,Qe+=1,pe=!1,Pe=q}else if(H==="CONECT"){var C=ae[parseInt(T.substr(6,5))],R=[11,16,21,26],z={};if(C===void 0)continue;for(var oe=0;oe<4;++oe){var ce=parseInt(T.substr(R[oe],5));if(!Number.isNaN(ce)&&(ce=ae[ce],ce!==void 0))if(C<ce?(Ze.index=C,Ve.index=ce):(Ze.index=ce,Ve.index=C),z[ce]!==void 0)f.bondStore.bondOrder[z[ce]]+=1;else{var Te=Ze.index+"|"+Ve.index;le[Te]===void 0&&(le[Te]=!0,z[ce]=f.bondStore.count,f.bondStore.addBond(Ze,Ve,1))}}}else if(H==="HELIX "){ee=T[19].trim(),K=parseInt(T.substr(21,4)),te=T[25].trim(),Y=T[31].trim(),J=parseInt(T.substr(33,4)),j=T[37].trim();var de=parseInt(T.substr(39,1));de=(If[de]||If[0]).charCodeAt(0),Ie.push([ee,K,te,Y,J,j,de])}else if(H==="SHEET ")ee=T[21].trim(),K=parseInt(T.substr(22,4)),te=T[26].trim(),Y=T[32].trim(),J=parseInt(T.substr(33,4)),j=T[37].trim(),qe.push([ee,K,te,Y,J,j]);else if(H==="HETNAM")ve[T.substr(11,3)]=T.substr(15).trim();else if(H==="SEQRES"){var ue=T[11].trim();ue!==ie&&(Be[ue]=[],ie=ue),(Ft=Be[ue]).push.apply(Ft,T.substr(19).trim().split(pm))}else if(H==="MODRES"){var Me=T.substr(12,3).trim(),Le=T[16].trim(),De=T[22].trim(),Fe=parseInt(T.substr(18,4).trim()),wt=vm(Fe,Le,De);se[wt]={resname:Me,chainname:Le,inscode:De,resno:Fe}}else if(H==="COMPND"){var ke=T.substr(10,70).trim(),je=ke.indexOf(":"),pt=ke.substring(0,je),Xe=void 0;iE.includes(pt)?(ne=pt,Xe=ke.substring(je+2)):Xe=ke,Xe=Xe.replace(/;$/,""),ne==="MOL_ID"?(_e={chainList:[],name:""},Se.push(_e)):ne==="MOLECULE"?(_e.name&&(_e.name+=" "),_e.name+=Xe):ne==="CHAIN"&&Array.prototype.push.apply(_e.chainList,Xe.split(/\s*,\s*/))}else if(T.startsWith("TER")){var be=f.getChainProxy(f.chainStore.count-1);xe[be.chainname]=be.index,he+=1,ye=he.toString(),pe=!0}else if(H==="REMARK"&&T.substr(7,3)==="350"){if(T.substr(11,12)==="BIOMOLECULE:"){var Re=T.substr(23).trim();/^(0|[1-9][0-9]*)$/.test(Re)&&(Re="BU"+Re),S=new Br(Re),A[Re]=S}else if(T.substr(13,5)==="BIOMT"){var et=T.split(/\s+/),mt=parseInt(T[18])-1;mt===0&&(E=new Ae,M.matrixList.push(E));var it=E.elements;it[4*0+mt]=parseFloat(et[4]),it[4*1+mt]=parseFloat(et[5]),it[4*2+mt]=parseFloat(et[6]),it[4*3+mt]=parseFloat(et[7])}else if(T.substr(11,30)==="APPLY THE FOLLOWING TO CHAINS:"||T.substr(11,30)==="                   AND CHAINS:"){T.substr(11,5)==="APPLY"&&(M=S.addPart());for(var xt=T.substr(41,30).split(","),_t=0,qt=xt.length;_t<qt;++_t){var Ar=xt[_t].trim();Ar&&M.chainList.push(Ar)}}}else if(H==="HEADER")f.id=T.substr(62,4);else if(H==="TITLE ")f.title+=(f.title?" ":"")+T.substr(10,70).trim();else if(H==="MODEL ")vt=!0;else if(H==="ENDMDL"||T.trim()==="END"){if(vt)continue;m&&!b&&(x.push(new Float32Array(_)),b=!0),Ye+=1,vt=!0}else if(T.substr(0,5)==="MTRIX"){if(T[59]==="1")continue;if(!S||S.name!=="NCS"){var gt="NCS";S=new Br(gt),A[gt]=S,M=S.addPart()}var rr=T.split(/\s+/),ji=parseInt(T[5])-1;ji===0&&(E=new Ae,M.matrixList.push(E));var Di=E.elements;Di[4*0+ji]=parseFloat(rr[2]),Di[4*1+ji]=parseFloat(rr[3]),Di[4*2+ji]=parseFloat(rr[4]),Di[4*3+ji]=parseFloat(rr[5])}else if(T.substr(0,5)==="ORIGX"){re.origx||(re.origx=new Ae);var Xn=T.split(/\s+/),Xi=parseInt(T[5])-1,qi=re.origx.elements;qi[4*0+Xi]=parseFloat(Xn[1]),qi[4*1+Xi]=parseFloat(Xn[2]),qi[4*2+Xi]=parseFloat(Xn[3]),qi[4*3+Xi]=parseFloat(Xn[4])}else if(T.substr(0,5)==="SCALE"){re.scale||(re.scale=new Ae);var Yi=T.split(/\s+/),Zi=parseInt(T[5])-1,Ki=re.scale.elements;Ki[4*0+Zi]=parseFloat(Yi[1]),Ki[4*1+Zi]=parseFloat(Yi[2]),Ki[4*2+Zi]=parseFloat(Yi[3]),Ki[4*3+Zi]=parseFloat(Yi[4])}else if(H==="CRYST1"){var qn=parseFloat(T.substr(6,9)),ds=parseFloat(T.substr(15,9)),Yn=parseFloat(T.substr(24,9)),ya=parseFloat(T.substr(33,7)),ba=parseFloat(T.substr(40,7)),xa=parseFloat(T.substr(47,7)),_a=T.substr(55,11).trim(),Ji=new Float32Array(9);Ji[0]=qn,Ji[4]=ds,Ji[8]=Yn,y.push(Ji),Ye===0&&(re.a=qn,re.b=ds,re.c=Yn,re.alpha=ya,re.beta=ba,re.gamma=xa,re.spacegroup=_a)}}this.streamer.eachChunkOfLines(function(bt){Nt(0,bt.length,bt)}),l.finalize();var Rt=Se.length;if(Rt){f.eachChain(function(bt){bt.entityIndex=Rt}),Se.forEach(function(bt,rt){var Ke=bt.chainList.map(function(Ft){return xe[Ft]});f.entityList.push(new Hi(f,rt,bt.name,"polymer",Ke))});var Gt=Se.length,Et=f.getResidueProxy(),Mt={};f.eachChain(function(bt){bt.entityIndex===Rt&&(Et.index=bt.residueOffset,Mt[Et.resname]||(Mt[Et.resname]=[]),Mt[Et.resname].push(bt.index))}),Object.keys(Mt).forEach(function(bt){var rt=Mt[bt],Ke="non-polymer",Ft=ve[bt]||bt;Af.includes(bt)&&(Ft="water",Ke="water"),f.entityList.push(new Hi(f,Gt,Ft,Ke,rt)),Gt+=1})}re.a!==void 0?f.unitcell=new Ja(re):f.unitcell=void 0,(Ie.length||qe.length)&&by(f,we),f.finalizeAtoms(),n||cl(f),Mf(f),f.finalizeBonds(),!Ie.length&&!qe.length&&ul(f),fl(f),ge&&fe.timeEnd("PdbParser._parse "+this.name)},Object.defineProperties(t.prototype,r),t}(jn);ut.add("pdb",Wu);ut.add("pdb1",Wu);ut.add("ent",Wu);var nE=/\s+/,mm=/'((?:(?!'\s).)*)'|"((?:(?!"\s).)*)"|(\S+)/g,Ts=/"/g,Ls=/^['"]+|['"]+$/g;function Wy(e){return e&&e[0]===e[e.length-1]&&(e[0]==="'"||e[0]==='"')?e.substring(1,e.length-1):e}function oi(e,t){Array.isArray(e[t])||Object.keys(e).forEach(function(r){e[r]=[e[r]]})}function ci(e){return e!=="?"}function sc(e,t){return ci(e)?e:t}function jy(e){switch(e.toLowerCase()){case"?":case"sing":return 1;case"doub":return 2;case"trip":return 3;case"quad":return 4}return 0}function aE(e,t,r){var i=t.atomStore,n=t.atomMap,a,o,s=e.chem_comp,u=e.chem_comp_atom,c=e.chem_comp_bond;s&&(s.name&&(t.title=s.name.trim().replace(Ls,"")),s.id&&(t.id=s.id.trim().replace(Ls,"")));var f={};if(u){oi(u,"comp_id");var l,h,d,p;for(o=u.comp_id.length,a=0;a<o;++a)i.growIfFull(),l=u.atom_id[a].replace(Ts,""),h=u.type_symbol[a],f[l]=a,i.atomTypeId[a]=n.add(l,h),i.x[a]=u.model_Cartn_x[a],i.y[a]=u.model_Cartn_y[a],i.z[a]=u.model_Cartn_z[a],i.serial[a]=a,d=u.pdbx_component_comp_id[a],p=u.pdbx_residue_numbering?u.pdbx_residue_numbering[a]:1,r.addAtom(0,"","",d,p,!0);for(a=0;a<o;++a){var v=a+o;i.growIfFull(),l=u.atom_id[a].replace(Ts,""),h=u.type_symbol[a],i.atomTypeId[v]=n.add(l,h),i.x[v]=u.pdbx_model_Cartn_x_ideal[a],i.y[v]=u.pdbx_model_Cartn_y_ideal[a],i.z[v]=u.pdbx_model_Cartn_z_ideal[a],i.serial[v]=v,d=u.pdbx_component_comp_id[a],p=u.pdbx_residue_numbering?u.pdbx_residue_numbering[a]:1,r.addAtom(1,"","",d,p,!0)}}if(u&&c){oi(c,"comp_id");var m,g,x;o=c.comp_id.length;var y=u.comp_id.length,b=t.getAtomProxy(),_=t.getAtomProxy();for(a=0;a<o;++a)m=c.atom_id_1[a].replace(Ts,""),g=c.atom_id_2[a].replace(Ts,""),x=jy(c.value_order[a]),b.index=f[m],_.index=f[g],t.bondStore.growIfFull(),t.bondStore.addBond(b,_,x),b.index+=y,_.index+=y,t.bondStore.growIfFull(),t.bondStore.addBond(b,_,x)}}function oE(e,t,r){var i=t.atomStore,n=t.atomMap;e.data&&(t.id=e.data,t.name=e.data),t.unitcell=new Ja({a:parseFloat(e.cell_length_a),b:parseFloat(e.cell_length_b),c:parseFloat(e.cell_length_c),alpha:parseFloat(e.cell_angle_alpha),beta:parseFloat(e.cell_angle_beta),gamma:parseFloat(e.cell_angle_gamma),spacegroup:Wy(e["symmetry_space_group_name_H-M"])});for(var a=new I,o=new I,s=e.atom_site_type_symbol.length,u=0;u<s;++u){i.growIfFull();var c=e.atom_site_label[u],f=e.atom_site_type_symbol[u];i.atomTypeId[u]=n.add(c,f),a.set(e.atom_site_fract_x[u],e.atom_site_fract_y[u],e.atom_site_fract_z[u]),a.applyMatrix4(t.unitcell.fracToCart),o.add(a),i.x[u]=a.x,i.y[u]=a.y,i.z[u]=a.z,e.atom_site_occupancy&&(i.occupancy[u]=parseFloat(e.atom_site_occupancy[u])),i.serial[u]=u,r.addAtom(0,"","","HET",1,!0)}o.divideScalar(s),t.center=o,fl(t);var l=new I,h=new I,d=t.biomolDict.SUPERCELL.partList[0].matrixList,p=s;function v(y){return n.get(i.atomTypeId[y]).covalent}for(var m=new Ae,g=function(y){var b=v(y);a.set(i.x[y],i.y[y],i.z[y]),d.forEach(function(_){if(!m.equals(_)){l.copy(a),l.applyMatrix4(_);for(var w=0;w<s;++w){h.set(i.x[w],i.y[w],i.z[w]);var A=l.distanceToSquared(h),S=v(w)+b,M=S+.3,E=S-.5;if(A<M*M&&A>E*E){i.growIfFull(),i.atomTypeId[p]=i.atomTypeId[y],i.x[p]=l.x,i.y[p]=l.y,i.z[p]=l.z,i.occupancy[p]=i.occupancy[y],i.serial[p]=p,i.altloc[p]=65,r.addAtom(0,"","","HET",1,!0),p+=1;return}}}})},x=0;x<s;++x)g(x)}function sE(e,t,r){var i=[],n=[],a,o,s,u,c=e.struct_conf;if(c)for(oi(c,"id"),a=0,o=c.beg_auth_seq_id.length;a<o;++a){var f=parseInt(c.pdbx_PDB_helix_class[a]);Number.isNaN(f)||(s=c.pdbx_beg_PDB_ins_code[a],u=c.pdbx_end_PDB_ins_code[a],i.push([r[c.beg_label_asym_id[a]],parseInt(c.beg_auth_seq_id[a]),sc(s,""),r[c.end_label_asym_id[a]],parseInt(c.end_auth_seq_id[a]),sc(u,""),(If[f]||If[0]).charCodeAt(0)]))}var l=e.struct_sheet_range;if(l)for(oi(l,"id"),a=0,o=l.beg_auth_seq_id.length;a<o;++a)s=l.pdbx_beg_PDB_ins_code[a],u=l.pdbx_end_PDB_ins_code[a],n.push([r[l.beg_label_asym_id[a]],parseInt(l.beg_auth_seq_id[a]),sc(s,""),r[l.end_label_asym_id[a]],parseInt(l.end_auth_seq_id[a]),sc(u,"")]);return c||l?{helices:i,sheets:n}:!1}function uE(e,t,r){var i={},n=t.biomolDict;if(e.pdbx_struct_oper_list){var a=e.pdbx_struct_oper_list;oi(a,"id"),a.id.forEach(function(A,S){var M=new Ae,E=M.elements;E[0]=parseFloat(a["matrix[1][1]"][S]),E[1]=parseFloat(a["matrix[1][2]"][S]),E[2]=parseFloat(a["matrix[1][3]"][S]),E[4]=parseFloat(a["matrix[2][1]"][S]),E[5]=parseFloat(a["matrix[2][2]"][S]),E[6]=parseFloat(a["matrix[2][3]"][S]),E[8]=parseFloat(a["matrix[3][1]"][S]),E[9]=parseFloat(a["matrix[3][2]"][S]),E[10]=parseFloat(a["matrix[3][3]"][S]),E[3]=parseFloat(a["vector[1]"][S]),E[7]=parseFloat(a["vector[2]"][S]),E[11]=parseFloat(a["vector[3]"][S]),M.transpose(),i[A]=M})}if(e.pdbx_struct_assembly_gen){var o=e.pdbx_struct_assembly_gen;oi(o,"assembly_id");var s=function(A){var S={},M=A.replace(/[()']/g,"").split(",");return M.forEach(function(E){if(E.includes("-"))for(var T=E.split("-"),H=parseInt(T[0]),X=parseInt(T[1]);H<=X;++H)S[H]=i[H];else S[E]=i[E]}),S};o.assembly_id.forEach(function(A,S){var M={},E=o.oper_expression[S].replace(/['"]\(|['"]/g,"");if(E.includes(")(")||E.indexOf("(")>0){E=E.split("(");var T=s(E[0]),H=s(E[1]);Object.keys(T).forEach(function(W){Object.keys(H).forEach(function(L){var U=new Ae;U.multiplyMatrices(T[W],H[L]),M[W+"x"+L]=U})})}else M=s(E);var X=[];for(var q in M)X.push(M[q]);var Z=A;/^(0|[1-9][0-9]*)$/.test(Z)&&(Z="BU"+Z);for(var Q=o.asym_id_list[S].split(","),N=0,D=Q.length;N<D;++N)Q[N]=r[Q[N]];n[Z]===void 0&&(n[Z]=new Br(Z)),n[Z].addPart(X,Q)})}if(e.struct_ncs_oper){var u=e.struct_ncs_oper;oi(u,"id");var c="NCS";n[c]=new Br(c);var f=n[c].addPart();u.id.forEach(function(A,S){if(u.code[S]!=="given"){var M=new Ae,E=M.elements;E[0]=parseFloat(u["matrix[1][1]"][S]),E[1]=parseFloat(u["matrix[1][2]"][S]),E[2]=parseFloat(u["matrix[1][3]"][S]),E[4]=parseFloat(u["matrix[2][1]"][S]),E[5]=parseFloat(u["matrix[2][2]"][S]),E[6]=parseFloat(u["matrix[2][3]"][S]),E[8]=parseFloat(u["matrix[3][1]"][S]),E[9]=parseFloat(u["matrix[3][2]"][S]),E[10]=parseFloat(u["matrix[3][3]"][S]),E[3]=parseFloat(u["vector[1]"][S]),E[7]=parseFloat(u["vector[2]"][S]),E[11]=parseFloat(u["vector[3]"][S]),M.transpose(),f.matrixList.push(M)}}),f.matrixList.length===0&&delete n[c]}var l={};if(e.cell){var h=e.cell,d=parseFloat(h.length_a),p=parseFloat(h.length_b),v=parseFloat(h.length_c),m=new Float32Array(9);m[0]=d,m[4]=p,m[8]=v,t.boxes.push(m),l.a=d,l.b=p,l.c=v,l.alpha=parseFloat(h.angle_alpha),l.beta=parseFloat(h.angle_beta),l.gamma=parseFloat(h.angle_gamma)}e.symmetry&&(l.spacegroup=Wy(e.symmetry["space_group_name_H-M"]));var g=new Ae;if(e.database_PDB_matrix){var x=e.database_PDB_matrix,y=g.elements;y[0]=parseFloat(x["origx[1][1]"]),y[1]=parseFloat(x["origx[1][2]"]),y[2]=parseFloat(x["origx[1][3]"]),y[4]=parseFloat(x["origx[2][1]"]),y[5]=parseFloat(x["origx[2][2]"]),y[6]=parseFloat(x["origx[2][3]"]),y[8]=parseFloat(x["origx[3][1]"]),y[9]=parseFloat(x["origx[3][2]"]),y[10]=parseFloat(x["origx[3][3]"]),y[3]=parseFloat(x["origx_vector[1]"]),y[7]=parseFloat(x["origx_vector[2]"]),y[11]=parseFloat(x["origx_vector[3]"]),g.transpose(),l.origx=g}var b=new Ae;if(e.atom_sites){var _=e.atom_sites,w=b.elements;w[0]=parseFloat(_["fract_transf_matrix[1][1]"]),w[1]=parseFloat(_["fract_transf_matrix[1][2]"]),w[2]=parseFloat(_["fract_transf_matrix[1][3]"]),w[4]=parseFloat(_["fract_transf_matrix[2][1]"]),w[5]=parseFloat(_["fract_transf_matrix[2][2]"]),w[6]=parseFloat(_["fract_transf_matrix[2][3]"]),w[8]=parseFloat(_["fract_transf_matrix[3][1]"]),w[9]=parseFloat(_["fract_transf_matrix[3][2]"]),w[10]=parseFloat(_["fract_transf_matrix[3][3]"]),w[3]=parseFloat(_["fract_transf_vector[1]"]),w[7]=parseFloat(_["fract_transf_vector[2]"]),w[11]=parseFloat(_["fract_transf_vector[3]"]),b.transpose(),l.scale=b}l.a!==void 0?t.unitcell=new Ja(l):t.unitcell=void 0}function cE(e,t,r){var i=e.struct_conn;if(i){oi(i,"id");for(var n=/"/g,a=t.getAtomProxy(),o=t.getAtomProxy(),s={},u=0,c=i.id.length;u<c;++u){var f=i.conn_type_id[u];if(!(f==="hydrog"||f==="mismat"||f==="saltbr")&&!(i.ptnr1_symmetry[u]!=="1_555"||i.ptnr2_symmetry[u]!=="1_555")){var l=i.pdbx_ptnr1_PDB_ins_code[u],h=i.pdbx_ptnr1_label_alt_id[u],d=i.ptnr1_auth_seq_id[u]+(ci(l)?"^"+l:"")+":"+r[i.ptnr1_label_asym_id[u]]+"."+i.ptnr1_label_atom_id[u].replace(n,"")+(ci(h)?"%"+h:""),p=s[d];if(!p){var v=new Kt(d);if(v.selection.error){ge&&fe.warn("invalid selection for connection",d);continue}p=t.getAtomIndices(v),s[d]=p}var m=i.pdbx_ptnr2_PDB_ins_code[u],g=i.pdbx_ptnr2_label_alt_id[u],x=i.ptnr2_auth_seq_id[u]+(ci(m)?"^"+m:"")+":"+r[i.ptnr2_label_asym_id[u]]+"."+i.ptnr2_label_atom_id[u].replace(n,"")+(ci(g)?"%"+g:""),y=s[x];if(!y){var b=new Kt(x);if(b.selection.error){ge&&fe.warn("invalid selection for connection",x);continue}y=t.getAtomIndices(b),s[x]=y}var _=p.length,w=y.length;if(_>w){var A=_;_=w,w=A;var S=p;p=y,y=S}if(_===0||w===0){ge&&fe.warn("no atoms found for",d,x);continue}for(var M=0;M<w;++M)a.index=p[M%_],o.index=y[M],a&&o?t.bondStore.addBond(a,o,jy(i.pdbx_value_order[u])):fe.log("atoms for connection not found")}}}}function fE(e,t,r){if(e.entity){oi(e.entity,"id");for(var i=e.entity,n=i.id.length,a=0;a<n;++a){var o=i.pdbx_description[a],s=i.type[a],u=Array.from(r[i.id[a]]);t.entityList[a]=new Hi(t,a,o,s,u)}}}var Cp=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"cif"},t.prototype._parse=function(){fe.time("CifParser._parse "+this.name);var n=this.structure,a=this.structureBuilder,o=this.firstModelOnly,s=this.asTrajectory,u=this.cAlphaOnly,c=n.frames,f,l,h,d,p={},v={},m={},g=!1,x=null,y=!1,b=!1,_=!1,w=[],A=null,S=null,M=null,E=null,T=[],H,X,q,Z,Q,N,D,W,L,U,k,ee,K,te,Y,J,j,ae=n.atomMap,re=n.atomStore;re.resize(this.streamer.data.length/100);var le=0,Se=0,_e;function ne(pe,Pe,He){for(var Je=pe;Je<Pe;++Je)if(h=He[Je],d=h.trim(),!d&&!g&&!b||d[0]==="#")g=!1,b=!1,y=!1,w.length=0,A=null,S=null,M=null,E=null,T.length=0;else if(d.substring(0,5)==="data_")p.data=d.substring(5).trim();else if(d[0]===";")g?(b?(A===w.length&&(A=0),w[A].push(x),A+=1):M===!1?p[S]=x:p[S][M]=x,g=!1,x=null):(g=!0,x=d.substring(1));else if(d==="loop_")b=!0,_=!0,w.length=0,T.length=0,A=0;else if(d[0]==="_"){var We,Be,ie;if(b&&!_&&(b=!1),b)We=d.split("."),Be=We[0].substring(1),ie=We[1],We.length===1?(ie=!1,p[Be]||(p[Be]=[]),w.push(p[Be])):(p[Be]||(p[Be]={}),p[Be][ie]?ge&&fe.warn(Be,ie,"already exists"):(p[Be][ie]=[],w.push(p[Be][ie]),T.push(ie))),S=Be,M=ie,E=!0;else{var we=d.match(mm),Ie=we[0],qe=we[1];We=Ie.split("."),Be=We[0].substring(1),ie=We[1],We.length===1?(ie=!1,p[Be]=qe):(p[Be]||(p[Be]={}),p[Be][ie]?ge&&fe.warn(Be,ie,"already exists"):p[Be][ie]=qe),qe||(y=!0),S=Be,M=ie}}else if(g)x+=h;else if(b){if(d)if(S==="atom_site"){var Ce=d.split(nE);E&&(H=T.indexOf("auth_asym_id"),X=T.indexOf("auth_seq_id"),q=T.indexOf("label_atom_id"),Z=T.indexOf("label_comp_id"),Q=T.indexOf("label_asym_id"),N=T.indexOf("label_entity_id"),D=T.indexOf("label_alt_id"),K=T.indexOf("Cartn_x"),te=T.indexOf("Cartn_y"),Y=T.indexOf("Cartn_z"),L=T.indexOf("id"),U=T.indexOf("type_symbol"),W=T.indexOf("group_PDB"),J=T.indexOf("B_iso_or_equiv"),k=T.indexOf("pdbx_PDB_model_num"),ee=T.indexOf("pdbx_PDB_ins_code"),j=T.indexOf("occupancy"),E=!1,_e=parseInt(Ce[k]),s&&(f=[],l=0));var Ne=parseInt(Ce[k]);if(_e!==Ne&&(s&&(Se===0&&c.push(new Float32Array(f)),f=new Float32Array(re.count*3),c.push(f),l=0),Se+=1),_e=Ne,o&&Se>0)continue;var Ze=Ce[q].replace(Ts,"");if(u&&Ze!=="CA")continue;var Ve=parseFloat(Ce[K]),Qe=parseFloat(Ce[te]),Ye=parseFloat(Ce[Y]);if(s){var vt=l*3;if(f[vt+0]=Ve,f[vt+1]=Qe,f[vt+2]=Ye,l+=1,Se>0)continue}var Nt=Ce[Z],Rt=parseInt(Ce[X]),Gt=Ce[ee];Gt=Gt==="?"?"":Gt;var Et=Ce[H],Mt=Ce[Q],bt=Ce[W][0]==="H"?1:0,rt=Ce[U],Ke=parseFloat(Ce[J]),Ft=parseFloat(Ce[j]),Zt=Ce[D];if(Zt=Zt==="."?"":Zt,re.growIfFull(),re.atomTypeId[le]=ae.add(Ze,rt),re.x[le]=Ve,re.y[le]=Qe,re.z[le]=Ye,re.serial[le]=parseInt(Ce[L]),re.bfactor[le]=isNaN(Ke)?0:Ke,re.occupancy[le]=isNaN(Ft)?0:Ft,re.altloc[le]=Zt.charCodeAt(0),a.addAtom(Se,Et,Mt,Nt,Rt,bt,void 0,Gt),ge){var dr=v[Mt];dr!==void 0&&dr!==Et&&ge&&fe.warn(dr,Et)}v[Mt]=Et;var Xt=Ce[N];m[Xt]||(m[Xt]=new Set),m[Xt].add(n.chainStore.count-1),le+=1}else{var P=d.match(mm),F=P.length;A===w.length&&(A=0);for(var B=0;B<F;++B)w[A+B].push(P[B]);A+=F}else continue;_=!1}else if(d[0]==="'"&&d[d.length-1]==="'"){var G=d.substring(1,d.length-1);M===!1?p[S]=G:p[S][M]=G}else y?M===!1?p[S]=d:p[S][M]=d:ge&&fe.log("CifParser._parse: unknown state",d)}if(this.streamer.eachChunkOfLines(function(pe){ne(0,pe.length,pe)}),p.chem_comp&&p.chem_comp_atom)aE(p,n,a),a.finalize(),n.finalizeAtoms(),n.finalizeBonds(),Wa(n);else if(p.atom_site_type_symbol&&p.atom_site_label&&p.atom_site_fract_x)oE(p,n,a),a.finalize(),n.finalizeAtoms(),Mf(n),n.finalizeBonds();else{var ve=sE(p,n,v);if(uE(p,n,v),cE(p,n,v),fE(p,n,m),p.struct&&p.struct.title&&(n.title=p.struct.title.trim().replace(Ls,"")),p.entry&&p.entry.id&&(n.id=p.entry.id.trim().replace(Ls,"")),p.pdbx_audit_revision_history){if(p.pdbx_audit_revision_history.revision_date){oi(p.pdbx_audit_revision_history,"revision_date");var se=p.pdbx_audit_revision_history.revision_date.filter(ci);se.length&&(n.header.releaseDate=se[0])}if(p.pdbx_database_status.recvd_initial_deposition_date){oi(p.pdbx_database_status,"recvd_initial_deposition_date");var xe=p.pdbx_database_status.recvd_initial_deposition_date.filter(ci);xe.length&&(n.header.depositionDate=xe[0])}}else if(p.database_PDB_rev){if(p.database_PDB_rev.date){oi(p.database_PDB_rev,"date");var he=p.database_PDB_rev.date.filter(ci);he.length&&(n.header.releaseDate=he[0])}if(p.database_PDB_rev.date_original){oi(p.database_PDB_rev,"date_original");var ye=p.database_PDB_rev.date_original.filter(ci);ye.length&&(n.header.depositionDate=ye[0])}}p.reflns&&p.reflns.d_resolution_high?ci(p.reflns.d_resolution_high)&&(n.header.resolution=parseFloat(p.reflns.d_resolution_high)):p.refine&&p.refine.ls_d_res_high&&ci(p.refine.ls_d_res_high)&&(n.header.resolution=parseFloat(p.refine.ls_d_res_high)),p.refine&&p.refine.ls_R_factor_R_free&&ci(p.refine.ls_R_factor_R_free)&&(n.header.rFree=parseFloat(p.refine.ls_R_factor_R_free)),p.refine&&p.refine.ls_R_factor_R_work&&ci(p.refine.ls_R_factor_R_work)&&(n.header.rWork=parseFloat(p.refine.ls_R_factor_R_work)),p.exptl&&p.exptl.method&&(oi(p.exptl,"method"),n.header.experimentalMethods=p.exptl.method.map(function(pe){return pe.replace(Ls,"")})),a.finalize(),n.finalizeAtoms(),Mf(n),n.finalizeBonds(),ve?by(n,ve):ul(n),fl(n),n.extraData.cif=p}ge&&fe.timeEnd("CifParser._parse "+this.name)},Object.defineProperties(t.prototype,r),t}(jn);ut.add("cif",Cp);ut.add("mcif",Cp);ut.add("mmcif",Cp);var lE=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"gro"},t.prototype._parse=function(){ge&&fe.time("GroParser._parse "+this.name);var n=this.structure,a=this.structureBuilder,o=this.firstModelOnly,s=this.asTrajectory,u=this.cAlphaOnly,c=n.frames,f=n.boxes,l,h,d=this.streamer.peekLines(3);n.title=d[0].trim();var p=d[2].length-d[2].lastIndexOf(".")-1,v=5+p,m=20,g=20+v,x=20+2*v,y,b,_,w,A=parseInt(d[1]),S=A+3,M=n.atomMap,E=n.atomStore;E.resize(A);var T=0,H=0,X=0;function q(Z,Q,N){for(var D=Z;D<Q;++D){++X;var W=X-1,L=N[D];if(L){if(W%S===0)s&&(l=new Float32Array(A*3),c.push(l),h=0);else if(W%S!==1)if(W%S===S-1){var U=L.trim().split(/\s+/),k=new Float32Array(9);if(k[0]=parseFloat(U[0])*10,k[4]=parseFloat(U[1])*10,k[8]=parseFloat(U[2])*10,f.push(k),o)return!0;H+=1}else{if(y=L.substr(10,5).trim(),u&&y!=="CA")continue;var ee=parseFloat(L.substr(m,v))*10,K=parseFloat(L.substr(g,v))*10,te=parseFloat(L.substr(x,v))*10;if(s){var Y=h*3;if(l[Y+0]=ee,l[Y+1]=K,l[Y+2]=te,h+=1,W>S)continue}b=L.substr(5,5).trim(),_=parseInt(L.substr(0,5)),w=parseInt(L.substr(15,5)),E.growIfFull(),E.atomTypeId[T]=M.add(y),E.x[T]=ee,E.y[T]=K,E.z[T]=te,E.serial[T]=w,a.addAtom(H,"","",b,_,0,"l"),T+=1}}}}this.streamer.eachChunkOfLines(function(Z){q(0,Z.length,Z)}),a.finalize(),n.finalizeAtoms(),cl(n),Mf(n),n.finalizeBonds(),ul(n),ge&&fe.timeEnd("GroParser._parse "+this.name)},Object.defineProperties(t.prototype,r),t}(jn);ut.add("gro",lE);var hE=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"],dE=["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"],pE=hE.concat(dE);function ju(e,t,r){return t?new e(t.buffer,t.byteOffset,t.byteLength/(r||1)):void 0}function vd(e){return ju(DataView,e)}function vE(e){return ju(Uint8Array,e)}function ch(e){return ju(Int8Array,e)}function pl(e){return ju(Int32Array,e,4)}function mE(e){return ju(Float32Array,e,4)}function xs(e,t){var r=e.length/2;t||(t=new Int16Array(r));for(var i=0,n=0;i<r;++i,n+=2)t[i]=e[n]<<8^e[n+1]<<0;return t}function $i(e,t){var r=e.length/4;t||(t=new Int32Array(r));for(var i=0,n=0;i<r;++i,n+=4)t[i]=e[n]<<24^e[n+1]<<16^e[n+2]<<8^e[n+3]<<0;return t}function gE(e,t){var r=e.length;t||(t=new Float32Array(r/4));for(var i=vd(t),n=vd(e),a=0,o=0,s=r/4;a<s;++a,o+=4)i.setFloat32(o,n.getFloat32(o),!0);return t}function vl(e,t,r){var i=e.length,n=1/t;r||(r=new Float32Array(i));for(var a=0;a<i;++a)r[a]=e[a]*n;return r}function Rf(e,t){var r,i;if(!t){var n=0;for(r=0,i=e.length;r<i;r+=2)n+=e[r+1];t=new e.constructor(n)}var a=0;for(r=0,i=e.length;r<i;r+=2)for(var o=e[r],s=e[r+1],u=0;u<s;++u)t[a]=o,++a;return t}function Xy(e,t){var r=e.length;t||(t=new e.constructor(r)),r&&(t[0]=e[0]);for(var i=1;i<r;++i)t[i]=e[i]+t[i-1];return t}function Lf(e,t){var r=e instanceof Int8Array?127:32767,i=-r-1,n=e.length,a,o;if(!t){var s=0;for(a=0;a<n;++a)e[a]<r&&e[a]>i&&++s;t=new Int32Array(s)}for(a=0,o=0;a<n;){for(var u=0;e[a]===r||e[a]===i;)u+=e[a],++a;u+=e[a],++a,t[o]=u,++o}return t}function yE(e,t){return Xy(Rf(e),t)}function bE(e,t,r){return vl(Rf(e,pl(r)),t,r)}function xE(e,t,r){return vl(Xy(e,pl(r)),t,r)}function gm(e,t,r){return vl(Lf(e,pl(r)),t,r)}function _E(e,t,r){var i=Lf(e,pl(r));return xE(i,t,mE(i))}function wE(a){var t=vd(a),r=t.getInt32(0),i=t.getInt32(4),n=a.subarray(8,12),a=a.subarray(12);return[r,a,i,n]}function qy(e){var t=0,r=new DataView(e.buffer);function i(u){for(var c={},f=0;f<u;f++){var l=s();c[l]=s()}return c}function n(u){var c=e.subarray(t,t+u);return t+=u,c}function a(u){var c=e.subarray(t,t+u);t+=u;var f=65535;if(u>f){for(var l=[],h=0;h<c.length;h+=f)l.push(String.fromCharCode.apply(null,c.subarray(h,h+f)));return l.join("")}else return String.fromCharCode.apply(null,c)}function o(u){for(var c=new Array(u),f=0;f<u;f++)c[f]=s();return c}function s(){var u=e[t],c,f;if(!(u&128))return t++,u;if((u&240)===128)return f=u&15,t++,i(f);if((u&240)===144)return f=u&15,t++,o(f);if((u&224)===160)return f=u&31,t++,a(f);if((u&224)===224)return c=r.getInt8(t),t++,c;switch(u){case 192:return t++,null;case 194:return t++,!1;case 195:return t++,!0;case 196:return f=r.getUint8(t+1),t+=2,n(f);case 197:return f=r.getUint16(t+1),t+=3,n(f);case 198:return f=r.getUint32(t+1),t+=5,n(f);case 202:return c=r.getFloat32(t+1),t+=5,c;case 203:return c=r.getFloat64(t+1),t+=9,c;case 204:return c=e[t+1],t+=2,c;case 205:return c=r.getUint16(t+1),t+=3,c;case 206:return c=r.getUint32(t+1),t+=5,c;case 208:return c=r.getInt8(t+1),t+=2,c;case 209:return c=r.getInt16(t+1),t+=3,c;case 210:return c=r.getInt32(t+1),t+=5,c;case 217:return f=r.getUint8(t+1),t+=2,a(f);case 218:return f=r.getUint16(t+1),t+=3,a(f);case 219:return f=r.getUint32(t+1),t+=5,a(f);case 220:return f=r.getUint16(t+1),t+=3,o(f);case 221:return f=r.getUint32(t+1),t+=5,o(f);case 222:return f=r.getUint16(t+1),t+=3,i(f);case 223:return f=r.getUint32(t+1),t+=5,i(f)}throw new Error("Unknown type 0x"+u.toString(16))}return s()}function AE(e,t,r,i){switch(e){case 1:return gE(t);case 2:return ch(t);case 3:return xs(t);case 4:return $i(t);case 5:return vE(t);case 6:return Rf($i(t),new Uint8Array(r));case 7:return Rf($i(t));case 8:return yE($i(t));case 9:return bE($i(t),$i(i)[0]);case 10:return _E(xs(t),$i(i)[0]);case 11:return vl(xs(t),$i(i)[0]);case 12:return gm(xs(t),$i(i)[0]);case 13:return gm(ch(t),$i(i)[0]);case 14:return Lf(xs(t));case 15:return Lf(ch(t))}}function SE(e,t){t=t||{};var r=t.ignoreFields,i={};return pE.forEach(function(n){var a=r?r.indexOf(n)!==-1:!1,o=e[n];!a&&o!==void 0&&(o instanceof Uint8Array?i[n]=AE.apply(null,wE(o)):i[n]=o)}),i}var ME={0:105,1:115,2:104,3:101,4:103,5:98,6:116,7:108,"-1":NaN},CE=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},isBinary:{configurable:!0}};return r.type.get=function(){return"mmtf"},r.isBinary.get=function(){return!0},t.prototype._parse=function(){ge&&fe.time("MmtfParser._parse "+this.name);var n,a,o,s,u,c=this.structure,f=SE(qy(this.streamer.data)),l=["depositionDate","releaseDate","resolution","rFree","rWork","experimentalMethods"];l.forEach(function(Ve){f[Ve]!==void 0&&(c.header[Ve]=f[Ve])});var h,d,p,v,m,g;if(c.id=f.structureId,c.title=f.title,c.atomStore.addField("formalCharge",1,"int8"),this.firstModelOnly||this.asTrajectory){for(m=1,v=f.chainsPerModel[0],p=0,n=0,a=v;n<a;++n)p+=f.groupsPerChain[n];for(d=0,n=0,a=p;n<a;++n)u=f.groupList[f.groupTypeList[n]],d+=u.atomNameList.length;h=f.numBonds,g=[v]}else h=f.numBonds,d=f.numAtoms,p=f.numGroups,v=f.numChains,m=f.numModels,g=f.chainsPerModel;if(h+=p,this.asTrajectory)for(n=0,a=f.numModels;n<a;++n){var x=new Float32Array(d*3),y=d*n;for(o=0;o<d;++o){var b=o*3,_=o+y;x[b]=f.xCoordList[_],x[b+1]=f.yCoordList[_],x[b+2]=f.zCoordList[_]}c.frames.push(x)}var w=new Uint32Array(h),A=new Uint32Array(h),S=new Uint8Array(h),M=new Uint32Array(d),E=new Int8Array(d),T=new Uint32Array(p),H=new Uint32Array(p),X=new Uint16Array(p),q=new Uint16Array(v),Z=new Uint32Array(v),Q=new Uint32Array(v),N=new Uint32Array(m),D=new Uint32Array(m),W=0;for(n=0,a=m;n<a;++n){var L=g[n];for(N[n]=W,D[n]=L,o=0;o<L;++o)q[o+W]=n;W+=L}var U=f.groupsPerChain,k=0;for(n=0,a=v;n<a;++n){var ee=U[n];for(Z[n]=k,Q[n]=ee,o=0;o<ee;++o)T[o+k]=n;k+=ee}var K=0,te=0;for(n=0,a=p;n<a;++n){u=f.groupList[f.groupTypeList[n]];var Y=u.atomNameList.length,J=u.formalChargeList,j=u.bondAtomList,ae=u.bondOrderList;for(o=0,s=ae.length;o<s;++o)w[te]=K+j[o*2],A[te]=K+j[o*2+1],S[te]=ae[o],te+=1;for(H[n]=K,X[n]=Y,o=0;o<Y;++o)M[K]=n,E[K]=J[o],K+=1}var re=f.bondAtomList;if(re)for(f.bondOrderList&&S.set(f.bondOrderList,te),n=0,a=re.length;n<a;n+=2){var le=re[n],Se=re[n+1];le<d&&Se<d&&(w[te]=le,A[te]=Se,te+=1)}c.bondStore.length=S.length,c.bondStore.count=te,c.bondStore.atomIndex1=w,c.bondStore.atomIndex2=A,c.bondStore.bondOrder=S,c.atomStore.length=d,c.atomStore.count=d,c.atomStore.residueIndex=M,c.atomStore.atomTypeId=new Uint16Array(d),c.atomStore.x=f.xCoordList.subarray(0,d),c.atomStore.y=f.yCoordList.subarray(0,d),c.atomStore.z=f.zCoordList.subarray(0,d),c.atomStore.serial=f.atomIdList.subarray(0,d),c.atomStore.bfactor=f.bFactorList.subarray(0,d),c.atomStore.altloc=f.altLocList.subarray(0,d),c.atomStore.occupancy=f.occupancyList.subarray(0,d),c.atomStore.formalCharge=E,c.residueStore.length=p,c.residueStore.count=p,c.residueStore.chainIndex=T,c.residueStore.residueTypeId=f.groupTypeList,c.residueStore.atomOffset=H,c.residueStore.atomCount=X,c.residueStore.resno=f.groupIdList.subarray(0,p),c.residueStore.sstruc=f.secStructList.subarray(0,p),c.residueStore.inscode=f.insCodeList.subarray(0,p),c.chainStore.length=v,c.chainStore.count=v,c.chainStore.entityIndex=new Uint16Array(v),c.chainStore.modelIndex=q,c.chainStore.residueOffset=Z,c.chainStore.residueCount=Q,c.chainStore.chainname=f.chainNameList.subarray(0,v*4),c.chainStore.chainid=f.chainIdList.subarray(0,v*4),c.modelStore.length=m,c.modelStore.count=m,c.modelStore.chainOffset=N,c.modelStore.chainCount=D;var _e={};for(n=0,a=f.groupList.length;n<a;++n){var ne=f.groupList[n],ve=[];for(o=0,s=ne.atomNameList.length;o<s;++o){var se=ne.elementList[o].toUpperCase(),xe=ne.atomNameList[o];ve.push(c.atomMap.add(xe,se))}var he=ne.chemCompType.toUpperCase(),ye=HS.includes(he),pe=ne.bondOrderList.length,Pe=new Array(pe),He=new Array(pe);for(o=0;o<pe;++o)Pe[o]=ne.bondAtomList[o*2],He[o]=ne.bondAtomList[o*2+1];var Je={atomIndices1:Pe,atomIndices2:He,bondOrders:ne.bondOrderList};_e[n]=c.residueMap.add(ne.groupName,ve,ye,he,Je)}for(n=0,a=p;n<a;++n)c.residueStore.residueTypeId[n]=_e[c.residueStore.residueTypeId[n]];for(n=0,a=c.atomStore.count;n<a;++n){var We=c.atomStore.residueIndex[n],Be=c.residueMap.list[c.residueStore.residueTypeId[We]],ie=c.residueStore.atomOffset[We];c.atomStore.atomTypeId[n]=Be.atomTypeIdList[n-ie]}if(f.secStructList){var we=f.secStructList.length;for(n=0,a=c.residueStore.count;n<a;++n){var Ie=ME[c.residueStore.sstruc[n%we]];Ie!==void 0&&(c.residueStore.sstruc[n]=Ie)}}if(f.entityList&&f.entityList.forEach(function(Ve,Qe){c.entityList[Qe]=new Hi(c,Qe,Ve.description,Ve.type,Ve.chainIndexList)}),f.bioAssemblyList&&f.bioAssemblyList.forEach(function(Ve,Qe){var Ye=Qe+1,vt=new Br(""+Ye);c.biomolDict["BU"+Ye]=vt;var Nt={};Ve.transformList.forEach(function(Rt){var Gt=new Ae().fromArray(Rt.matrix).transpose(),Et=Rt.chainIndexList.map(function(bt){for(var rt="",Ke=0;Ke<4;++Ke){var Ft=f.chainNameList[bt*4+Ke];if(Ft)rt+=String.fromCharCode(Ft);else break}return rt}),Mt=Nt[Et.toString()];Mt?Mt.matrixList.push(Gt):Nt[Et.toString()]=vt.addPart([Gt],Et)})}),f.ncsOperatorList){var qe="NCS",Ce=new Br(qe),Ne=Ce.addPart();f.ncsOperatorList.forEach(function(Ve){var Qe=new Ae().fromArray(Ve).transpose();Ne.matrixList.push(Qe)}),Ne.matrixList.length>0&&(c.biomolDict[qe]=Ce)}var Ze=f.unitCell;Ze&&Array.isArray(Ze)&&Ze[0]?c.unitcell=new Ja({a:Ze[0],b:Ze[1],c:Ze[2],alpha:Ze[3],beta:Ze[4],gamma:Ze[5],spacegroup:f.spaceGroup}):c.unitcell=void 0,as(c,!0),ns(c,!0),c.finalizeAtoms(),c.finalizeBonds(),fl(c),ge&&fe.timeEnd("MmtfParser._parse "+this.name)},Object.defineProperties(t.prototype,r),t}(jn);ut.add("mmtf",CE);var fh=/\s+/,PE={1:1,2:2,3:3,am:1,ar:1,du:1,un:1,nc:0},TE=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"mol2"},t.prototype._parse=function(){ge&&fe.time("Mol2Parser._parse "+this.name);var n=this.structure,a=this.structureBuilder,o=this.firstModelOnly,s=this.asTrajectory,u=n.frames,c=!1,f,l,h=n.atomMap,d=n.atomStore;d.resize(Math.round(this.streamer.data.length/60)),d.addField("partialCharge",1,"float32");var p=0,v=0,m=0,g=-1,x=0,y=0,b=1,_=2,w=3,A=n.getAtomProxy(),S=n.getAtomProxy();function M(E,T,H){for(var X=E;X<T;++X){var q=H[X].trim();if(!(q===""||q[0]==="#")){if(q[0]==="@")q==="@<TRIPOS>MOLECULE"?(y=b,v=0,++g):q==="@<TRIPOS>ATOM"?(y=_,m=d.count,s&&(l=0,f=new Float32Array(x*3),u.push(f),g>0&&(c=!0))):q==="@<TRIPOS>BOND"?y=w:y=0;else if(y===b){if(v===0)n.title=q,n.id=q;else if(v===1){var Z=q.split(fh);x=parseInt(Z[0])}++v}else if(y===_){var Q=q.split(fh);if(o&&g>0)continue;var N=parseFloat(Q[2]),D=parseFloat(Q[3]),W=parseFloat(Q[4]);if(s){var L=l*3;if(f[L+0]=N,f[L+1]=D,f[L+2]=W,l+=1,c)continue}var U=Q[0],k=Q[1],ee=Q[5].split(".")[0],K=Q[6]?parseInt(Q[6]):1,te=Q[7]?Q[7]:"",Y=Q[8]?parseFloat(Q[8]):0;d.growIfFull(),d.atomTypeId[p]=h.add(k,ee),d.x[p]=N,d.y[p]=D,d.z[p]=W,d.serial[p]=U,d.partialCharge[p]=Y,a.addAtom(g,"","",te,K,1),p+=1}else if(y===w){if(o&&g>0||s&&g>0)continue;var J=q.split(fh);A.index=parseInt(J[1])-1+m,S.index=parseInt(J[2])-1+m;var j=PE[J[3]];n.bondStore.addBond(A,S,j)}}}}this.streamer.eachChunkOfLines(function(E){M(0,E.length,E)}),a.finalize(),n.finalizeAtoms(),cl(n),ns(n,!0),as(n,!0),n.finalizeBonds(),Wa(n),ul(n),ge&&fe.timeEnd("Mol2Parser._parse "+this.name)},Object.defineProperties(t.prototype,r),t}(jn);ut.add("mol2",TE);var EE=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"pdbqt"},Object.defineProperties(t.prototype,r),t}(Wu);ut.add("pdbqt",EE);var IE=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"pqr"},Object.defineProperties(t.prototype,r),t}(Wu);ut.add("pqr",IE);var RE=/> <(.+)>/,Pp=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"sdf"},t.prototype._parse=function(){ge&&fe.time("SdfParser._parse "+this.name);var n=this.structure,a=this.structureBuilder,o=this.firstModelOnly,s=this.asTrajectory,u=this.streamer.peekLines(2);n.id=u[0].trim(),n.title=u[1].trim();var c=n.frames,f=!1,l,h,d=n.atomMap,p=n.atomStore;p.resize(Math.round(this.streamer.data.length/50)),p.addField("formalCharge",1,"int8");var v=n.getAtomProxy(),m=n.getAtomProxy(),g=0,x=0,y=0,b=0,_=[],w=!1,A={},S;n.extraData.sdf=_;var M,E,T,H,X,q;function Z(Q,N,D){for(var W=Q;W<N;++W){var L=D[W];if(L.substr(0,4)==="$$$$")x=-1,++y,b=p.count,_.push(A),A={},w=!1;else if(x===3)M=parseInt(L.substr(0,3)),E=parseInt(L.substr(3,3)),T=4,H=T+M,X=H,q=X+E,s&&(h=0,l=new Float32Array(M*3),c.push(l),y>0&&(f=!0));else if(x>=T&&x<H){if(o&&y>0)continue;var U=parseFloat(L.substr(0,10)),k=parseFloat(L.substr(10,10)),ee=parseFloat(L.substr(20,10));if(s){var K=h*3;if(l[K+0]=U,l[K+1]=k,l[K+2]=ee,h+=1,f)continue}var te=L.substr(31,3).trim(),Y=te+(g+1);p.growIfFull(),p.atomTypeId[g]=d.add(Y,te),p.x[g]=U,p.y[g]=k,p.z[g]=ee,p.serial[g]=g,p.formalCharge[g]=0,a.addAtom(y,"","","HET",1,1),g+=1}else if(x>=X&&x<q){if(o&&y>0||s&&y>0)continue;v.index=parseInt(L.substr(0,3))-1+b,m.index=parseInt(L.substr(3,3))-1+b;var J=parseInt(L.substr(6,3));n.bondStore.addBond(v,m,J)}else if(L.match(/M {2}CHG/))for(var j=parseInt(L.substr(6,3)),ae=0,re=10;ae<j;++ae,re+=8){var le=parseInt(L.substr(re,3)),Se=le-1+b,_e=parseInt(L.substr(re+4,3));p.formalCharge[Se]=_e}else(S=L.match(RE))?(w=S[1],A[w]=[]):w!==!1&&L&&A[w].push(L);++x}}this.streamer.eachChunkOfLines(function(Q){Z(0,Q.length,Q)}),a.finalize(),n.finalizeAtoms(),n.finalizeBonds(),Wa(n),ge&&fe.timeEnd("SdfParser._parse "+this.name)},t.prototype._postProcess=function(){Wa(this.structure)},Object.defineProperties(t.prototype,r),t}(jn);ut.add("sdf",Pp);ut.add("sd",Pp);ut.add("mol",Pp);var LE=18.2223;function _s(e,t,r){return parseInt(e.substr(t,r).trim())}var Yy=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"prmtop"},t.prototype._parse=function(){ge&&fe.time("PrmtopParser._parse "+this.name);var n=this.structure,a=this.structureBuilder,o=n.atomMap,s=n.atomStore;s.addField("partialCharge",1,"float32"),s.addField("radius",1,"float32");var u=[],c={},f=["NATOM","NTYPES","NBONH","MBONA","NTHETH","MTHETA","NPHIH","MPHIA","NHPARM","NPARM","NNB","NRES","NBONA","NTHETA","NPHIA","NUMBND","NUMANG","NPTRA","NATYP","NPHB","IFPERT","NBPER","NGPER","NDPER","MBPER","MGPER","MDPER","IFBOX","NMXRS","IFCAP","NUMEXTRA","NCOPY"];f.forEach(function(H){c[H]=0});var l,h,d,p,v,m,g,x,y,b,_;function w(H,X,q){for(var Z=H;Z<X;++Z){var Q=q[Z],N=Q.trim();if(N){if(!Q.startsWith("%FORMAT")){if(Q.startsWith("%FLAG")){var D=Q.substr(5).trim();b=0,D==="TITLE"?y=0:D==="POINTERS"?y=1:D==="ATOM_NAME"?y=2:D==="CHARGE"?y=3:D==="MASS"?y=4:D==="RESIDUE_LABEL"?y=5:D==="RESIDUE_POINTER"?y=6:D==="BONDS_INC_HYDROGEN"?(_=0,y=7):D==="BONDS_WITHOUT_HYDROGEN"?(_=c.NBONH,y=8):D==="RADII"?y=9:y=void 0}else if(y===0)u.push(N);else if(y===1){for(var W=Math.min(b+10,32),L=0;b<W;++L,++b)c[f[b]]=parseInt(Q.substr(L*8,8).trim());l=new Array(c.NATOM),h=new Float32Array(c.NATOM),d=new Float32Array(c.NATOM),s.resize(c.NATOM);var U=c.NBONH+c.MBONA;p=new Uint32Array(U),v=new Uint32Array(U),m=new Uint8Array(U),g=new Array(c.NRES),x=new Uint32Array(c.NRES)}else if(y===2)for(var k=Math.min(b+20,c.NATOM),ee=0;b<k;++ee,++b)l[b]=Q.substr(ee*4,4).trim();else if(y===3)for(var K=Math.min(b+5,c.NATOM),te=0;b<K;++te,++b)h[b]=parseFloat(Q.substr(te*16,16))/LE;else if(y!==4){if(y===5)for(var Y=Math.min(b+20,c.NRES),J=0;b<Y;++J,++b)g[b]=Q.substr(J*4,4).trim();else if(y===6)for(var j=Math.min(b+10,c.NRES),ae=0;b<j;++ae,++b)x[b]=_s(Q,ae*8,8);else if(y===7)for(var re=Math.min(b+10,c.NBONH*3),le=0;b<re;++le,++b){var Se=b%3;Se===0&&(p[_]=_s(Q,le*8,8)/3),Se===1&&(v[_]=_s(Q,le*8,8)/3,m[_]=1,++_)}else if(y===8)for(var _e=Math.min(b+10,c.MBONA*3),ne=0;b<_e;++ne,++b){var ve=b%3;ve===0&&(p[_]=_s(Q,ne*8,8)/3),ve===1&&(v[_]=_s(Q,ne*8,8)/3,m[_]=1,++_)}else if(y===9)for(var se=Math.min(b+5,c.NATOM),xe=0;b<se;++xe,++b)d[b]=parseFloat(Q.substr(xe*16,16))}}}else continue}}this.streamer.eachChunkOfLines(function(H){w(0,H.length,H)}),n.title=u.join(" ");for(var A=c.NATOM,S=0,M=g[0],E=1,T=0;T<A;++T)T+1===x[S+1]&&(++S,M=g[S],E=S+1),s.atomTypeId[T]=o.add(l[T]),s.serial[T]=T+1,a.addAtom(0,"","",M,E);s.partialCharge.set(h),s.radius.set(d),n.bondStore.length=m.length,n.bondStore.count=m.length,n.bondStore.atomIndex1=p,n.bondStore.atomIndex2=v,n.bondStore.bondOrder=m,a.finalize(),n.finalizeAtoms(),n.finalizeBonds(),ns(n,!0),as(n,!0,!0),cl(n,!0),Wa(n),ge&&fe.timeEnd("PrmtopParser._parse "+this.name)},Object.defineProperties(t.prototype,r),t}(jn);ut.add("prmtop",Yy);ut.add("parm7",Yy);var ym=1,bm=2,xm=3,_m=4,wm=5,Am=6,uc=/\s+/,OE=/(^\*|REMARK)*/,DE=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"psf"},t.prototype._parse=function(){ge&&fe.time("PsfParser._parse "+this.name);var n=this.structure,a=this.structureBuilder,o=n.atomMap,s=n.atomStore;s.addField("partialCharge",1,"float32");var u=[],c,f,l,h=0,d=0,p=0,v,m,g;function x(y,b,_){for(var w=y;w<b;++w){var A=_[w].trim();if(!A){c=void 0;continue}if(c===bm){var S=A.split(uc),M=parseInt(S[0]),E=S[1],T=parseInt(S[2]),H=S[3],X=S[4],q=parseFloat(S[6]);E!==l&&(f=Au(d),++d),s.growIfFull(),s.atomTypeId[h]=o.add(X),s.serial[h]=M,s.partialCharge[h]=q,a.addAtom(0,f,f,H,T),h+=1,l=E}else if(c===xm)for(var Z=A.split(uc),Q=0,N=Z.length;Q<N;Q+=2)v[p]=parseInt(Z[Q])-1,m[p]=parseInt(Z[Q+1])-1,g[p]=1,p+=1;else if(c===ym)u.push(A.replace(OE,"").trim());else if(c!==_m){if(c!==wm){if(c!==Am)if(A.includes("!NATOM")){c=bm;var D=parseInt(A.split(uc)[0]);s.resize(D)}else if(A.includes("!NBOND")){c=xm;var W=parseInt(A.split(uc)[0]);v=new Uint32Array(W),m=new Uint32Array(W),g=new Uint8Array(W)}else A.includes("!NTITLE")?c=ym:A.includes("!NTHETA")?c=_m:A.includes("!NPHI")?c=wm:A.includes("!NIMPHI")&&(c=Am)}}}}this.streamer.eachChunkOfLines(function(y){x(0,y.length,y)}),n.title=u.join(" "),n.bondStore.length=g.length,n.bondStore.count=p,n.bondStore.atomIndex1=v,n.bondStore.atomIndex2=m,n.bondStore.bondOrder=g,a.finalize(),n.finalizeAtoms(),n.finalizeBonds(),ns(n,!0),as(n,!0,!0),Wa(n),ge&&fe.timeEnd("PsfParser._parse "+this.name)},Object.defineProperties(t.prototype,r),t}(jn);ut.add("psf",DE);var FE=/\[ (.+) \]/,cc=/\s+/,BE=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"top"},t.prototype._parse=function(){ge&&fe.time("TopParser._parse "+this.name);var n=this.structure,a=this.structureBuilder,o=n.atomMap,s=n.bondStore,u=n.atomStore;u.addField("partialCharge",1,"float32");var c=[],f={},l,h;function d(A,S,M){for(var E=A;E<S;++E){var T=M[E],H=T.trim();if(!(!H||H[0]==="*"||H[0]===";")){if(H.startsWith("#include"))throw new Error("TopParser: #include statements not allowed");var X=T.match(FE);if(X!==null){var q=X[1];q==="moleculetype"?(h=2,l={atoms:[],bonds:[]}):q==="atoms"?h=3:q==="bonds"?h=4:q==="system"?h=0:q==="molecules"?h=1:h=void 0;continue}var Z=H.indexOf(";");if(Z!==-1&&(H=H.substring(0,Z).trim()),h===2){var Q=H.split(cc)[0];f[Q]=l}else if(h===3){var N=H.split(cc);l.atoms.push([parseInt(N[2]),N[3],N[4],parseFloat(N[6])])}else if(h===4){var D=H.split(cc);l.bonds.push([parseInt(D[0]),parseInt(D[1])])}else if(h===0)n.title=H;else if(h===1){var W=H.split(cc);c.push([W[0],parseInt(W[1])])}}}}this.streamer.eachChunkOfLines(function(A){d(0,A.length,A)});var p=0,v=0;c.forEach(function(A){var S=A[0],M=A[1],E=f[S];p+=M*E.atoms.length,v+=M*E.bonds.length}),u.resize(p),s.resize(v);var m=0,g=0,x=0,y=0,b=0,_=0,w;c.forEach(function(A){for(var S=A[0],M=A[1],E=f[S],T=Au(y),H=function(q){w=-1;var Z=Af.includes(S)?T:Au(x);E.atoms.forEach(function(Q){var N=Q[0],D=Q[1],W=Q[2],L=Q[3];N!==w&&++g,u.atomTypeId[m]=o.add(W),u.serial[m]=m+1,u.partialCharge[m]=L,a.addAtom(0,T,Z,D,g+1),++m,w=N}),E.bonds.forEach(function(Q){s.atomIndex1[b]=_+Q[0]-1,s.atomIndex2[b]=_+Q[1]-1,++b}),++x,_+=E.atoms.length},X=0;X<M;++X)H();++y}),s.count=v,a.finalize(),n.finalizeAtoms(),n.finalizeBonds(),ns(n,!0),as(n,!0,!0),Wa(n),ge&&fe.timeEnd("TopParser._parse "+this.name)},Object.defineProperties(t.prototype,r),t}(jn);ut.add("top",BE);var ml=function(e){function t(i,n){e.call(this,i,n),this.frames=new xp(this.name,this.path)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},__objName:{configurable:!0}};return r.type.get=function(){return"trajectory"},r.__objName.get=function(){return"frames"},Object.defineProperties(t.prototype,r),t}(qr),NE=20.45482949774598,kE=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},isBinary:{configurable:!0}};return r.type.get=function(){return"dcd"},r.isBinary.get=function(){return!0},t.prototype._parse=function(){ge&&fe.time("DcdParser._parse "+this.name);var n=Ho(this.streamer.data),a=new DataView(n),o=this.frames,s=o.coordinates,u=o.boxes,c={},f=0,l=new Int32Array(n,0,23),h=l[0]!==a.getInt32(0);if(l[0]!==84)for(var d=n.byteLength,p=0;p<d;p+=4)a.setFloat32(p,a.getFloat32(p),!0);l[0]!==84&&fe.error("dcd bad format, header block start");var v=String.fromCharCode(a.getUint8(4),a.getUint8(5),a.getUint8(6),a.getUint8(7));v!=="CORD"&&fe.error("dcd bad format, format string");var m=!1,g=!1,x=!1;l[22]!==0&&(m=!0,l[12]!==0&&(g=!0),l[13]===1&&(x=!0)),c.NSET=l[2],c.ISTART=l[3],c.NSAVC=l[4],c.NAMNF=l[10],m?c.DELTA=a.getFloat32(44,h):c.DELTA=a.getFloat64(44,h),l[22]!==84&&fe.error("dcd bad format, header block end"),f=f+21*4+8;var y=a.getInt32(f,h),b=f+1;if((y-4)%80!==0&&fe.error("dcd bad format, title block start"),c.TITLE=Nf(new Uint8Array(n,b,y)),a.getInt32(b+y+4-1,h)!==y&&fe.error("dcd bad format, title block end"),f=f+y+8,a.getInt32(f,h)!==4&&fe.error("dcd bad format, natom block start"),c.NATOM=a.getInt32(f+4,h),a.getInt32(f+8,h)!==4&&fe.error("dcd bad format, natom block end"),f=f+4+8,c.NAMNF>0){fe.error("dcd format with fixed atoms unsupported, aborting");return}for(var _=c.NATOM,w=_*4,A=0,S=c.NSET;A<S;++A){if(g){f+=4;var M=new Float32Array(9);M[0]=a.getFloat64(f,h),M[4]=a.getFloat64(f+2*8,h),M[8]=a.getFloat64(f+5*8,h),u.push(M),f+=48,f+=4}for(var E=new Float32Array(_*3),T=0;T<3;++T){a.getInt32(f,h)!==w&&fe.error("dcd bad format, coord block start",A,T),f+=4;for(var H=new Float32Array(n,f,_),X=0;X<_;++X)E[3*X+T]=H[X];f+=w,a.getInt32(f,h)!==w&&fe.error("dcd bad format, coord block end",A,T),f+=4}if(s.push(E),x){var q=a.getInt32(f,h);f+=4+q+4}}c.DELTA&&(o.deltaTime=c.DELTA*NE),c.ISTART>=1&&(o.timeOffset=(c.ISTART-1)*o.deltaTime),ge&&fe.timeEnd("DcdParser._parse "+this.name)},Object.defineProperties(t.prototype,r),t}(ml);ut.add("dcd",kE);function fi(e,t){if(e)throw new TypeError("Not a valid NetCDF v3.x file: "+t)}function Zy(e){e.offset%4!==0&&e.skip(4-e.offset%4)}function Tp(e){var t=e.readUint32(),r=e.readChars(t);return Zy(e),r}var cr={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function Ky(e){switch(Number(e)){case cr.BYTE:return"byte";case cr.CHAR:return"char";case cr.SHORT:return"short";case cr.INT:return"int";case cr.FLOAT:return"float";case cr.DOUBLE:return"double";default:return"undefined"}}function Jy(e){switch(Number(e)){case cr.BYTE:return 1;case cr.CHAR:return 1;case cr.SHORT:return 2;case cr.INT:return 4;case cr.FLOAT:return 4;case cr.DOUBLE:return 8;default:return-1}}function Qy(e){switch(String(e)){case"byte":return cr.BYTE;case"char":return cr.CHAR;case"short":return cr.SHORT;case"int":return cr.INT;case"float":return cr.FLOAT;case"double":return cr.DOUBLE;default:return-1}}function fc(e,t){if(e!==1){for(var r=new Array(e),i=0;i<e;i++)r[i]=t();return r}else return t()}function Ep(e,t,r){switch(t){case cr.BYTE:return e.readBytes(r);case cr.CHAR:return zE(e.readChars(r));case cr.SHORT:return fc(r,e.readInt16.bind(e));case cr.INT:return fc(r,e.readInt32.bind(e));case cr.FLOAT:return fc(r,e.readFloat32.bind(e));case cr.DOUBLE:return fc(r,e.readFloat64.bind(e));default:fi(!0,"non valid type "+t);return}}function zE(e){return e.charCodeAt(e.length-1)===0?e.substring(0,e.length-1):e}function UE(e,t){for(var r=Qy(t.type),i=t.size/Jy(r),n=new Array(i),a=0;a<i;a++)n[a]=Ep(e,r,1);return n}function GE(e,t,r){for(var i=Qy(t.type),n=t.size?t.size/Jy(i):1,a=r.length,o=new Array(a),s=r.recordStep,u=0;u<a;u++){var c=e.offset;o[u]=Ep(e,i,n),e.seek(c+s)}return o}var No=0,HE=10,VE=11,WE=12;function jE(e,t){var r={recordDimension:{length:e.readUint32()}};r.version=t;var i=XE(e);r.recordDimension.id=i.recordId,r.recordDimension.name=i.recordName,r.dimensions=i.dimensions,r.globalAttributes=$y(e);var n=qE(e,i.recordId,t);return r.variables=n.variables,r.recordDimension.recordStep=n.recordStep,r}function XE(e){var t,r,i,n=e.readUint32();if(n===No)return fi(e.readUint32()!==No,"wrong empty tag for list of dimensions"),[];fi(n!==HE,"wrong tag for list of dimensions");var a=e.readUint32();t=new Array(a);for(var o=0;o<a;o++){var s=Tp(e),u=e.readUint32();u===0&&(r=o,i=s),t[o]={name:s,size:u}}return{dimensions:t,recordId:r,recordName:i}}function $y(e){var t,r=e.readUint32();if(r===No)return fi(e.readUint32()!==No,"wrong empty tag for list of attributes"),[];fi(r!==WE,"wrong tag for list of attributes");var i=e.readUint32();t=new Array(i);for(var n=0;n<i;n++){var a=Tp(e),o=e.readUint32();fi(o<1||o>6,"non valid type "+o);var s=e.readUint32(),u=Ep(e,o,s);Zy(e),t[n]={name:a,type:Ky(o),value:u}}return t}function qE(e,t,r){var i=e.readUint32(),n=0,a;if(i===No)return fi(e.readUint32()!==No,"wrong empty tag for list of variables"),[];fi(i!==VE,"wrong tag for list of variables");var o=e.readUint32();a=new Array(o);for(var s=0;s<o;s++){for(var u=Tp(e),c=e.readUint32(),f=new Array(c),l=0;l<c;l++)f[l]=e.readUint32();var h=$y(e),d=e.readUint32();fi(d<1&&d>6,"non valid type "+d);var p=e.readUint32(),v=e.readUint32();r===2&&(fi(v>0,"offsets larger than 4GB not supported"),v=e.readUint32()),f[0]===t&&(n+=p),a[s]={name:u,dimensions:f,attributes:h,type:Ky(d),size:p,offset:v,record:f[0]===t}}return{variables:a,recordStep:n}}var Xu=function(t){var r=new yt(t);r.setBigEndian(),fi(r.readChars(3)!=="CDF","should start with CDF");var i=r.readByte();fi(i>2,"unknown version"),this.header=jE(r,i),this.buffer=r},hs={version:{configurable:!0},recordDimension:{configurable:!0},dimensions:{configurable:!0},globalAttributes:{configurable:!0},variables:{configurable:!0}};hs.version.get=function(){return this.header.version===1?"classic format":"64-bit offset format"};hs.recordDimension.get=function(){return this.header.recordDimension};hs.dimensions.get=function(){return this.header.dimensions};hs.globalAttributes.get=function(){return this.header.globalAttributes};hs.variables.get=function(){return this.header.variables};Xu.prototype.hasDataVariable=function(t){return this.header.variables.findIndex(function(r){return r.name===t})!==-1};Xu.prototype.getDataVariable=function(t){var r;return typeof t=="string"?r=this.header.variables.find(function(i){return i.name===t}):r=t,fi(r===void 0,"variable not found"),this.buffer.seek(r.offset),r.record?GE(this.buffer,r,this.header.recordDimension):UE(this.buffer,r)};Object.defineProperties(Xu.prototype,hs);var Ip=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},isBinary:{configurable:!0}};return r.type.get=function(){return"nctraj"},r.isBinary.get=function(){return!0},t.prototype._parse=function(){ge&&fe.time("NctrajParser._parse "+this.name);var n=new Xu(this.streamer.data),a=this.frames,o=a.coordinates,s=a.boxes,u=a.times;n.getDataVariable("coordinates").forEach(function(c){o.push(new Float32Array(c))}),n.hasDataVariable("cell_lengths")&&n.getDataVariable("cell_lengths").forEach(function(c){s.push(new Float32Array(c))}),n.hasDataVariable("time")&&n.getDataVariable("time").forEach(function(c){u.push(c)}),u.length>=1&&(a.timeOffset=u[0]),u.length>=2&&(a.deltaTime=u[1]-u[0]),ge&&fe.timeEnd("NctrajParser._parse "+this.name)},Object.defineProperties(t.prototype,r),t}(ml);ut.add("nctraj",Ip);ut.add("ncdf",Ip);ut.add("nc",Ip);var YE=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},isBinary:{configurable:!0}};return r.type.get=function(){return"trr"},r.isBinary.get=function(){return!0},t.prototype._parse=function(){ge&&fe.time("TrrParser._parse "+this.name);for(var n=Ho(this.streamer.data),a=new DataView(n),o=this.frames,s=o.coordinates,u=o.boxes,c=o.times,f=0;;){f+=8;var l=a.getInt32(f);f+=4,f+=l;var h=a.getInt32(f+8),d=a.getInt32(f+12),p=a.getInt32(f+16),v=a.getInt32(f+28),m=a.getInt32(f+32),g=a.getInt32(f+36),x=a.getInt32(f+40);f+=52;var y=h/9,b=x*3;if(y===8?c.push(a.getFloat64(f)):c.push(a.getFloat32(f)),f+=2*y,h){var _=new Float32Array(9);if(y===8)for(var w=0;w<9;++w)_[w]=a.getFloat64(f)*10,f+=8;else for(var A=0;A<9;++A)_[A]=a.getFloat32(f)*10,f+=4;u.push(_)}if(f+=d,f+=p,v){var S=void 0;if(y===8){S=new Float32Array(b);for(var M=0;M<b;++M)S[M]=a.getFloat64(f)*10,f+=8}else{for(var E=new Uint32Array(n,f,b),T=0;T<b;++T){var H=E[T];E[T]=(H&255)<<24|(H&65280)<<8|H>>8&65280|H>>24&255}S=new Float32Array(n,f,b);for(var X=0;X<b;++X)S[X]*=10,f+=4}s.push(S)}if(f+=m,f+=g,f>=n.byteLength)break}c.length>=1&&(o.timeOffset=c[0]),c.length>=2&&(o.deltaTime=c[1]-c[0]),ge&&fe.timeEnd("TrrParser._parse "+this.name)},Object.defineProperties(t.prototype,r),t}(ml);ut.add("trr",YE);var no=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]),lh=9;function hh(e){for(var t=1,r=0;e>=t&&r<32;)r++,t<<=1;return r}var ws=new Uint8Array(32);function ZE(e,t){var r=1,i=0;ws[0]=1;for(var n=0;n<e;n++){var a=void 0,o=0;for(a=0;a<r;a++)o+=ws[a]*t[n],ws[a]=o&255,o>>=8;for(;o!==0;)ws[a++]=o&255,o>>=8;r=a}var s=1;for(r--;ws[r]>=s;)i++,s*=2;return i+r*8}function Ca(e,t,r,i){for(var n=(1<<r)-1,a=i[1],o=i[2],s=e[0],u=0;r>=8;)o=o<<8|t[s++],u|=o>>a<<r-8,r-=8;return r>0&&(a<r&&(a+=8,o=o<<8|t[s++]),a-=r,u|=o>>a&(1<<r)-1),u&=n,e[0]=s,e[1]=a,e[2]=o,u}var Fi=new Int32Array(32);function Sm(e,t,r,i,n,a,o){var s=0;for(Fi[1]=0,Fi[2]=0,Fi[3]=0;i>8;)Fi[s++]=Ca(e,t,8,o),i-=8;i>0&&(Fi[s++]=Ca(e,t,i,o));for(var u=r-1;u>0;u--){for(var c=0,f=s-1;f>=0;f--){c=c<<8|Fi[f];var l=c/n[u]|0;Fi[f]=l,c=c-l*n[u]}a[u]=c}a[0]=Fi[0]|Fi[1]<<8|Fi[2]<<16|Fi[3]<<24}var KE=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},isBinary:{configurable:!0}};return r.type.get=function(){return"xtc"},r.isBinary.get=function(){return!0},t.prototype._parse=function(){ge&&fe.time("XtcParser._parse "+this.name);for(var n=Ho(this.streamer.data),a=new DataView(n),o=this.frames,s=o.coordinates,u=o.boxes,c=o.times,f=new Int32Array(6),l=new Int32Array(3),h=new Int32Array(3),d=new Uint32Array(3),p=new Float32Array(3),v=new Float32Array(3),m=0,g=new Int32Array(3),x=new Uint32Array(g.buffer);;){var y=void 0,b=a.getInt32(m+4);m+=12;var _=b*3;c.push(a.getFloat32(m)),m+=4;for(var w=new Float32Array(9),A=0;A<9;++A)w[A]=a.getFloat32(m)*10,m+=4;if(u.push(w),b<=9){y=new Float32Array(b);for(var S=0;S<b;++S)y[S]=a.getFloat32(m),m+=4}else{g[0]=g[1]=g[2]=0,l[0]=l[1]=l[2]=0,d[0]=d[1]=d[2]=0,h[0]=h[1]=h[2]=0,p[0]=p[1]=p[2]=0,v[0]=v[1]=v[2]=0,y=new Float32Array(_);var M=0,E=a.getInt32(m);m+=4;var T=a.getFloat32(m);m+=4,f[0]=a.getInt32(m),f[1]=a.getInt32(m+4),f[2]=a.getInt32(m+8),f[3]=a.getInt32(m+12),f[4]=a.getInt32(m+16),f[5]=a.getInt32(m+20),l[0]=f[3]-f[0]+1,l[1]=f[4]-f[1]+1,l[2]=f[5]-f[2]+1,m+=24;var H=void 0;(l[0]|l[1]|l[2])>16777215?(h[0]=hh(l[0]),h[1]=hh(l[1]),h[2]=hh(l[2]),H=0):H=ZE(3,l);var X=a.getInt32(m);m+=4;var q=X-1;q=lh>q?lh:q;var Z=no[q]/2|0,Q=no[X]/2|0;d[0]=d[1]=d[2]=no[X];var N=Math.ceil(a.getInt32(m)/4)*4;m+=4;var D=1/T,W=0,L=0,U=new Uint8Array(n,m);for(p[0]=p[1]=p[2]=0;L<E;){H===0?(p[0]=Ca(g,U,h[0],x),p[1]=Ca(g,U,h[1],x),p[2]=Ca(g,U,h[2],x)):Sm(g,U,3,H,l,p,x),L++,p[0]+=f[0],p[1]+=f[1],p[2]+=f[2],v[0]=p[0],v[1]=p[1],v[2]=p[2];var k=Ca(g,U,1,x),ee=0;if(k===1&&(W=Ca(g,U,5,x),ee=W%3,W-=ee,ee--),W>0){p[0]=p[1]=p[2]=0;for(var K=0;K<W;K+=3){if(Sm(g,U,3,X,d,p,x),L++,p[0]+=v[0]-Q,p[1]+=v[1]-Q,p[2]+=v[2]-Q,K===0){var te=p[0];p[0]=v[0],v[0]=te,te=p[1],p[1]=v[1],v[1]=te,te=p[2],p[2]=v[2],v[2]=te,y[M++]=v[0]*D,y[M++]=v[1]*D,y[M++]=v[2]*D}else v[0]=p[0],v[1]=p[1],v[2]=p[2];y[M++]=p[0]*D,y[M++]=p[1]*D,y[M++]=p[2]*D}}else y[M++]=p[0]*D,y[M++]=p[1]*D,y[M++]=p[2]*D;if(X+=ee,ee<0?(Q=Z,X>lh?Z=no[X-1]/2|0:Z=0):ee>0&&(Z=Q,Q=no[X]/2|0),d[0]=d[1]=d[2]=no[X],d[0]===0||d[1]===0||d[2]===0){console.error("(xdrfile error) Undefined error.");return}}m+=N}for(var Y=0;Y<_;Y++)y[Y]*=10;if(s.push(y),m>=n.byteLength)break}c.length>=1&&(o.timeOffset=c[0]),c.length>=2&&(o.deltaTime=c[1]-c[0]),ge&&fe.timeEnd("XtcParser._parse "+this.name)},Object.defineProperties(t.prototype,r),t}(ml);ut.add("xtc",KE);var qu=function(e){function t(i,n){var a=n||{};e.call(this,i,a),this.volume=new jt(this.name,this.path),this.voxelSize=O(a.voxelSize,1)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},__objName:{configurable:!0}};return r.type.get=function(){return"volume"},r.__objName.get=function(){return"volume"},t.prototype._afterParse=function(){this.volume.setMatrix(this.getMatrix()),e.prototype._afterParse.call(this)},t.prototype.getMatrix=function(){return new Ae},Object.defineProperties(t.prototype,r),t}(qr),JE=/\s+/,QE=/-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?/g,lc=.529177210859,e1=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"cube"},t.prototype._parse=function(){ge&&fe.time("CubeParser._parse "+this.name);var n=this.volume,a=this.streamer.peekLines(6),o={},s=lc*this.voxelSize;function u(p,v){var m=a[p].trim().split(JE)[v];return parseFloat(m)}o.atomCount=Math.abs(u(2,0)),o.originX=u(2,1)*lc,o.originY=u(2,2)*lc,o.originZ=u(2,3)*lc,o.NVX=u(3,0),o.NVY=u(4,0),o.NVZ=u(5,0),o.basisX=new I(u(3,1),u(3,2),u(3,3)).multiplyScalar(s),o.basisY=new I(u(4,1),u(4,2),u(4,3)).multiplyScalar(s),o.basisZ=new I(u(5,1),u(5,2),u(5,3)).multiplyScalar(s);var c=new Float32Array(o.NVX*o.NVY*o.NVZ),f=0,l=0,h=u(2,0)>0?0:1;function d(p,v,m){for(var g=p;g<v;++g){var x=m[g].trim();if(x!==""&&l>=o.atomCount+6+h)for(var y=x.match(QE),b=0,_=y.length;b<_;++b)c[f]=parseFloat(y[b]),++f;++l}}this.streamer.eachChunkOfLines(function(p){d(0,p.length,p)}),n.header=o,n.setData(c,o.NVZ,o.NVY,o.NVX),ge&&fe.timeEnd("CubeParser._parse "+this.name)},t.prototype.getMatrix=function(){var n=this.volume.header,a=new Ae;return a.multiply(new Ae().makeTranslation(n.originX,n.originY,n.originZ)),a.multiply(new Ae().makeBasis(n.basisZ,n.basisY,n.basisX)),a},Object.defineProperties(t.prototype,r),t}(qu);ut.add("cub",e1);ut.add("cube",e1);var t1=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},isBinary:{configurable:!0}};return r.type.get=function(){return"dsn6"},r.isBinary.get=function(){return!0},t.prototype._parse=function(){ge&&fe.time("Dsn6Parser._parse "+this.name);var n=this.volume,a={},o,s,u=Ho(this.streamer.data),c=new Int16Array(u),f=new Uint8Array(u),l=String.fromCharCode.apply(null,f.subarray(0,512));if(l.startsWith(":-)"))a.xStart=parseInt(l.substr(10,5)),a.yStart=parseInt(l.substr(15,5)),a.zStart=parseInt(l.substr(20,5)),a.xExtent=parseInt(l.substr(32,5)),a.yExtent=parseInt(l.substr(38,5)),a.zExtent=parseInt(l.substr(42,5)),a.xRate=parseInt(l.substr(52,5)),a.yRate=parseInt(l.substr(58,5)),a.zRate=parseInt(l.substr(62,5)),a.xlen=parseFloat(l.substr(73,10))*this.voxelSize,a.ylen=parseFloat(l.substr(83,10))*this.voxelSize,a.zlen=parseFloat(l.substr(93,10))*this.voxelSize,a.alpha=parseFloat(l.substr(103,10)),a.beta=parseFloat(l.substr(113,10)),a.gamma=parseFloat(l.substr(123,10)),o=parseFloat(l.substr(138,12))/100,s=parseInt(l.substr(155,8)),a.sigma=parseFloat(l.substr(170,12))*100;else{if(c[18]!==100)for(var h=0,d=c.length;h<d;++h){var p=c[h];c[h]=(p&255)<<8|p>>8&255}a.xStart=c[0],a.yStart=c[1],a.zStart=c[2],a.xExtent=c[3],a.yExtent=c[4],a.zExtent=c[5],a.xRate=c[6],a.yRate=c[7],a.zRate=c[8];var v=1/c[17],m=v*this.voxelSize;a.xlen=c[9]*m,a.ylen=c[10]*m,a.zlen=c[11]*m,a.alpha=c[12]*v,a.beta=c[13]*v,a.gamma=c[14]*v,o=c[15]/100,s=c[16],a.gamma=c[14]*v}n.header=a,ge&&fe.log(a,o,s);for(var g=new Float32Array(a.xExtent*a.yExtent*a.zExtent),x=512,y=Math.ceil(a.xExtent/8),b=Math.ceil(a.yExtent/8),_=Math.ceil(a.zExtent/8),w=0;w<_;++w)for(var A=0;A<b;++A)for(var S=0;S<y;++S)for(var M=0;M<8;++M)for(var E=8*w+M,T=0;T<8;++T)for(var H=8*A+T,X=0;X<8;++X){var q=8*S+X;if(q<a.xExtent&&H<a.yExtent&&E<a.zExtent){var Z=(q*a.yExtent+H)*a.zExtent+E;g[Z]=(f[x]-s)/o,++x}else{x+=8-X;break}}n.setData(g,a.zExtent,a.yExtent,a.xExtent),a.sigma&&n.setStats(void 0,void 0,void 0,a.sigma),ge&&fe.timeEnd("Dsn6Parser._parse "+this.name)},t.prototype.getMatrix=function(){var n=this.volume.header,a=[n.xlen,0,0],o=[n.ylen*Math.cos(Math.PI/180*n.gamma),n.ylen*Math.sin(Math.PI/180*n.gamma),0],s=[n.zlen*Math.cos(Math.PI/180*n.beta),n.zlen*(Math.cos(Math.PI/180*n.alpha)-Math.cos(Math.PI/180*n.gamma)*Math.cos(Math.PI/180*n.beta))/Math.sin(Math.PI/180*n.gamma),0];s[2]=Math.sqrt(n.zlen*n.zlen*Math.sin(Math.PI/180*n.beta)*Math.sin(Math.PI/180*n.beta)-s[1]*s[1]);var u=[[],a,o,s],c=[0,n.xRate,n.yRate,n.zRate],f=[0,1,2,3],l=new Ae;return l.set(u[f[1]][0]/c[f[1]],u[f[2]][0]/c[f[2]],u[f[3]][0]/c[f[3]],0,u[f[1]][1]/c[f[1]],u[f[2]][1]/c[f[2]],u[f[3]][1]/c[f[3]],0,u[f[1]][2]/c[f[1]],u[f[2]][2]/c[f[2]],u[f[3]][2]/c[f[3]],0,0,0,0,1),l.multiply(new Ae().makeRotationY(lr(90))),l.multiply(new Ae().makeTranslation(-n.zStart,n.yStart,n.xStart)),l.multiply(new Ae().makeScale(-1,1,1)),l},Object.defineProperties(t.prototype,r),t}(qu);ut.add("dsn6",t1);ut.add("brix",t1);var hc=/\s+/,r1=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"dx"},t.prototype._parse=function(){ge&&fe.time("DxParser._parse "+this.name);var n=this.volume,a=this.streamer.peekLines(30),o=this.parseHeaderLines(a),s=this.volume.header,u=o.dataLineStart,c=s.nx*s.ny*s.nz,f=new Float32Array(c),l=0,h=0;function d(p,v,m){for(var g=p;g<v;++g){if(l<c&&h>u){var x=m[g].trim();if(x!=="")for(var y=x.split(hc),b=0,_=y.length;b<_;++b)f[l]=parseFloat(y[b]),++l}++h}}this.streamer.eachChunkOfLines(function(p){d(0,p.length,p)}),n.setData(f,s.nz,s.ny,s.nx),ge&&fe.timeEnd("DxParser._parse "+this.name)},t.prototype.parseHeaderLines=function(n){for(var a=this,o={},s=n.length,u=0,c=0,f=0,l=0;l<s;++l){var h=void 0,d=n[l];if(d.startsWith("object 1"))h=d.split(hc),o.nx=parseInt(h[5]),o.ny=parseInt(h[6]),o.nz=parseInt(h[7]);else if(d.startsWith("origin"))h=d.split(hc),o.xmin=parseFloat(h[1]),o.ymin=parseFloat(h[2]),o.zmin=parseFloat(h[3]);else if(d.startsWith("delta"))h=d.split(hc),f===0?o.hx=parseFloat(h[1])*a.voxelSize:f===1?o.hy=parseFloat(h[2])*a.voxelSize:f===2&&(o.hz=parseFloat(h[3])*a.voxelSize),f+=1;else if(d.startsWith("object 3")){u=l,c+=d.length+1;break}c+=d.length+1}return this.volume.header=o,{dataLineStart:u,headerByteCount:c}},t.prototype.getMatrix=function(){var n=this.volume.header,a=new Ae;return a.multiply(new Ae().makeRotationY(lr(90))),a.multiply(new Ae().makeTranslation(-n.zmin,n.ymin,n.xmin)),a.multiply(new Ae().makeScale(-n.hz,n.hy,n.hx)),a},Object.defineProperties(t.prototype,r),t}(qu);ut.add("dx",r1);var $E=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},isBinary:{configurable:!0}};return r.type.get=function(){return"dxbin"},r.isBinary.get=function(){return!0},t.prototype._parse=function(){ge&&fe.time("DxbinParser._parse "+this.name);for(var n=Ho(this.streamer.data),a=X2(new Uint8Array(n,0,1e3)),o=this.parseHeaderLines(a),s=this.volume.header,u=o.headerByteCount,c=s.nx*s.ny*s.nz,f=new DataView(n),l=new Float32Array(c),h=0;h<c;++h)l[h]=f.getFloat64(h*8+u,!0);this.volume.setData(l,s.nz,s.ny,s.nx),ge&&fe.timeEnd("DxbinParser._parse "+this.name)},Object.defineProperties(t.prototype,r),t}(r1);ut.add("dxbin",$E);var Rp=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},isBinary:{configurable:!0}};return r.type.get=function(){return"mrc"},r.isBinary.get=function(){return!0},t.prototype._parse=function(){ge&&fe.time("MrcParser._parse "+this.name);var n=this.volume,a={},o=Ho(this.streamer.data),s=new Int32Array(o,0,56),u=new Float32Array(o,0,56),c=new DataView(o);if(a.MAP=String.fromCharCode(c.getUint8(52*4),c.getUint8(52*4+1),c.getUint8(52*4+2),c.getUint8(52*4+3)),a.MACHST=[c.getUint8(53*4),c.getUint8(53*4+1)],a.MACHST[0]===17&&a.MACHST[1]===17)for(var f=o.byteLength,l=0;l<f;l+=4)c.setFloat32(l,c.getFloat32(l),!0);a.NX=s[0],a.NY=s[1],a.NZ=s[2],a.MODE=s[3],a.NXSTART=s[4],a.NYSTART=s[5],a.NZSTART=s[6],a.MX=s[7],a.MY=s[8],a.MZ=s[9],a.xlen=u[10]*this.voxelSize,a.ylen=u[11]*this.voxelSize,a.zlen=u[12]*this.voxelSize,a.alpha=u[13],a.beta=u[14],a.gamma=u[15],a.MAPC=s[16],a.MAPR=s[17],a.MAPS=s[18],a.DMIN=u[19],a.DMAX=u[20],a.DMEAN=u[21],a.ISPG=s[22],a.NSYMBT=s[23],a.LSKFLG=s[24],a.originX=u[49],a.originY=u[50],a.originZ=u[51],a.ARMS=u[54],n.header=a;var h;if(a.MODE===2)h=new Float32Array(o,256*4+a.NSYMBT,a.NX*a.NY*a.NZ);else if(a.MODE===0){if(h=new Float32Array(new Int8Array(o,256*4+a.NSYMBT,a.NX*a.NY*a.NZ)),s[39]===-128&&s[40]===127)for(var d=(a.DMAX-a.DMIN)/255,p=.5*(a.DMIN+a.DMAX+d),v=0,m=h.length;v<m;++v)h[v]=d*h[v]+p}else fe.error("MrcParser unknown mode",a.MODE);n.setData(h,a.NX,a.NY,a.NZ),a.ARMS!==0&&n.setStats(a.DMIN,a.DMAX,a.DMEAN,a.ARMS),ge&&fe.timeEnd("MrcParser._parse "+this.name)},t.prototype.getMatrix=function(){var n=this.volume.header,a=[n.xlen,0,0],o=[n.ylen*Math.cos(Math.PI/180*n.gamma),n.ylen*Math.sin(Math.PI/180*n.gamma),0],s=[n.zlen*Math.cos(Math.PI/180*n.beta),n.zlen*(Math.cos(Math.PI/180*n.alpha)-Math.cos(Math.PI/180*n.gamma)*Math.cos(Math.PI/180*n.beta))/Math.sin(Math.PI/180*n.gamma),0];s[2]=Math.sqrt(n.zlen*n.zlen*Math.sin(Math.PI/180*n.beta)*Math.sin(Math.PI/180*n.beta)-s[1]*s[1]);var u=[[],a,o,s],c=[0,n.MX,n.MY,n.MZ],f=[0,n.MAPC,n.MAPR,n.MAPS],l=new Ae;return l.set(u[f[1]][0]/c[f[1]],u[f[2]][0]/c[f[2]],u[f[3]][0]/c[f[3]],0,u[f[1]][1]/c[f[1]],u[f[2]][1]/c[f[2]],u[f[3]][1]/c[f[3]],0,u[f[1]][2]/c[f[1]],u[f[2]][2]/c[f[2]],u[f[3]][2]/c[f[3]],0,0,0,0,1),l.setPosition(new I(n.originX,n.originY,n.originZ)),l.multiply(new Ae().makeTranslation(n.NXSTART,n.NYSTART,n.NZSTART)),l},Object.defineProperties(t.prototype,r),t}(qu);ut.add("mrc",Rp);ut.add("ccp4",Rp);ut.add("map",Rp);var eI=/\s+/;function dh(e){return e.trim().split(eI).map(parseFloat)}var i1=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"xplor"},t.prototype._parse=function(){ge&&fe.time("XplorParser._parse "+this.name);var n=this.volume,a=this.streamer.peekLines(8),o={},s;a[2].startsWith("REMARKS")?s=parseInt(a[1].substring(0,8))+2:s=5;var u=s+3,c=dh(a[s]);o.NA=c[0],o.AMIN=c[1],o.AMAX=c[2],o.NB=c[3],o.BMIN=c[4],o.BMAX=c[5],o.NC=c[6],o.CMIN=c[7],o.CMAX=c[8];var f=dh(a[s+1]);o.a=f[0]*this.voxelSize,o.b=f[1]*this.voxelSize,o.c=f[2]*this.voxelSize,o.alpha=f[3],o.beta=f[4],o.gamma=f[5];var l=o.AMAX-o.AMIN+1,h=o.BMAX-o.BMIN+1,d=o.CMAX-o.CMIN+1,p=l*h*d,v=new Float32Array(p),m=Math.ceil(1+l*h/6),g=0,x=0;function y(b,_,w){for(var A=b;A<_;++A){var S=w[A];if(x>=u&&(x-u)%m!==0&&g<p)for(var M=0,E=6;M<E;++M){var T=parseFloat(S.substr(12*M,12));if(isNaN(T))break;v[g++]=T}else if(g===p){var H=S.trim();if(H&&H!=="-9999"){var X=dh(S);o.RAVE=X[0],o.RSIGMA=X[1]}}++x}}this.streamer.eachChunkOfLines(function(b){y(0,b.length,b)}),n.header=o,n.setData(v,l,h,d),o.RAVE!==0&&o.RSIGMA!==1&&n.setStats(void 0,void 0,o.RAVE,o.RSIGMA),ge&&fe.timeEnd("XplorParser._parse "+this.name)},t.prototype.getMatrix=function(){var n=this.volume.header,a=[n.a,0,0],o=[n.b*Math.cos(Math.PI/180*n.gamma),n.b*Math.sin(Math.PI/180*n.gamma),0],s=[n.c*Math.cos(Math.PI/180*n.beta),n.c*(Math.cos(Math.PI/180*n.alpha)-Math.cos(Math.PI/180*n.gamma)*Math.cos(Math.PI/180*n.beta))/Math.sin(Math.PI/180*n.gamma),0];s[2]=Math.sqrt(n.c*n.c*Math.sin(Math.PI/180*n.beta)*Math.sin(Math.PI/180*n.beta)-s[1]*s[1]);var u=[[],a,o,s],c=[0,n.NA,n.NB,n.NC],f=[0,1,2,3],l=new Ae;return l.set(u[f[1]][0]/c[f[1]],u[f[2]][0]/c[f[2]],u[f[3]][0]/c[f[3]],0,u[f[1]][1]/c[f[1]],u[f[2]][1]/c[f[2]],u[f[3]][1]/c[f[3]],0,u[f[1]][2]/c[f[1]],u[f[2]][2]/c[f[2]],u[f[3]][2]/c[f[3]],0,0,0,0,1),l.multiply(new Ae().makeTranslation(n.AMIN,n.BMIN,n.CMIN)),l},Object.defineProperties(t.prototype,r),t}(qu);ut.add("xplor",i1);ut.add("cns",i1);function nr(e,t,r){e/=360,t/=100,r/=100;var i,n,a,o=Math.floor(e*6),s=e*6-o,u=r*(1-t),c=r*(1-s*t),f=r*(1-(1-s)*t);switch(o%6){case 0:i=r,n=f,a=u;break;case 1:i=c,n=r,a=u;break;case 2:i=u,n=r,a=f;break;case 3:i=u,n=c,a=r;break;case 4:i=f,n=u,a=r;break;case 5:i=r,n=u,a=c;break}return[i,n,a]}var md={red:nr(0,100,100),orange:nr(20,100,100),gold:nr(40,100,100),yellow:nr(60,100,100),lime:nr(80,100,100),green:nr(120,80,100),sea:nr(150,100,100),cyan:nr(180,100,85),sky:nr(210,75,95),blue:nr(240,70,100),purple:nr(275,75,100),magenta:nr(300,95,100),hotpink:nr(335,100,100),pink:nr(350,55,100),peach:nr(25,75,100),lilac:nr(275,55,100),pinktint:nr(340,30,100),peachtint:nr(25,50,100),yellowtint:nr(60,50,100),greentint:nr(135,40,100),bluetint:nr(220,40,100),lilactint:nr(275,35,100),white:nr(0,0,100),gray:nr(0,0,50),brown:nr(20,45,75),deadwhite:[1,1,1],deadblack:[0,0,0],invisible:[0,0,0]},tI=/[\s,]+/,n1=/[^{}\s]*{[^{}]+}|[^{}\s]+/g,a1=/^{+|}+$/g,rI=/^['"]+|['"]+$/g,o1=/\s*=\s*/g;function dc(e){var t,r,i=[],n;e=e.replace(o1,"=");for(var a=e.match(n1),o=1;o<a.length;++o){var s=a[o];if(s[0]==="{")t=s.substring(1,s.length-1);else{var u=s.split("=");u.length===2&&(u[0]==="color"?r=md[u[1]]:u[0]==="width"?n=parseInt(u[1]):u[0]==="master"&&i.push(u[1].replace(a1,"")))}}return{listName:t,listColor:r,listMasters:i,listWidth:n}}function As(e){e=e.trim();for(var t=e.indexOf("{"),r=e.indexOf("}"),i=e.substr(r+1).split(tI),n=e.substr(t+1,r-1),a=[parseFloat(i[i.length-3]),parseFloat(i[i.length-2]),parseFloat(i[i.length-1])],o,s,u,c=4;c<=i.length;c++){var f=i[i.length-c];f in md&&(o=md[i[i.length-c]]),f.startsWith("width")&&(s=parseInt(f.substring(5))),f.startsWith("r=")&&(u=parseFloat(f.split("=")[1]))}return{label:n,position:a,color:o,radius:u,width:s}}function ph(e){var t=e.indexOf("{"),r=e.indexOf("}");return e.substring(t!==-1?t+1:0,r!==-1?r:void 0).trim()}function iI(e){var t=e.indexOf("}");return t===-1?void 0:e.substr(t+1).trim()}function vh(e){var t,r={};e=e.replace(o1,"=");for(var i=e.match(n1),n=1;n<i.length;++n){var a=i[n];if(a[0]==="{")t=a.substring(1,a.length-1);else{var o=a.split("=");o.length===2?r[o[0]]=o[1].replace(a1,""):r[o[0]]=!0}}return[t,r]}function nI(e){for(var t=e.labelArray,r=e.positionArray,i=e.colorArray,n=[],a=0;a<(t.length-2)*3;++a)n[a]=t[a-Math.floor(a/3)*2];for(var o=[],s=0;s<(r.length/3-2)*9;++s)o[s]=r[s-Math.floor(s/9)*6];for(var u=[],c=0;c<(i.length/3-2)*9;++c)u[c]=i[c-Math.floor(c/9)*6];return{name:e.name,masterArray:e.masterArray,labelArray:n,positionArray:o,colorArray:u}}var aI=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},__objName:{configurable:!0}};return r.type.get=function(){return"kin"},r.__objName.get=function(){return"kinemage"},t.prototype._parse=function(){ge&&fe.time("KinParser._parse "+this.name);var n={kinemage:void 0,onewidth:void 0,"1viewid":void 0,pdbfile:void 0,texts:[],text:"",captions:[],caption:"",groupDict:{},subgroupDict:{},masterDict:{},pointmasterDict:{},dotLists:[],vectorLists:[],ballLists:[],ribbonLists:[]};this.kinemage=n;var a=!1,o="",s,u,c,f,l=!1,h="",d,p,v,m,g,x,y,b,_,w,A=!1,S="",M,E,T,H,X,q=!1,Z="",Q,N,D,W,L=!1,U=!1;function k(K,te,Y){for(var J=K;J<te;++J){var j=Y[J];if(j[0]==="@"&&(a=!1,l=!1,A=!1,q=!1,L=!1,U=!1),!j)a=!1,l=!1,A=!1,q=!1;else if(j.startsWith("@dotlist")){var ae=dc(j),re=ae.listColor,le=ae.listName,Se=ae.listMasters;a=!0,o="",u=[],c=[],f=[],s=re,n.dotLists.push({name:le,masterArray:Se,labelArray:u,positionArray:c,colorArray:f})}else if(j.startsWith("@vectorlist")){var _e=dc(j),ne=_e.listMasters,ve=_e.listName,se=_e.listWidth,xe=_e.listColor;ne&&ne.forEach(function(De){n.masterDict[De]||(n.masterDict[De]={indent:!1,visible:!1})}),l=!0,h="",d=null,p=null,g=[],x=[],y=[],b=[],_=[],w=[],v=xe,m=[],se&&m.push(se),n.vectorLists.push({name:ve,masterArray:ne,label1Array:g,label2Array:x,position1Array:y,position2Array:b,color1Array:_,color2Array:w,width:m})}else if(j.startsWith("@balllist")){var he=dc(j),ye=he.listName,pe=he.listColor,Pe=he.listMasters;Pe&&Pe.forEach(function(De){n.masterDict[De]||(n.masterDict[De]={indent:!1,visible:!1})}),A=!0,S="",T=[],M=[],H=[],X=[],E=pe,n.ballLists.push({name:ye,masterArray:Pe,labelArray:T,radiusArray:M,positionArray:H,colorArray:X})}else if(j.startsWith("@ribbonlist")){var He=dc(j),Je=He.listMasters,We=He.listName,Be=He.listColor;Je&&Je.forEach(function(De){n.masterDict[De]||(n.masterDict[De]={indent:!1,visible:!1})}),q=!0,Z="",N=[],D=[],W=[],Q=Be,n.ribbonLists.push({name:We,masterArray:Je,labelArray:N,positionArray:D,colorArray:W})}else if(j.startsWith("@text"))L=!0,n.texts.push(j.substr(5));else if(j.startsWith("@caption"))U=!0,n.captions.push(j.substr(8));else if(a){var ie=As(j),we=ie.label,Ie=ie.color,qe=ie.position;we==='"'?we=o:o=we,Ie===void 0&&(Ie=s),u.push(we),c.push.apply(c,qe),f.push.apply(f,Ie)}else if(l){var Ce=j.indexOf("{"),Ne=j.indexOf("{",Ce+1),Ze=void 0,Ve=void 0;Ne===-1?(Ze=j,Ve=j):(Ze=j.substr(0,Ne),Ve=j.substr(Ne));var Qe=As(Ze),Ye=Qe.label,vt=Qe.color,Nt=Qe.width,Rt=Qe.position;if(Ye==='"'?Ye=h:h=Ye,vt===void 0&&(vt=v),Nt&&m.push(Nt),g.push(Ye),y.push.apply(y,Rt),_.push.apply(_,vt),Ne===-1&&d)x.push(h),b.push.apply(b,d),w.push.apply(w,p),h=Ye,d=Rt,p=vt;else{var Gt=As(Ve),Et=Gt.label,Mt=Gt.color,bt=Gt.position;Et==='"'?Et=h:h=Et,Mt===void 0&&(Mt=v),x.push(Et),b.push.apply(b,bt),w.push.apply(w,Mt),d=bt,p=Mt}}else if(A){var rt=As(j),Ke=rt.label,Ft=rt.radius,Zt=rt.color,dr=rt.position;Ke==='"'?Ke=S:S=Ke,Ft===void 0&&(Ft=1),Zt===void 0&&(Zt=E),T.push(Ke),M.push(Ft),H.push.apply(H,dr),X.push.apply(X,Zt)}else if(q){var Xt=As(j),P=Xt.label,F=Xt.color,B=Xt.position;P==='"'?P=Z:Z=P,F===void 0&&(F=Q),N.push(P),D.push.apply(D,B),W.push.apply(W,F)}else if(L)n.texts.push(j);else if(U)n.captions.push(j);else if(j.startsWith("@kinemage"))n.kinemage=parseInt(j.substr(9).trim());else if(j.startsWith("@onewidth"))n.onewidth=!0;else if(j.startsWith("@1viewid"))n["1viewid"]=ph(j);else if(j.startsWith("@pdbfile"))n.pdbfile=ph(j);else if(j.startsWith("@group")){var G=vh(j),V=G[0],$=G[1];n.groupDict[V]||(n.groupDict[V]={dominant:!1,animate:!1});for(var C in $)n.groupDict[V][C]=$[C]}else if(j.startsWith("@subgroup")){var R=vh(j),z=R[0],oe=R[1];n.subgroupDict[z]||(n.subgroupDict[z]={dominant:!1,animate:!1,master:void 0});for(var ce in oe)n.subgroupDict[z][ce]=oe[ce]}else if(j.startsWith("@master")){var Te=ph(j),de=iI(j);n.masterDict[Te]||(n.masterDict[Te]={indent:!1,visible:!1}),de==="on"?n.masterDict[Te].visible=!0:de==="off"?n.masterDict[Te].visible=!1:de==="indent"&&(n.masterDict[Te].indent=!0)}else if(j.startsWith("@pointmaster")){var ue=vh(j),Me=ue[0],Le=ue[1];n.pointmasterDict[Me]={id:Object.keys(Le)[0].replace(rI,"")}}else console.log(j)}}if(this.streamer.eachChunkOfLines(function(K){k(0,K.length,K)}),n.text=n.texts.join(`
`).trim(),n.caption=n.captions.join(`
`).trim(),n.ribbonLists){var ee=[];n.ribbonLists.forEach(function(K){ee.push(nI(K))}),n.ribbonLists=ee}ge&&fe.timeEnd("KinParser._parse "+this.name)},Object.defineProperties(t.prototype,r),t}(qr);ut.add("kin",aI);var s1=function(e){function t(i,n){e.call(this,i,n),this.loader=this.getLoader(),this.surface=new jr(this.name,this.path)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},__objName:{configurable:!0}};return r.type.get=function(){return"surface"},r.__objName.get=function(){return"surface"},t.prototype._parse=function(){var n=this.loader.parse(this.streamer.asText());this.surface.fromGeometry(n)},Object.defineProperties(t.prototype,r),t}(qr),gd=function(){this.regexp={vertex_pattern:/^v\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,normal_pattern:/^vn\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,uv_pattern:/^vt\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}};gd.prototype={constructor:gd,setPath:function(e){this.path=e},_createParserState:function(){var e={objects:[],object:{},vertices:[],normals:[],startObject:function(t,r){if(this.object&&this.object.fromDeclaration===!1){this.object.name=t,this.object.fromDeclaration=r!==!1;return}this.object={name:t||"",geometry:{vertices:[],normals:[]},fromDeclaration:r!==!1},this.objects.push(this.object)},parseVertexIndex:function(t,r){var i=parseInt(t,10);return(i>=0?i-1:i+r/3)*3},parseNormalIndex:function(t,r){var i=parseInt(t,10);return(i>=0?i-1:i+r/3)*3},addVertex:function(t,r,i){var n=this.vertices,a=this.object.geometry.vertices;a.push(n[t+0]),a.push(n[t+1]),a.push(n[t+2]),a.push(n[r+0]),a.push(n[r+1]),a.push(n[r+2]),a.push(n[i+0]),a.push(n[i+1]),a.push(n[i+2])},addVertexLine:function(t){var r=this.vertices,i=this.object.geometry.vertices;i.push(r[t+0]),i.push(r[t+1]),i.push(r[t+2])},addNormal:function(t,r,i){var n=this.normals,a=this.object.geometry.normals;a.push(n[t+0]),a.push(n[t+1]),a.push(n[t+2]),a.push(n[r+0]),a.push(n[r+1]),a.push(n[r+2]),a.push(n[i+0]),a.push(n[i+1]),a.push(n[i+2])},addFace:function(t,r,i,n,a,o,s,u){var c=this.vertices.length,f=this.parseVertexIndex(t,c),l=this.parseVertexIndex(r,c),h=this.parseVertexIndex(i,c),d;if(n===void 0?this.addVertex(f,l,h):(d=this.parseVertexIndex(n,c),this.addVertex(f,l,d),this.addVertex(l,h,d)),a!==void 0){var p=this.normals.length;f=this.parseNormalIndex(a,p),l=a===o?f:this.parseNormalIndex(o,p),h=a===s?f:this.parseNormalIndex(s,p),n===void 0?this.addNormal(f,l,h):(d=this.parseNormalIndex(u,p),this.addNormal(f,l,d),this.addNormal(l,h,d))}},addLineGeometry:function(t){var r=this;this.object.geometry.type="Line";for(var i=this.vertices.length,n=0,a=t.length;n<a;n++)r.addVertexLine(r.parseVertexIndex(t[n],i))}};return e.startObject("",!1),e},parse:function(e){var t=this,r=this._createParserState();e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));var i,n,a=e.split(`
`),o="",s="",u="",c=0,f=[],l=typeof"".trimLeft=="function";for(i=0,n=a.length;i<n;i++)if(o=a[i],o=l?o.trimLeft():o.trim(),c=o.length,c!==0&&(s=o.charAt(0),s!=="#")){if(s==="v"){if(u=o.charAt(1),u===" "&&(f=t.regexp.vertex_pattern.exec(o))!==null)r.vertices.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));else if(u==="n"&&(f=t.regexp.normal_pattern.exec(o))!==null)r.normals.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));else if(!(u==="t"&&t.regexp.uv_pattern.exec(o)!==null))throw new Error("Unexpected vertex/normal/uv line: '"+o+"'")}else if(s==="f"){if((f=t.regexp.face_vertex_uv_normal.exec(o))!==null)r.addFace(f[1],f[4],f[7],f[10],f[3],f[6],f[9],f[12]);else if(t.regexp.face_vertex_uv.exec(o)===null)if((f=t.regexp.face_vertex_normal.exec(o))!==null)r.addFace(f[1],f[3],f[5],f[7],f[2],f[4],f[6],f[8]);else if((f=t.regexp.face_vertex.exec(o))!==null)r.addFace(f[1],f[2],f[3],f[4]);else throw new Error("Unexpected face line: '"+o+"'")}else if(s==="l"){var h=o.substring(1).trim().split(" "),d=[],p=[];if(o.indexOf("/")===-1)d=h;else for(var v=0,m=h.length;v<m;v++){var g=h[v].split("/");g[0]!==""&&d.push(g[0]),g[1]!==""&&p.push(g[1])}r.addLineGeometry(d,p)}else if((f=t.regexp.object_pattern.exec(o))!==null){var x=f[0].substr(1).trim();r.startObject(x)}else if(!t.regexp.material_use_pattern.test(o)){if(!t.regexp.material_library_pattern.test(o)){if(t.regexp.smoothing_pattern.exec(o)===null){if(o==="\0")continue;throw new Error("Unexpected line: '"+o+"'")}}}}var y=[];for(i=0,n=r.objects.length;i<n;i++){var b=r.objects[i],_=b.geometry;if(_.vertices.length!==0){var w=new Ue;w.addAttribute("position",new ft(new Float32Array(_.vertices),3)),_.normals.length>0?w.addAttribute("normal",new ft(new Float32Array(_.normals),3)):w.computeVertexNormals(),y.push(w)}}return y}};var oI=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"obj"},t.prototype.getLoader=function(){return new gd},Object.defineProperties(t.prototype,r),t}(s1);ut.add("obj",oI);var yd=function(){this.propertyNameMapping={}};yd.prototype={constructor:yd,setPropertyNameMapping:function(e){this.propertyNameMapping=e},bin2str:function(e){for(var t=new Uint8Array(e),r="",i=0;i<e.byteLength;i++)r+=String.fromCharCode(t[i]);return r},isASCII:function(e){var t=this.parseHeader(this.bin2str(e));return t.format==="ascii"},parse:function(e){return e instanceof ArrayBuffer?this.isASCII(e)?this.parseASCII(this.bin2str(e)):this.parseBinary(e):this.parseASCII(e)},parseHeader:function(e){var t=this,r=/ply([\s\S]*)end_header\s/,i="",n=0,a=r.exec(e);a!==null&&(i=a[1],n=a[0].length);var o={comments:[],elements:[],headerLength:n},s=i.split(`
`),u,c,f;function l(p,v){var m={type:p[0]};return m.type==="list"?(m.name=p[3],m.countType=p[1],m.itemType=p[2]):m.name=p[1],m.name in v&&(m.name=v[m.name]),m}for(var h=0;h<s.length;h++){var d=s[h];if(d=d.trim(),d!=="")switch(f=d.split(/\s+/),c=f.shift(),d=f.join(" "),c){case"format":o.format=f[0],o.version=f[1];break;case"comment":o.comments.push(d);break;case"element":u!==void 0&&o.elements.push(u),u={},u.name=f[0],u.count=parseInt(f[1]),u.properties=[];break;case"property":u.properties.push(l(f,t.propertyNameMapping));break;default:console.log("unhandled",c,f)}}return u!==void 0&&o.elements.push(u),o},parseASCIINumber:function(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}},parseASCIIElement:function(e,t){for(var r=this,i=t.split(/\s+/),n={},a=0;a<e.length;a++)if(e[a].type==="list"){for(var o=[],s=r.parseASCIINumber(i.shift(),e[a].countType),u=0;u<s;u++)o.push(r.parseASCIINumber(i.shift(),e[a].itemType));n[e[a].name]=o}else n[e[a].name]=r.parseASCIINumber(i.shift(),e[a].type);return n},parseASCII:function(e){var t=this,r=new st,i,n=this.parseHeader(e),a=/end_header\s([\s\S]*)$/,o="";(i=a.exec(e))!==null&&(o=i[1]);var s=o.split(`
`),u=0,c=0;r.useColor=!1;for(var f=0;f<s.length;f++){var l=s[f];if(l=l.trim(),l!==""){c>=n.elements[u].count&&(u++,c=0);var h=t.parseASCIIElement(n.elements[u].properties,l);t.handleElement(r,n.elements[u].name,h),c++}}return this.postProcess(r)},postProcess:function(e){if(e.useColor){for(var t=0;t<e.faces.length;t++)e.faces[t].vertexColors=[e.colors[e.faces[t].a],e.colors[e.faces[t].b],e.colors[e.faces[t].c]];e.elementsNeedUpdate=!0}return e.computeBoundingSphere(),e},handleElement:function(e,t,r){if(t==="vertex"){if(e.vertices.push(new I(r.x,r.y,r.z)),"red"in r&&"green"in r&&"blue"in r){e.useColor=!0;var i=new Oe;i.setRGB(r.red/255,r.green/255,r.blue/255),e.colors.push(i)}}else if(t==="face"){var n=r.vertex_indices;n.length===3?e.faces.push(new nn(n[0],n[1],n[2])):n.length===4&&e.faces.push(new nn(n[0],n[1],n[3]),new nn(n[1],n[2],n[3]))}},binaryRead:function(e,t,r,i){switch(r){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,i),2];case"uint16":case"ushort":return[e.getUint16(t,i),2];case"int32":case"int":return[e.getInt32(t,i),4];case"uint32":case"uint":return[e.getUint32(t,i),4];case"float32":case"float":return[e.getFloat32(t,i),4];case"float64":case"double":return[e.getFloat64(t,i),8]}},binaryReadElement:function(e,t,r,i){for(var n=this,a={},o,s=0,u=0;u<r.length;u++)if(r[u].type==="list"){var c=[];o=n.binaryRead(e,t+s,r[u].countType,i);var f=o[0];s+=o[1];for(var l=0;l<f;l++)o=n.binaryRead(e,t+s,r[u].itemType,i),c.push(o[0]),s+=o[1];a[r[u].name]=c}else o=n.binaryRead(e,t+s,r[u].type,i),a[r[u].name]=o[0],s+=o[1];return[a,s]},parseBinary:function(e){for(var t=this,r=new st,i=this.parseHeader(this.bin2str(e)),n=i.format==="binary_little_endian",a=new DataView(e,i.headerLength),o,s=0,u=0;u<i.elements.length;u++)for(var c=0;c<i.elements[u].count;c++){o=t.binaryReadElement(a,s,i.elements[u].properties,n),s+=o[1];var f=o[0];t.handleElement(r,i.elements[u].name,f)}return this.postProcess(r)}};var sI=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0}};return r.type.get=function(){return"ply"},t.prototype.getLoader=function(){return new yd},Object.defineProperties(t.prototype,r),t}(s1);ut.add("ply",sI);var uI=function(e){function t(i,n){var a=n||{};e.call(this,i,a),this.delimiter=O(a.delimiter,","),this.comment=O(a.comment,"#"),this.columnNames=O(a.columnNames,!1),this.table={name:this.name,path:this.path,columnNames:[],data:[]}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},__objName:{configurable:!0}};return r.type.get=function(){return"csv"},r.__objName.get=function(){return"table"},t.prototype._parse=function(){var n=this,a=this.table.data,o=new RegExp("\\s*"+this.delimiter+"\\s*"),s=0;this.streamer.eachChunkOfLines(function(u){for(var c=u.length,f=0;f<c;++f){var l=u[f].trim();if(!l.startsWith(n.comment)){var h=l.split(o);s===0?n.table.columnNames=h:l&&a.push(h),++s}}})},Object.defineProperties(t.prototype,r),t}(qr);ut.add("csv",uI);var cI=function(e){function t(i,n){var a=n||{};e.call(this,i,a),this.string=O(a.string,!1),this.json={name:this.name,path:this.path,data:{}}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},__objName:{configurable:!0},isJson:{configurable:!0}};return r.type.get=function(){return"json"},r.__objName.get=function(){return"json"},r.isJson.get=function(){return!0},t.prototype._parse=function(){this.streamer.isBinary()||this.string?this.json.data=JSON.parse(this.streamer.asText()):this.json.data=this.streamer.data},Object.defineProperties(t.prototype,r),t}(qr);ut.add("json",cI);var fI=function(e){function t(i,n){var a=n||{};e.call(this,i,a),this.msgpack={name:this.name,path:this.path,data:void 0}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},__objName:{configurable:!0},isBinary:{configurable:!0}};return r.type.get=function(){return"msgpack"},r.__objName.get=function(){return"msgpack"},r.isBinary.get=function(){return!0},t.prototype._parse=function(){ge&&fe.time("MsgpackParser._parse "+this.name),this.msgpack.data=qy(this.streamer.data),ge&&fe.timeEnd("MsgpackParser._parse "+this.name)},Object.defineProperties(t.prototype,r),t}(qr);ut.add("msgpack",fI);var lI=function(e){function t(i,n){var a=n||{};e.call(this,i,a),this.netcdf={name:this.name,path:this.path,data:void 0}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},__objName:{configurable:!0},isBinary:{configurable:!0}};return r.type.get=function(){return"netcdf"},r.__objName.get=function(){return"netcdf"},r.isBinary.get=function(){return!0},t.prototype._parse=function(){ge&&fe.time("NetcdfParser._parse "+this.name),this.netcdf.data=new Xu(this.streamer.data),ge&&fe.timeEnd("NetcdfParser._parse "+this.name)},Object.defineProperties(t.prototype,r),t}(qr);ut.add("netcdf",lI);var u1=function(e){function t(i,n){e.call(this,i,n),this.text={name:this.name,path:this.path,data:""}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},__objName:{configurable:!0}};return r.type.get=function(){return"text"},r.__objName.get=function(){return"text"},t.prototype._parse=function(){this.text.data=this.streamer.asText()},Object.defineProperties(t.prototype,r),t}(qr);ut.add("txt",u1);ut.add("text",u1);var hI=/^['"]|['"]$/g,dI=/^<([\w-:.]+)\s*/,pI=/^([^<]*)/,vI=/([\w:-]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/;function mI(e){return e.replace(hI,"")}function gI(e){return e=e.trim().replace(/<!--[\s\S]*?-->/g,""),t();function t(){return{declaration:r(),root:i()}}function r(){var c=o(/^<\?xml\s*/);if(c){for(var f={attributes:{}};!(s()||u("?>"));){var l=a();if(!l)return f;f.attributes[l.name]=l.value}return o(/\?>\s*/),f}}function i(){var c=o(dI);if(c){for(var f={name:c[1],attributes:{},children:[]};!(s()||u(">")||u("?>")||u("/>"));){var l=a();if(!l)return f;f.attributes[l.name]=l.value}if(o(/^\s*\/>\s*/))return f;o(/\??>\s*/),f.content=n();for(var h;h=i();)f.children.push(h);return o(/^<\/[\w-:.]+>\s*/),f}}function n(){var c=o(pI);return c?c[1]:""}function a(){var c=o(vI);if(c)return{name:c[1],value:mI(c[2])}}function o(c){var f=e.match(c);if(f)return e=e.slice(f[0].length),f}function s(){return e.length===0}function u(c){return e.indexOf(c)===0}}var c1=function(e){function t(i,n){var a=n||{};e.call(this,i,a),this.useDomParser=O(a.useDomParser,!1),this.xml={name:this.name,path:this.path,data:{}}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={type:{configurable:!0},__objName:{configurable:!0},isXml:{configurable:!0}};return r.type.get=function(){return"xml"},r.__objName.get=function(){return"xml"},r.isXml.get=function(){return!0},t.prototype.__xmlParser=function(n){return gI(n)},t.prototype.__domParser=function(n){var a=new window.DOMParser;return a.parseFromString(n,"text/xml")},t.prototype._parse=function(){ge&&fe.time("XmlParser._parse "+this.name),this.useDomParser?this.streamer.data instanceof Document?this.xml.data=this.streamer.data:this.xml.data=this.__domParser(this.streamer.asText()):this.xml.data=this.__xmlParser(this.streamer.asText()),ge&&fe.timeEnd("XmlParser._parse "+this.name)},Object.defineProperties(t.prototype,r),t}(qr);ut.add("xml",c1);function Sr(e,t){var r=e.getNamedItem(t);return r!==null?r.value:""}function Mm(e,t,r){r===void 0&&(r=!1);var i=Sr(e,"icode").trim(),n=Sr(e,"chain").trim(),a=Sr(e,"altcode"),o=Sr(e,"resnum");return i&&(o+="^"+i),n&&(o+=":"+n),t&&(o+="."+t),r&&a.trim()&&(o+="%"+a),o+="/"+(parseInt(Sr(e,"model"))-1),o}function yI(e){var t=Sr(e,"chain").trim(),r=Sr(e,"rescode"),i=Sr(e,"resnum"),n="["+r+"]"+i;return t&&(n+=":"+t),n}function mh(e,t,r){e[t]===void 0?e[t]=r:e[t]|=r}function gh(e,t){return e!==null&&e.value===t}function bI(e){var t=e.inscode,r=e.chainname,i=e.atomname,n=e.altloc,a=e.resno+"";return t&&(a+="^"+t),r&&(a+=":"+r),i&&(a+="."+i),n&&(a+="%"+n),a+="/"+e.modelIndex,a}function xI(e,t,r){for(var i=0,n=t.getElementsByTagName("clash"),a=0,o=n.length;a<o;++a)if(e[Sr(n[a].attributes,"cid")]){i+=1;break}var s=t.getElementsByTagName("angle-outlier");s.length>0&&(i+=1);var u=t.getElementsByTagName("bond-outlier");u.length>0&&(i+=1);var c=t.getElementsByTagName("plane-outlier");return c.length>0&&(i+=1),gh(r.getNamedItem("rota"),"OUTLIER")&&(i+=1),gh(r.getNamedItem("rama"),"OUTLIER")&&(i+=1),gh(r.getNamedItem("RNApucker"),"outlier")&&(i+=1),i}var gl=function(t,r){this.name=t,this.path=r,this.rsrzDict={},this.rsccDict={},this.rciDict={},this.clashDict={},this.clashArray=[],this.geoDict={},this.geoAtomDict={},this.atomDict={},this.clashSele="NONE"},f1={type:{configurable:!0}};f1.type.get=function(){return"validation"};gl.prototype.fromXml=function(t){ge&&fe.time("Validation.fromXml");var r=this.rsrzDict,i=this.rsccDict,n=this.rciDict,a=this.clashDict,o=this.clashArray,s=this.geoDict,u=this.geoAtomDict,c=this.atomDict,f=t.getElementsByTagName("Entry");if(f.length===1){var l=f[0].getElementsByTagName("chemical_shift_list");if(l.length===1)for(var h=l[0].getElementsByTagName("random_coil_index"),d=0,p=h.length;d<p;++d){var v=h[d].attributes,m=yI(v);n[m]=parseFloat(Sr(v,"value"))}}var g=t.getElementsByTagName("ModelledSubgroup"),x={},y=[];ge&&fe.time("Validation.fromXml#clashDict");for(var b=0,_=g.length;b<_;++b){var w=g[b],A=w.attributes,S=Mm(A);A.getNamedItem("rsrz")!==null&&(r[S]=parseFloat(Sr(A,"rsrz"))),A.getNamedItem("rscc")!==null&&(i[S]=parseFloat(Sr(A,"rscc")));var M=t.createAttribute("sele");M.value=S,A.setNamedItem(M);for(var E=w.getElementsByTagName("clash"),T=0,H=E.length;T<H;++T){var X=E[T].attributes,q=Sr(X,"atom");if(cp(q)!=="H"){var Z=Sr(X,"cid"),Q=Mm(A,q,!0);if(c[Q]=!0,x[Z]===void 0)x[Z]={sele1:Q,res1:S};else{var N=x[Z];N.res1!==S&&(N.sele2=Q,N.res2=S,y.push(N.res1,S),a[Z]=N,o.push(N))}}}}ge&&fe.timeEnd("Validation.fromXml#clashDict");for(var D=0,W=g.length;D<W;++D){var L=g[D],U=L.attributes,k=Sr(U,"sele"),ee=Sr(U,"seq")!==".";if(ee){var K=xI(a,L,U);K>0&&(s[k]=K)}else{var te=L.getElementsByTagName("clash"),Y=L.getElementsByTagName("mog-bond-outlier"),J=L.getElementsByTagName("mog-angle-outlier");if(Y.length>0||J.length>0||te.length>0){var j={};u[k]=j;for(var ae=0,re=te.length;ae<re;++ae){var le=te[ae].attributes;a[Sr(le,"cid")]&&mh(j,Sr(le,"atom"),1)}for(var Se=0,_e=Y.length;Se<_e;++Se){var ne=Y[Se].attributes;Sr(ne,"atoms").split(",").forEach(function(he){mh(j,he,2)})}for(var ve=0,se=J.length;ve<se;++ve){var xe=J[ve].attributes;Sr(xe,"atoms").split(",").forEach(function(he){mh(j,he,4)})}}}}this.clashSele=y.length?y.join(" OR "):"NONE",ge&&fe.timeEnd("Validation.fromXml")};gl.prototype.getClashData=function(t){ge&&fe.time("Validation.getClashData");var r=t||{},i=r.structure,n=i.atomSet,a=new Oe(O(r.color,"#f0027f")),o=i.getAtomProxy(),s=i.getAtomProxy(),u=new I,c=new I,f=new I,l=this.clashArray,h=l.length,d=new Float32Array(h*3),p=new Float32Array(h*3),v=Qt(h,a.r,a.g,a.b),m=new Float32Array(h),g=new Float32Array(h);ge&&fe.time("Validation.getClashData#atomDict");var x=this.atomDict;i.eachAtom(function(b){var _=bI(b);x[_]===!0&&(x[_]=b.index)}),ge&&fe.timeEnd("Validation.getClashData#atomDict");var y=0;return l.forEach(function(b,_){if(o.index=x[b.sele1],s.index=x[b.sele2],!(o.index===void 0||s.index===void 0||!n.isSet(o.index,s.index))){u.subVectors(s,o).setLength(o.vdw),c.copy(o).add(u),u.subVectors(o,s).setLength(s.vdw),f.copy(s).add(u);var w=o.distanceTo(s)/2,A=Math.sqrt(o.vdw*o.vdw-w*w),S=Math.sqrt(s.vdw*s.vdw-w*w);c.toArray(d,y*3),f.toArray(p,y*3),m[y]=(A+S)/2,g[y]=_,++y}}),ge&&fe.timeEnd("Validation.getClashData"),{position1:d.subarray(0,y*3),position2:p.subarray(0,y*3),color:v.subarray(0,y*3),color2:v.subarray(0,y*3),radius:m.subarray(0,y),picking:new vM(g.subarray(0,y),this,i)}};Object.defineProperties(gl.prototype,f1);var _I=function(e){function t(i,n){var a=n||{};e.call(this,i,a),this.useDomParser=!0,this.validation=new gl(this.name,this.path)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={__objName:{configurable:!0},isXml:{configurable:!0}};return r.__objName.get=function(){return"validation"},r.isXml.get=function(){return!0},t.prototype._parse=function(){e.prototype._parse.call(this),ge&&fe.time("ValidationParser._parse "+this.name),this.validation.fromXml(this.xml.data),ge&&fe.timeEnd("ValidationParser._parse "+this.name)},Object.defineProperties(t.prototype,r),t}(c1);ut.add("validation",_I);function wI(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])}}return e}function l1(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)}function vo(e,t,r,i,n){if(t.subarray&&e.subarray){e.set(t.subarray(r,r+i),n);return}for(var a=0;a<i;a++)e[n+a]=t[r+a]}function AI(e){var t,r,i,n,a,o;for(i=0,t=0,r=e.length;t<r;t++)i+=e[t].length;for(o=new Uint8Array(i),n=0,t=0,r=e.length;t<r;t++)a=e[t],o.set(a,n),n+=a.length;return o}function bd(e,t,r,i){for(var n=e&65535|0,a=e>>>16&65535|0,o=0;r!==0;){o=r>2e3?2e3:r,r-=o;do n=n+t[i++]|0,a=a+n|0;while(--o);n%=65521,a%=65521}return n|a<<16|0}function SI(){for(var e,t=[],r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=e&1?3988292384^e>>>1:e>>>1;t[r]=e}return t}var MI=SI();function en(e,t,r,i){var n=MI,a=i+r;e^=-1;for(var o=i;o<a;o++)e=e>>>8^n[(e^t[o])&255];return e^-1}var pc=30,CI=12;function PI(e,t){var r,i,n,a,o,s,u,c,f,l,h,d,p,v,m,g,x,y,b,_,w,A,S,M,E;r=e.state,i=e.next_in,M=e.input,n=i+(e.avail_in-5),a=e.next_out,E=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),u=r.dmax,c=r.wsize,f=r.whave,l=r.wnext,h=r.window,d=r.hold,p=r.bits,v=r.lencode,m=r.distcode,g=(1<<r.lenbits)-1,x=(1<<r.distbits)-1;e:do{p<15&&(d+=M[i++]<<p,p+=8,d+=M[i++]<<p,p+=8),y=v[d&g];t:for(;;){if(b=y>>>24,d>>>=b,p-=b,b=y>>>16&255,b===0)E[a++]=y&65535;else if(b&16){_=y&65535,b&=15,b&&(p<b&&(d+=M[i++]<<p,p+=8),_+=d&(1<<b)-1,d>>>=b,p-=b),p<15&&(d+=M[i++]<<p,p+=8,d+=M[i++]<<p,p+=8),y=m[d&x];r:for(;;){if(b=y>>>24,d>>>=b,p-=b,b=y>>>16&255,b&16){if(w=y&65535,b&=15,p<b&&(d+=M[i++]<<p,p+=8,p<b&&(d+=M[i++]<<p,p+=8)),w+=d&(1<<b)-1,w>u){e.msg="invalid distance too far back",r.mode=pc;break e}if(d>>>=b,p-=b,b=a-o,w>b){if(b=w-b,b>f&&r.sane){e.msg="invalid distance too far back",r.mode=pc;break e}if(A=0,S=h,l===0){if(A+=c-b,b<_){_-=b;do E[a++]=h[A++];while(--b);A=a-w,S=E}}else if(l<b){if(A+=c+l-b,b-=l,b<_){_-=b;do E[a++]=h[A++];while(--b);if(A=0,l<_){b=l,_-=b;do E[a++]=h[A++];while(--b);A=a-w,S=E}}}else if(A+=l-b,b<_){_-=b;do E[a++]=h[A++];while(--b);A=a-w,S=E}for(;_>2;)E[a++]=S[A++],E[a++]=S[A++],E[a++]=S[A++],_-=3;_&&(E[a++]=S[A++],_>1&&(E[a++]=S[A++]))}else{A=a-w;do E[a++]=E[A++],E[a++]=E[A++],E[a++]=E[A++],_-=3;while(_>2);_&&(E[a++]=E[A++],_>1&&(E[a++]=E[A++]))}}else if(b&64){e.msg="invalid distance code",r.mode=pc;break e}else{y=m[(y&65535)+(d&(1<<b)-1)];continue r}break}}else if(b&64)if(b&32){r.mode=CI;break e}else{e.msg="invalid literal/length code",r.mode=pc;break e}else{y=v[(y&65535)+(d&(1<<b)-1)];continue t}break}}while(i<n&&a<s);_=p>>3,i-=_,p-=_<<3,d&=(1<<p)-1,e.next_in=i,e.next_out=a,e.avail_in=i<n?5+(n-i):5-(i-n),e.avail_out=a<s?257+(s-a):257-(a-s),r.hold=d,r.bits=p}var ao=15,Cm=852,Pm=592,Tm=0,yh=1,Em=2,TI=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],EI=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],II=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],RI=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function Os(e,t,r,i,n,a,o,s){var u=s.bits,c=0,f=0,l=0,h=0,d=0,p=0,v=0,m=0,g=0,x=0,y,b,_,w,A,S=null,M=0,E,T=new Uint16Array(ao+1),H=new Uint16Array(ao+1),X=null,q=0,Z,Q,N;for(c=0;c<=ao;c++)T[c]=0;for(f=0;f<i;f++)T[t[r+f]]++;for(d=u,h=ao;h>=1&&T[h]===0;h--);if(d>h&&(d=h),h===0)return n[a++]=1<<24|64<<16|0,n[a++]=1<<24|64<<16|0,s.bits=1,0;for(l=1;l<h&&T[l]===0;l++);for(d<l&&(d=l),m=1,c=1;c<=ao;c++)if(m<<=1,m-=T[c],m<0)return-1;if(m>0&&(e===Tm||h!==1))return-1;for(H[1]=0,c=1;c<ao;c++)H[c+1]=H[c]+T[c];for(f=0;f<i;f++)t[r+f]!==0&&(o[H[t[r+f]]++]=f);if(e===Tm?(S=X=o,E=19):e===yh?(S=TI,M-=257,X=EI,q-=257,E=256):(S=II,X=RI,E=-1),x=0,f=0,c=l,A=a,p=d,v=0,_=-1,g=1<<d,w=g-1,e===yh&&g>Cm||e===Em&&g>Pm)return 1;for(;;){Z=c-v,o[f]<E?(Q=0,N=o[f]):o[f]>E?(Q=X[q+o[f]],N=S[M+o[f]]):(Q=96,N=0),y=1<<c-v,b=1<<p,l=b;do b-=y,n[A+(x>>v)+b]=Z<<24|Q<<16|N|0;while(b!==0);for(y=1<<c-1;x&y;)y>>=1;if(y!==0?(x&=y-1,x+=y):x=0,f++,--T[c]===0){if(c===h)break;c=t[r+o[f]]}if(c>d&&(x&w)!==_){for(v===0&&(v=d),A+=l,p=c-v,m=1<<p;p+v<h&&(m-=T[p+v],!(m<=0));)p++,m<<=1;if(g+=1<<p,e===yh&&g>Cm||e===Em&&g>Pm)return 1;_=x&w,n[_]=d<<24|p<<16|A-a|0}}return x!==0&&(n[A+x]=c-v<<24|64<<16|0),s.bits=d,0}var LI=0,h1=1,d1=2,Im=4,OI=5,vc=6,ja=0,DI=1,FI=2,Mi=-2,p1=-3,v1=-4,BI=-5,Rm=8,m1=1,Lm=2,Om=3,Dm=4,Fm=5,Bm=6,Nm=7,km=8,zm=9,Um=10,Of=11,Cn=12,bh=13,Gm=14,xh=15,Hm=16,Vm=17,Wm=18,jm=19,mc=20,gc=21,Xm=22,qm=23,Ym=24,Zm=25,Km=26,_h=27,Jm=28,Qm=29,sr=30,g1=31,NI=32,kI=852,zI=592;function $m(e){return(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24)}function UI(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function GI(e){var t;return!e||!e.state?Mi:(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=m1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(kI),t.distcode=t.distdyn=new Int32Array(zI),t.sane=1,t.back=-1,ja)}function HI(e){var t;return!e||!e.state?Mi:(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,GI(e))}function VI(e,t){var r,i;return!e||!e.state||(i=e.state,t<0?(r=0,t=-t):(r=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15))?Mi:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=r,i.wbits=t,HI(e))}function WI(e,t){var r,i;return e?(i=new UI,e.state=i,i.window=null,r=VI(e,t),r!==ja&&(e.state=null),r):Mi}var eg=!0,wh,Ah;function jI(e){if(eg){var t;for(wh=new Int32Array(512),Ah=new Int32Array(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Os(h1,e.lens,0,288,wh,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Os(d1,e.lens,0,32,Ah,0,e.work,{bits:5}),eg=!1}e.lencode=wh,e.lenbits=9,e.distcode=Ah,e.distbits=5}function y1(e,t,r,i){var n,a=e.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),i>=a.wsize?(vo(a.window,t,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(n=a.wsize-a.wnext,n>i&&(n=i),vo(a.window,t,r-i,n,a.wnext),i-=n,i?(vo(a.window,t,r-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=n,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=n))),0}function XI(e,t){var r,i,n,a,o,s,u,c,f,l,h,d,p,v,m=0,g,x,y,b,_,w,A,S,M=new Uint8Array(4),E,T,H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0)return Mi;r=e.state,r.mode===Cn&&(r.mode=bh),o=e.next_out,n=e.output,u=e.avail_out,a=e.next_in,i=e.input,s=e.avail_in,c=r.hold,f=r.bits,l=s,h=u,S=ja;e:for(;;)switch(r.mode){case m1:if(r.wrap===0){r.mode=bh;break}for(;f<16;){if(s===0)break e;s--,c+=i[a++]<<f,f+=8}if(r.wrap&2&&c===35615){r.check=0,M[0]=c&255,M[1]=c>>>8&255,r.check=en(r.check,M,2,0),c=0,f=0,r.mode=Lm;break}if(r.flags=0,r.head&&(r.head.done=!1),!(r.wrap&1)||(((c&255)<<8)+(c>>8))%31){e.msg="incorrect header check",r.mode=sr;break}if((c&15)!==Rm){e.msg="unknown compression method",r.mode=sr;break}if(c>>>=4,f-=4,A=(c&15)+8,r.wbits===0)r.wbits=A;else if(A>r.wbits){e.msg="invalid window size",r.mode=sr;break}r.dmax=1<<A,e.adler=r.check=1,r.mode=c&512?Um:Cn,c=0,f=0;break;case Lm:for(;f<16;){if(s===0)break e;s--,c+=i[a++]<<f,f+=8}if(r.flags=c,(r.flags&255)!==Rm){e.msg="unknown compression method",r.mode=sr;break}if(r.flags&57344){e.msg="unknown header flags set",r.mode=sr;break}r.head&&(r.head.text=c>>8&1),r.flags&512&&(M[0]=c&255,M[1]=c>>>8&255,r.check=en(r.check,M,2,0)),c=0,f=0,r.mode=Om;case Om:for(;f<32;){if(s===0)break e;s--,c+=i[a++]<<f,f+=8}r.head&&(r.head.time=c),r.flags&512&&(M[0]=c&255,M[1]=c>>>8&255,M[2]=c>>>16&255,M[3]=c>>>24&255,r.check=en(r.check,M,4,0)),c=0,f=0,r.mode=Dm;case Dm:for(;f<16;){if(s===0)break e;s--,c+=i[a++]<<f,f+=8}r.head&&(r.head.xflags=c&255,r.head.os=c>>8),r.flags&512&&(M[0]=c&255,M[1]=c>>>8&255,r.check=en(r.check,M,2,0)),c=0,f=0,r.mode=Fm;case Fm:if(r.flags&1024){for(;f<16;){if(s===0)break e;s--,c+=i[a++]<<f,f+=8}r.length=c,r.head&&(r.head.extra_len=c),r.flags&512&&(M[0]=c&255,M[1]=c>>>8&255,r.check=en(r.check,M,2,0)),c=0,f=0}else r.head&&(r.head.extra=null);r.mode=Bm;case Bm:if(r.flags&1024&&(d=r.length,d>s&&(d=s),d&&(r.head&&(A=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),vo(r.head.extra,i,a,d,A)),r.flags&512&&(r.check=en(r.check,i,d,a)),s-=d,a+=d,r.length-=d),r.length))break e;r.length=0,r.mode=Nm;case Nm:if(r.flags&2048){if(s===0)break e;d=0;do A=i[a+d++],r.head&&A&&r.length<65536&&(r.head.name+=String.fromCharCode(A));while(A&&d<s);if(r.flags&512&&(r.check=en(r.check,i,d,a)),s-=d,a+=d,A)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=km;case km:if(r.flags&4096){if(s===0)break e;d=0;do A=i[a+d++],r.head&&A&&r.length<65536&&(r.head.comment+=String.fromCharCode(A));while(A&&d<s);if(r.flags&512&&(r.check=en(r.check,i,d,a)),s-=d,a+=d,A)break e}else r.head&&(r.head.comment=null);r.mode=zm;case zm:if(r.flags&512){for(;f<16;){if(s===0)break e;s--,c+=i[a++]<<f,f+=8}if(c!==(r.check&65535)){e.msg="header crc mismatch",r.mode=sr;break}c=0,f=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=Cn;break;case Um:for(;f<32;){if(s===0)break e;s--,c+=i[a++]<<f,f+=8}e.adler=r.check=$m(c),c=0,f=0,r.mode=Of;case Of:if(r.havedict===0)return e.next_out=o,e.avail_out=u,e.next_in=a,e.avail_in=s,r.hold=c,r.bits=f,FI;e.adler=r.check=1,r.mode=Cn;case Cn:if(t===OI||t===vc)break e;case bh:if(r.last){c>>>=f&7,f-=f&7,r.mode=_h;break}for(;f<3;){if(s===0)break e;s--,c+=i[a++]<<f,f+=8}switch(r.last=c&1,c>>>=1,f-=1,c&3){case 0:r.mode=Gm;break;case 1:if(jI(r),r.mode=mc,t===vc){c>>>=2,f-=2;break e}break;case 2:r.mode=Vm;break;case 3:e.msg="invalid block type",r.mode=sr}c>>>=2,f-=2;break;case Gm:for(c>>>=f&7,f-=f&7;f<32;){if(s===0)break e;s--,c+=i[a++]<<f,f+=8}if((c&65535)!==(c>>>16^65535)){e.msg="invalid stored block lengths",r.mode=sr;break}if(r.length=c&65535,c=0,f=0,r.mode=xh,t===vc)break e;case xh:r.mode=Hm;case Hm:if(d=r.length,d){if(d>s&&(d=s),d>u&&(d=u),d===0)break e;vo(n,i,a,d,o),s-=d,a+=d,u-=d,o+=d,r.length-=d;break}r.mode=Cn;break;case Vm:for(;f<14;){if(s===0)break e;s--,c+=i[a++]<<f,f+=8}if(r.nlen=(c&31)+257,c>>>=5,f-=5,r.ndist=(c&31)+1,c>>>=5,f-=5,r.ncode=(c&15)+4,c>>>=4,f-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=sr;break}r.have=0,r.mode=Wm;case Wm:for(;r.have<r.ncode;){for(;f<3;){if(s===0)break e;s--,c+=i[a++]<<f,f+=8}r.lens[H[r.have++]]=c&7,c>>>=3,f-=3}for(;r.have<19;)r.lens[H[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,E={bits:r.lenbits},S=Os(LI,r.lens,0,19,r.lencode,0,r.work,E),r.lenbits=E.bits,S){e.msg="invalid code lengths set",r.mode=sr;break}r.have=0,r.mode=jm;case jm:for(;r.have<r.nlen+r.ndist;){for(;m=r.lencode[c&(1<<r.lenbits)-1],g=m>>>24,x=m>>>16&255,y=m&65535,!(g<=f);){if(s===0)break e;s--,c+=i[a++]<<f,f+=8}if(y<16)c>>>=g,f-=g,r.lens[r.have++]=y;else{if(y===16){for(T=g+2;f<T;){if(s===0)break e;s--,c+=i[a++]<<f,f+=8}if(c>>>=g,f-=g,r.have===0){e.msg="invalid bit length repeat",r.mode=sr;break}A=r.lens[r.have-1],d=3+(c&3),c>>>=2,f-=2}else if(y===17){for(T=g+3;f<T;){if(s===0)break e;s--,c+=i[a++]<<f,f+=8}c>>>=g,f-=g,A=0,d=3+(c&7),c>>>=3,f-=3}else{for(T=g+7;f<T;){if(s===0)break e;s--,c+=i[a++]<<f,f+=8}c>>>=g,f-=g,A=0,d=11+(c&127),c>>>=7,f-=7}if(r.have+d>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=sr;break}for(;d--;)r.lens[r.have++]=A}}if(r.mode===sr)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=sr;break}if(r.lenbits=9,E={bits:r.lenbits},S=Os(h1,r.lens,0,r.nlen,r.lencode,0,r.work,E),r.lenbits=E.bits,S){e.msg="invalid literal/lengths set",r.mode=sr;break}if(r.distbits=6,r.distcode=r.distdyn,E={bits:r.distbits},S=Os(d1,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,E),r.distbits=E.bits,S){e.msg="invalid distances set",r.mode=sr;break}if(r.mode=mc,t===vc)break e;case mc:r.mode=gc;case gc:if(s>=6&&u>=258){e.next_out=o,e.avail_out=u,e.next_in=a,e.avail_in=s,r.hold=c,r.bits=f,PI(e,h),o=e.next_out,n=e.output,u=e.avail_out,a=e.next_in,i=e.input,s=e.avail_in,c=r.hold,f=r.bits,r.mode===Cn&&(r.back=-1);break}for(r.back=0;m=r.lencode[c&(1<<r.lenbits)-1],g=m>>>24,x=m>>>16&255,y=m&65535,!(g<=f);){if(s===0)break e;s--,c+=i[a++]<<f,f+=8}if(x&&!(x&240)){for(b=g,_=x,w=y;m=r.lencode[w+((c&(1<<b+_)-1)>>b)],g=m>>>24,x=m>>>16&255,y=m&65535,!(b+g<=f);){if(s===0)break e;s--,c+=i[a++]<<f,f+=8}c>>>=b,f-=b,r.back+=b}if(c>>>=g,f-=g,r.back+=g,r.length=y,x===0){r.mode=Km;break}if(x&32){r.back=-1,r.mode=Cn;break}if(x&64){e.msg="invalid literal/length code",r.mode=sr;break}r.extra=x&15,r.mode=Xm;case Xm:if(r.extra){for(T=r.extra;f<T;){if(s===0)break e;s--,c+=i[a++]<<f,f+=8}r.length+=c&(1<<r.extra)-1,c>>>=r.extra,f-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=qm;case qm:for(;m=r.distcode[c&(1<<r.distbits)-1],g=m>>>24,x=m>>>16&255,y=m&65535,!(g<=f);){if(s===0)break e;s--,c+=i[a++]<<f,f+=8}if(!(x&240)){for(b=g,_=x,w=y;m=r.distcode[w+((c&(1<<b+_)-1)>>b)],g=m>>>24,x=m>>>16&255,y=m&65535,!(b+g<=f);){if(s===0)break e;s--,c+=i[a++]<<f,f+=8}c>>>=b,f-=b,r.back+=b}if(c>>>=g,f-=g,r.back+=g,x&64){e.msg="invalid distance code",r.mode=sr;break}r.offset=y,r.extra=x&15,r.mode=Ym;case Ym:if(r.extra){for(T=r.extra;f<T;){if(s===0)break e;s--,c+=i[a++]<<f,f+=8}r.offset+=c&(1<<r.extra)-1,c>>>=r.extra,f-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=sr;break}r.mode=Zm;case Zm:if(u===0)break e;if(d=h-u,r.offset>d){if(d=r.offset-d,d>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=sr;break}d>r.wnext?(d-=r.wnext,p=r.wsize-d):p=r.wnext-d,d>r.length&&(d=r.length),v=r.window}else v=n,p=o-r.offset,d=r.length;d>u&&(d=u),u-=d,r.length-=d;do n[o++]=v[p++];while(--d);r.length===0&&(r.mode=gc);break;case Km:if(u===0)break e;n[o++]=r.length,u--,r.mode=gc;break;case _h:if(r.wrap){for(;f<32;){if(s===0)break e;s--,c|=i[a++]<<f,f+=8}if(h-=u,e.total_out+=h,r.total+=h,h&&(e.adler=r.check=r.flags?en(r.check,n,h,o-h):bd(r.check,n,h,o-h)),h=u,(r.flags?c:$m(c))!==r.check){e.msg="incorrect data check",r.mode=sr;break}c=0,f=0}r.mode=Jm;case Jm:if(r.wrap&&r.flags){for(;f<32;){if(s===0)break e;s--,c+=i[a++]<<f,f+=8}if(c!==(r.total&4294967295)){e.msg="incorrect length check",r.mode=sr;break}c=0,f=0}r.mode=Qm;case Qm:S=DI;break e;case sr:S=p1;break e;case g1:return v1;case NI:default:return Mi}return e.next_out=o,e.avail_out=u,e.next_in=a,e.avail_in=s,r.hold=c,r.bits=f,(r.wsize||h!==e.avail_out&&r.mode<sr&&(r.mode<_h||t!==Im))&&y1(e,e.output,e.next_out,h-e.avail_out),l-=e.avail_in,h-=e.avail_out,e.total_in+=l,e.total_out+=h,r.total+=h,r.wrap&&h&&(e.adler=r.check=r.flags?en(r.check,n,h,e.next_out-h):bd(r.check,n,h,e.next_out-h)),e.data_type=r.bits+(r.last?64:0)+(r.mode===Cn?128:0)+(r.mode===mc||r.mode===xh?256:0),(l===0&&h===0||t===Im)&&S===ja&&(S=BI),S}function qI(e){if(!e||!e.state)return Mi;var t=e.state;return t.window&&(t.window=null),e.state=null,ja}function YI(e,t){var r;return!e||!e.state||(r=e.state,!(r.wrap&2))?Mi:(r.head=t,t.done=!1,ja)}function ZI(e,t){var r=t.length,i,n,a;return!e||!e.state||(i=e.state,i.wrap!==0&&i.mode!==Of)?Mi:i.mode===Of&&(n=1,n=bd(n,t,r,0),n!==i.check)?p1:(a=y1(e,t,r,r),a?(i.mode=g1,v1):(i.havedict=1,ja))}var b1=!0,x1=!0;try{String.fromCharCode.apply(null,[0])}catch{b1=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{x1=!1}var Su=new Uint8Array(256);for(var Kn=0;Kn<256;Kn++)Su[Kn]=Kn>=252?6:Kn>=248?5:Kn>=240?4:Kn>=224?3:Kn>=192?2:1;Su[254]=Su[254]=1;function KI(e){var t,r,i,n,a,o=e.length,s=0;for(n=0;n<o;n++)r=e.charCodeAt(n),(r&64512)===55296&&n+1<o&&(i=e.charCodeAt(n+1),(i&64512)===56320&&(r=65536+(r-55296<<10)+(i-56320),n++)),s+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(s),a=0,n=0;a<s;n++)r=e.charCodeAt(n),(r&64512)===55296&&n+1<o&&(i=e.charCodeAt(n+1),(i&64512)===56320&&(r=65536+(r-55296<<10)+(i-56320),n++)),r<128?t[a++]=r:r<2048?(t[a++]=192|r>>>6,t[a++]=128|r&63):r<65536?(t[a++]=224|r>>>12,t[a++]=128|r>>>6&63,t[a++]=128|r&63):(t[a++]=240|r>>>18,t[a++]=128|r>>>12&63,t[a++]=128|r>>>6&63,t[a++]=128|r&63);return t}function JI(e,t){if(t<65537&&(e.subarray&&x1||!e.subarray&&b1))return String.fromCharCode.apply(null,l1(e,t));for(var r="",i=0;i<t;i++)r+=String.fromCharCode(e[i]);return r}function QI(e){for(var t=new Uint8Array(e.length),r=0,i=t.length;r<i;r++)t[r]=e.charCodeAt(r);return t}function $I(e,t){var r,i,n,a,o=t||e.length,s=new Array(o*2);for(i=0,r=0;r<o;){if(n=e[r++],n<128){s[i++]=n;continue}if(a=Su[n],a>4){s[i++]=65533,r+=a-1;continue}for(n&=a===2?31:a===3?15:7;a>1&&r<o;)n=n<<6|e[r++]&63,a--;if(a>1){s[i++]=65533;continue}n<65536?s[i++]=n:(n-=65536,s[i++]=55296|n>>10&1023,s[i++]=56320|n&1023)}return JI(s,i)}function eR(e,t){var r;for(t=t||e.length,t>e.length&&(t=e.length),r=t-1;r>=0&&(e[r]&192)===128;)r--;return r<0||r===0?t:r+Su[e[r]]>t?r:t}var tg=0,rg=2,yc=4,fo=0,bc=1,tR=2,rR=-5,iR={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function nR(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function aR(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var ig=Object.prototype.toString;function ko(e){if(!(this instanceof ko))return new ko(e);this.options=wI({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new nR,this.strm.avail_out=0;var r=WI(this.strm,t.windowBits);if(r!==fo)throw new Error(iR[r]);this.header=new aR,YI(this.strm,this.header)}ko.prototype.push=function(e,t){var r=this,i=this.strm,n=this.options.chunkSize,a=this.options.dictionary,o,s,u,c,f,l,h=!1;if(this.ended)return!1;s=t===~~t?t:t===!0?yc:tg,typeof e=="string"?i.input=QI(e):ig.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;do{if(i.avail_out===0&&(i.output=new Uint8Array(n),i.next_out=0,i.avail_out=n),o=XI(i,tg),o===tR&&a&&(typeof a=="string"?l=KI(a):ig.call(a)==="[object ArrayBuffer]"?l=new Uint8Array(a):l=a,o=ZI(r.strm,l)),o===rR&&h===!0&&(o=fo,h=!1),o!==bc&&o!==fo)return r.onEnd(o),r.ended=!0,!1;i.next_out&&(i.avail_out===0||o===bc||i.avail_in===0&&(s===yc||s===rg))&&(r.options.to==="string"?(u=eR(i.output,i.next_out),c=i.next_out-u,f=$I(i.output,u),i.next_out=c,i.avail_out=n-c,c&&vo(i.output,i.output,u,c,0),r.onData(f)):r.onData(l1(i.output,i.next_out))),i.avail_in===0&&i.avail_out===0&&(h=!0)}while((i.avail_in>0||i.avail_out===0)&&o!==bc);return o===bc&&(s=yc),s===yc?(o=qI(this.strm),this.onEnd(o),this.ended=!0,o===fo):(s===rg&&(this.onEnd(fo),i.avail_out=0),!0)};ko.prototype.onData=function(e){this.chunks.push(e)};ko.prototype.onEnd=function(e){e===fo&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=AI(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function oR(e,t){var r=new ko(t);if(r.push(e,!0),r.err)throw r.msg;return r.result}function sR(e){var t;e instanceof ArrayBuffer&&(e=new Uint8Array(e));try{t=oR(e)}catch{t=e}return t}Hd.add("gz",sR);var Yu=function(){},uR="//files.rcsb.org/download/",_1="//mmtf.rcsb.org/v1.0/",Sh=_1+"full/",cR=_1+"reduced/",fR=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getUrl=function(i){var n=Or(i),a=n.name.substr(0,4),o;return["pdb","cif"].includes(n.ext)&&(n.compressed===!1||n.compressed==="gz")?o=uR+n.path:n.ext==="mmtf"?n.base.endsWith(".bb")?o=cR+a:o=Sh+a:(n.ext&&fe.warn("unsupported ext",n.ext),o=Sh+a),h0()+o},t.prototype.getExt=function(i){var n=Or(i).ext;return n||"mmtf"},t}(Yu);Vo.add("rcsb",new fR);var ng="//pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/",ag="/SDF?record_type=3d",lR=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getUrl=function(i){var n=Or(i),a=n.name,o;return!n.ext||n.ext==="sdf"||fe.warn("unsupported ext",n.ext),o=ng+a+ag,h0()+o},t.prototype.getExt=function(i){var n=Or(i).ext;return n||"sdf"},t}(Yu);Vo.add("pubchem",new lR);var Lp=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getUrl=function(i){return i},t.prototype.getExt=function(i){return Or(i).ext},t}(Yu);Vo.add("ftp",new Lp);Vo.add("http",new Lp);Vo.add("https",new Lp);var hR=/^((http|https|ftp):)*\/\//;(function(e){function t(r){r===void 0&&(r=""),e.call(this),this.baseUrl=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getUrl=function(i){var n=Or(i),a=this.baseUrl+n.path;return hR.test(this.baseUrl)||(a=G2(a)),a},t.prototype.getExt=function(i){return Or(i).ext},t})(Yu);(function(e){function t(r){r===void 0&&(r=""),e.call(this),this.baseUrl=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getListing=function(i){i===void 0&&(i="");var n=this.baseUrl+"dir/"+i;return n[n.length-1]!=="/"&&(n+="/"),Vd(n,{ext:"json"}).then(function(a){return{path:i,data:a.data}})},t.prototype.getUrl=function(i){var n=Or(i);return this.baseUrl+"file/"+n.path+n.query},t.prototype.getCountUrl=function(i){var n=Or(i);return this.baseUrl+"traj/numframes/"+n.path+n.query},t.prototype.getFrameUrl=function(i,n){var a=Or(i);return this.baseUrl+"traj/frame/"+n+"/"+a.path+a.query},t.prototype.getFrameParams=function(i,n){return"atomIndices="+n.join(";")},t.prototype.getPathUrl=function(i,n){var a=Or(i);return this.baseUrl+"traj/path/"+n+"/"+a.path+a.query},t.prototype.getExt=function(i){return Or(i).ext},t})(Yu);function Mh(){return{type:"boolean"}}function Ch(){return{type:"color"}}function og(e,t){return{type:"integer",max:e,min:t}}function oo(e,t,r){return{type:"number",precision:e,max:t,min:r}}function so(e,t,r){return{type:"range",step:e,max:t,min:r}}function wa(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return{type:"select",options:e.reduce(function(r,i){var n;return Object.assign({},r,(n={},n[i]=i,n))},{})}}Ch(),wa("auto","low","medium","high"),so(1,5,-1),Mh(),Mh(),oo(1,10,0),oo(1,10,0),oo(1,10,0),so(1,100,0),so(1,100,0),og(200,0),wa("scene","camera"),wa("relative","absolute"),so(1,100,0),so(1,100,0),wa("scene","camera"),wa("relative","absolute"),wa("perspective","orthographic","stereo"),oo(3,1,.01),so(1,120,15),Ch(),oo(2,10,0),Ch(),oo(2,10,0),og(1e4,-1),Mh(),wa.apply(void 0,Object.keys(fy));window.Promise||(window.Promise=Mr);let xc,Ss,vR=e=>{const{width:t,height:r}=e;Ss==null&&(Ss=document.createElement("div")),Ss.style.width=t.toString(),Ss.style.height=r.toString(),xc==null&&(xc=new Dt(Ss,{backgroundColor:"white",tooltip:!1}));const i=e.width.toString(),n=e.height.toString();return xc.setSize(i,n),xc},mR=(e,t,r,i,n)=>{const a=r.width.toString(),o=r.height.toString();e.style.width=a,e.style.height=o,e.getBoundingClientRect=()=>new DOMRect(0,0,r.width,r.height);const s=new Dt(e);return s.setSize(a,o),s.loadFile(t,n).then(u=>{s.eachRepresentation(f=>f.dispose()),i.representation&&i.representation!=="default"?u.addRepresentation(i.representation):s.defaultFileRepresentation(u),u.autoView(),s.autoView();const c=u.structure.getPrincipalAxes();return s.animationControls.rotate(c.getRotationQuaternion(),0),u}).catch(u=>{console.log("molecule screenshot error",u)}),s};class dR{constructor(t=6){this.stageListeners=[],this.maxOpenStages=t,this.activeStages=0}requestStage(t){return new Promise(r=>{this.activeStages<this.maxOpenStages?(this.activeStages++,r(this._makeDisposableStage(t))):this.stageListeners.push({resolve:r,domElement:t})})}_disposeStage(t){if(t.__dispose(),this.activeStages--,this.stageListeners.length>0){const r=this.stageListeners.pop();r!=null&&(this.activeStages++,r.resolve(this._makeDisposableStage(r.domElement)))}}_makeDisposableStage(t){const r=new Dt(t);return r.__dispose=r.dispose.bind(r),r.dispose=()=>{this._disposeStage(r)},r}}const pR=new dR;let gR=async(e,t,r,i)=>{const n=document.createElement("div"),a=window.devicePixelRatio;n.getBoundingClientRect=()=>new DOMRect(0,0,t.width*a,t.height*a);const o=t.width.toString(),s=t.height.toString();n.style.width=o,n.style.height=s;const u=await pR.requestStage(n);return u.setSize(o,s),new Promise((c,f)=>u.loadFile(e,i).then(async l=>{r.representation&&r.representation!=="default"?l.addRepresentation(r.representation):u.defaultFileRepresentation(l),l.autoView(),u.autoView();const h=l.structure.getPrincipalAxes();u.animationControls.rotate(h.getRotationQuaternion(),0);const d=await u.makeImage({factor:1});return u.dispose(),c(d)}).catch(l=>{console.log("molecule screenshot error",l)}))};export{vR as getStage,gR as moleculeScreenshot,mR as moleculeStage};
//# sourceMappingURL=nglviewerRender-Ca59ZUZE.js.map
